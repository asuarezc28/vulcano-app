{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{\"2ByA\":function(e,t,r){\"use strict\";r.r(t);var s=r(\"pO5D\"),i=r(\"04ZG\"),n=r(\"975N\"),o=r(\"3r0u\"),a=(r(\"wSAH\"),r(\"f/qv\")),l=r(\"nR38\"),c=r(\"EyXx\"),h=r(\"s7YA\"),u=(r(\"6S2I\"),r(\"zqDF\"),r(\"WbKI\")),d=r(\"zlDU\"),p=r(\"4EHJ\"),f=(r(\"ju1D\"),r(\"9AIY\"),r(\"nYOO\")),v=r(\"9MzC\"),g=r(\"zm0L\"),m=r(\"Lqtk\"),b=r(\"srIe\");function _(e,t,r={}){let s=Object(b.c)(r.expires);if(\"number\"==typeof s){const e=new Date;e.setTime(e.getTime()+24*s*60*60*1e3),s=r.expires=e}\"string\"!=typeof s&&(r.expires=s.toUTCString());let i=e+\"=\"+encodeURIComponent(t);for(const n in r){i+=\"; \"+n;const e=r[n];!0!==e&&(i+=\"=\"+e)}document.cookie=i}var w=r(\"JV2H\"),O=r(\"cCpn\"),I=r(\"dV4Z\"),S=r(\"OWWk\"),y=r(\"Jv1m\"),k=r(\"Ehpe\");const j=\"esri-identity-form__group\",A=\"esri-identity-form__label\",U=\"esri-input\",T=\"esri-button\";let x=class extends k.a{constructor(e,t){super(e,t),this._usernameInputNode=null,this._passwordInputNode=null,this.messages=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:e,server:t,resource:r,signingIn:s,oAuthPrompt:i,messages:n}=this,o=Object(y.a)(\"div\",{class:j},Object(w.a)(i?n.oAuthInfo:n.info,{server:/\\.arcgis\\.com/i.test(t)?\"ArcGIS Online\":t,resource:`(${r||n.lblItem})`})),a=i?null:Object(y.a)(\"div\",{class:j},Object(y.a)(\"label\",{class:A},n.lblUser,Object(y.a)(\"input\",{value:\"\",required:!0,autocomplete:\"off\",spellcheck:!1,type:\"text\",bind:this,afterCreate:O.g,\"data-node-ref\":\"_usernameInputNode\",class:U}))),l=i?null:Object(y.a)(\"div\",{class:j},Object(y.a)(\"label\",{class:A},n.lblPwd,Object(y.a)(\"input\",{value:\"\",required:!0,type:\"password\",bind:this,afterCreate:O.g,\"data-node-ref\":\"_passwordInputNode\",class:U}))),c=Object(y.a)(\"div\",{class:this.classes(j,\"esri-identity-form__footer\")},Object(y.a)(\"input\",{type:\"submit\",disabled:!!s,value:s?n.lblSigning:n.lblOk,class:T}),Object(y.a)(\"input\",{type:\"button\",value:n.lblCancel,bind:this,onclick:this._cancel,class:this.classes(T,\"esri-button--secondary\")})),h=e?Object(y.a)(\"div\",null,e.details&&e.details.httpStatus?n.invalidUser:n.noAuthService):null;return Object(y.a)(\"form\",{class:\"esri-identity-form\",bind:this,onsubmit:this._submit},o,h,a,l,c)}_cancel(){this._set(\"signingIn\",!1),this._usernameInputNode&&(this._usernameInputNode.value=\"\"),this._passwordInputNode&&(this._passwordInputNode.value=\"\"),this.emit(\"cancel\")}_submit(e){e.preventDefault(),this._set(\"signingIn\",!0),this.emit(\"submit\",this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value})}};Object(s.a)([Object(u.b)(),Object(S.a)(),Object(I.a)(\"esri/identity/t9n/identity\")],x.prototype,\"messages\",void 0),Object(s.a)([Object(u.b)(),Object(S.a)()],x.prototype,\"signingIn\",void 0),Object(s.a)([Object(u.b)(),Object(S.a)()],x.prototype,\"server\",void 0),Object(s.a)([Object(u.b)(),Object(S.a)()],x.prototype,\"resource\",void 0),Object(s.a)([Object(u.b)(),Object(S.a)()],x.prototype,\"error\",void 0),Object(s.a)([Object(u.b)(),Object(S.a)()],x.prototype,\"oAuthPrompt\",void 0),x=Object(s.a)([Object(i.a)(\"esri.identity.IdentityForm\")],x);var C,P=x,D=r(\"J3K2\"),R=[\"input\",\"select\",\"textarea\",\"a[href]\",\"button\",\"[tabindex]\",\"audio[controls]\",\"video[controls]\",'[contenteditable]:not([contenteditable=\"false\"])',\"details>summary:first-of-type\",\"details\"],E=R.join(\",\"),N=\"undefined\"==typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,q=function(e){var t=parseInt(e.getAttribute(\"tabindex\"),10);return isNaN(t)?function(e){return\"true\"===e.contentEditable}(e)?0:\"AUDIO\"!==e.nodeName&&\"VIDEO\"!==e.nodeName&&\"DETAILS\"!==e.nodeName||null!==e.getAttribute(\"tabindex\")?e.tabIndex:0:t},L=function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex},F=function(e){return\"INPUT\"===e.tagName},B=function(e){return!(e.disabled||function(e){return F(e)&&\"hidden\"===e.type}(e)||function(e){if(\"hidden\"===getComputedStyle(e).visibility)return!0;var t=N.call(e,\"details>summary:first-of-type\");if(N.call(t?e.parentElement:e,\"details:not([open]) *\"))return!0;for(;e;){if(\"none\"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}(e)||function(e){return\"DETAILS\"===e.tagName&&Array.prototype.slice.apply(e.children).some(function(e){return\"SUMMARY\"===e.tagName})}(e))},z=function(e){return!(!B(e)||function(e){return function(e){return F(e)&&\"radio\"===e.type}(e)&&!function(e){if(!e.name)return!0;var t,r=e.form||e.ownerDocument,s=function(e){return r.querySelectorAll('input[type=\"radio\"][name=\"'+e+'\"]')};if(\"undefined\"!=typeof window&&void 0!==window.CSS&&\"function\"==typeof window.CSS.escape)t=s(window.CSS.escape(e.name));else try{t=s(e.name)}catch(n){return console.error(\"Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s\",n.message),!1}var i=function(e,t){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===t)return e[r]}(t,e.form);return!i||i===e}(e)}(e)||q(e)<0)},H=R.concat(\"iframe\").join(\",\"),V=function(e){if(!e)throw new Error(\"No node provided\");return!1!==N.call(e,H)&&B(e)};function G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}var M,W=(M=[],{activateTrap:function(e){if(M.length>0){var t=M[M.length-1];t!==e&&t.pause()}var r=M.indexOf(e);-1===r||M.splice(r,1),M.push(e)},deactivateTrap:function(e){var t=M.indexOf(e);-1!==t&&M.splice(t,1),M.length>0&&M[M.length-1].unpause()}}),$=function(e){return setTimeout(e,0)},Y=function(e,t){var r=-1;return e.every(function(e,s){return!t(e)||(r=s,!1)}),r};const K=\"esri-identity-modal__content\";let X=class extends k.a{constructor(e,t){super(e,t),this.container=document.createElement(\"div\"),this.content=null,this.open=!1,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.own(this.watch(\"open\",()=>this._toggleFocusTrap()))}destroy(){this._destroyFocusTrap()}render(){const e=this.id,{open:t,content:r,title:s,messages:i}=this,n=t&&!!r,o={\"esri-identity-modal--open\":n,\"esri-identity-modal--closed\":!n},a=Object(y.a)(\"button\",{class:\"esri-identity-modal__close-button\",\"aria-label\":i.close,title:i.close,bind:this,onclick:this._close},Object(y.a)(\"span\",{\"aria-hidden\":\"true\",class:\"esri-icon-close\"})),l=e+\"_title\",c=e+\"_content\",h=s?Object(y.a)(\"h1\",{id:l,class:\"esri-identity-modal__title\"},s):null,u=n?Object(y.a)(\"div\",{bind:this,class:\"esri-identity-modal__dialog\",role:\"dialog\",\"aria-labelledby\":l,\"aria-describedby\":c,afterCreate:this._createFocusTrap},a,h,this._renderContent(c)):null;return Object(y.a)(\"div\",{tabIndex:-1,class:this.classes(\"esri-identity-modal\",o)},u)}_destroyFocusTrap(){var e;null==(e=this._focusTrap)||e.deactivate({onDeactivate:null}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:e,open:t}=this;e&&(t?e.activate():e.deactivate())}_createFocusTrap(e){this._destroyFocusTrap(),requestAnimationFrame(()=>{var t,r,s,i,n,o,a,l,c,h,u,d,p,f,v,g;this._focusTrap=(t=e,s=document,i=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach(function(t){G(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},{initialFocus:\"input\",onDeactivate:this._close}),n={containers:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1},o=function(e){return n.containers.some(function(t){return t.contains(e)})},a=function(e){var t=i[e];if(!t)return null;var r=t;if(\"string\"==typeof t&&!(r=s.querySelector(t)))throw new Error(\"`\".concat(e,\"` refers to no known node\"));if(\"function\"==typeof t&&!(r=t()))throw new Error(\"`\".concat(e,\"` did not return a node\"));return r},l=function(){var e;if(null!==a(\"initialFocus\"))e=a(\"initialFocus\");else if(o(s.activeElement))e=s.activeElement;else{var t=n.tabbableGroups[0];e=t&&t.firstTabbableNode||a(\"fallbackFocus\")}if(!e)throw new Error(\"Your focus-trap needs to have at least one focusable element\");return e},c=function(){if(n.tabbableGroups=n.containers.map(function(e){var t,r,s,i,n,o,a,l=(r=[],s=[],(i=e,n=(t=t||{}).includeContainer,o=z,a=Array.prototype.slice.apply(i.querySelectorAll(E)),n&&N.call(i,E)&&a.unshift(i),a.filter(o)).forEach(function(e,t){var i=q(e);0===i?r.push(e):s.push({documentOrder:t,tabIndex:i,node:e})}),s.sort(L).map(function(e){return e.node}).concat(r));if(l.length>0)return{firstTabbableNode:l[0],lastTabbableNode:l[l.length-1]}}).filter(function(e){return!!e}),n.tabbableGroups.length<=0&&!a(\"fallbackFocus\"))throw new Error(\"Your focus-trap must have at least one container with at least one tabbable node in it at all times\")},h=function e(t){t!==s.activeElement&&(t&&t.focus?(t.focus({preventScroll:!!i.preventScroll}),n.mostRecentlyFocusedNode=t,function(e){return e.tagName&&\"input\"===e.tagName.toLowerCase()&&\"function\"==typeof e.select}(t)&&t.select()):e(l()))},u=function(e){o(e.target)||(i.clickOutsideDeactivates?r.deactivate({returnFocus:i.returnFocusOnDeactivate&&!V(e.target)}):i.allowOutsideClick&&(\"boolean\"==typeof i.allowOutsideClick?i.allowOutsideClick:i.allowOutsideClick(e))||e.preventDefault())},d=function(e){var t=o(e.target);t||e.target instanceof Document?t&&(n.mostRecentlyFocusedNode=e.target):(e.stopImmediatePropagation(),h(n.mostRecentlyFocusedNode||l()))},p=function(e){if(!1!==i.escapeDeactivates&&function(e){return\"Escape\"===e.key||\"Esc\"===e.key||27===e.keyCode}(e))return e.preventDefault(),void r.deactivate();(function(e){return\"Tab\"===e.key||9===e.keyCode})(e)&&function(e){c();var t=null;if(n.tabbableGroups.length>0)if(e.shiftKey){var r=Y(n.tabbableGroups,function(t){return e.target===t.firstTabbableNode});r>=0&&(t=n.tabbableGroups[0===r?n.tabbableGroups.length-1:r-1].lastTabbableNode)}else{var s=Y(n.tabbableGroups,function(t){return e.target===t.lastTabbableNode});s>=0&&(t=n.tabbableGroups[s===n.tabbableGroups.length-1?0:s+1].firstTabbableNode)}else t=a(\"fallbackFocus\");t&&(e.preventDefault(),h(t))}(e)},f=function(e){i.clickOutsideDeactivates||o(e.target)||i.allowOutsideClick&&(\"boolean\"==typeof i.allowOutsideClick?i.allowOutsideClick:i.allowOutsideClick(e))||(e.preventDefault(),e.stopImmediatePropagation())},v=function(){if(n.active)return W.activateTrap(r),C=i.delayInitialFocus?$(function(){h(l())}):h(l()),s.addEventListener(\"focusin\",d,!0),s.addEventListener(\"mousedown\",u,{capture:!0,passive:!1}),s.addEventListener(\"touchstart\",u,{capture:!0,passive:!1}),s.addEventListener(\"click\",f,{capture:!0,passive:!1}),s.addEventListener(\"keydown\",p,{capture:!0,passive:!1}),r},g=function(){if(n.active)return s.removeEventListener(\"focusin\",d,!0),s.removeEventListener(\"mousedown\",u,!0),s.removeEventListener(\"touchstart\",u,!0),s.removeEventListener(\"click\",f,!0),s.removeEventListener(\"keydown\",p,!0),r},(r={activate:function(e){if(n.active)return this;c(),n.active=!0,n.paused=!1,n.nodeFocusedBeforeActivation=s.activeElement;var t=e&&e.onActivate?e.onActivate:i.onActivate;return t&&t(),v(),this},deactivate:function(e){if(!n.active)return this;clearTimeout(C),g(),n.active=!1,n.paused=!1,W.deactivateTrap(r);var t=e&&void 0!==e.onDeactivate?e.onDeactivate:i.onDeactivate;return t&&t(),(e&&void 0!==e.returnFocus?e.returnFocus:i.returnFocusOnDeactivate)&&$(function(){var e;h((e=n.nodeFocusedBeforeActivation,a(\"setReturnFocus\")||e))}),this},pause:function(){return n.paused||!n.active||(n.paused=!0,g()),this},unpause:function(){return n.paused&&n.active?(n.paused=!1,c(),v(),this):this},updateContainerElements:function(e){var t=[].concat(e).filter(Boolean);return n.containers=t.map(function(e){return\"string\"==typeof e?s.querySelector(e):e}),n.active&&c(),this}}).updateContainerElements(t),r),this._toggleFocusTrap()})}_renderContent(e){const t=this.content;return\"string\"==typeof t?Object(y.a)(\"div\",{class:K,id:e,innerHTML:t}):Object(D.b)(t)?Object(y.a)(\"div\",{class:K,id:e},t.render()):t instanceof HTMLElement?Object(y.a)(\"div\",{class:K,id:e,bind:t,afterCreate:this._attachToNode}):null}_attachToNode(e){e.appendChild(this)}};Object(s.a)([Object(u.b)({readOnly:!0})],X.prototype,\"container\",void 0),Object(s.a)([Object(u.b)(),Object(S.a)()],X.prototype,\"content\",void 0),Object(s.a)([Object(u.b)(),Object(S.a)()],X.prototype,\"open\",void 0),Object(s.a)([Object(u.b)(),Object(S.a)(),Object(I.a)(\"esri/t9n/common\")],X.prototype,\"messages\",void 0),Object(s.a)([Object(u.b)({aliasOf:\"messages.auth.signIn\"}),Object(S.a)()],X.prototype,\"title\",void 0),X=Object(s.a)([Object(i.a)(\"esri.identity.IdentityModal\")],X);var Z=X;class Q{constructor(e,t){this.oAuthInfo=null,this.storage=null,this.appId=null,this.expires=null,this.ssl=null,this.token=null,this.userId=null,this.oAuthInfo=e,this.storage=t,this._init()}isValid(){let e=!1;if(this.oAuthInfo&&this.token&&this.userId){const t=Date.now();this.expires>t&&(this.expires-t)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}return e}save(){if(!this.storage)return;const e=this._load(),t=this.oAuthInfo;if(t&&t.authNamespace&&t.portalUrl){let r=e[t.authNamespace];r||(r=e[t.authNamespace]={}),r[t.portalUrl]={appId:this.appId=t.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem(\"esriJSAPIOAuth\",JSON.stringify(e))}catch(e){console.log(e)}}}destroy(){const e=this._load(),t=this.oAuthInfo;if(t&&t.appId&&t.portalUrl&&this.token&&this.expires>Date.now()){const e=t.portalUrl.replace(/^http:/i,\"https:\")+\"/sharing/rest/oauth2/revokeToken\",r=new FormData;if(r.append(\"f\",\"json\"),r.append(\"auth_token\",this.token),r.append(\"client_id\",t.appId),r.append(\"token_type_hint\",\"access_token\"),\"function\"==typeof navigator.sendBeacon)navigator.sendBeacon(e,r);else{const t=new XMLHttpRequest;t.open(\"POST\",e),t.send(r)}}if(t&&t.authNamespace&&t.portalUrl&&this.storage){const r=e[t.authNamespace];if(r){delete r[t.portalUrl];try{this.storage.setItem(\"esriJSAPIOAuth\",JSON.stringify(e))}catch(e){console.log(e)}}}t&&(t._oAuthCred=null,this.oAuthInfo=null)}_init(){const e=this._load(),t=this.oAuthInfo;if(t&&t.authNamespace&&t.portalUrl){let r=e[t.authNamespace];r&&(r=r[t.portalUrl],r&&(this.appId=r.appId,this.expires=r.expires,this.ssl=r.ssl,this.token=r.token,this.userId=r.userId))}}_load(){let e={};if(this.storage){const t=this.storage.getItem(\"esriJSAPIOAuth\");if(t)try{e=JSON.parse(t)}catch(e){console.log(e)}}return e}}Q.prototype.declaredClass=\"esri.identity.OAuthCredential\";var ee,te=Q,re=r(\"ag7Y\");let se=ee=class extends re.a{constructor(e){super(e),this._oAuthCred=null,this.appId=null,this.authNamespace=\"/\",this.expiration=20160,this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl=\"oauth-callback.html\",this.popupWindowFeatures=\"height=490,width=800,resizable,scrollbars,status\",this.portalUrl=\"https://www.arcgis.com\",this.preserveUrlHash=!1,this.userId=null}clone(){return ee.fromJSON(this.toJSON())}};Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"appId\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"authNamespace\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"expiration\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"forceLogin\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"forceUserId\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"locale\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"minTimeUntilExpiration\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"popup\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"popupCallbackUrl\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"popupWindowFeatures\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"portalUrl\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"preserveUrlHash\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],se.prototype,\"userId\",void 0),se=ee=Object(s.a)([Object(i.a)(\"esri.identity.OAuthInfo\")],se);var ie=se;let ne=class extends re.a{constructor(e){super(e),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};Object(s.a)([Object(u.b)({json:{write:!0}})],ne.prototype,\"adminTokenServiceUrl\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],ne.prototype,\"currentVersion\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],ne.prototype,\"hasPortal\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],ne.prototype,\"hasServer\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],ne.prototype,\"owningSystemUrl\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],ne.prototype,\"owningTenant\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],ne.prototype,\"server\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],ne.prototype,\"shortLivedTokenValidity\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],ne.prototype,\"tokenServiceUrl\",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],ne.prototype,\"webTierAuth\",void 0),ne=Object(s.a)([Object(i.a)(\"esri.identity.ServerInfo\")],ne);var oe=ne;const ae={},le=e=>{const t=new p.a(e.owningSystemUrl).host,r=new p.a(e.server).host,s=/.+\\.arcgis\\.com$/i;return s.test(t)&&s.test(r)},ce=(e,t)=>!!(le(e)&&t&&t.some(t=>t.test(e.server)));let he=class extends g.a{constructor(){super(),this._portalConfig=o.a.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this.defaultOAuthInfo=null,this.defaultTokenValidity=60,this.dialog=null,this.formConstructor=P,this.tokenValidity=null,this.signInPage=null,this.useSignInPage=!0,this.normalizeWebTierAuth=!1,this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthHash=null,this._gwTokenUrl=\"/sharing/rest/generateToken\",this._agsRest=\"/rest/services\",this._agsPortal=/\\/sharing(\\/|$)/i,this._agsAdmin=/(https?:\\/\\/[^\\/]+\\/[^\\/]+)\\/admin\\/?(\\/.*)?$/i,this._adminSvcs=/\\/rest\\/admin\\/services(\\/|$)/i,this._gwDomains=[{regex:/^https?:\\/\\/www\\.arcgis\\.com/i,customBaseUrl:\"maps.arcgis.com\",tokenServiceUrl:\"https://www.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:dev|[a-z\\d-]+\\.mapsdev)\\.arcgis\\.com/i,customBaseUrl:\"mapsdev.arcgis.com\",tokenServiceUrl:\"https://dev.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:devext|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,customBaseUrl:\"mapsdevext.arcgis.com\",tokenServiceUrl:\"https://devext.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:qaext|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i,customBaseUrl:\"mapsqa.arcgis.com\",tokenServiceUrl:\"https://qaext.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/[a-z\\d-]+\\.maps\\.arcgis\\.com/i,customBaseUrl:\"maps.arcgis.com\",tokenServiceUrl:\"https://www.arcgis.com/sharing/rest/generateToken\"}],this._legacyFed=[],this._regexSDirUrl=/http.+\\/rest\\/services\\/?/gi,this._regexServerType=/(\\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi,this._gwUser=/http.+\\/users\\/([^\\/]+)\\/?.*/i,this._gwItem=/http.+\\/items\\/([^\\/]+)\\/?.*/i,this._gwGroup=/http.+\\/groups\\/([^\\/]+)\\/?.*/i,this._rePortalTokenSvc=/\\/sharing(\\/rest)?\\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthHash(),window.addEventListener(\"pageshow\",e=>{this._pageShowHandler(e)})}registerServers(e){const t=this.serverInfos;t?(e=e.filter(e=>!this.findServerInfo(e.server)),this.serverInfos=t.concat(e)):this.serverInfos=e,e.forEach(e=>{e.owningSystemUrl&&this._portals.push(e.owningSystemUrl),e.hasPortal&&this._portals.push(e.server)})}registerOAuthInfos(e){const t=this.oAuthInfos;t?(e=e.filter(e=>!this.findOAuthInfo(e.portalUrl)),this.oAuthInfos=t.concat(e)):this.oAuthInfos=e}registerToken(e){e={...e};const t=this._sanitizeUrl(e.server),r=this._isServerRsrc(t);let s,i=this.findServerInfo(t),n=!0;i||(i=new oe,i.server=this._getServerInstanceRoot(t),r?i.hasServer=!0:(i.tokenServiceUrl=this._getTokenSvcUrl(t),i.hasPortal=!0),this.registerServers([i])),s=this._findCredential(t),s?(delete e.server,Object(a.d)(s,e),n=!1):(s=new ue({userId:e.userId,server:i.server,token:e.token,expires:e.expires,ssl:e.ssl,scope:r?\"server\":\"portal\"}),s.resources=[t],this.credentials.push(s)),s.emitTokenChange(!1),n||s.refreshServerTokens()}toJSON(){return Object(a.c)({serverInfos:this.serverInfos.map(e=>e.toJSON()),oAuthInfos:this.oAuthInfos.map(e=>e.toJSON()),credentials:this.credentials.map(e=>e.toJSON())})}initialize(e){if(!e)return;\"string\"==typeof e&&(e=JSON.parse(e));const t=e.serverInfos,r=e.oAuthInfos,s=e.credentials;if(t){const e=[];t.forEach(t=>{t.server&&t.tokenServiceUrl&&e.push(t.declaredClass?t:new oe(t))}),e.length&&this.registerServers(e)}if(r){const e=[];r.forEach(t=>{t.appId&&e.push(t.declaredClass?t:new ie(t))}),e.length&&this.registerOAuthInfos(e)}s&&s.forEach(e=>{e.server&&e.token&&e.expires&&e.expires>Date.now()&&((e=e.declaredClass?e:new ue(e)).emitTokenChange(),this.credentials.push(e))})}findServerInfo(e){let t;e=this._sanitizeUrl(e);for(const r of this.serverInfos)if(this._hasSameServerInstance(r.server,e)){t=r;break}return t}findOAuthInfo(e){let t;e=this._sanitizeUrl(e);for(const r of this.oAuthInfos)if(this._hasSameServerInstance(r.portalUrl,e)){t=r;break}return t}findCredential(e,t){let r,s;if(e=this._sanitizeUrl(e),s=this._isServerRsrc(e)?\"server\":\"portal\",t){for(const i of this.credentials)if(this._hasSameServerInstance(i.server,e)&&t===i.userId&&i.scope===s){r=i;break}}else for(const i of this.credentials)if(this._hasSameServerInstance(i.server,e)&&-1!==this._getIdenticalSvcIdx(e,i)&&i.scope===s){r=i;break}return r}getCredential(e,t){let r,s,i=!0;t&&(r=!!t.token,s=t.error,i=!1!==t.prompt),t={...t},e=this._sanitizeUrl(e);const n=Object(v.d)(),o=Object(v.g)();if(t.signal&&Object(v.r)(t.signal,()=>{n.abort()}),Object(v.r)(n,()=>{o.reject(new d.a(\"identity-manager:user-aborted\",\"ABORTED\"))}),Object(v.o)(n))return o.promise;t.signal=n.signal;const a=this._isAdminResource(e),l=r&&this._doPortalSignIn(e)?this._getEsriAuthCookie():null,c=r?this.findCredential(e):null;let h;if(c&&s&&s.details&&498===s.details.httpStatus)c.destroy(),l&&l.token===t.token&&(_(\"esri_auth\",null,{expires:-1,path:\"/\",domain:document.domain}),window.location.hostname.endsWith(\".arcgis.com\")&&_(\"esri_auth\",null,{expires:-1,path:\"/\",domain:\"arcgis.com\"}));else if(l||c)return h=new d.a(\"identity-manager:not-authorized\",\"You are currently signed in as: '\"+(l&&l.email||c&&c.userId)+\"'. You do not have access to this resource: \"+e,{error:s}),o.reject(h),o.promise;const u=this._findCredential(e,t);if(u)return o.resolve(u),o.promise;let p=this.findServerInfo(e);if(p)!p.hasServer&&this._isServerRsrc(e)&&(p._restInfoPms=this._getTokenSvcUrl(e),p.hasServer=!0);else{const t=this._getTokenSvcUrl(e);if(!t)return h=new d.a(\"identity-manager:unknown-resource\",\"Unknown resource - could not find token service endpoint.\"),o.reject(h),o.promise;p=new oe,p.server=this._getServerInstanceRoot(e),\"string\"==typeof t?(p.tokenServiceUrl=t,p.hasPortal=!0):(p._restInfoPms=t,p.hasServer=!0),this.registerServers([p])}return i&&p.hasPortal&&void 0===p._selfReq&&!this._findOAuthInfo(e)&&(p._selfReq={owningTenant:t&&t.owningTenant,selfDfd:this._getPortalSelf(p.tokenServiceUrl.replace(this._rePortalTokenSvc,\"/sharing/rest/portals/self\"),e)}),this._enqueue(e,p,t,o,a)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,\"\").replace(this._regexServerType,\"\")||\"\":this._gwUser.test(e)&&e.replace(this._gwUser,\"$1\")||this._gwItem.test(e)&&e.replace(this._gwItem,\"$1\")||this._gwGroup.test(e)&&e.replace(this._gwGroup,\"$1\")||\"\"}generateToken(e,t,r){const s=this._rePortalTokenSvc.test(e.tokenServiceUrl),i=new p.a(window.location.href.toLowerCase()),n=this._getEsriAuthCookie(),o=e.shortLivedTokenValidity;let l,c,h,u,f,v,g,b,_,w;return t&&(w=this.tokenValidity||o||this.defaultTokenValidity,w>o&&o>0&&(w=o)),r&&(c=r.isAdmin,h=r.serverUrl,u=r.token,g=r.signal,b=r.ssl,e.customParameters=r.customParameters),c?f=e.adminTokenServiceUrl:(f=e.tokenServiceUrl,v=new p.a(f.toLowerCase()),n&&(l=n.auth_tier,l=l&&l.toLowerCase()),(\"web\"===l||e.webTierAuth)&&r&&r.serverUrl&&!b&&\"http\"===i.scheme&&(Object(p.q)(i.uri,f,!0)||\"https\"===v.scheme&&i.host===v.host&&\"7080\"===i.port&&\"7443\"===v.port)&&(f=f.replace(/^https:/i,\"http:\").replace(/:7443/i,\":7080\"))),_=Object(a.d)({query:Object(a.d)({request:\"getToken\",username:t&&t.username,password:t&&t.password,serverUrl:h,token:u,expiration:w,referer:c||s?window.location.host:null,client:c?\"referer\":null,f:\"json\"},e.customParameters),method:\"post\",authMode:\"anonymous\",useProxy:this._useProxy(e,r),signal:g},r&&r.ioArgs),s||(_.withCredentials=!1),Object(m.default)(f,_).then(r=>{const s=r.data;if(!s||!s.token)return new d.a(\"identity-manager:authentication-failed\",\"Unable to generate token\");const i=e.server;return ae[i]||(ae[i]={}),t&&(ae[i][t.username]=t.password),s.validity=w,s})}isBusy(){return!!this._busy}checkSignInStatus(e){return this.checkAppAccess(e,\"\").then(e=>e.credential)}checkAppAccess(e,t,r){let s=!1;return this.getCredential(e,{prompt:!1}).then(i=>{let n;const o={f:\"json\"};if(\"portal\"===i.scope)if(t&&(this._doPortalSignIn(e,!0)||r&&r.force))n=i.server+\"/sharing/rest/oauth2/validateAppAccess\",o.client_id=t;else{if(!i.token)return{credential:i};n=i.server+\"/sharing/rest\"}else{if(!i.token)return{credential:i};n=i.server+\"/rest/services\"}return i.token&&(o.token=i.token),Object(m.default)(n,{query:o,authMode:\"anonymous\"}).then(e=>{if(!1===e.data.valid)throw new d.a(\"identity-manager:not-authorized\",`You are currently signed in as: '${i.userId}'.`,e.data);return s=!!e.data.viewOnlyUserTypeApp,{credential:i}}).catch(e=>{if(\"identity-manager:not-authorized\"===e.name)throw e;const t=e.details&&e.details.httpStatus;if(498===t)throw i.destroy(),new d.a(\"identity-manager:not-authenticated\",\"User is not signed in.\");if(400===t)throw new d.a(\"identity-manager:invalid-request\");return{credential:i}})}).then(e=>({credential:e.credential,viewOnly:s}))}setOAuthResponseHash(e){var t;const r=this._oAuthDfd;if(this._oAuthDfd=null,!r||!e)return;clearInterval(this._oAuthIntervalId),null==(t=this._oAuthOnHashHandle)||t.remove(),\"#\"===e.charAt(0)&&(e=e.substring(1));const s=Object(p.D)(e);if(s.error){const e=\"access_denied\"===s.error,t=new d.a(e?\"identity-manager:user-aborted\":\"identity-manager:authentication-failed\",e?\"ABORTED\":\"OAuth: \"+s.error+\" - \"+s.error_description);r.reject(t)}else{const e=r.oinfo_,t=e._oAuthCred,i=new ue({userId:s.username,server:r.sinfo_.server,token:s.access_token,expires:Date.now()+1e3*Number(s.expires_in),ssl:\"true\"===s.ssl,_oAuthCred:t});e.userId=i.userId,t.storage=s.persist?window.localStorage:window.sessionStorage,t.token=i.token,t.expires=i.expires,t.userId=i.userId,t.ssl=i.ssl,t.save(),r.resolve(i)}}setRedirectionHandler(e){this._redirectFunc=e}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,t,r={}){const s=Object(v.g)(),i=()=>{var e,t,r,s,i;null==(e=a)||e.remove(),null==(t=l)||t.remove(),null==(r=c)||r.remove(),null==(s=o)||s.destroy(),null==(i=this.dialog)||i.destroy(),this.dialog=o=a=l=c=null},n=()=>{i(),this._oAuthDfd=null,s.reject(new d.a(\"identity-manager:user-aborted\",\"ABORTED\"))};r.signal&&Object(v.r)(r.signal,()=>{n()});let o=new this.formConstructor;o.resource=this.getResourceName(e),o.server=t.server,this.dialog=new Z,this.dialog.content=o,this.dialog.open=!0,this.emit(\"dialog-create\");let a=o.on(\"cancel\",n),l=this.dialog.watch(\"open\",n),c=o.on(\"submit\",e=>{this.generateToken(t,e,{isAdmin:r.isAdmin,signal:r.signal}).then(n=>{i();const o=new ue({userId:e.username,server:t.server,token:n.token,expires:null!=n.expires?Number(n.expires):null,ssl:!!n.ssl,isAdmin:r.isAdmin,validity:n.validity});s.resolve(o)}).catch(e=>{o.error=e,o.signingIn=!1})});return s.promise}oAuthSignIn(e,t,r,s){this._oAuthDfd=Object(v.g)();const i=this._oAuthDfd;if(null!=s&&s.signal&&Object(v.r)(s.signal,()=>{const e=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;e&&!e.closed?e.close():this.dialog&&o()}),i.resUrl_=e,i.sinfo_=t,i.oinfo_=r,!r.popup||s&&!1===s.oAuthPopupConfirmation)return this._doOAuthSignIn(e,t,r),i.promise;const n=new this.formConstructor;n.oAuthPrompt=!0,n.server=t.server,this.dialog=new Z,this.dialog.content=n,this.dialog.open=!0,this.emit(\"dialog-create\");const o=()=>{h(),this._oAuthDfd=null,i.reject(new d.a(\"identity-manager:user-aborted\",\"ABORTED\"))},a=n.on(\"cancel\",o),l=this.dialog.watch(\"open\",o),c=n.on(\"submit\",()=>{h(),this._doOAuthSignIn(e,t,r)}),h=()=>{a.remove(),l.remove(),c.remove(),n.destroy(),this.dialog.destroy(),this.dialog=null};return i.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach(e=>{e.destroy()}),this.emit(\"credentials-destroy\")}_getOAuthHash(){let e=window.location.hash;if(e){\"#\"===e.charAt(0)&&(e=e.substring(1));const t=Object(p.D)(e);let r=!1;t.access_token&&t.expires_in&&t.state&&t.hasOwnProperty(\"username\")?(t.state=JSON.parse(t.state),this._oAuthHash=t,r=!0):t.error&&t.error_description&&(console.log(\"IdentityManager OAuth Error: \",t.error,\" - \",t.error_description),\"access_denied\"===t.error&&(r=!0)),r&&(window.location.hash=\"object\"==typeof t.state&&t.state.hash||\"\")}}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const e=new d.a(\"identity-manager:user-aborted\",\"ABORTED\");this._errbackFunc(e)}}_findCredential(e,t){let r,s,i,n,o=-1;const a=t&&t.token,l=t&&t.resource,c=this._isServerRsrc(e)?\"server\":\"portal\",h=this.credentials.filter(t=>this._hasSameServerInstance(t.server,e)&&t.scope===c);if(e=l||e,h.length)if(1===h.length){if(r=h[0],n=this.findServerInfo(r.server),s=n&&n.owningSystemUrl,i=s&&this.findCredential(s,r.userId),o=this._getIdenticalSvcIdx(e,r),!a)return-1===o&&r.resources.push(e),this._addResource(e,i),r;-1!==o&&(r.resources.splice(o,1),this._removeResource(e,i))}else{let t,r;if(h.some(a=>(r=this._getIdenticalSvcIdx(e,a),-1!==r&&(t=a,n=this.findServerInfo(t.server),s=n&&n.owningSystemUrl,i=s&&this.findCredential(s,t.userId),o=r,!0))),a)t&&(t.resources.splice(o,1),this._removeResource(e,i));else if(t)return this._addResource(e,i),t}}_findOAuthInfo(e){let t=this.findOAuthInfo(e);if(!t)for(const r of this.oAuthInfos)if(this._isIdProvider(r.portalUrl,e)){t=r;break}return t}_addResource(e,t){t&&-1===this._getIdenticalSvcIdx(e,t)&&t.resources.push(e)}_removeResource(e,t){let r=-1;t&&(r=this._getIdenticalSvcIdx(e,t),r>-1&&t.resources.splice(r,1))}_useProxy(e,t){return t&&t.isAdmin&&!Object(p.q)(e.adminTokenServiceUrl,window.location.href)||!this._isPortalDomain(e.tokenServiceUrl)&&\"10.1\"===String(e.currentVersion)&&!Object(p.q)(e.tokenServiceUrl,window.location.href)}_getOrigin(e){const t=new p.a(e);return t.scheme+\"://\"+t.host+(null!=t.port?\":\"+t.port:\"\")}_getServerInstanceRoot(e){const t=e.toLowerCase();let r=t.indexOf(this._agsRest);return-1===r&&this._isAdminResource(e)&&(r=this._agsAdmin.test(e)?e.replace(this._agsAdmin,\"$1\").length:e.search(this._adminSvcs)),-1===r&&(r=t.indexOf(\"/sharing\")),-1===r&&\"/\"===t.substr(-1)&&(r=t.length-1),r>-1?e.substring(0,r):e}_hasSameServerInstance(e,t){return\"/\"===e.substr(-1)&&(e=e.slice(0,-1)),e=e.toLowerCase(),t=this._getServerInstanceRoot(t).toLowerCase(),e=this._normalizeAGOLorgDomain(e),t=this._normalizeAGOLorgDomain(t),(e=e.substr(e.indexOf(\":\")))===t.substr(t.indexOf(\":\"))}_normalizeAGOLorgDomain(e){const t=/^https?:\\/\\/(?:cdn|[a-z\\d-]+\\.maps)\\.arcgis\\.com/i,r=/^https?:\\/\\/(?:cdndev|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,s=/^https?:\\/\\/(?:cdnqa|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i;return t.test(e)?e=e.replace(t,\"https://www.arcgis.com\"):r.test(e)?e=e.replace(r,\"https://devext.arcgis.com\"):s.test(e)&&(e=e.replace(s,\"https://qaext.arcgis.com\")),e}_sanitizeUrl(e){const t=(c.a.request.proxyUrl||\"\").toLowerCase(),r=t?e.toLowerCase().indexOf(t+\"?\"):-1;return-1!==r&&(e=e.substring(r+t.length+1)),e=Object(p.B)(e),Object(p.I)(e).path}_isRESTService(e){return e.indexOf(this._agsRest)>-1}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,t){let r;if(this._isRESTService(e)&&this._isRESTService(t)){const s=this._getSuffix(e).toLowerCase(),i=this._getSuffix(t).toLowerCase();if(r=s===i,!r){const e=/(.*)\\/(MapServer|FeatureServer).*/gi;r=s.replace(e,\"$1\")===i.replace(e,\"$1\")}}else this._isAdminResource(e)&&this._isAdminResource(t)?r=!0:this._isServerRsrc(e)||this._isServerRsrc(t)||!this._isPortalDomain(e)||(r=!0);return r}_isPortalDomain(e){const t=new p.a(e.toLowerCase()),r=this._portalConfig;let s=this._gwDomains.some(e=>e.regex.test(t.uri));return!s&&r&&(s=this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),t.uri)),s||c.a.portalUrl&&(s=Object(p.q)(t,c.a.portalUrl,!0)),s||(s=this._portals.some(e=>this._hasSameServerInstance(e,t.uri))),s=s||this._agsPortal.test(t.path),s}_isIdProvider(e,t){let r=-1,s=-1;this._gwDomains.forEach((i,n)=>{-1===r&&i.regex.test(e)&&(r=n),-1===s&&i.regex.test(t)&&(s=n)});let i=!1;if(r>-1&&s>-1&&(0===r||4===r?0!==s&&4!==s||(i=!0):1===r?1!==s&&2!==s||(i=!0):2===r?2===s&&(i=!0):3===r&&3===s&&(i=!0)),!i){const r=this.findServerInfo(t),s=r&&r.owningSystemUrl;s&&le(r)&&this._isPortalDomain(s)&&this._isIdProvider(e,s)&&(i=!0)}return i}_getIdenticalSvcIdx(e,t){let r=-1;for(let s=0;s<t.resources.length;s++)if(this._isIdenticalService(e,t.resources[s])){r=s;break}return r}_getSuffix(e){return e.replace(this._regexSDirUrl,\"\").replace(this._regexServerType,\"$1\")}_getTokenSvcUrl(e){let t,r,s;if(this._isRESTService(e)||this._isAdminResource(e)){const s=this._getServerInstanceRoot(e);return t=s+\"/admin/generateToken\",r=Object(m.default)(e=s+\"/rest/info\",{query:{f:\"json\"}}).then(e=>e.data),{adminUrl:t,promise:r}}if(this._isPortalDomain(e)){let t=\"\";if(this._gwDomains.some(r=>(r.regex.test(e)&&(t=r.tokenServiceUrl),!!t)),t||this._portals.some(r=>(this._hasSameServerInstance(r,e)&&(t=r+this._gwTokenUrl),!!t)),t||(s=e.toLowerCase().indexOf(\"/sharing\"),-1!==s&&(t=e.substring(0,s)+this._gwTokenUrl)),t||(t=this._getOrigin(e)+this._gwTokenUrl),t){const r=new p.a(e).port;/^http:\\/\\//i.test(e)&&\"7080\"===r&&(t=t.replace(/:7080/i,\":7443\")),t=t.replace(/http:/i,\"https:\")}return t}if(-1!==e.toLowerCase().indexOf(\"premium.arcgisonline.com\"))return\"https://premium.arcgisonline.com/server/tokens\"}_exchangeToken(e,t,r){return Object(m.default)(e+\"/sharing/rest/oauth2/exchangeToken\",{authMode:\"anonymous\",method:\"post\",query:{f:\"json\",client_id:t,token:r}}).then(e=>e.data.token)}_getPortalSelf(e,t){let r;return this._gwDomains.some(t=>(t.regex.test(e)&&(r=t.customBaseUrl),!!r)),r?Object(v.u)({allSSL:!0,currentVersion:\"4.4\",customBaseUrl:r,portalMode:\"multitenant\",supportsOAuth:!0}):(\"https:\"===window.location.protocol?e=e.replace(/^http:/i,\"https:\").replace(/:7080/i,\":7443\"):/^http:/i.test(t)&&(e=e.replace(/^https:/i,\"http:\").replace(/:7443/i,\":7080\")),Object(m.default)(e,{query:{f:\"json\"},authMode:\"anonymous\",withCredentials:!0}).then(e=>e.data))}_hasPortalSession(){return!!this._getEsriAuthCookie()}_getEsriAuthCookie(){let e=null;if(navigator.cookieEnabled){const t=this._getAllCookies(\"esri_auth\");let r;for(let s=0;s<t.length;s++){const i=JSON.parse(t[s]);if(i.portalApp){e=i;break}r?r.push(i):r=[i]}if(!e&&r)for(const s of r)if(s.urlKey&&window.location.hostname===`${s.urlKey.toLowerCase()}.${s.customBaseUrl}`){e=s;break}}if(e){let t=null;e.expires&&(\"number\"==typeof e.expires?t=e.expires:\"string\"==typeof e.expires&&(t=Date.parse(e.expires)),isNaN(t)&&(t=null),e.expires=t),t&&t<Date.now()&&(e=null)}return e}_getAllCookies(e){const t=[],r=document.cookie.match(new RegExp(\"(?:^|; )\"+Object(h.a)(e)+\"=([^;]*)\",\"g\"));if(r)for(let s=0;s<r.length;s++){let e=r[s];const i=e.indexOf(\"=\");i>-1&&(e=e.substring(i+1),t.push(decodeURIComponent(e)))}return t}_doPortalSignIn(e,t){if(navigator.cookieEnabled){const r=this._getEsriAuthCookie(),s=this._portalConfig,i=window.location.href,n=this.findServerInfo(e);if((t||this.useSignInPage)&&(s||this._isPortalDomain(i)||r)&&(n?n.hasPortal||n.owningSystemUrl&&this._isPortalDomain(n.owningSystemUrl):this._isPortalDomain(e))&&(this._isIdProvider(i,e)||s&&(this._hasSameServerInstance(this._getServerInstanceRoot(s.restBaseUrl),e)||this._isIdProvider(s.restBaseUrl,e))||Object(p.q)(i,e,!0)))return!0}return!1}_canUsePortalSignInWorkflow(e){return this._doPortalSignIn(e)&&(window===window.top||this._hasPortalSession())}_checkProtocol(e,t,r,s){let i=!0;const n=s?t.adminTokenServiceUrl:t.tokenServiceUrl;return 0===n.trim().toLowerCase().indexOf(\"https:\")&&0!==window.location.href.toLowerCase().indexOf(\"https:\")&&Object(p.o)(n)&&(i=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:t}),!i)&&r(new d.a(\"identity-manager:aborted\",\"Aborted the Sign-In process to avoid sending password over insecure connection.\")),i}_enqueue(e,t,r,s,i,n){return s||(s=Object(v.g)()),s.resUrl_=e,s.sinfo_=t,s.options_=r,s.admin_=i,s.refresh_=n,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(s)):this._xoReqs.push(s):this._doSignIn(s),s.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const t=t=>{const r=e.options_&&e.options_.resource,s=e.resUrl_,i=e.refresh_;let n=!1;-1===this.credentials.indexOf(t)&&(i&&-1!==this.credentials.indexOf(i)?(i.userId=t.userId,i.token=t.token,i.expires=t.expires,i.validity=t.validity,i.ssl=t.ssl,i.creationTime=t.creationTime,n=!0,t=i):this.credentials.push(t)),t.resources||(t.resources=[]),t.resources.push(r||s),t.scope=this._isServerRsrc(s)?\"server\":\"portal\",t.emitTokenChange();const o=this._soReqs,a={};this._soReqs=[],o.forEach(e=>{if(!this._isIdenticalService(s,e.resUrl_)){const r=this._getSuffix(e.resUrl_);a[r]||(a[r]=!0,t.resources.push(e.resUrl_))}}),e.resolve(t),o.forEach(e=>{this._hasSameServerInstance(this._getServerInstanceRoot(s),e.resUrl_)?e.resolve(t):this._soReqs.push(e)}),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,n||this.emit(\"credential-create\",{credential:t}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=t=>{e.reject(t),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=(s,i,n,o)=>{const a=e.sinfo_,l=!e.options_||!1!==e.options_.prompt,c=a.hasPortal&&this._findOAuthInfo(e.resUrl_);let h,u;if(this._canUsePortalSignInWorkflow(e.resUrl_)){const s=this._getEsriAuthCookie(),i=this._portalConfig;if(s)return a.webTierAuth||\"web\"===(s.auth_tier&&s.auth_tier.toLowerCase())&&(a.webTierAuth=!0),h=new ue({userId:s.email,server:a.server,token:a.webTierAuth?null:s.token,expires:s.expires}),void(h.token?e._pendingDfd=this._exchangeToken(h.server,c?c.appId:\"arcgisonline\",h.token).then(e=>{h.token=e,t(h)}).catch(()=>{t(h)}):t(h));if(l){let t=\"\";const s=window.location.href;return t=this.signInPage?this.signInPage:i?i.baseUrl+i.signin:this._isIdProvider(s,e.resUrl_)?this._getOrigin(s)+\"/home/signin.html\":a.tokenServiceUrl.replace(this._rePortalTokenSvc,\"\")+\"/home/signin.html\",t=t.replace(/http:/i,\"https:\"),i&&!1===i.useSSL&&(t=t.replace(/https:/i,\"http:\")),void(0===s.toLowerCase().replace(\"https\",\"http\").indexOf(t.toLowerCase().replace(\"https\",\"http\"))?(u=new d.a(\"identity-manager:unexpected-error\",\"Cannot redirect to Sign-In page from within Sign-In page. URL of the resource that triggered this workflow: \"+e.resUrl_),r(u)):(this._rejectOnPersistedPageShow=!0,this._redirectFunc?this._redirectFunc({signInPage:t,returnUrlParamName:\"returnUrl\",returnUrl:s,resourceUrl:e.resUrl_,serverInfo:a}):window.location.href=t+\"?returnUrl=\"+encodeURIComponent(s)))}u=new d.a(\"identity-manager:not-authenticated\",\"User is not signed in.\"),r(u)}else if(s)t(new ue({userId:s,server:a.server,token:n,expires:null!=o?Number(o):null,ssl:!!i}));else if(c){let s=c._oAuthCred;if(!s){const e=new te(c,window.localStorage),t=new te(c,window.sessionStorage);e.isValid()&&t.isValid()?e.expires>t.expires?(s=e,t.destroy()):(s=t,e.destroy()):s=e.isValid()?e:t,c._oAuthCred=s}if(s.isValid())h=new ue({userId:s.userId,server:a.server,token:s.token,expires:s.expires,ssl:s.ssl,_oAuthCred:s}),c.appId!==s.appId&&this._doPortalSignIn(e.resUrl_,!0)?e._pendingDfd=this._exchangeToken(h.server,c.appId,h.token).then(e=>{h.token=e,s.token=e,s.save(),t(h)}).catch(()=>{t(h)}):t(h);else if(this._oAuthHash&&this._oAuthHash.state.portalUrl===c.portalUrl){const e=this._oAuthHash;h=new ue({userId:e.username,server:a.server,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:\"true\"===e.ssl,oAuthState:e.state,_oAuthCred:s}),c.userId=h.userId,s.storage=e.persist?window.localStorage:window.sessionStorage,s.token=h.token,s.expires=h.expires,s.userId=h.userId,s.ssl=h.ssl,s.save(),this._oAuthHash=null,t(h)}else l?e._pendingDfd=this.oAuthSignIn(e.resUrl_,a,c,e.options_).then(t,r):(u=new d.a(\"identity-manager:not-authenticated\",\"User is not signed in.\"),r(u))}else if(l){if(this._checkProtocol(e.resUrl_,a,r,e.admin_)){let s=e.options_;e.admin_&&(s=s||{},s.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,a,s).then(t,r)}}else u=new d.a(\"identity-manager:not-authenticated\",\"User is not signed in.\"),r(u)},i=()=>{const s=e.sinfo_,i=s.owningSystemUrl,n=e.options_;let o,a,l,c;if(n&&(o=n.token,a=n.error,l=n.prompt),c=this._findCredential(i,{token:o,resource:e.resUrl_}),!c)for(const e of this.credentials)if(this._isIdProvider(i,e.server)){c=e;break}if(c){const i=this.findCredential(e.resUrl_,c.userId);if(i)t(i);else if(ce(s,this._legacyFed)){const e=c.toJSON();e.server=s.server,e.resources=null,t(new ue(e))}else(e._pendingDfd=this.generateToken(this.findServerInfo(c.server),null,{serverUrl:e.resUrl_,token:c.token,signal:e.options_.signal,ssl:c.ssl})).then(r=>{t(new ue({userId:c.userId,server:s.server,token:r.token,expires:null!=r.expires?Number(r.expires):null,ssl:!!r.ssl,isAdmin:e.admin_,validity:r.validity}))},r)}else this._busy=null,o&&(e.options_.token=null),(e._pendingDfd=this.getCredential(i.replace(/\\/?$/,\"/sharing\"),{resource:e.resUrl_,owningTenant:s.owningTenant,signal:e.options_.signal,token:o,error:a,prompt:l})).then(()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)},e=>{r(e)})};this._errbackFunc=r;const n=e.sinfo_.owningSystemUrl,o=this._isServerRsrc(e.resUrl_),a=e.sinfo_._restInfoPms;a?a.promise.then(t=>{const r=e.sinfo_;if(r._restInfoPms){r.adminTokenServiceUrl=r._restInfoPms.adminUrl,r._restInfoPms=null,r.tokenServiceUrl=Object(l.b)(\"authInfo.tokenServicesUrl\",t)||Object(l.b)(\"authInfo.tokenServiceUrl\",t)||Object(l.b)(\"tokenServiceUrl\",t),r.shortLivedTokenValidity=Object(l.b)(\"authInfo.shortLivedTokenValidity\",t),r.currentVersion=t.currentVersion,r.owningTenant=t.owningTenant;const e=r.owningSystemUrl=t.owningSystemUrl;e&&this._portals.push(e)}o&&r.owningSystemUrl?i():s()},()=>{e.sinfo_._restInfoPms=null;const t=new d.a(\"identity-manager:server-identification-failed\",\"Unknown resource - could not find token service endpoint.\");r(t)}):o&&n?i():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then(t=>{const r={};let s,i,n,o;return t&&(s=t.user&&t.user.username,r.username=s,r.allSSL=t.allSSL,i=t.supportsOAuth,n=t.currentVersion,\"multitenant\"===t.portalMode&&(o=t.customBaseUrl)),e.sinfo_.webTierAuth=!!s,s&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:r.allSSL}).catch(()=>null).then(e=>(r.portalToken=e&&e.token,r.tokenExpiration=e&&e.expires,r)):!s&&i&&parseFloat(n)>=4.4&&!this._canUsePortalSignInWorkflow(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:o,owningTenant:e.sinfo_._selfReq.owningTenant}).catch(()=>null).then(()=>r):r}).catch(()=>null).then(t=>{e.sinfo_._selfReq=null,t?s(t.username,t.allSSL,t.portalToken,t.tokenExpiration):s()}):s()}_generateOAuthInfo(e){let t,r,s=e.portalUrl;const i=e.customBaseUrl,n=e.owningTenant,o=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(o){r=window.location.href;let e=r.indexOf(\"?\");e>-1&&(r=r.slice(0,e)),e=r.search(/\\/(apps|home)\\//),r=e>-1?r.slice(0,e):null}return o&&r?(this._hasTestedIfAppIsOnPortal=!0,t=Object(m.default)(r+\"/sharing/rest\",{query:{f:\"json\"}}).then(()=>{this.defaultOAuthInfo=new ie({appId:\"arcgisonline\",popup:!0,popupCallbackUrl:r+\"/home/oauth-callback.html\"})})):t=Object(v.u)(),t.then(()=>{if(this.defaultOAuthInfo)return s=s.replace(/^http:/i,\"https:\"),Object(m.default)(s+\"/sharing/rest/oauth2/validateRedirectUri\",{query:{accountId:n,client_id:this.defaultOAuthInfo.appId,redirect_uri:Object(p.y)(this.defaultOAuthInfo.popupCallbackUrl),f:\"json\"}}).then(e=>{if(e.data.valid){const t=this.defaultOAuthInfo.clone();t.portalUrl=e.data.urlKey&&i?\"https://\"+e.data.urlKey.toLowerCase()+\".\"+i:s,this.oAuthInfos.push(t)}})})}_doOAuthSignIn(e,t,r){const s={portalUrl:r.portalUrl};!r.popup&&r.preserveUrlHash&&window.location.hash&&(s.hash=window.location.hash);const i={client_id:r.appId,response_type:\"token\",state:JSON.stringify(s),expiration:r.expiration,locale:r.locale,redirect_uri:r.popup?Object(p.y)(r.popupCallbackUrl):window.location.href.replace(/#.*$/,\"\")};r.forceLogin&&(i.force_login=!0),r.forceUserId&&r.userId&&(i.prepopulatedusername=r.userId);const n=r.portalUrl.replace(/^http:/i,\"https:\")+\"/sharing/oauth2/authorize\",a=n+\"?\"+Object(p.C)(i);if(r.popup){const e=window.open(a,\"esriJSAPIOAuth\",r.popupWindowFeatures);if(e)e.focus(),this._oAuthDfd.oAuthWin_=e,this._oAuthIntervalId=setInterval(()=>{if(e.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnHashHandle.remove();const e=this._oAuthDfd;if(e){const t=new d.a(\"identity-manager:user-aborted\",\"ABORTED\");e.reject(t)}}},500),this._oAuthOnHashHandle=Object(f.c)(o.a,\"arcgis:auth:hash\",e=>{this.setOAuthResponseHash(e.detail)});else{const e=new d.a(\"identity-manager:popup-blocked\",\"ABORTED\");this._oAuthDfd.reject(e)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:i,authorizeUrl:n,resourceUrl:e,serverInfo:t,oAuthInfo:r}):window.location.href=a}};he=Object(s.a)([Object(i.a)(\"esri.identity.IdentityManagerBase\")],he);let ue=class extends g.a.EventedAccessor{constructor(e){super(e),this._oAuthCred=null,this.tokenRefreshBuffer=2,e&&e._oAuthCred&&(this._oAuthCred=e._oAuthCred)}initialize(){this.resources=this.resources||[],null==this.creationTime&&(this.creationTime=Date.now())}refreshToken(){const e=n.b.findServerInfo(this.server),t=e&&e.owningSystemUrl,r=!!t&&\"server\"===this.scope,s=r&&ce(e,n.b._legacyFed),i=e.webTierAuth,o=i&&n.b.normalizeWebTierAuth,a=ae[this.server],l=a&&a[this.userId];let c,h,u=this.resources&&this.resources[0],d=r&&n.b.findServerInfo(t),p={username:this.userId,password:l};if((!i||o)&&(r&&!d&&n.b.serverInfos.some(e=>(n.b._isIdProvider(t,e.server)&&(d=e),!!d)),c=d&&n.b.findCredential(d.server,this.userId),!r||c)){if(!s){if(r)h={serverUrl:u,token:c&&c.token,ssl:c&&c.ssl};else if(o)p=null,h={ssl:this.ssl};else{if(!l){let t;return u&&(u=n.b._sanitizeUrl(u),this._enqueued=1,t=n.b._enqueue(u,e,null,null,this.isAdmin,this),t.then(()=>{this._enqueued=0,this.refreshServerTokens()}).catch(()=>{this._enqueued=0})),t}this.isAdmin&&(h={isAdmin:!0})}return n.b.generateToken(r?d:e,r?null:p,h).then(e=>{this.token=e.token,this.expires=null!=e.expires?Number(e.expires):null,this.creationTime=Date.now(),this.validity=e.validity,this.emitTokenChange(),this.refreshServerTokens()}).catch(()=>{})}c.refreshToken()}}refreshServerTokens(){\"portal\"===this.scope&&n.b.credentials.forEach(e=>{const t=n.b.findServerInfo(e.server),r=t&&t.owningSystemUrl;e!==this&&e.userId===this.userId&&r&&\"server\"===e.scope&&(n.b._hasSameServerInstance(this.server,r)||n.b._isIdProvider(r,this.server))&&(ce(t,n.b._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())})}emitTokenChange(e){clearTimeout(this._refreshTimer);const t=this.server&&n.b.findServerInfo(this.server),r=t&&t.owningSystemUrl,s=r&&n.b.findServerInfo(r);!1===e||r&&\"portal\"!==this.scope&&(!s||!s.webTierAuth||n.b.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer(),this.emit(\"token-change\")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const e=n.b.credentials.indexOf(this);e>-1&&n.b.credentials.splice(e,1),this.emitTokenChange(),this.emit(\"destroy\")}toJSON(){const e=Object(a.c)({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),t=this.resources;return t&&t.length>0&&(e.resources=t.slice()),e}_startRefreshTimer(){clearTimeout(this._refreshTimer);const e=6e4*this.tokenRefreshBuffer;let t=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();t<0&&(t=0),this._refreshTimer=setTimeout(this.refreshToken.bind(this),t>e?t-e:t)}};Object(s.a)([Object(u.b)()],ue.prototype,\"creationTime\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"expires\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"isAdmin\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"oAuthState\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"resources\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"scope\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"server\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"ssl\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"token\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"tokenRefreshBuffer\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"userId\",void 0),Object(s.a)([Object(u.b)()],ue.prototype,\"validity\",void 0),ue=Object(s.a)([Object(i.a)(\"esri.identity.Credential\")],ue);let de=class extends he{};de=Object(s.a)([Object(i.a)(\"esri.identity.IdentityManager\")],de);const pe=new de;Object(n.c)(pe),t.default=pe}}]);","name":"124.5b9461470ea8286a2f7c.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[124],{\n\n/***/ \"2ByA\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/tslib.es6.js\nvar tslib_es6 = __webpack_require__(\"pO5D\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js + 1 modules\nvar subclass = __webpack_require__(\"04ZG\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/kernel.js + 1 modules\nvar kernel = __webpack_require__(\"975N\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/global.js\nvar global = __webpack_require__(\"3r0u\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/has.js\nvar has = __webpack_require__(\"wSAH\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/lang.js\nvar lang = __webpack_require__(\"f/qv\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/object.js\nvar object = __webpack_require__(\"nR38\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/config.js\nvar core_config = __webpack_require__(\"EyXx\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/string.js\nvar string = __webpack_require__(\"s7YA\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Logger.js\nvar Logger = __webpack_require__(\"6S2I\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/accessorSupport/ensureType.js\nvar ensureType = __webpack_require__(\"zqDF\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js\nvar property = __webpack_require__(\"WbKI\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Error.js\nvar core_Error = __webpack_require__(\"zlDU\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/urlUtils.js\nvar urlUtils = __webpack_require__(\"4EHJ\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/uuid.js\nvar uuid = __webpack_require__(\"ju1D\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/portal/support/resourceExtension.js\nvar resourceExtension = __webpack_require__(\"9AIY\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/events.js\nvar events = __webpack_require__(\"nYOO\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/promiseUtils.js\nvar promiseUtils = __webpack_require__(\"9MzC\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Evented.js\nvar Evented = __webpack_require__(\"zm0L\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/request.js\nvar request = __webpack_require__(\"Lqtk\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/maybe.js\nvar maybe = __webpack_require__(\"srIe\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/core/cookie.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction cookie_t(t,o,n={}){let i=Object(maybe[\"c\" /* assumeNonNull */])(n.expires);if(\"number\"==typeof i){const e=new Date;e.setTime(e.getTime()+24*i*60*60*1e3),i=n.expires=e}\"string\"!=typeof i&&(n.expires=i.toUTCString());let r=t+\"=\"+encodeURIComponent(o);for(const e in n){r+=\"; \"+e;const t=n[e];!0!==t&&(r+=\"=\"+t)}document.cookie=r}\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/intl/substitute.js\nvar substitute = __webpack_require__(\"JV2H\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/widgets/support/widgetUtils.js + 1 modules\nvar widgetUtils = __webpack_require__(\"cCpn\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/widgets/support/decorators/messageBundle.js\nvar messageBundle = __webpack_require__(\"dV4Z\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/widgets/support/decorators/renderable.js\nvar renderable = __webpack_require__(\"OWWk\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/index.js\nvar chunks = __webpack_require__(\"Jv1m\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/widgets/Widget.js\nvar Widget = __webpack_require__(\"Ehpe\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/identity/IdentityForm.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst IdentityForm_p=\"esri-identity-form\",IdentityForm_a=\"esri-identity-form__group\",IdentityForm_d=\"esri-identity-form__label\",IdentityForm_c=\"esri-identity-form__footer\",IdentityForm_m=\"esri-input\",IdentityForm_h=\"esri-button\",IdentityForm_v=\"esri-button--secondary\";let IdentityForm_b=class extends Widget[\"a\" /* default */]{constructor(s,e){super(s,e),this._usernameInputNode=null,this._passwordInputNode=null,this.messages=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:s,server:e,resource:t,signingIn:i,oAuthPrompt:n,messages:l}=this,b=Object(chunks[\"a\" /* j */])(\"div\",{class:IdentityForm_a},Object(substitute[\"a\" /* substitute */])(n?l.oAuthInfo:l.info,{server:/\\.arcgis\\.com/i.test(e)?\"ArcGIS Online\":e,resource:`(${t||l.lblItem})`})),g=n?null:Object(chunks[\"a\" /* j */])(\"div\",{class:IdentityForm_a},Object(chunks[\"a\" /* j */])(\"label\",{class:IdentityForm_d},l.lblUser,Object(chunks[\"a\" /* j */])(\"input\",{value:\"\",required:!0,autocomplete:\"off\",spellcheck:!1,type:\"text\",bind:this,afterCreate:widgetUtils[\"g\" /* storeNode */],\"data-node-ref\":\"_usernameInputNode\",class:IdentityForm_m}))),f=n?null:Object(chunks[\"a\" /* j */])(\"div\",{class:IdentityForm_a},Object(chunks[\"a\" /* j */])(\"label\",{class:IdentityForm_d},l.lblPwd,Object(chunks[\"a\" /* j */])(\"input\",{value:\"\",required:!0,type:\"password\",bind:this,afterCreate:widgetUtils[\"g\" /* storeNode */],\"data-node-ref\":\"_passwordInputNode\",class:IdentityForm_m}))),_=Object(chunks[\"a\" /* j */])(\"div\",{class:this.classes(IdentityForm_a,IdentityForm_c)},Object(chunks[\"a\" /* j */])(\"input\",{type:\"submit\",disabled:!!i,value:i?l.lblSigning:l.lblOk,class:IdentityForm_h}),Object(chunks[\"a\" /* j */])(\"input\",{type:\"button\",value:l.lblCancel,bind:this,onclick:this._cancel,class:this.classes(IdentityForm_h,IdentityForm_v)})),y=s?Object(chunks[\"a\" /* j */])(\"div\",null,s.details&&s.details.httpStatus?l.invalidUser:l.noAuthService):null;return Object(chunks[\"a\" /* j */])(\"form\",{class:IdentityForm_p,bind:this,onsubmit:this._submit},b,y,g,f,_)}_cancel(){this._set(\"signingIn\",!1),this._usernameInputNode&&(this._usernameInputNode.value=\"\"),this._passwordInputNode&&(this._passwordInputNode.value=\"\"),this.emit(\"cancel\")}_submit(s){s.preventDefault(),this._set(\"signingIn\",!0);const e=this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value};this.emit(\"submit\",e)}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])(),Object(renderable[\"a\" /* renderable */])(),Object(messageBundle[\"a\" /* messageBundle */])(\"esri/identity/t9n/identity\")],IdentityForm_b.prototype,\"messages\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])(),Object(renderable[\"a\" /* renderable */])()],IdentityForm_b.prototype,\"signingIn\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])(),Object(renderable[\"a\" /* renderable */])()],IdentityForm_b.prototype,\"server\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])(),Object(renderable[\"a\" /* renderable */])()],IdentityForm_b.prototype,\"resource\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])(),Object(renderable[\"a\" /* renderable */])()],IdentityForm_b.prototype,\"error\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])(),Object(renderable[\"a\" /* renderable */])()],IdentityForm_b.prototype,\"oAuthPrompt\",void 0),IdentityForm_b=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.identity.IdentityForm\")],IdentityForm_b);var IdentityForm_g=IdentityForm_b;/* harmony default export */ var IdentityForm = (IdentityForm_g);\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/widgets/support/widget.js\nvar widget = __webpack_require__(\"J3K2\");\n\n// CONCATENATED MODULE: ./node_modules/tabbable/dist/index.esm.js\n/*!\n* tabbable 5.1.5\n* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE\n*/\nvar candidateSelectors = ['input', 'select', 'textarea', 'a[href]', 'button', '[tabindex]', 'audio[controls]', 'video[controls]', '[contenteditable]:not([contenteditable=\"false\"])', 'details>summary:first-of-type', 'details'];\nvar candidateSelector = /* #__PURE__ */candidateSelectors.join(',');\nvar matches = typeof Element === 'undefined' ? function () {} : Element.prototype.matches || Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;\n\nvar getCandidates = function getCandidates(el, includeContainer, filter) {\n  var candidates = Array.prototype.slice.apply(el.querySelectorAll(candidateSelector));\n\n  if (includeContainer && matches.call(el, candidateSelector)) {\n    candidates.unshift(el);\n  }\n\n  candidates = candidates.filter(filter);\n  return candidates;\n};\n\nvar isContentEditable = function isContentEditable(node) {\n  return node.contentEditable === 'true';\n};\n\nvar getTabindex = function getTabindex(node) {\n  var tabindexAttr = parseInt(node.getAttribute('tabindex'), 10);\n\n  if (!isNaN(tabindexAttr)) {\n    return tabindexAttr;\n  } // Browsers do not return `tabIndex` correctly for contentEditable nodes;\n  // so if they don't have a tabindex attribute specifically set, assume it's 0.\n\n\n  if (isContentEditable(node)) {\n    return 0;\n  } // in Chrome, <details/>, <audio controls/> and <video controls/> elements get a default\n  //  `tabIndex` of -1 when the 'tabindex' attribute isn't specified in the DOM,\n  //  yet they are still part of the regular tab order; in FF, they get a default\n  //  `tabIndex` of 0; since Chrome still puts those elements in the regular tab\n  //  order, consider their tab index to be 0.\n\n\n  if ((node.nodeName === 'AUDIO' || node.nodeName === 'VIDEO' || node.nodeName === 'DETAILS') && node.getAttribute('tabindex') === null) {\n    return 0;\n  }\n\n  return node.tabIndex;\n};\n\nvar sortOrderedTabbables = function sortOrderedTabbables(a, b) {\n  return a.tabIndex === b.tabIndex ? a.documentOrder - b.documentOrder : a.tabIndex - b.tabIndex;\n};\n\nvar isInput = function isInput(node) {\n  return node.tagName === 'INPUT';\n};\n\nvar isHiddenInput = function isHiddenInput(node) {\n  return isInput(node) && node.type === 'hidden';\n};\n\nvar isDetailsWithSummary = function isDetailsWithSummary(node) {\n  var r = node.tagName === 'DETAILS' && Array.prototype.slice.apply(node.children).some(function (child) {\n    return child.tagName === 'SUMMARY';\n  });\n  return r;\n};\n\nvar getCheckedRadio = function getCheckedRadio(nodes, form) {\n  for (var i = 0; i < nodes.length; i++) {\n    if (nodes[i].checked && nodes[i].form === form) {\n      return nodes[i];\n    }\n  }\n};\n\nvar isTabbableRadio = function isTabbableRadio(node) {\n  if (!node.name) {\n    return true;\n  }\n\n  var radioScope = node.form || node.ownerDocument;\n\n  var queryRadios = function queryRadios(name) {\n    return radioScope.querySelectorAll('input[type=\"radio\"][name=\"' + name + '\"]');\n  };\n\n  var radioSet;\n\n  if (typeof window !== 'undefined' && typeof window.CSS !== 'undefined' && typeof window.CSS.escape === 'function') {\n    radioSet = queryRadios(window.CSS.escape(node.name));\n  } else {\n    try {\n      radioSet = queryRadios(node.name);\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error('Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s', err.message);\n      return false;\n    }\n  }\n\n  var checked = getCheckedRadio(radioSet, node.form);\n  return !checked || checked === node;\n};\n\nvar isRadio = function isRadio(node) {\n  return isInput(node) && node.type === 'radio';\n};\n\nvar isNonTabbableRadio = function isNonTabbableRadio(node) {\n  return isRadio(node) && !isTabbableRadio(node);\n};\n\nvar isHidden = function isHidden(node) {\n  if (getComputedStyle(node).visibility === 'hidden') {\n    return true;\n  }\n\n  var isDirectSummary = matches.call(node, 'details>summary:first-of-type');\n  var nodeUnderDetails = isDirectSummary ? node.parentElement : node;\n\n  if (matches.call(nodeUnderDetails, 'details:not([open]) *')) {\n    return true;\n  }\n\n  while (node) {\n    if (getComputedStyle(node).display === 'none') {\n      return true;\n    }\n\n    node = node.parentElement;\n  }\n\n  return false;\n};\n\nvar isNodeMatchingSelectorFocusable = function isNodeMatchingSelectorFocusable(node) {\n  if (node.disabled || isHiddenInput(node) || isHidden(node) ||\n  /* For a details element with a summary, the summary element gets the focused  */\n  isDetailsWithSummary(node)) {\n    return false;\n  }\n\n  return true;\n};\n\nvar isNodeMatchingSelectorTabbable = function isNodeMatchingSelectorTabbable(node) {\n  if (!isNodeMatchingSelectorFocusable(node) || isNonTabbableRadio(node) || getTabindex(node) < 0) {\n    return false;\n  }\n\n  return true;\n};\n\nvar tabbable = function tabbable(el, options) {\n  options = options || {};\n  var regularTabbables = [];\n  var orderedTabbables = [];\n  var candidates = getCandidates(el, options.includeContainer, isNodeMatchingSelectorTabbable);\n  candidates.forEach(function (candidate, i) {\n    var candidateTabindex = getTabindex(candidate);\n\n    if (candidateTabindex === 0) {\n      regularTabbables.push(candidate);\n    } else {\n      orderedTabbables.push({\n        documentOrder: i,\n        tabIndex: candidateTabindex,\n        node: candidate\n      });\n    }\n  });\n  var tabbableNodes = orderedTabbables.sort(sortOrderedTabbables).map(function (a) {\n    return a.node;\n  }).concat(regularTabbables);\n  return tabbableNodes;\n};\n\nvar focusable = function focusable(el, options) {\n  options = options || {};\n  var candidates = getCandidates(el, options.includeContainer, isNodeMatchingSelectorFocusable);\n  return candidates;\n};\n\nvar isTabbable = function isTabbable(node) {\n  if (!node) {\n    throw new Error('No node provided');\n  }\n\n  if (matches.call(node, candidateSelector) === false) {\n    return false;\n  }\n\n  return isNodeMatchingSelectorTabbable(node);\n};\n\nvar focusableCandidateSelector = /* #__PURE__ */candidateSelectors.concat('iframe').join(',');\n\nvar isFocusable = function isFocusable(node) {\n  if (!node) {\n    throw new Error('No node provided');\n  }\n\n  if (matches.call(node, focusableCandidateSelector) === false) {\n    return false;\n  }\n\n  return isNodeMatchingSelectorFocusable(node);\n};\n\n\n//# sourceMappingURL=index.esm.js.map\n\n// CONCATENATED MODULE: ./node_modules/focus-trap/dist/focus-trap.esm.js\n/*!\n* focus-trap 6.2.3\n* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE\n*/\n\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar activeFocusDelay;\n\nvar activeFocusTraps = function () {\n  var trapQueue = [];\n  return {\n    activateTrap: function activateTrap(trap) {\n      if (trapQueue.length > 0) {\n        var activeTrap = trapQueue[trapQueue.length - 1];\n\n        if (activeTrap !== trap) {\n          activeTrap.pause();\n        }\n      }\n\n      var trapIndex = trapQueue.indexOf(trap);\n\n      if (trapIndex === -1) {\n        trapQueue.push(trap);\n      } else {\n        // move this existing trap to the front of the queue\n        trapQueue.splice(trapIndex, 1);\n        trapQueue.push(trap);\n      }\n    },\n    deactivateTrap: function deactivateTrap(trap) {\n      var trapIndex = trapQueue.indexOf(trap);\n\n      if (trapIndex !== -1) {\n        trapQueue.splice(trapIndex, 1);\n      }\n\n      if (trapQueue.length > 0) {\n        trapQueue[trapQueue.length - 1].unpause();\n      }\n    }\n  };\n}();\n\nvar isSelectableInput = function isSelectableInput(node) {\n  return node.tagName && node.tagName.toLowerCase() === 'input' && typeof node.select === 'function';\n};\n\nvar isEscapeEvent = function isEscapeEvent(e) {\n  return e.key === 'Escape' || e.key === 'Esc' || e.keyCode === 27;\n};\n\nvar isTabEvent = function isTabEvent(e) {\n  return e.key === 'Tab' || e.keyCode === 9;\n};\n\nvar delay = function delay(fn) {\n  return setTimeout(fn, 0);\n}; // Array.find/findIndex() are not supported on IE; this replicates enough\n//  of Array.findIndex() for our needs\n\n\nvar findIndex = function findIndex(arr, fn) {\n  var idx = -1;\n  arr.every(function (value, i) {\n    if (fn(value)) {\n      idx = i;\n      return false; // break\n    }\n\n    return true; // next\n  });\n  return idx;\n};\n\nvar focus_trap_esm_createFocusTrap = function createFocusTrap(elements, userOptions) {\n  var doc = document;\n\n  var config = _objectSpread2({\n    returnFocusOnDeactivate: true,\n    escapeDeactivates: true,\n    delayInitialFocus: true\n  }, userOptions);\n\n  var state = {\n    // @type {Array<HTMLElement>}\n    containers: [],\n    // list of objects identifying the first and last tabbable nodes in all containers/groups in\n    //  the trap\n    // NOTE: it's possible that a group has no tabbable nodes if nodes get removed while the trap\n    //  is active, but the trap should never get to a state where there isn't at least one group\n    //  with at least one tabbable node in it (that would lead to an error condition that would\n    //  result in an error being thrown)\n    // @type {Array<{ firstTabbableNode: HTMLElement|null, lastTabbableNode: HTMLElement|null }>}\n    tabbableGroups: [],\n    nodeFocusedBeforeActivation: null,\n    mostRecentlyFocusedNode: null,\n    active: false,\n    paused: false\n  };\n  var trap; // eslint-disable-line prefer-const -- some private functions reference it, and its methods reference private functions, so we must declare here and define later\n\n  var containersContain = function containersContain(element) {\n    return state.containers.some(function (container) {\n      return container.contains(element);\n    });\n  };\n\n  var getNodeForOption = function getNodeForOption(optionName) {\n    var optionValue = config[optionName];\n\n    if (!optionValue) {\n      return null;\n    }\n\n    var node = optionValue;\n\n    if (typeof optionValue === 'string') {\n      node = doc.querySelector(optionValue);\n\n      if (!node) {\n        throw new Error(\"`\".concat(optionName, \"` refers to no known node\"));\n      }\n    }\n\n    if (typeof optionValue === 'function') {\n      node = optionValue();\n\n      if (!node) {\n        throw new Error(\"`\".concat(optionName, \"` did not return a node\"));\n      }\n    }\n\n    return node;\n  };\n\n  var getInitialFocusNode = function getInitialFocusNode() {\n    var node;\n\n    if (getNodeForOption('initialFocus') !== null) {\n      node = getNodeForOption('initialFocus');\n    } else if (containersContain(doc.activeElement)) {\n      node = doc.activeElement;\n    } else {\n      var firstTabbableGroup = state.tabbableGroups[0];\n      var firstTabbableNode = firstTabbableGroup && firstTabbableGroup.firstTabbableNode;\n      node = firstTabbableNode || getNodeForOption('fallbackFocus');\n    }\n\n    if (!node) {\n      throw new Error('Your focus-trap needs to have at least one focusable element');\n    }\n\n    return node;\n  };\n\n  var updateTabbableNodes = function updateTabbableNodes() {\n    state.tabbableGroups = state.containers.map(function (container) {\n      var tabbableNodes = tabbable(container);\n\n      if (tabbableNodes.length > 0) {\n        return {\n          firstTabbableNode: tabbableNodes[0],\n          lastTabbableNode: tabbableNodes[tabbableNodes.length - 1]\n        };\n      }\n\n      return undefined;\n    }).filter(function (group) {\n      return !!group;\n    }); // remove groups with no tabbable nodes\n    // throw if no groups have tabbable nodes and we don't have a fallback focus node either\n\n    if (state.tabbableGroups.length <= 0 && !getNodeForOption('fallbackFocus')) {\n      throw new Error('Your focus-trap must have at least one container with at least one tabbable node in it at all times');\n    }\n  };\n\n  var tryFocus = function tryFocus(node) {\n    if (node === doc.activeElement) {\n      return;\n    }\n\n    if (!node || !node.focus) {\n      tryFocus(getInitialFocusNode());\n      return;\n    }\n\n    node.focus({\n      preventScroll: !!config.preventScroll\n    });\n    state.mostRecentlyFocusedNode = node;\n\n    if (isSelectableInput(node)) {\n      node.select();\n    }\n  };\n\n  var getReturnFocusNode = function getReturnFocusNode(previousActiveElement) {\n    var node = getNodeForOption('setReturnFocus');\n    return node ? node : previousActiveElement;\n  }; // This needs to be done on mousedown and touchstart instead of click\n  // so that it precedes the focus event.\n\n\n  var checkPointerDown = function checkPointerDown(e) {\n    if (containersContain(e.target)) {\n      // allow the click since it ocurred inside the trap\n      return;\n    }\n\n    if (config.clickOutsideDeactivates) {\n      // immediately deactivate the trap\n      trap.deactivate({\n        // if, on deactivation, we should return focus to the node originally-focused\n        //  when the trap was activated (or the configured `setReturnFocus` node),\n        //  then assume it's also OK to return focus to the outside node that was\n        //  just clicked, causing deactivation, as long as that node is focusable;\n        //  if it isn't focusable, then return focus to the original node focused\n        //  on activation (or the configured `setReturnFocus` node)\n        // NOTE: by setting `returnFocus: false`, deactivate() will do nothing,\n        //  which will result in the outside click setting focus to the node\n        //  that was clicked, whether it's focusable or not; by setting\n        //  `returnFocus: true`, we'll attempt to re-focus the node originally-focused\n        //  on activation (or the configured `setReturnFocus` node)\n        returnFocus: config.returnFocusOnDeactivate && !isFocusable(e.target)\n      });\n      return;\n    } // This is needed for mobile devices.\n    // (If we'll only let `click` events through,\n    // then on mobile they will be blocked anyways if `touchstart` is blocked.)\n\n\n    if (config.allowOutsideClick && (typeof config.allowOutsideClick === 'boolean' ? config.allowOutsideClick : config.allowOutsideClick(e))) {\n      // allow the click outside the trap to take place\n      return;\n    } // otherwise, prevent the click\n\n\n    e.preventDefault();\n  }; // In case focus escapes the trap for some strange reason, pull it back in.\n\n\n  var checkFocusIn = function checkFocusIn(e) {\n    var targetContained = containersContain(e.target); // In Firefox when you Tab out of an iframe the Document is briefly focused.\n\n    if (targetContained || e.target instanceof Document) {\n      if (targetContained) {\n        state.mostRecentlyFocusedNode = e.target;\n      }\n    } else {\n      // escaped! pull it back in to where it just left\n      e.stopImmediatePropagation();\n      tryFocus(state.mostRecentlyFocusedNode || getInitialFocusNode());\n    }\n  }; // Hijack Tab events on the first and last focusable nodes of the trap,\n  // in order to prevent focus from escaping. If it escapes for even a\n  // moment it can end up scrolling the page and causing confusion so we\n  // kind of need to capture the action at the keydown phase.\n\n\n  var checkTab = function checkTab(e) {\n    updateTabbableNodes();\n    var destinationNode = null;\n\n    if (state.tabbableGroups.length > 0) {\n      if (e.shiftKey) {\n        var startOfGroupIndex = findIndex(state.tabbableGroups, function (_ref) {\n          var firstTabbableNode = _ref.firstTabbableNode;\n          return e.target === firstTabbableNode;\n        });\n\n        if (startOfGroupIndex >= 0) {\n          var destinationGroupIndex = startOfGroupIndex === 0 ? state.tabbableGroups.length - 1 : startOfGroupIndex - 1;\n          var destinationGroup = state.tabbableGroups[destinationGroupIndex];\n          destinationNode = destinationGroup.lastTabbableNode;\n        }\n      } else {\n        var lastOfGroupIndex = findIndex(state.tabbableGroups, function (_ref2) {\n          var lastTabbableNode = _ref2.lastTabbableNode;\n          return e.target === lastTabbableNode;\n        });\n\n        if (lastOfGroupIndex >= 0) {\n          var _destinationGroupIndex = lastOfGroupIndex === state.tabbableGroups.length - 1 ? 0 : lastOfGroupIndex + 1;\n\n          var _destinationGroup = state.tabbableGroups[_destinationGroupIndex];\n          destinationNode = _destinationGroup.firstTabbableNode;\n        }\n      }\n    } else {\n      destinationNode = getNodeForOption('fallbackFocus');\n    }\n\n    if (destinationNode) {\n      e.preventDefault();\n      tryFocus(destinationNode);\n    }\n  };\n\n  var checkKey = function checkKey(e) {\n    if (config.escapeDeactivates !== false && isEscapeEvent(e)) {\n      e.preventDefault();\n      trap.deactivate();\n      return;\n    }\n\n    if (isTabEvent(e)) {\n      checkTab(e);\n      return;\n    }\n  };\n\n  var checkClick = function checkClick(e) {\n    if (config.clickOutsideDeactivates) {\n      return;\n    }\n\n    if (containersContain(e.target)) {\n      return;\n    }\n\n    if (config.allowOutsideClick && (typeof config.allowOutsideClick === 'boolean' ? config.allowOutsideClick : config.allowOutsideClick(e))) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopImmediatePropagation();\n  }; //\n  // EVENT LISTENERS\n  //\n\n\n  var addListeners = function addListeners() {\n    if (!state.active) {\n      return;\n    } // There can be only one listening focus trap at a time\n\n\n    activeFocusTraps.activateTrap(trap); // Delay ensures that the focused element doesn't capture the event\n    // that caused the focus trap activation.\n\n    activeFocusDelay = config.delayInitialFocus ? delay(function () {\n      tryFocus(getInitialFocusNode());\n    }) : tryFocus(getInitialFocusNode());\n    doc.addEventListener('focusin', checkFocusIn, true);\n    doc.addEventListener('mousedown', checkPointerDown, {\n      capture: true,\n      passive: false\n    });\n    doc.addEventListener('touchstart', checkPointerDown, {\n      capture: true,\n      passive: false\n    });\n    doc.addEventListener('click', checkClick, {\n      capture: true,\n      passive: false\n    });\n    doc.addEventListener('keydown', checkKey, {\n      capture: true,\n      passive: false\n    });\n    return trap;\n  };\n\n  var removeListeners = function removeListeners() {\n    if (!state.active) {\n      return;\n    }\n\n    doc.removeEventListener('focusin', checkFocusIn, true);\n    doc.removeEventListener('mousedown', checkPointerDown, true);\n    doc.removeEventListener('touchstart', checkPointerDown, true);\n    doc.removeEventListener('click', checkClick, true);\n    doc.removeEventListener('keydown', checkKey, true);\n    return trap;\n  }; //\n  // TRAP DEFINITION\n  //\n\n\n  trap = {\n    activate: function activate(activateOptions) {\n      if (state.active) {\n        return this;\n      }\n\n      updateTabbableNodes();\n      state.active = true;\n      state.paused = false;\n      state.nodeFocusedBeforeActivation = doc.activeElement;\n      var onActivate = activateOptions && activateOptions.onActivate ? activateOptions.onActivate : config.onActivate;\n\n      if (onActivate) {\n        onActivate();\n      }\n\n      addListeners();\n      return this;\n    },\n    deactivate: function deactivate(deactivateOptions) {\n      if (!state.active) {\n        return this;\n      }\n\n      clearTimeout(activeFocusDelay);\n      removeListeners();\n      state.active = false;\n      state.paused = false;\n      activeFocusTraps.deactivateTrap(trap);\n      var onDeactivate = deactivateOptions && deactivateOptions.onDeactivate !== undefined ? deactivateOptions.onDeactivate : config.onDeactivate;\n\n      if (onDeactivate) {\n        onDeactivate();\n      }\n\n      var returnFocus = deactivateOptions && deactivateOptions.returnFocus !== undefined ? deactivateOptions.returnFocus : config.returnFocusOnDeactivate;\n\n      if (returnFocus) {\n        delay(function () {\n          tryFocus(getReturnFocusNode(state.nodeFocusedBeforeActivation));\n        });\n      }\n\n      return this;\n    },\n    pause: function pause() {\n      if (state.paused || !state.active) {\n        return this;\n      }\n\n      state.paused = true;\n      removeListeners();\n      return this;\n    },\n    unpause: function unpause() {\n      if (!state.paused || !state.active) {\n        return this;\n      }\n\n      state.paused = false;\n      updateTabbableNodes();\n      addListeners();\n      return this;\n    },\n    updateContainerElements: function updateContainerElements(containerElements) {\n      var elementsAsArray = [].concat(containerElements).filter(Boolean);\n      state.containers = elementsAsArray.map(function (element) {\n        return typeof element === 'string' ? doc.querySelector(element) : element;\n      });\n\n      if (state.active) {\n        updateTabbableNodes();\n      }\n\n      return this;\n    }\n  }; // initialize container elements\n\n  trap.updateContainerElements(elements);\n  return trap;\n};\n\n\n//# sourceMappingURL=focus-trap.esm.js.map\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/identity/IdentityModal.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst IdentityModal_d=\"esri-identity-modal\",IdentityModal_l=\"esri-identity-modal--open\",IdentityModal_p=\"esri-identity-modal--closed\",IdentityModal_u=\"esri-identity-modal__title\",IdentityModal_m=\"esri-identity-modal__dialog\",IdentityModal_h=\"esri-identity-modal__content\",IdentityModal_=\"esri-identity-modal__close-button\",IdentityModal_y=\"esri-icon-close\";let IdentityModal_g=class extends Widget[\"a\" /* default */]{constructor(t,e){super(t,e),this.container=document.createElement(\"div\"),this.content=null,this.open=!1,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.own(this.watch(\"open\",(()=>this._toggleFocusTrap())))}destroy(){this._destroyFocusTrap()}render(){const t=this.id,{open:e,content:s,title:o,messages:i}=this,a=e&&!!s,n={[IdentityModal_l]:a,[IdentityModal_p]:!a},c=Object(chunks[\"a\" /* j */])(\"button\",{class:IdentityModal_,\"aria-label\":i.close,title:i.close,bind:this,onclick:this._close},Object(chunks[\"a\" /* j */])(\"span\",{\"aria-hidden\":\"true\",class:IdentityModal_y})),h=`${t}_title`,g=`${t}_content`,f=o?Object(chunks[\"a\" /* j */])(\"h1\",{id:h,class:IdentityModal_u},o):null,v=a?Object(chunks[\"a\" /* j */])(\"div\",{bind:this,class:IdentityModal_m,role:\"dialog\",\"aria-labelledby\":h,\"aria-describedby\":g,afterCreate:this._createFocusTrap},c,f,this._renderContent(g)):null;return Object(chunks[\"a\" /* j */])(\"div\",{tabIndex:-1,class:this.classes(IdentityModal_d,n)},v)}_destroyFocusTrap(){var t;null==(t=this._focusTrap)||t.deactivate({onDeactivate:null}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:t,open:e}=this;t&&(e?t.activate():t.deactivate())}_createFocusTrap(t){this._destroyFocusTrap(),requestAnimationFrame((()=>{this._focusTrap=focus_trap_esm_createFocusTrap(t,{initialFocus:\"input\",onDeactivate:this._close}),this._toggleFocusTrap()}))}_renderContent(t){const e=this.content;return\"string\"==typeof e?Object(chunks[\"a\" /* j */])(\"div\",{class:IdentityModal_h,id:t,innerHTML:e}):Object(widget[\"b\" /* isWidget */])(e)?Object(chunks[\"a\" /* j */])(\"div\",{class:IdentityModal_h,id:t},e.render()):e instanceof HTMLElement?Object(chunks[\"a\" /* j */])(\"div\",{class:IdentityModal_h,id:t,bind:e,afterCreate:this._attachToNode}):null}_attachToNode(t){t.appendChild(this)}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({readOnly:!0})],IdentityModal_g.prototype,\"container\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])(),Object(renderable[\"a\" /* renderable */])()],IdentityModal_g.prototype,\"content\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])(),Object(renderable[\"a\" /* renderable */])()],IdentityModal_g.prototype,\"open\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])(),Object(renderable[\"a\" /* renderable */])(),Object(messageBundle[\"a\" /* messageBundle */])(\"esri/t9n/common\")],IdentityModal_g.prototype,\"messages\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({aliasOf:\"messages.auth.signIn\"}),Object(renderable[\"a\" /* renderable */])()],IdentityModal_g.prototype,\"title\",void 0),IdentityModal_g=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.identity.IdentityModal\")],IdentityModal_g);var IdentityModal_f=IdentityModal_g;/* harmony default export */ var IdentityModal = (IdentityModal_f);\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/identity/OAuthCredential.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass OAuthCredential_t{constructor(t,e){this.oAuthInfo=null,this.storage=null,this.appId=null,this.expires=null,this.ssl=null,this.token=null,this.userId=null,this.oAuthInfo=t,this.storage=e,this._init()}isValid(){let t=!1;if(this.oAuthInfo&&this.token&&this.userId){const e=Date.now();if(this.expires>e){(this.expires-e)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(t=!0)}}return t}save(){if(!this.storage)return;const t=this._load(),e=this.oAuthInfo;if(e&&e.authNamespace&&e.portalUrl){let s=t[e.authNamespace];s||(s=t[e.authNamespace]={}),s[e.portalUrl]={appId:this.appId=e.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem(\"esriJSAPIOAuth\",JSON.stringify(t))}catch(t){console.log(t)}}}destroy(){const t=this._load(),e=this.oAuthInfo;if(e&&e.appId&&e.portalUrl&&this.token&&this.expires>Date.now()){const t=e.portalUrl.replace(/^http:/i,\"https:\")+\"/sharing/rest/oauth2/revokeToken\",s=new FormData;if(s.append(\"f\",\"json\"),s.append(\"auth_token\",this.token),s.append(\"client_id\",e.appId),s.append(\"token_type_hint\",\"access_token\"),\"function\"==typeof navigator.sendBeacon)navigator.sendBeacon(t,s);else{const e=new XMLHttpRequest;e.open(\"POST\",t),e.send(s)}}if(e&&e.authNamespace&&e.portalUrl&&this.storage){const s=t[e.authNamespace];if(s){delete s[e.portalUrl];try{this.storage.setItem(\"esriJSAPIOAuth\",JSON.stringify(t))}catch(t){console.log(t)}}}e&&(e._oAuthCred=null,this.oAuthInfo=null)}_init(){const t=this._load(),e=this.oAuthInfo;if(e&&e.authNamespace&&e.portalUrl){let s=t[e.authNamespace];s&&(s=s[e.portalUrl],s&&(this.appId=s.appId,this.expires=s.expires,this.ssl=s.ssl,this.token=s.token,this.userId=s.userId))}}_load(){let t={};if(this.storage){const e=this.storage.getItem(\"esriJSAPIOAuth\");if(e)try{t=JSON.parse(e)}catch(t){console.log(t)}}return t}}OAuthCredential_t.prototype.declaredClass=\"esri.identity.OAuthCredential\";/* harmony default export */ var OAuthCredential = (OAuthCredential_t);\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/JSONSupport.js\nvar JSONSupport = __webpack_require__(\"ag7Y\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/identity/OAuthInfo.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nvar OAuthInfo_p;let OAuthInfo_s=OAuthInfo_p=class extends JSONSupport[\"a\" /* JSONSupport */]{constructor(o){super(o),this._oAuthCred=null,this.appId=null,this.authNamespace=\"/\",this.expiration=20160,this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl=\"oauth-callback.html\",this.popupWindowFeatures=\"height=490,width=800,resizable,scrollbars,status\",this.portalUrl=\"https://www.arcgis.com\",this.preserveUrlHash=!1,this.userId=null}clone(){return OAuthInfo_p.fromJSON(this.toJSON())}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"appId\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"authNamespace\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"expiration\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"forceLogin\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"forceUserId\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"locale\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"minTimeUntilExpiration\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"popup\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"popupCallbackUrl\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"popupWindowFeatures\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"portalUrl\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"preserveUrlHash\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],OAuthInfo_s.prototype,\"userId\",void 0),OAuthInfo_s=OAuthInfo_p=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.identity.OAuthInfo\")],OAuthInfo_s);var OAuthInfo_i=OAuthInfo_s;/* harmony default export */ var OAuthInfo = (OAuthInfo_i);\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/identity/ServerInfo.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nlet ServerInfo_s=class extends JSONSupport[\"a\" /* JSONSupport */]{constructor(r){super(r),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],ServerInfo_s.prototype,\"adminTokenServiceUrl\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],ServerInfo_s.prototype,\"currentVersion\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],ServerInfo_s.prototype,\"hasPortal\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],ServerInfo_s.prototype,\"hasServer\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],ServerInfo_s.prototype,\"owningSystemUrl\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],ServerInfo_s.prototype,\"owningTenant\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],ServerInfo_s.prototype,\"server\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],ServerInfo_s.prototype,\"shortLivedTokenValidity\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],ServerInfo_s.prototype,\"tokenServiceUrl\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({json:{write:!0}})],ServerInfo_s.prototype,\"webTierAuth\",void 0),ServerInfo_s=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.identity.ServerInfo\")],ServerInfo_s);var ServerInfo_i=ServerInfo_s;/* harmony default export */ var ServerInfo = (ServerInfo_i);\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/identity/IdentityManagerBase.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst D={},j=e=>{const t=new urlUtils[\"a\" /* Url */](e.owningSystemUrl).host,r=new urlUtils[\"a\" /* Url */](e.server).host,s=/.+\\.arcgis\\.com$/i;return s.test(t)&&s.test(r)},q=(e,t)=>!!(j(e)&&t&&t.some((t=>t.test(e.server))));let E=class extends Evented[\"a\" /* default */]{constructor(){super(),this._portalConfig=global[\"a\" /* default */].esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this.defaultOAuthInfo=null,this.defaultTokenValidity=60,this.dialog=null,this.formConstructor=IdentityForm,this.tokenValidity=null,this.signInPage=null,this.useSignInPage=!0,this.normalizeWebTierAuth=!1,this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthHash=null,this._gwTokenUrl=\"/sharing/rest/generateToken\",this._agsRest=\"/rest/services\",this._agsPortal=/\\/sharing(\\/|$)/i,this._agsAdmin=/(https?:\\/\\/[^\\/]+\\/[^\\/]+)\\/admin\\/?(\\/.*)?$/i,this._adminSvcs=/\\/rest\\/admin\\/services(\\/|$)/i,this._gwDomains=[{regex:/^https?:\\/\\/www\\.arcgis\\.com/i,customBaseUrl:\"maps.arcgis.com\",tokenServiceUrl:\"https://www.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:dev|[a-z\\d-]+\\.mapsdev)\\.arcgis\\.com/i,customBaseUrl:\"mapsdev.arcgis.com\",tokenServiceUrl:\"https://dev.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:devext|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,customBaseUrl:\"mapsdevext.arcgis.com\",tokenServiceUrl:\"https://devext.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:qaext|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i,customBaseUrl:\"mapsqa.arcgis.com\",tokenServiceUrl:\"https://qaext.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/[a-z\\d-]+\\.maps\\.arcgis\\.com/i,customBaseUrl:\"maps.arcgis.com\",tokenServiceUrl:\"https://www.arcgis.com/sharing/rest/generateToken\"}],this._legacyFed=[],this._regexSDirUrl=/http.+\\/rest\\/services\\/?/gi,this._regexServerType=/(\\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi,this._gwUser=/http.+\\/users\\/([^\\/]+)\\/?.*/i,this._gwItem=/http.+\\/items\\/([^\\/]+)\\/?.*/i,this._gwGroup=/http.+\\/groups\\/([^\\/]+)\\/?.*/i,this._rePortalTokenSvc=/\\/sharing(\\/rest)?\\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthHash(),window.addEventListener(\"pageshow\",(e=>{this._pageShowHandler(e)}))}registerServers(e){const t=this.serverInfos;t?(e=e.filter((e=>!this.findServerInfo(e.server))),this.serverInfos=t.concat(e)):this.serverInfos=e,e.forEach((e=>{e.owningSystemUrl&&this._portals.push(e.owningSystemUrl),e.hasPortal&&this._portals.push(e.server)}))}registerOAuthInfos(e){const t=this.oAuthInfos;t?(e=e.filter((e=>!this.findOAuthInfo(e.portalUrl))),this.oAuthInfos=t.concat(e)):this.oAuthInfos=e}registerToken(e){e={...e};const t=this._sanitizeUrl(e.server),s=this._isServerRsrc(t);let i,n=this.findServerInfo(t),o=!0;n||(n=new ServerInfo,n.server=this._getServerInstanceRoot(t),s?n.hasServer=!0:(n.tokenServiceUrl=this._getTokenSvcUrl(t),n.hasPortal=!0),this.registerServers([n])),i=this._findCredential(t),i?(delete e.server,Object(lang[\"d\" /* mixin */])(i,e),o=!1):(i=new L({userId:e.userId,server:n.server,token:e.token,expires:e.expires,ssl:e.ssl,scope:s?\"server\":\"portal\"}),i.resources=[t],this.credentials.push(i)),i.emitTokenChange(!1),o||i.refreshServerTokens()}toJSON(){return Object(lang[\"c\" /* fixJson */])({serverInfos:this.serverInfos.map((e=>e.toJSON())),oAuthInfos:this.oAuthInfos.map((e=>e.toJSON())),credentials:this.credentials.map((e=>e.toJSON()))})}initialize(e){if(!e)return;\"string\"==typeof e&&(e=JSON.parse(e));const t=e.serverInfos,r=e.oAuthInfos,s=e.credentials;if(t){const e=[];t.forEach((t=>{t.server&&t.tokenServiceUrl&&e.push(t.declaredClass?t:new ServerInfo(t))})),e.length&&this.registerServers(e)}if(r){const e=[];r.forEach((t=>{t.appId&&e.push(t.declaredClass?t:new OAuthInfo(t))})),e.length&&this.registerOAuthInfos(e)}s&&s.forEach((e=>{e.server&&e.token&&e.expires&&e.expires>Date.now()&&((e=e.declaredClass?e:new L(e)).emitTokenChange(),this.credentials.push(e))}))}findServerInfo(e){let t;e=this._sanitizeUrl(e);for(const r of this.serverInfos)if(this._hasSameServerInstance(r.server,e)){t=r;break}return t}findOAuthInfo(e){let t;e=this._sanitizeUrl(e);for(const r of this.oAuthInfos)if(this._hasSameServerInstance(r.portalUrl,e)){t=r;break}return t}findCredential(e,t){let r,s;if(e=this._sanitizeUrl(e),s=this._isServerRsrc(e)?\"server\":\"portal\",t){for(const i of this.credentials)if(this._hasSameServerInstance(i.server,e)&&t===i.userId&&i.scope===s){r=i;break}}else for(const t of this.credentials)if(this._hasSameServerInstance(t.server,e)&&-1!==this._getIdenticalSvcIdx(e,t)&&t.scope===s){r=t;break}return r}getCredential(e,t){let r,s,i=!0;t&&(r=!!t.token,s=t.error,i=!1!==t.prompt),t={...t},e=this._sanitizeUrl(e);const n=Object(promiseUtils[\"d\" /* createAbortController */])(),o=Object(promiseUtils[\"g\" /* createResolver */])();if(t.signal&&Object(promiseUtils[\"r\" /* onAbort */])(t.signal,(()=>{n.abort()})),Object(promiseUtils[\"r\" /* onAbort */])(n,(()=>{o.reject(new core_Error[\"a\" /* default */](\"identity-manager:user-aborted\",\"ABORTED\"))})),Object(promiseUtils[\"o\" /* isAborted */])(n))return o.promise;t.signal=n.signal;const a=this._isAdminResource(e),h=r&&this._doPortalSignIn(e)?this._getEsriAuthCookie():null,c=r?this.findCredential(e):null;let d;if(c&&s&&s.details&&498===s.details.httpStatus)c.destroy(),h&&h.token===t.token&&(cookie_t(\"esri_auth\",null,{expires:-1,path:\"/\",domain:document.domain}),window.location.hostname.endsWith(\".arcgis.com\")&&cookie_t(\"esri_auth\",null,{expires:-1,path:\"/\",domain:\"arcgis.com\"}));else if(h||c){const t=h&&h.email||c&&c.userId;return d=new core_Error[\"a\" /* default */](\"identity-manager:not-authorized\",\"You are currently signed in as: '\"+t+\"'. You do not have access to this resource: \"+e,{error:s}),o.reject(d),o.promise}const u=this._findCredential(e,t);if(u)return o.resolve(u),o.promise;let p=this.findServerInfo(e);if(p)!p.hasServer&&this._isServerRsrc(e)&&(p._restInfoPms=this._getTokenSvcUrl(e),p.hasServer=!0);else{const t=this._getTokenSvcUrl(e);if(!t)return d=new core_Error[\"a\" /* default */](\"identity-manager:unknown-resource\",\"Unknown resource - could not find token service endpoint.\"),o.reject(d),o.promise;p=new ServerInfo,p.server=this._getServerInstanceRoot(e),\"string\"==typeof t?(p.tokenServiceUrl=t,p.hasPortal=!0):(p._restInfoPms=t,p.hasServer=!0),this.registerServers([p])}return i&&p.hasPortal&&void 0===p._selfReq&&!this._findOAuthInfo(e)&&(p._selfReq={owningTenant:t&&t.owningTenant,selfDfd:this._getPortalSelf(p.tokenServiceUrl.replace(this._rePortalTokenSvc,\"/sharing/rest/portals/self\"),e)}),this._enqueue(e,p,t,o,a)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,\"\").replace(this._regexServerType,\"\")||\"\":this._gwUser.test(e)&&e.replace(this._gwUser,\"$1\")||this._gwItem.test(e)&&e.replace(this._gwItem,\"$1\")||this._gwGroup.test(e)&&e.replace(this._gwGroup,\"$1\")||\"\"}generateToken(e,t,s){const i=this._rePortalTokenSvc.test(e.tokenServiceUrl),n=new urlUtils[\"a\" /* Url */](window.location.href.toLowerCase()),o=this._getEsriAuthCookie(),a=e.shortLivedTokenValidity;let h,u,p,_,f,g,m,v,S,w;t&&(w=this.tokenValidity||a||this.defaultTokenValidity,w>a&&a>0&&(w=a)),s&&(u=s.isAdmin,p=s.serverUrl,_=s.token,m=s.signal,v=s.ssl,e.customParameters=s.customParameters),u?f=e.adminTokenServiceUrl:(f=e.tokenServiceUrl,g=new urlUtils[\"a\" /* Url */](f.toLowerCase()),o&&(h=o.auth_tier,h=h&&h.toLowerCase()),(\"web\"===h||e.webTierAuth)&&s&&s.serverUrl&&!v&&\"http\"===n.scheme&&(Object(urlUtils[\"q\" /* hasSameOrigin */])(n.uri,f,!0)||\"https\"===g.scheme&&n.host===g.host&&\"7080\"===n.port&&\"7443\"===g.port)&&(f=f.replace(/^https:/i,\"http:\").replace(/:7443/i,\":7080\"))),S=Object(lang[\"d\" /* mixin */])({query:Object(lang[\"d\" /* mixin */])({request:\"getToken\",username:t&&t.username,password:t&&t.password,serverUrl:p,token:_,expiration:w,referer:u||i?window.location.host:null,client:u?\"referer\":null,f:\"json\"},e.customParameters),method:\"post\",authMode:\"anonymous\",useProxy:this._useProxy(e,s),signal:m},s&&s.ioArgs),i||(S.withCredentials=!1);return Object(request[\"default\"])(f,S).then((r=>{const s=r.data;if(!s||!s.token)return new core_Error[\"a\" /* default */](\"identity-manager:authentication-failed\",\"Unable to generate token\");const i=e.server;return D[i]||(D[i]={}),t&&(D[i][t.username]=t.password),s.validity=w,s}))}isBusy(){return!!this._busy}checkSignInStatus(e){return this.checkAppAccess(e,\"\").then((e=>e.credential))}checkAppAccess(e,t,r){let s=!1;return this.getCredential(e,{prompt:!1}).then((i=>{let n;const o={f:\"json\"};if(\"portal\"===i.scope)if(t&&(this._doPortalSignIn(e,!0)||r&&r.force))n=i.server+\"/sharing/rest/oauth2/validateAppAccess\",o.client_id=t;else{if(!i.token)return{credential:i};n=i.server+\"/sharing/rest\"}else{if(!i.token)return{credential:i};n=i.server+\"/rest/services\"}return i.token&&(o.token=i.token),Object(request[\"default\"])(n,{query:o,authMode:\"anonymous\"}).then((e=>{if(!1===e.data.valid)throw new core_Error[\"a\" /* default */](\"identity-manager:not-authorized\",`You are currently signed in as: '${i.userId}'.`,e.data);return s=!!e.data.viewOnlyUserTypeApp,{credential:i}})).catch((e=>{if(\"identity-manager:not-authorized\"===e.name)throw e;const t=e.details&&e.details.httpStatus;if(498===t)throw i.destroy(),new core_Error[\"a\" /* default */](\"identity-manager:not-authenticated\",\"User is not signed in.\");if(400===t)throw new core_Error[\"a\" /* default */](\"identity-manager:invalid-request\");return{credential:i}}))})).then((e=>({credential:e.credential,viewOnly:s})))}setOAuthResponseHash(e){var t;const r=this._oAuthDfd;if(this._oAuthDfd=null,!r||!e)return;clearInterval(this._oAuthIntervalId),null==(t=this._oAuthOnHashHandle)||t.remove(),\"#\"===e.charAt(0)&&(e=e.substring(1));const s=Object(urlUtils[\"D\" /* queryToObject */])(e);if(s.error){const e=\"access_denied\"===s.error,t=new core_Error[\"a\" /* default */](e?\"identity-manager:user-aborted\":\"identity-manager:authentication-failed\",e?\"ABORTED\":\"OAuth: \"+s.error+\" - \"+s.error_description);r.reject(t)}else{const e=r.sinfo_,t=r.oinfo_,i=t._oAuthCred,n=new L({userId:s.username,server:e.server,token:s.access_token,expires:Date.now()+1e3*Number(s.expires_in),ssl:\"true\"===s.ssl,_oAuthCred:i});t.userId=n.userId,i.storage=s.persist?window.localStorage:window.sessionStorage,i.token=n.token,i.expires=n.expires,i.userId=n.userId,i.ssl=n.ssl,i.save(),r.resolve(n)}}setRedirectionHandler(e){this._redirectFunc=e}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,t,r={}){const s=Object(promiseUtils[\"g\" /* createResolver */])(),i=()=>{var e,t,r,s,i;null==(e=a)||e.remove(),null==(t=h)||t.remove(),null==(r=c)||r.remove(),null==(s=o)||s.destroy(),null==(i=this.dialog)||i.destroy(),this.dialog=o=a=h=c=null},n=()=>{i(),this._oAuthDfd=null,s.reject(new core_Error[\"a\" /* default */](\"identity-manager:user-aborted\",\"ABORTED\"))};r.signal&&Object(promiseUtils[\"r\" /* onAbort */])(r.signal,(()=>{n()}));let o=new this.formConstructor;o.resource=this.getResourceName(e),o.server=t.server,this.dialog=new IdentityModal,this.dialog.content=o,this.dialog.open=!0,this.emit(\"dialog-create\");let a=o.on(\"cancel\",n),h=this.dialog.watch(\"open\",n),c=o.on(\"submit\",(e=>{this.generateToken(t,e,{isAdmin:r.isAdmin,signal:r.signal}).then((n=>{i();const o=new L({userId:e.username,server:t.server,token:n.token,expires:null!=n.expires?Number(n.expires):null,ssl:!!n.ssl,isAdmin:r.isAdmin,validity:n.validity});s.resolve(o)})).catch((e=>{o.error=e,o.signingIn=!1}))}));return s.promise}oAuthSignIn(e,t,r,s){this._oAuthDfd=Object(promiseUtils[\"g\" /* createResolver */])();const i=this._oAuthDfd;null!=s&&s.signal&&Object(promiseUtils[\"r\" /* onAbort */])(s.signal,(()=>{const e=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;e&&!e.closed?e.close():this.dialog&&a()})),i.resUrl_=e,i.sinfo_=t,i.oinfo_=r;const n=!s||!1!==s.oAuthPopupConfirmation;if(!r.popup||!n)return this._doOAuthSignIn(e,t,r),i.promise;const o=new this.formConstructor;o.oAuthPrompt=!0,o.server=t.server,this.dialog=new IdentityModal,this.dialog.content=o,this.dialog.open=!0,this.emit(\"dialog-create\");const a=()=>{u(),this._oAuthDfd=null,i.reject(new core_Error[\"a\" /* default */](\"identity-manager:user-aborted\",\"ABORTED\"))},h=o.on(\"cancel\",a),c=this.dialog.watch(\"open\",a),d=o.on(\"submit\",(()=>{u(),this._doOAuthSignIn(e,t,r)})),u=()=>{h.remove(),c.remove(),d.remove(),o.destroy(),this.dialog.destroy(),this.dialog=null};return i.promise}destroyCredentials(){if(this.credentials){this.credentials.slice().forEach((e=>{e.destroy()}))}this.emit(\"credentials-destroy\")}_getOAuthHash(){let e=window.location.hash;if(e){\"#\"===e.charAt(0)&&(e=e.substring(1));const t=Object(urlUtils[\"D\" /* queryToObject */])(e);let r=!1;t.access_token&&t.expires_in&&t.state&&t.hasOwnProperty(\"username\")?(t.state=JSON.parse(t.state),this._oAuthHash=t,r=!0):t.error&&t.error_description&&(console.log(\"IdentityManager OAuth Error: \",t.error,\" - \",t.error_description),\"access_denied\"===t.error&&(r=!0)),r&&(window.location.hash=\"object\"==typeof t.state&&t.state.hash||\"\")}}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const e=new core_Error[\"a\" /* default */](\"identity-manager:user-aborted\",\"ABORTED\");this._errbackFunc(e)}}_findCredential(e,t){let r,s,i,n,o=-1;const a=t&&t.token,h=t&&t.resource,l=this._isServerRsrc(e)?\"server\":\"portal\",c=this.credentials.filter((t=>this._hasSameServerInstance(t.server,e)&&t.scope===l));if(e=h||e,c.length)if(1===c.length){if(r=c[0],n=this.findServerInfo(r.server),s=n&&n.owningSystemUrl,i=s&&this.findCredential(s,r.userId),o=this._getIdenticalSvcIdx(e,r),!a)return-1===o&&r.resources.push(e),this._addResource(e,i),r;-1!==o&&(r.resources.splice(o,1),this._removeResource(e,i))}else{let t,r;if(c.some((a=>(r=this._getIdenticalSvcIdx(e,a),-1!==r&&(t=a,n=this.findServerInfo(t.server),s=n&&n.owningSystemUrl,i=s&&this.findCredential(s,t.userId),o=r,!0)))),a)t&&(t.resources.splice(o,1),this._removeResource(e,i));else if(t)return this._addResource(e,i),t}}_findOAuthInfo(e){let t=this.findOAuthInfo(e);if(!t)for(const r of this.oAuthInfos)if(this._isIdProvider(r.portalUrl,e)){t=r;break}return t}_addResource(e,t){t&&-1===this._getIdenticalSvcIdx(e,t)&&t.resources.push(e)}_removeResource(e,t){let r=-1;t&&(r=this._getIdenticalSvcIdx(e,t),r>-1&&t.resources.splice(r,1))}_useProxy(e,t){return t&&t.isAdmin&&!Object(urlUtils[\"q\" /* hasSameOrigin */])(e.adminTokenServiceUrl,window.location.href)||!this._isPortalDomain(e.tokenServiceUrl)&&\"10.1\"===String(e.currentVersion)&&!Object(urlUtils[\"q\" /* hasSameOrigin */])(e.tokenServiceUrl,window.location.href)}_getOrigin(e){const t=new urlUtils[\"a\" /* Url */](e);return t.scheme+\"://\"+t.host+(null!=t.port?\":\"+t.port:\"\")}_getServerInstanceRoot(e){const t=e.toLowerCase();let r=t.indexOf(this._agsRest);return-1===r&&this._isAdminResource(e)&&(r=this._agsAdmin.test(e)?e.replace(this._agsAdmin,\"$1\").length:e.search(this._adminSvcs)),-1===r&&(r=t.indexOf(\"/sharing\")),-1===r&&\"/\"===t.substr(-1)&&(r=t.length-1),r>-1?e.substring(0,r):e}_hasSameServerInstance(e,t){return\"/\"===e.substr(-1)&&(e=e.slice(0,-1)),e=e.toLowerCase(),t=this._getServerInstanceRoot(t).toLowerCase(),e=this._normalizeAGOLorgDomain(e),t=this._normalizeAGOLorgDomain(t),(e=e.substr(e.indexOf(\":\")))===(t=t.substr(t.indexOf(\":\")))}_normalizeAGOLorgDomain(e){const t=/^https?:\\/\\/(?:cdn|[a-z\\d-]+\\.maps)\\.arcgis\\.com/i,r=/^https?:\\/\\/(?:cdndev|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,s=/^https?:\\/\\/(?:cdnqa|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i;return t.test(e)?e=e.replace(t,\"https://www.arcgis.com\"):r.test(e)?e=e.replace(r,\"https://devext.arcgis.com\"):s.test(e)&&(e=e.replace(s,\"https://qaext.arcgis.com\")),e}_sanitizeUrl(e){const t=(core_config[\"a\" /* default */].request.proxyUrl||\"\").toLowerCase(),r=t?e.toLowerCase().indexOf(t+\"?\"):-1;return-1!==r&&(e=e.substring(r+t.length+1)),e=Object(urlUtils[\"B\" /* normalize */])(e),Object(urlUtils[\"I\" /* urlToObject */])(e).path}_isRESTService(e){return e.indexOf(this._agsRest)>-1}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,t){let r;if(this._isRESTService(e)&&this._isRESTService(t)){const s=this._getSuffix(e).toLowerCase(),i=this._getSuffix(t).toLowerCase();if(r=s===i,!r){const e=/(.*)\\/(MapServer|FeatureServer).*/gi;r=s.replace(e,\"$1\")===i.replace(e,\"$1\")}}else this._isAdminResource(e)&&this._isAdminResource(t)?r=!0:this._isServerRsrc(e)||this._isServerRsrc(t)||!this._isPortalDomain(e)||(r=!0);return r}_isPortalDomain(e){const t=new urlUtils[\"a\" /* Url */](e.toLowerCase()),r=this._portalConfig;let s=this._gwDomains.some((e=>e.regex.test(t.uri)));return!s&&r&&(s=this._hasSameServerInstance(this._getServerInstanceRoot(r.restBaseUrl),t.uri)),s||core_config[\"a\" /* default */].portalUrl&&(s=Object(urlUtils[\"q\" /* hasSameOrigin */])(t,core_config[\"a\" /* default */].portalUrl,!0)),s||(s=this._portals.some((e=>this._hasSameServerInstance(e,t.uri)))),s=s||this._agsPortal.test(t.path),s}_isIdProvider(e,t){let r=-1,s=-1;this._gwDomains.forEach(((i,n)=>{-1===r&&i.regex.test(e)&&(r=n),-1===s&&i.regex.test(t)&&(s=n)}));let i=!1;if(r>-1&&s>-1&&(0===r||4===r?0!==s&&4!==s||(i=!0):1===r?1!==s&&2!==s||(i=!0):2===r?2===s&&(i=!0):3===r&&3===s&&(i=!0)),!i){const r=this.findServerInfo(t),s=r&&r.owningSystemUrl;s&&j(r)&&this._isPortalDomain(s)&&this._isIdProvider(e,s)&&(i=!0)}return i}_getIdenticalSvcIdx(e,t){let r=-1;for(let s=0;s<t.resources.length;s++){const i=t.resources[s];if(this._isIdenticalService(e,i)){r=s;break}}return r}_getSuffix(e){return e.replace(this._regexSDirUrl,\"\").replace(this._regexServerType,\"$1\")}_getTokenSvcUrl(e){let t,r,s;if(this._isRESTService(e)||this._isAdminResource(e)){const s=this._getServerInstanceRoot(e);return t=s+\"/admin/generateToken\",r=Object(request[\"default\"])(e=s+\"/rest/info\",{query:{f:\"json\"}}).then((e=>e.data)),{adminUrl:t,promise:r}}if(this._isPortalDomain(e)){let t=\"\";if(this._gwDomains.some((r=>(r.regex.test(e)&&(t=r.tokenServiceUrl),!!t))),t||this._portals.some((r=>(this._hasSameServerInstance(r,e)&&(t=r+this._gwTokenUrl),!!t))),t||(s=e.toLowerCase().indexOf(\"/sharing\"),-1!==s&&(t=e.substring(0,s)+this._gwTokenUrl)),t||(t=this._getOrigin(e)+this._gwTokenUrl),t){const r=new urlUtils[\"a\" /* Url */](e).port;/^http:\\/\\//i.test(e)&&\"7080\"===r&&(t=t.replace(/:7080/i,\":7443\")),t=t.replace(/http:/i,\"https:\")}return t}if(-1!==e.toLowerCase().indexOf(\"premium.arcgisonline.com\"))return\"https://premium.arcgisonline.com/server/tokens\"}_exchangeToken(e,t,r){return Object(request[\"default\"])(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:\"anonymous\",method:\"post\",query:{f:\"json\",client_id:t,token:r}}).then((e=>e.data.token))}_getPortalSelf(e,t){let r;if(this._gwDomains.some((t=>(t.regex.test(e)&&(r=t.customBaseUrl),!!r))),r)return Object(promiseUtils[\"u\" /* resolve */])({allSSL:!0,currentVersion:\"4.4\",customBaseUrl:r,portalMode:\"multitenant\",supportsOAuth:!0});\"https:\"===window.location.protocol?e=e.replace(/^http:/i,\"https:\").replace(/:7080/i,\":7443\"):/^http:/i.test(t)&&(e=e.replace(/^https:/i,\"http:\").replace(/:7443/i,\":7080\"));return Object(request[\"default\"])(e,{query:{f:\"json\"},authMode:\"anonymous\",withCredentials:!0}).then((e=>e.data))}_hasPortalSession(){return!!this._getEsriAuthCookie()}_getEsriAuthCookie(){let e=null;if(navigator.cookieEnabled){const t=this._getAllCookies(\"esri_auth\");let r;for(let s=0;s<t.length;s++){const i=JSON.parse(t[s]);if(i.portalApp){e=i;break}r?r.push(i):r=[i]}if(!e&&r)for(const t of r)if(t.urlKey&&window.location.hostname===`${t.urlKey.toLowerCase()}.${t.customBaseUrl}`){e=t;break}}if(e){let t=null;e.expires&&(\"number\"==typeof e.expires?t=e.expires:\"string\"==typeof e.expires&&(t=Date.parse(e.expires)),isNaN(t)&&(t=null),e.expires=t),t&&t<Date.now()&&(e=null)}return e}_getAllCookies(e){const t=[],r=document.cookie.match(new RegExp(\"(?:^|; )\"+Object(string[\"a\" /* escapeRegExpString */])(e)+\"=([^;]*)\",\"g\"));if(r)for(let e=0;e<r.length;e++){let s=r[e];const i=s.indexOf(\"=\");i>-1&&(s=s.substring(i+1),t.push(decodeURIComponent(s)))}return t}_doPortalSignIn(e,t){if(navigator.cookieEnabled){const r=this._getEsriAuthCookie(),s=this._portalConfig,i=window.location.href,n=this.findServerInfo(e);if((t||this.useSignInPage)&&(s||this._isPortalDomain(i)||r)&&(n?n.hasPortal||n.owningSystemUrl&&this._isPortalDomain(n.owningSystemUrl):this._isPortalDomain(e))&&(this._isIdProvider(i,e)||s&&(this._hasSameServerInstance(this._getServerInstanceRoot(s.restBaseUrl),e)||this._isIdProvider(s.restBaseUrl,e))||Object(urlUtils[\"q\" /* hasSameOrigin */])(i,e,!0)))return!0}return!1}_canUsePortalSignInWorkflow(e){return this._doPortalSignIn(e)&&(window===window.top||this._hasPortalSession())}_checkProtocol(e,t,r,s){let i=!0;const n=s?t.adminTokenServiceUrl:t.tokenServiceUrl;if(0===n.trim().toLowerCase().indexOf(\"https:\")&&0!==window.location.href.toLowerCase().indexOf(\"https:\")&&Object(urlUtils[\"o\" /* getProxyRule */])(n)&&(i=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:t}),!i)){r(new core_Error[\"a\" /* default */](\"identity-manager:aborted\",\"Aborted the Sign-In process to avoid sending password over insecure connection.\"))}return i}_enqueue(e,t,r,s,i,n){return s||(s=Object(promiseUtils[\"g\" /* createResolver */])()),s.resUrl_=e,s.sinfo_=t,s.options_=r,s.admin_=i,s.refresh_=n,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(s)):this._xoReqs.push(s):this._doSignIn(s),s.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const t=t=>{const r=e.options_&&e.options_.resource,s=e.resUrl_,i=e.refresh_;let n=!1;-1===this.credentials.indexOf(t)&&(i&&-1!==this.credentials.indexOf(i)?(i.userId=t.userId,i.token=t.token,i.expires=t.expires,i.validity=t.validity,i.ssl=t.ssl,i.creationTime=t.creationTime,n=!0,t=i):this.credentials.push(t)),t.resources||(t.resources=[]),t.resources.push(r||s),t.scope=this._isServerRsrc(s)?\"server\":\"portal\",t.emitTokenChange();const o=this._soReqs,a={};this._soReqs=[],o.forEach((e=>{if(!this._isIdenticalService(s,e.resUrl_)){const r=this._getSuffix(e.resUrl_);a[r]||(a[r]=!0,t.resources.push(e.resUrl_))}})),e.resolve(t),o.forEach((e=>{this._hasSameServerInstance(this._getServerInstanceRoot(s),e.resUrl_)?e.resolve(t):this._soReqs.push(e)})),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,n||this.emit(\"credential-create\",{credential:t}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=t=>{e.reject(t),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=(s,i,n,o)=>{const a=e.sinfo_,h=!e.options_||!1!==e.options_.prompt,c=a.hasPortal&&this._findOAuthInfo(e.resUrl_);let d,u;if(this._canUsePortalSignInWorkflow(e.resUrl_)){const s=this._getEsriAuthCookie(),i=this._portalConfig;if(s){if(!a.webTierAuth){\"web\"===(s.auth_tier&&s.auth_tier.toLowerCase())&&(a.webTierAuth=!0)}return d=new L({userId:s.email,server:a.server,token:a.webTierAuth?null:s.token,expires:s.expires}),void(d.token?e._pendingDfd=this._exchangeToken(d.server,c?c.appId:\"arcgisonline\",d.token).then((e=>{d.token=e,t(d)})).catch((()=>{t(d)})):t(d))}if(h){let t=\"\";const s=window.location.href;return t=this.signInPage?this.signInPage:i?i.baseUrl+i.signin:this._isIdProvider(s,e.resUrl_)?this._getOrigin(s)+\"/home/signin.html\":a.tokenServiceUrl.replace(this._rePortalTokenSvc,\"\")+\"/home/signin.html\",t=t.replace(/http:/i,\"https:\"),i&&!1===i.useSSL&&(t=t.replace(/https:/i,\"http:\")),void(0===s.toLowerCase().replace(\"https\",\"http\").indexOf(t.toLowerCase().replace(\"https\",\"http\"))?(u=new core_Error[\"a\" /* default */](\"identity-manager:unexpected-error\",\"Cannot redirect to Sign-In page from within Sign-In page. URL of the resource that triggered this workflow: \"+e.resUrl_),r(u)):(this._rejectOnPersistedPageShow=!0,this._redirectFunc?this._redirectFunc({signInPage:t,returnUrlParamName:\"returnUrl\",returnUrl:s,resourceUrl:e.resUrl_,serverInfo:a}):window.location.href=t+\"?returnUrl=\"+encodeURIComponent(s)))}u=new core_Error[\"a\" /* default */](\"identity-manager:not-authenticated\",\"User is not signed in.\"),r(u)}else if(s)t(new L({userId:s,server:a.server,token:n,expires:null!=o?Number(o):null,ssl:!!i}));else if(c){let s=c._oAuthCred;if(!s){const e=new OAuthCredential(c,window.localStorage),t=new OAuthCredential(c,window.sessionStorage);e.isValid()&&t.isValid()?e.expires>t.expires?(s=e,t.destroy()):(s=t,e.destroy()):s=e.isValid()?e:t,c._oAuthCred=s}if(s.isValid())d=new L({userId:s.userId,server:a.server,token:s.token,expires:s.expires,ssl:s.ssl,_oAuthCred:s}),c.appId!==s.appId&&this._doPortalSignIn(e.resUrl_,!0)?e._pendingDfd=this._exchangeToken(d.server,c.appId,d.token).then((e=>{d.token=e,s.token=e,s.save(),t(d)})).catch((()=>{t(d)})):t(d);else if(this._oAuthHash&&this._oAuthHash.state.portalUrl===c.portalUrl){const e=this._oAuthHash;d=new L({userId:e.username,server:a.server,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:\"true\"===e.ssl,oAuthState:e.state,_oAuthCred:s}),c.userId=d.userId,s.storage=e.persist?window.localStorage:window.sessionStorage,s.token=d.token,s.expires=d.expires,s.userId=d.userId,s.ssl=d.ssl,s.save(),this._oAuthHash=null,t(d)}else h?e._pendingDfd=this.oAuthSignIn(e.resUrl_,a,c,e.options_).then(t,r):(u=new core_Error[\"a\" /* default */](\"identity-manager:not-authenticated\",\"User is not signed in.\"),r(u))}else if(h){if(this._checkProtocol(e.resUrl_,a,r,e.admin_)){let s=e.options_;e.admin_&&(s=s||{},s.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,a,s).then(t,r)}}else u=new core_Error[\"a\" /* default */](\"identity-manager:not-authenticated\",\"User is not signed in.\"),r(u)},n=()=>{const s=e.sinfo_,i=s.owningSystemUrl,n=e.options_;let o,a,h,l;if(n&&(o=n.token,a=n.error,h=n.prompt),l=this._findCredential(i,{token:o,resource:e.resUrl_}),!l)for(const e of this.credentials)if(this._isIdProvider(i,e.server)){l=e;break}if(l){const i=this.findCredential(e.resUrl_,l.userId);if(i)t(i);else if(q(s,this._legacyFed)){const e=l.toJSON();e.server=s.server,e.resources=null,t(new L(e))}else{(e._pendingDfd=this.generateToken(this.findServerInfo(l.server),null,{serverUrl:e.resUrl_,token:l.token,signal:e.options_.signal,ssl:l.ssl})).then((r=>{t(new L({userId:l.userId,server:s.server,token:r.token,expires:null!=r.expires?Number(r.expires):null,ssl:!!r.ssl,isAdmin:e.admin_,validity:r.validity}))}),r)}}else{this._busy=null,o&&(e.options_.token=null);(e._pendingDfd=this.getCredential(i.replace(/\\/?$/,\"/sharing\"),{resource:e.resUrl_,owningTenant:s.owningTenant,signal:e.options_.signal,token:o,error:a,prompt:h})).then((()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)}),(e=>{r(e)}))}};this._errbackFunc=r;const o=e.sinfo_.owningSystemUrl,a=this._isServerRsrc(e.resUrl_),h=e.sinfo_._restInfoPms;h?h.promise.then((t=>{const r=e.sinfo_;if(r._restInfoPms){r.adminTokenServiceUrl=r._restInfoPms.adminUrl,r._restInfoPms=null,r.tokenServiceUrl=Object(object[\"b\" /* getDeepValue */])(\"authInfo.tokenServicesUrl\",t)||Object(object[\"b\" /* getDeepValue */])(\"authInfo.tokenServiceUrl\",t)||Object(object[\"b\" /* getDeepValue */])(\"tokenServiceUrl\",t),r.shortLivedTokenValidity=Object(object[\"b\" /* getDeepValue */])(\"authInfo.shortLivedTokenValidity\",t),r.currentVersion=t.currentVersion,r.owningTenant=t.owningTenant;const e=r.owningSystemUrl=t.owningSystemUrl;e&&this._portals.push(e)}a&&r.owningSystemUrl?n():s()}),(()=>{e.sinfo_._restInfoPms=null;const t=new core_Error[\"a\" /* default */](\"identity-manager:server-identification-failed\",\"Unknown resource - could not find token service endpoint.\");r(t)})):a&&o?n():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then((t=>{const r={};let s,i,n,o;return t&&(s=t.user&&t.user.username,r.username=s,r.allSSL=t.allSSL,i=t.supportsOAuth,n=t.currentVersion,\"multitenant\"===t.portalMode&&(o=t.customBaseUrl)),e.sinfo_.webTierAuth=!!s,s&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:r.allSSL}).catch((()=>null)).then((e=>(r.portalToken=e&&e.token,r.tokenExpiration=e&&e.expires,r))):!s&&i&&parseFloat(n)>=4.4&&!this._canUsePortalSignInWorkflow(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:o,owningTenant:e.sinfo_._selfReq.owningTenant}).catch((()=>null)).then((()=>r)):r})).catch((()=>null)).then((t=>{e.sinfo_._selfReq=null,t?s(t.username,t.allSSL,t.portalToken,t.tokenExpiration):s()})):s()}_generateOAuthInfo(e){let t,r,s=e.portalUrl;const i=e.customBaseUrl,n=e.owningTenant,o=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(o){r=window.location.href;let e=r.indexOf(\"?\");e>-1&&(r=r.slice(0,e)),e=r.search(/\\/(apps|home)\\//),r=e>-1?r.slice(0,e):null}return o&&r?(this._hasTestedIfAppIsOnPortal=!0,t=Object(request[\"default\"])(r+\"/sharing/rest\",{query:{f:\"json\"}}).then((()=>{this.defaultOAuthInfo=new OAuthInfo({appId:\"arcgisonline\",popup:!0,popupCallbackUrl:r+\"/home/oauth-callback.html\"})}))):t=Object(promiseUtils[\"u\" /* resolve */])(),t.then((()=>{if(this.defaultOAuthInfo)return s=s.replace(/^http:/i,\"https:\"),Object(request[\"default\"])(s+\"/sharing/rest/oauth2/validateRedirectUri\",{query:{accountId:n,client_id:this.defaultOAuthInfo.appId,redirect_uri:Object(urlUtils[\"y\" /* makeAbsolute */])(this.defaultOAuthInfo.popupCallbackUrl),f:\"json\"}}).then((e=>{if(e.data.valid){const t=this.defaultOAuthInfo.clone();e.data.urlKey&&i?t.portalUrl=\"https://\"+e.data.urlKey.toLowerCase()+\".\"+i:t.portalUrl=s,this.oAuthInfos.push(t)}}))}))}_doOAuthSignIn(e,r,s){const i={portalUrl:s.portalUrl};!s.popup&&s.preserveUrlHash&&window.location.hash&&(i.hash=window.location.hash);const n={client_id:s.appId,response_type:\"token\",state:JSON.stringify(i),expiration:s.expiration,locale:s.locale,redirect_uri:s.popup?Object(urlUtils[\"y\" /* makeAbsolute */])(s.popupCallbackUrl):window.location.href.replace(/#.*$/,\"\")};s.forceLogin&&(n.force_login=!0),s.forceUserId&&s.userId&&(n.prepopulatedusername=s.userId);const o=s.portalUrl.replace(/^http:/i,\"https:\")+\"/sharing/oauth2/authorize\",a=o+\"?\"+Object(urlUtils[\"C\" /* objectToQuery */])(n);if(s.popup){const e=window.open(a,\"esriJSAPIOAuth\",s.popupWindowFeatures);if(e)e.focus(),this._oAuthDfd.oAuthWin_=e,this._oAuthIntervalId=setInterval((()=>{if(e.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnHashHandle.remove();const e=this._oAuthDfd;if(e){const t=new core_Error[\"a\" /* default */](\"identity-manager:user-aborted\",\"ABORTED\");e.reject(t)}}}),500),this._oAuthOnHashHandle=Object(events[\"c\" /* on */])(global[\"a\" /* default */],\"arcgis:auth:hash\",(e=>{this.setOAuthResponseHash(e.detail)}));else{const e=new core_Error[\"a\" /* default */](\"identity-manager:popup-blocked\",\"ABORTED\");this._oAuthDfd.reject(e)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:n,authorizeUrl:o,resourceUrl:e,serverInfo:r,oAuthInfo:s}):window.location.href=a}};E=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.identity.IdentityManagerBase\")],E);let L=class extends Evented[\"a\" /* default */].EventedAccessor{constructor(e){super(e),this._oAuthCred=null,this.tokenRefreshBuffer=2,e&&e._oAuthCred&&(this._oAuthCred=e._oAuthCred)}initialize(){this.resources=this.resources||[],null==this.creationTime&&(this.creationTime=Date.now())}refreshToken(){const e=kernel[\"b\" /* id */].findServerInfo(this.server),t=e&&e.owningSystemUrl,r=!!t&&\"server\"===this.scope,s=r&&q(e,kernel[\"b\" /* id */]._legacyFed),i=e.webTierAuth,n=i&&kernel[\"b\" /* id */].normalizeWebTierAuth,o=D[this.server],a=o&&o[this.userId];let h,l,c=this.resources&&this.resources[0],d=r&&kernel[\"b\" /* id */].findServerInfo(t),u={username:this.userId,password:a};if((!i||n)&&(r&&!d&&kernel[\"b\" /* id */].serverInfos.some((e=>(kernel[\"b\" /* id */]._isIdProvider(t,e.server)&&(d=e),!!d))),h=d&&kernel[\"b\" /* id */].findCredential(d.server,this.userId),!r||h)){if(!s){if(r)l={serverUrl:c,token:h&&h.token,ssl:h&&h.ssl};else if(n)u=null,l={ssl:this.ssl};else{if(!a){let t;return c&&(c=kernel[\"b\" /* id */]._sanitizeUrl(c),this._enqueued=1,t=kernel[\"b\" /* id */]._enqueue(c,e,null,null,this.isAdmin,this),t.then((()=>{this._enqueued=0,this.refreshServerTokens()})).catch((()=>{this._enqueued=0}))),t}this.isAdmin&&(l={isAdmin:!0})}return kernel[\"b\" /* id */].generateToken(r?d:e,r?null:u,l).then((e=>{this.token=e.token,this.expires=null!=e.expires?Number(e.expires):null,this.creationTime=Date.now(),this.validity=e.validity,this.emitTokenChange(),this.refreshServerTokens()})).catch((()=>{}))}h.refreshToken()}}refreshServerTokens(){\"portal\"===this.scope&&kernel[\"b\" /* id */].credentials.forEach((e=>{const t=kernel[\"b\" /* id */].findServerInfo(e.server),r=t&&t.owningSystemUrl;e!==this&&e.userId===this.userId&&r&&\"server\"===e.scope&&(kernel[\"b\" /* id */]._hasSameServerInstance(this.server,r)||kernel[\"b\" /* id */]._isIdProvider(r,this.server))&&(q(t,kernel[\"b\" /* id */]._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())}))}emitTokenChange(e){clearTimeout(this._refreshTimer);const t=this.server&&kernel[\"b\" /* id */].findServerInfo(this.server),r=t&&t.owningSystemUrl,s=r&&kernel[\"b\" /* id */].findServerInfo(r);!1===e||r&&\"portal\"!==this.scope&&(!s||!s.webTierAuth||kernel[\"b\" /* id */].normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer(),this.emit(\"token-change\")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const e=kernel[\"b\" /* id */].credentials.indexOf(this);e>-1&&kernel[\"b\" /* id */].credentials.splice(e,1),this.emitTokenChange(),this.emit(\"destroy\")}toJSON(){const e=Object(lang[\"c\" /* fixJson */])({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),t=this.resources;return t&&t.length>0&&(e.resources=t.slice()),e}_startRefreshTimer(){clearTimeout(this._refreshTimer);const e=6e4*this.tokenRefreshBuffer;let t=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();t<0&&(t=0),this._refreshTimer=setTimeout(this.refreshToken.bind(this),t>e?t-e:t)}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"creationTime\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"expires\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"isAdmin\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"oAuthState\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"resources\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"scope\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"server\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"ssl\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"token\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"tokenRefreshBuffer\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"userId\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],L.prototype,\"validity\",void 0),L=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.identity.Credential\")],L);\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/identity/IdentityManager.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nlet IdentityManager_o=class extends E{};IdentityManager_o=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.identity.IdentityManager\")],IdentityManager_o);const IdentityManager_a=new IdentityManager_o;Object(kernel[\"c\" /* setId */])(IdentityManager_a);/* harmony default export */ var IdentityManager = __webpack_exports__[\"default\"] = (IdentityManager_a);\n\n\n/***/ })\n\n}]);","inputSourceMap":null}