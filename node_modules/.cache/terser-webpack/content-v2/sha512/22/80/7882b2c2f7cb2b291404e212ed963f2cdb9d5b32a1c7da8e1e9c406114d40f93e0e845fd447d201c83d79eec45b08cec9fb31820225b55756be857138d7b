{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{tGAV:function(e,t,i){\"use strict\";i.r(t),i.d(t,\"LabelManager\",function(){return L}),i.d(t,\"Stage\",function(){return Gt}),i.d(t,\"GraphicsView2D\",function(){return Wt.a}),i.d(t,\"MapViewNavigation\",function(){return yi}),i.d(t,\"MagnifierView2D\",function(){return Si});var s=i(\"pO5D\"),r=i(\"wSAH\"),a=i(\"6S2I\"),n=(i(\"zqDF\"),i(\"WbKI\")),o=i(\"04ZG\"),h=i(\"zlDU\"),l=(i(\"4EHJ\"),i(\"ju1D\"),i(\"9AIY\"),i(\"/CmD\")),c=i(\"kJYu\"),d=i(\"5C/r\"),u=i(\"OKTS\"),m=i(\"jIHu\"),g=i(\"rlSK\"),p=(i(\"Pns9\"),i(\"AY31\"),i(\"B81a\"),i(\"0wLv\"),i(\"M0lq\")),_=class{constructor(){this._reference=null}get dirty(){return this.reference&&this.reference.isDirty}set dirty(e){this.reference&&this.reference.hasData&&(e||this.reference.isDirty)&&(this.reference.isDirty=e)}get index(){return this._reference&&this._reference.labelIndex}get reference(){return this._reference}set reference(e){this._reference=e}reset(e,t,i){const{state:s}=e,r=i.layerView.tileRenderer,a=this.reference;if(!a||!a.hasData)return!1;t&&(a.isDirty=!0);const n=a.transforms.labelMat2d,o=n[4],h=n[5];for(const l of a.displayObjects){const e=r.featuresView.attributeView,t=i.hasVV()?e.getVVSize(l.id):0;for(const r of l.metrics){i.hasVV()&&r.computeVVOffset(t,i.vvEval);const e=r.bounds.center,l=r.bounds.centerT;a.isDirty&&(r.minZoom=-1);const c=Object(p.c)(l,r.anchor);if(s.rotation?Object(p.n)(c,c,n):(l[0]=c[0]+o,l[1]=c[1]+h),Object(p.h)(l,c,e),l[0]+=r.offsetX,l[1]+=r.offsetY,r.boxes)for(const t of r.boxes){const e=t.center,i=r.anchor,a=t.centerT;Object(p.h)(a,i,e),s.rotation?Object(p.n)(a,a,n):(a[0]=a[0]+o,a[1]=a[1]+h)}}}return!0}},f=i(\"qRWG\"),b=i(\"m0D6\");const w=Math.PI;function y(e,t){switch(t.transformationType){case\"additive\":return(i=e)+(v((s=t).minSize,i)||s.minDataValue);case\"constant\":return function(e,t){const i=e.stops;let s=i&&i.length&&i[0].size;return null==s&&(s=e.minSize),v(s,t)}(t,e);case\"clamped-linear\":return function(e,t){const i=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),s=v(t.minSize,e),r=v(t.maxSize,e);return e<=t.minDataValue?s:e>=t.maxDataValue?r:s+i*(r-s)}(e,t);case\"proportional\":return function(e,t){const i=e/t.minDataValue,s=v(t.minSize,e),r=v(t.maxSize,e);let a=null;return a=i*s,Object(u.c)(a,s,r)}(e,t);case\"stops\":return function(e,t){const[i,s,r]=function(e,t){if(!t)return;let i=0,s=t.length-1;return t.some((t,r)=>e<t?(s=r,!0):(i=r,!1)),[i,s,(e-t[i])/(t[s]-t[i])]}(e,t.cache.ipData);if(i===s)return v(t.stops[i].size,e);{const a=v(t.stops[i].size,e);return a+(v(t.stops[s].size,e)-a)*r}}(e,t);case\"real-world-size\":return function(e,t){const i=b.a[t.valueUnit],s=v(t.minSize,e),r=v(t.maxSize,e),{valueRepresentation:a}=t;let n=null;return n=\"area\"===a?2*Math.sqrt(e/w)/i:\"radius\"===a||\"distance\"===a?2*e/i:e/i,Object(u.c)(n,s,r)}(e,t);case\"identity\":return e;case\"unknown\":return null}var i,s}function v(e,t){return\"number\"==typeof e?e:y(t,e)}const x=(e,t)=>e.order-t.order,O=(e,t)=>e.index-t.index,T=a.a.getLogger(\"esri/views/2d/engine/webgl/collisions/CollisionEngine\");function S(e,t){const i=!!e.maxScale,s=!!e.minScale&&t.scaleToZoom(e.minScale)||0,r=i&&t.scaleToZoom(e.maxScale)||255;return{deconflictionStrategy:e.deconflictionStrategy,minZoom:Object(u.c)(Math.floor(10*s),0,255),maxZoom:Object(u.c)(Math.floor(10*r),0,255)}}function C(e){return t=>Object(f.d)(y(t,e))}function M(e){if(!e)return null;for(const t of e)if(\"size\"===t.type)return C(t);return null}class j{constructor(e,t,i,s){this._vvHandle=null;const r=e.layer,{geometryType:a,labelingInfo:n,renderer:o}=r;o&&(this.vvEval=M(\"visualVariables\"in o&&o.visualVariables)),this._vvHandle=r.watch(\"renderer\",e=>{e&&(this.vvEval=M(\"visualVariables\"in e&&e.visualVariables))});const h=r.featureReduction,l=h&&\"cluster\"===h.type&&h.labelingInfo,c=(n||[]).map(e=>S(e,s)),d=(l||[]).map(e=>S(e,s));this.layerView=e,this.geometryType=a,this.index=t,this.order=i,this.zoomRanges=[...c,...d],this.layerView=e}hasVV(){return!!this.vvEval}allOrNothing(){return!(\"polyline\"===this.geometryType)}destroy(){this._vvHandle.remove()}static create(e,t,i,s){const r=i.sort(x);let a=!1,n=-1;for(const o of r)!a&&o.order>t&&(n=o.index,a=!0),a&&o.index++;return a||(n=r.length),new j(e,n,t,s)}static delete(e,t){const i=t.sort(O);for(let s=e+1;s<i.length;s++)t[s].index--;t[e].destroy(),t.splice(e,1)}static find(e,t){for(const i of t)if(i.index===e)return i;return T.error(\"Tried to get a LayerCollisionInfo for an index that doesn't exist!\"),null}}var P=j;const F=m.F/m.d,R=F,B=a.a.getLogger(\"esri.views.2d.engine.webgl.collisions.CollisionEngine\");class z{constructor(e){this._layers=new Map,this._collisionBuckets=new Map,this._didError=!1,this._tilingScheme=e}get collisionInfos(){return Array.from(this._layers.values())}registerLayerView(e,t){if(this._layers.has(e))return;const i=P.create(e,t,this.collisionInfos,this._tilingScheme);this._layers.set(e,i),this._collisionBuckets.forEach(e=>e.onRegisterLayer(i.index))}unregisterLayerView(e){if(!this._layers.has(e))return;const t=this._layers.get(e);P.delete(t.index,this.collisionInfos),this._layers.delete(e),this._collisionBuckets.forEach((e,i)=>{const s=e.getTile(t.index);s&&(e.onUnregisterLayer(t.index),e.canDelete()&&this._collisionBuckets.delete(i),s.reference&&(s.reference.isDirty=!1))})}addTile(e,t){const i=t.key.id;if(!this._layers.has(e))return;this._collisionBuckets.has(i)||this._collisionBuckets.set(i,new class{constructor(e,t){this.neighbors=new Array(9),this._tiles=new Array(t);for(let i=0;i<t;i++)this._tiles[i]=new _;this.key=e}get isDirty(){for(const e of this._tiles)if(e.dirty)return!0;return!1}get size(){return this._tiles.length}getTile(e){return this._tiles[e]}getReference(e){const t=this._tiles[e];return t&&t.reference}onRegisterLayer(e){this.invalidateRange(e),this._add(e)}onUnregisterLayer(e){this.invalidateRange(e),this._remove(e)}onLabelsRendered(){}invalidateRange(e){for(let t=e;t<this._tiles.length;t++)this._tiles[t].dirty=!0}add(e){this._add(e)}remove(e){this._remove(e)}canDelete(){return 0===this._tiles.length}ready(){for(const e of this._tiles)e.dirty=!1}computeNeighbors(e){this.neighbors[0]=this._getNeighbor(e,-1,-1),this.neighbors[1]=this._getNeighbor(e,0,-1),this.neighbors[2]=this._getNeighbor(e,1,-1),this.neighbors[3]=this._getNeighbor(e,-1,0),this.neighbors[4]=this,this.neighbors[5]=this._getNeighbor(e,1,0),this.neighbors[6]=this._getNeighbor(e,-1,1),this.neighbors[7]=this._getNeighbor(e,0,1),this.neighbors[8]=this._getNeighbor(e,1,1)}reset(e,t,i){const s=this._tiles[i.index];s&&s.reset(e,t,i)}_add(e){const t=[];if(e>=this._tiles.length)this._tiles.push(new _);else{for(let i=0;i<this._tiles.length;i++)i===e&&t.push(new _),t.push(this._tiles[i]);this._tiles=t}}_remove(e){const t=[];for(let i=0;i<this._tiles.length;i++)i!==e&&t.push(this._tiles[i]);this._tiles=t}_getNeighbor(e,t,i){const s=this.key,r=g.a.getId(s.level,s.row+i,s.col+t,s.world);return e.has(r)?e.get(r):null}}(t.key,this._layers.size));const s=this._getIndex(e);this._collisionBuckets.get(i).getTile(s).reference=t}removeTile(e,t){if(!this._layers.has(e)||!this._collisionBuckets.has(t))return;const i=this._getIndex(e),s=this._collisionBuckets.get(t).getTile(i);s.dirty=!1,s.reference=null}run(e,t){const i=Array.from(this._collisionBuckets.values()).sort((e,t)=>e.key.compareRowMajor(t.key));let s=!0;const r=e.renderingOptions.labelCollisionsEnabled&&!this._didError,a=this.collisionInfos;try{for(const t of i){s=s||t.isDirty,t.computeNeighbors(this._collisionBuckets);for(let i=0;i<this._layers.size;i++){const r=P.find(i,a);t.reset(e,s,r)}}for(let e=0;e<this._layers.size;e++){const s=P.find(e,a);for(const e of i)this._run(r,e,s,t)}}catch(e){B.error(new h.a(\"mapview-labeling\",\"Encountered an error during decluttering. Disabling collisions\",e)),this._didError=!0}for(const n of i)n.ready()}_run(e,t,i,s){const r=t.getReference(i.index);r&&r.hasData&&(r.key.level!==s?this._resetLabelsMinZoom(t,i):this._runVisibility(e,t,r,i,s))}_resetLabelsMinZoom(e,t){if(!e||\"polyline\"===t.geometryType)return;const i=e.getReference(t.index);if(!i||!i.hasData)return;const s=t.layerView.tileRenderer.featuresView.attributeView,r=i.displayObjects;for(const a of r)s.setLabelMinZoom(a.id,255)}_checkLabelsVisible(e,t){return(!t.filter||!!(e&m.i))&&(!t.effect||t.effect.excludedLabelsVisible||!!(e&m.h))}_runVisibility(e,t,i,s,r){const a=s.layerView.tileRenderer.featuresView.attributeView,n=i.displayObjects.sort((e,t)=>a.getLabelMinZoom(e.id)-a.getLabelMinZoom(t.id)),o=s.zoomRanges.some(e=>\"none\"===e.deconflictionStrategy);for(const h of n){if(!h.metrics.length)continue;let i=\"polyline\"===s.geometryType?0:10*(r-1);const n=a.getFilterFlags(h.id),l=this._checkLabelsVisible(n,s.layerView);if(e&&!o)for(let e=0;e<h.metrics.length;e++){const a=h.metrics[e],n=l?-1!==a.minZoom?a.minZoom:this._computeLabelVisibility(h,a,s.index,t,a.baseZoom,r):255;i=Math.max(n,i)}i=Math.max(i,0),a.setLabelMinZoom(h.id,i);for(const e of h.metrics)e.minZoom=i}}_computeLabelVisibility(e,t,i,s,r,a){let n=r;const{xBucket:o,yBucket:h,xOverflow:l,yOverflow:c}=t,d=o-l,u=o+l+1,m=h+c+1;for(let g=h-c;g<m;g++)for(let r=d;r<u;r++)if(!(r<-F||g<-R||r>F||g>R))for(let o=0;o<=i;o++){const h=this._getRelativeSubBucket(o,s,r,g);if(h)for(const s of h){if(o===i&&s.id===e.id)continue;const r=this._compareLabels(t,s,n,a);n=Math.max(r,n)}}return n}_compareLabels(e,t,i,s){if(-1===t.minZoom||t.minZoom>10*(s+1))return i;const r=e.findCollisionDelta(t),a=Object(u.c)(Math.ceil(10*(r+s)),0,255);return t.minZoom>=a?i:Math.max(i,a)}_getNeighboringTile(e,t,i,s){const r=t.neighbors[3*(1+s)+(1+i)];return r&&r.getTile(e)}_getRelativeSubBucket(e,t,i,s){const r=Object(u.l)(Math.floor(i/4)),a=Object(u.l)(Math.floor(s/4)),n=this._getNeighboringTile(e,t,r,a);return n&&n.reference&&n.index&&n.reference.hasData?n.index[s-4*a][i-4*r]:null}_getIndex(e){return this._layers.get(e).index}}const D=a.a.getLogger(\"esri.views.2d.engine.collisions.LayerViewSorter\");function I(e){return\"esri.views.2d.layers.FeatureLayerView2D\"===e.declaredClass||\"esri.views.2d.layers.StreamLayerView2D\"===e.declaredClass}function E(e){if(!e.layer||!e.layer.renderer)return!1;switch(e.layer.renderer.type){case\"class-breaks\":case\"simple\":case\"unique-value\":case\"dictionary\":case\"dot-density\":return!0;default:return D.error(new h.a(\"mapview-labeling\",`Renderer of type ${e.layer.renderer.type} does not currently support labeling`)),!1}}class k{constructor(e,t){this.registerLayer=e,this.unregisterLayer=t,this._layerViewState=new Map}findIndex(e){return e.view.allLayerViews.findIndex(t=>t.uid===e.uid)}update(e){const{added:t,removed:i}=e;for(const s of i)I(s)&&this._layerViewState.has(s)&&this._deleteState(s);for(const s of t)I(s)&&E(s)&&!this._layerViewState.has(s)&&this._createState(s);this._recomputeOrder()}destroy(){this._layerViewState.forEach(e=>e.handles.forEach(e=>e.remove()))}_createState(e){const t={priority:-1,handles:null};return t.handles=[e.layer.watch(\"visible\",this._recomputeOrder.bind(this)),e.layer.watch(\"labelsVisible\",this._recomputeOrder.bind(this)),e.layer.watch(\"labelingInfo\",this._recomputeOrder.bind(this)),e.layer.watch(\"featureReduction\",this._recomputeOrder.bind(this))],this._layerViewState.set(e,t),t}_deleteState(e){if(!this._layerViewState.has(e))return;const t=this._layerViewState.get(e);t.handles.forEach(e=>e.remove()),-1!==t.priority&&this.unregisterLayer(e),this._layerViewState.delete(e)}_recomputeOrder(){this._layerViewState.forEach((e,t)=>{const i=t.view.map.allLayers.findIndex(e=>e.uid===t.layer.uid),s=t.layer,r=s.featureReduction,a=s.visible&&(s.labelsVisible&&s.labelingInfo&&s.labelingInfo.length||r&&\"cluster\"===r.type&&r.labelsVisible&&r.labelingInfo&&r.labelingInfo.length)?4294967295-i:-1;a!==e.priority&&(e.priority=a,this.unregisterLayer(t),-1!==a&&this.registerLayer(t,a))})}}const V=a.a.getLogger(\"esri.views.2d.layers.labels.LabelManager\");let A=class extends(Object(c.b)(l.a)){constructor(e){super(e),this._applyVisibilityPassThrottled=Object(d.a)(this._applyVisibilityPass,64,this),this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}initialize(){this.collisionEngine=new z(this.view.featuresTilingScheme),this._layerViewSorter=new k((e,t)=>{this.collisionEngine.registerLayerView(e,t);const i=e.tileRenderer;i&&i.forEachTile(t=>{t.isDirty=!0,this.addTile(e,t)}),this.requestUpdate()},e=>{this.collisionEngine.unregisterLayerView(e),this.requestUpdate()}),this.handles.add(this.view.allLayerViews.on(\"change\",e=>{this._layerViewSorter.update(e)}))}destroy(){this._layerViewSorter.destroy(),this._layerViewSorter=null,this.collisionEngine=null,this._applyVisibilityPassThrottled.remove(),this._applyVisibilityPassThrottled=null}get updating(){return this.updateRequested}update(e){this._applyVisibilityPassThrottled(e)}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}processUpdate(e){this._set(\"updateParameters\",e),this.updateRequested&&(this.updateRequested=!1,this.update(e))}addTile(e,t){this.collisionEngine.addTile(e,t)}removeTile(e,t){this.collisionEngine.removeTile(e,t)}_applyVisibilityPass(e){try{const t=this.view.featuresTilingScheme.getClosestInfoForScale(e.state.scale).level;this.collisionEngine.run(e,t)}catch(e){V.error(new h.a(\"mapview-labeling\",\"Encountered an error during label decluttering\",e))}}};Object(s.a)([Object(n.b)()],A.prototype,\"updateRequested\",void 0),Object(s.a)([Object(n.b)({readOnly:!0})],A.prototype,\"updateParameters\",void 0),Object(s.a)([Object(n.b)({dependsOn:[\"updateRequested\"]})],A.prototype,\"updating\",null),Object(s.a)([Object(n.b)()],A.prototype,\"view\",void 0),A=Object(s.a)([Object(o.a)(\"esri.views.2d.layers.labels.LabelManager\")],A);var L=A,U=i(\"nYOO\"),N=i(\"WBXD\"),q=i(\"QhKk\"),H=i(\"N5XI\"),G=i(\"AvGH\"),W=i(\"TcGo\"),$=i(\"zBXm\"),Z=i(\"opr1\"),Y=i(\"9+ss\"),X=i(\"Snp0\"),K=(i(\"n4uK\"),i(\"fOQB\")),J=i(\"D6bk\"),Q=i(\"0meK\"),ee=i(\"1F90\"),te=i(\"bfJE\"),ie=i(\"yE7X\"),se=i(\"AMBt\"),re=i(\"srIe\"),ae=i(\"kbDN\"),ne=i(\"Oxob\"),oe=i(\"kGdt\"),he=i(\"6ldq\"),le=i(\"vpBa\");const ce={name:\"bitBlit\",shaders:{vertexShader:Object(le.a)(\"bitBlit/bitBlit.vert\"),fragmentShader:Object(le.a)(\"bitBlit/bitBlit.frag\")},attributes:{a_pos:0,a_tex:1}};class de{constructor(){this._initialized=!1}dispose(){this._program&&(this._program.dispose(),this._program=null),this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)}render(e,t,i,s){e&&(this._initialized||this._initialize(e),e.setBlendFunctionSeparate(1,771,1,771),e.bindVAO(this._vertexArrayObject),e.bindProgram(this._program),t.setSamplingMode(i),e.bindTexture(t,0),this._program.setUniform1i(\"u_tex\",0),this._program.setUniform1f(\"u_opacity\",s),e.drawArrays(5,0,4),e.bindTexture(null,0),e.bindVAO())}_initialize(e){if(this._initialized)return!0;const t=ce.attributes,i=Object(ee.a)(e,ce);if(!i)return!1;const s=new Int8Array(16);s[0]=-1,s[1]=-1,s[2]=0,s[3]=0,s[4]=1,s[5]=-1,s[6]=1,s[7]=0,s[8]=-1,s[9]=1,s[10]=0,s[11]=1,s[12]=1,s[13]=1,s[14]=1,s[15]=1;const r=new J.a(e,t,{geometry:[{name:\"a_pos\",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:\"a_tex\",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:K.a.createVertex(e,35044,s)});return this._program=i,this._vertexArrayObject=r,this._initialized=!0,!0}}const ue=e=>{let t=\"\";t+=e[0].toUpperCase();for(let i=1;i<e.length;i++){const s=e[i];s===s.toUpperCase()?(t+=\"_\",t+=s):t+=s.toUpperCase()}return t},me=e=>{const t={};for(const i in e)t[ue(i)]=e[i];return Object(ee.b)(t)},ge=(e,t,i)=>{const s=e+e.substring(e.lastIndexOf(\"/\")),r=t+t.substring(t.lastIndexOf(\"/\"));return{name:name,attributes:i,shaders:e=>({vertexShader:me(e)+Object(le.a)(s+\".vert\"),fragmentShader:me(e)+Object(le.a)(r+\".frag\")})}},pe=e=>e===ie.c.HITTEST||e===ie.c.LABEL_ALPHA;var _e=i(\"EyXx\"),fe=i(\"9MzC\"),be=i(\"Lqtk\"),we=i(\"c46T\"),ye=i(\"t7mB\"),ve=i(\"NrhG\"),xe=i(\"Du6U\"),Oe=i(\"eT81\"),Te=i(\"QFw1\"),Se=i(\"of9L\"),Ce=i(\"qcDN\"),Me=class{constructor(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new Ce.a(0,0,e,t))}get width(){return this._width}get height(){return this._height}allocate(e,t){if(e>this._width||t>this._height)return new Ce.a;let i=null,s=-1;for(let r=0;r<this._free.length;++r){const a=this._free[r];e<=a.width&&t<=a.height&&(null===i||a.y<=i.y&&a.x<=i.x)&&(i=a,s=r)}return null===i?new Ce.a:(this._free.splice(s,1),i.width<i.height?(i.width>e&&this._free.push(new Ce.a(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new Ce.a(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new Ce.a(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new Ce.a(i.x,i.y+t,e,i.height-t))),new Ce.a(i.x,i.y,e,t))}release(e){for(let t=0;t<this._free.length;++t){const i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}};const je=e=>Math.floor(e/256);var Pe=i(\"ATu9\");class Fe{constructor(e){for(this._metrics=[],this._bitmaps=[];e.next();)switch(e.tag()){case 1:{const t=e.getMessage();for(;t.next();)switch(t.tag()){case 3:{const e=t.getMessage();let i,s,r,a,n,o,h;for(;e.next();)switch(e.tag()){case 1:i=e.getUInt32();break;case 2:s=e.getBytes();break;case 3:r=e.getUInt32();break;case 4:a=e.getUInt32();break;case 5:n=e.getSInt32();break;case 6:o=e.getSInt32();break;case 7:h=e.getUInt32();break;default:e.skip()}e.release(),i&&(this._metrics[i]={width:r,height:a,left:n,top:o,advance:h},this._bitmaps[i]=s);break}default:t.skip()}t.release();break}default:e.skip()}}getMetrics(e){return this._metrics[e]}getBitmap(e){return this._bitmaps[e]}}class Re{constructor(){this._ranges=[]}getRange(e){return this._ranges[e]}addRange(e,t){this._ranges[e]=t}}const Be=[1,256,65536,16777216],ze=[1/256,1/65536,1/16777216,1/4294967296],De=function(e,t=0){let i=0;for(let s=0;s<4;s++)i+=e[t+s]*ze[s];return i}(new Uint8ClampedArray([255,255,255,255]));function Ie(e,t,i=0){const s=(a=De,(r=e)<0?0:r>a?a:r);var r,a,n;for(let o=0;o<4;o++)t[i+o]=Math.floor(256*((n=s*Be[o])-Math.floor(n)))}const Ee=1e20;var ke=i(\"HQFP\");function Ve(e){return e&&\"static\"===e.type}class Ae{constructor(e,t,i,s=0){if(this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._fixSpriteLocationsTable=Object(r.a)(\"fix-sprite-locations\"),this._testId=Object(r.a)(\"test-id\"),this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(t<=0||i<=0)&&console.error(\"Sprites mosaic defaultWidth and defaultHeight must be greater than zero!\"),this._pageWidth=t,this._pageHeight=i,this._requestRender=e,s>0&&(this._maxItemSize=s),this.pixelRatio=window.devicePixelRatio||1,this._fixSpriteLocationsTable){const e=[];for(const t in this._fixSpriteLocationsTable[this._testId]){const i=this._fixSpriteLocationsTable[this._testId][t];e[i.page]=i.pageSize}for(const t of e)this._mosaicPages.push({mosaicsData:{type:\"static\",data:new Uint32Array(t[0]*t[1])},size:[t[0],t[1]],dirty:!0,texture:void 0})}this._binPack=new Me(this._pageWidth,this._pageHeight);const a=Math.floor(this._pageWidth),n=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:\"static\",data:new Uint32Array(a*n)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[0]}getHeight(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[1]}getPageTexture(e){return e<this._mosaicPages.length?this._mosaicPages[e].texture:null}has(e){return this._mosaicRects.has(e)}get itemCount(){return this._mosaicRects.size}getSpriteItem(e){return this._mosaicRects.get(e)}addSpriteItem(e,t,i,s,r,a){if(this._mosaicRects.has(e))return this._mosaicRects.get(e);let n,o,h;if(Ve(i))if(this._fixSpriteLocationsTable&&this._fixSpriteLocationsTable[this._testId]&&this._fixSpriteLocationsTable[this._testId][e]){const t=this._fixSpriteLocationsTable[this._testId][e];n=t.rect,o=t.page,h=t.pageSize}else[n,o,h]=this._allocateImage(t[0],t[1]);else n=new Ce.a(0,0,t[0],t[1]),o=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:i,size:t,dirty:!0,texture:void 0});if(n.width<=0||n.height<=0)return null;const l={rect:n,width:t[0],height:t[1],sdf:r,simplePattern:a,pixelRatio:1,page:o};return this._mosaicRects.set(e,l),Ve(i)&&this._copy({rect:n,spriteSize:t,spriteData:i.data,page:o,pageSize:h,repeat:s,sdf:r}),l}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const e=this._spriteCopyQueue.pop();e&&this._copy(e)}getSpriteItems(e){const t={};for(const i of e)t[i]=this.getSpriteItem(i);return t}getMosaicItemPosition(e){const t=this.getSpriteItem(e),i=t&&t.rect;if(!i)return null;i.width=t.width,i.height=t.height;const s=m.r,r=this._mosaicPages[t.page];return{size:[t.width,t.height],tl:[(i.x+s)/r[0],(i.y+s)/r[1]],br:[(i.x+s+t.width)/r[0],(i.y+s+t.height)/r[1]],page:t.page}}bind(e,t,i=0,s=0){const r=this._mosaicPages[i],a=r.mosaicsData;let n=r.texture;if(n||(n=function(e,t,i){return Ve(t)?new Se.a(e,{pixelFormat:6408,dataType:5121,width:i[0],height:i[1]},new Uint8Array(t.data.buffer)):new Se.a(e,{pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:i[0],height:i[1]},null)}(e,a,r.size),r.texture=n),n.setSamplingMode(t),Ve(a))e.bindTexture(n,s),r.dirty&&(n.setData(new Uint8Array(a.data.buffer)),n.generateMipmap());else{const t=a.data,i=t.bindFrame(e,n,s);Object(re.h)(this._requestRender)&&i&&t.frameCount>0&&this._requestRender.requestRender(),t.bindFrame(e,n,s)}r.dirty=!1}static _copyBits(e,t,i,s,r,a,n,o,h,l,c){let d=s*t+i,u=o*a+n;if(c){u-=a;for(let n=-1;n<=l;n++,d=((n+l)%l+s)*t+i,u+=a)for(let t=-1;t<=h;t++)r[u+t]=e[d+(t+h)%h]}else for(let m=0;m<l;m++){for(let t=0;t<h;t++)r[u+t]=e[d+t];d+=t,u+=a}}_copy(e){if(e.page>=this._mosaicPages.length)return;const t=this._mosaicPages[e.page],i=t.mosaicsData;if(!Ve(t.mosaicsData))throw new h.a(\"mapview-invalid-resource\",\"unsuitable data type!\");const s=e.spriteData,r=i.data;r&&s||console.error(\"Source or target images are uninitialized!\"),Ae._copyBits(s,e.spriteSize[0],0,0,r,e.pageSize[0],e.rect.x+m.r,e.rect.y+m.r,e.spriteSize[0],e.spriteSize[1],e.repeat),t.dirty=!0}_allocateImage(e,t){e+=2*m.r,t+=2*m.r;const i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){const i=Math.pow(2,Math.ceil(Object(ke.c)(e))),s=Math.pow(2,Math.ceil(Object(ke.c)(t))),r=new Ce.a(0,0,e,t);return this._mosaicPages.push({mosaicsData:{type:\"static\",data:new Uint32Array(i*s)},size:[i,s],dirty:!0,texture:void 0}),[r,this._mosaicPages.length-1,[i,s]]}const s=this._binPack.allocate(e,t);if(s.width<=0){const i=this._mosaicPages[this._currentPage];return!i.dirty&&Ve(i.mosaicsData)&&(i.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:\"static\",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new Me(this._pageWidth,this._pageHeight),this._allocateImage(e,t)}return[s,this._currentPage,[this._pageWidth,this._pageHeight]]}dispose(){this._binPack=null;for(const e of this._mosaicPages){const t=e.texture;t&&t.dispose();const i=e.mosaicsData;Ve(i)||i.data.pause()}this._mosaicPages=null,this._mosaicRects.clear()}}var Le=Ae;const Ue=new Uint32Array(256);for(let Ci=0;Ci<256;Ci++){let e=Ci;for(let t=0;t<8;t++)e=0!=(1&e)?3988292384^e>>>1:e>>>1;Ue[Ci]=e}const Ne=new h.a(\"Not a PNG\"),qe=new h.a(\"Not an animated PNG\"),He=new Uint8Array([137,80,78,71,13,10,26,10]);function Ge(e){const t=e.constructor===Uint8Array?e:new Uint8Array(e);return!He.some((e,i)=>e!==t[i])}class We{constructor(){this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[],this.paused=!1,this.playing=!1,this.playSpeed=1,this.currentFrameNumber=0,this._lastUsedFrame=-1}static async create(e,t){const i=new We;try{await i._load(e,t)}catch(e){if(!Object(fe.n)(e))return new h.a(\"invalid-resource\",\"Could not load PNG: \"+e.message)}return i}play(){this.playing||(this.paused=!1,this.playing=!0,this._play())}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}togglePlay(){this.paused||!this.playing?this.play():this.pause()}bindFrame(e,t,i){e.bindTexture(t,i);const s=this.frameChanged();if(!s)return!1;const r=this.currentFrame,a=r.frameData,n=t.descriptor;return(r.left||r.top||r.width!==n.width||r.height!==n.height)&&t.setData(null),t.updateData(0,r.left,r.top,r.width,r.height,a),this.updateUsedFrame(),s}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber}async _load(e,t){try{const t=function(e,t){const i=new Uint8Array(t);if(He.some((e,t)=>e!==i[t]))return Ne;let s=!1;if(Ze(i,e=>!(s=\"acTL\"===e)),!s)return qe;const r=[],a=[];let n=null,o=null,h=0;if(Ze(i,(t,i,s,l)=>{const c=new DataView(i.buffer);switch(t){case\"IHDR\":n=i.subarray(s+8,s+8+l),e.width=c.getUint32(s+8),e.height=c.getUint32(s+12);break;case\"acTL\":e.numPlays=c.getUint32(s+8+4);break;case\"fcTL\":{o&&(e.frames.push(o),h++),o=new $e,o.width=c.getUint32(s+8+4),o.height=c.getUint32(s+8+8),o.left=c.getUint32(s+8+12),o.top=c.getUint32(s+8+16);const t=c.getUint16(s+8+20);let i=c.getUint16(s+8+22);0===i&&(i=100),o.delay=1e3*t/i,o.delay<=10&&(o.delay=100),e.playTime+=o.delay,o.disposeOp=c.getUint8(s+8+24),o.blendOp=c.getUint8(s+8+25),o.dataParts=[],0===h&&2===o.disposeOp&&(o.disposeOp=1);break}case\"fdAT\":o&&o.dataParts.push(i.subarray(s+8+4,s+8+l));break;case\"IDAT\":o&&o.dataParts.push(i.subarray(s+8,s+8+l));break;case\"IEND\":a.push(Xe(i,s,12+l));break;default:r.push(Xe(i,s,12+l))}}),0===e.frames.length)return qe;e.frameCount=e.frames.length;const l=new Blob(r),c=new Blob(a);return e.frames.forEach(e=>{let t=[];t.push(He),n.set(Je(e.width),0),n.set(Je(e.height),4),t.push(Ke(\"IHDR\",n)),t.push(l),e.dataParts.forEach(e=>t.push(Ke(\"IDAT\",e))),t.push(c),e.data=new Blob(t,{type:\"image/png\"}),delete e.dataParts,t=null}),e}(this,e);if(t!==this)return t;this._resizeCanvas=document.createElement(\"canvas\"),this._resizeCanvas.width=this.width,this._resizeCanvas.height=this.height,await Object(fe.b)(this.frames.map(e=>e.createImage(this._resizeCanvas)))}catch(i){if(!Object(fe.n)(i))return new h.a(\"invalid-resource\",\"Could not parse PNG\")}this.play()}_play(){let e,t;if(0===this.playSpeed)return void this.pause();this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),t=this.currentFrameNumber,t-=1,t<0&&(t=this.frames.length-1),e=1*-this.frames[t].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,e=1*this.frames[this.currentFrameNumber].delay/this.playSpeed);const i=this.frames[this.currentFrameNumber];this.currentFrame={frameData:i.imageData,top:i.top,left:i.left,width:i.width,height:i.height},this.timerID=window.setTimeout(()=>this._play(),e)}}class $e{constructor(){this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.data=null,this.imageData=null}async createImage(e){if(null===this.imageData)return Object(fe.c)((t,i)=>{const s=URL.createObjectURL(this.data),r=document.createElement(\"img\");r.onload=()=>{URL.revokeObjectURL(s),this.imageData=function(e,t){t.width=e.width,t.height=e.height;const i=t.getContext(\"2d\");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=new Uint8Array(s.data);let a;for(let n=0;n<r.length;n+=4)a=r[n+3]/255,r[n]=r[n]*a,r[n+1]=r[n+1]*a,r[n+2]=r[n+2]*a;return new ImageData(new Uint8ClampedArray(r.buffer),e.width,e.height)}(r,e),t()},r.onerror=()=>{URL.revokeObjectURL(s),this.imageData=null,i(new Error(\"Image creation error\"))},r.src=s})}}function Ze(e,t){const i=new DataView(e.buffer);let s,r,a,n=8;do{r=i.getUint32(n),s=Ye(e,n+4,4),a=t(s,e,n,r),n+=12+r}while(!1!==a&&\"IEND\"!==s&&n<e.length)}function Ye(e,t,i){const s=Array.prototype.slice.call(e.subarray(t,t+i));return String.fromCharCode.apply(String,s)}function Xe(e,t,i){const s=new Uint8Array(i);return s.set(e.subarray(t,t+i)),s}function Ke(e,t){const i=e.length+t.length,s=new Uint8Array(i+8),r=new DataView(s.buffer);r.setUint32(0,t.length),s.set(function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(e),4),s.set(t,8);const a=function(e,t=0,i=e.length-t){let s=-1;for(let r=t,a=t+i;r<a;r++)s=s>>>8^Ue[255&(s^e[r])];return-1^s}(s,4,i);return r.setUint32(i+4,a),s}function Je(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}var Qe=We;function et(e){if(!e||0===e.byteLength)return!1;const t=e.constructor===Uint8Array?e:new Uint8Array(e);return 71===t[0]&&73===t[1]&&70===t[2]&&56===t[3]}class tt{constructor(){this.paused=!1,this.playing=!1,this.waitTillDone=!0,this.loading=!1,this.firstFrameOnly=!1,this.frames=[],this.comment=\"\",this.length=0,this.currentFrameNumber=0,this.frameCount=0,this.playSpeed=1,this.lastFrame=null,this.playOnLoad=!0,this.complete=!1,this.interlaceOffsets=[0,4,2,1],this.interlaceSteps=[8,8,4,2],this._lastUsedFrame=-1}static async create(e,t){const i=new tt;try{await i._load(e,t)}catch(e){if(!Object(fe.n)(e))return new h.a(\"invalid-resource\",\"Could not load PNG: \"+e.message)}return i}play(){this.playing||(this.paused=!1,this.playing=!0,this._play())}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}togglePlay(){this.paused||!this.playing?this.play():this.pause()}bindFrame(e,t,i){e.bindTexture(t,i);const s=this.frameChanged();if(s){const e=this.currentFrame;t.updateData(0,0,0,e.width,e.height,e.frameData),this.updateUsedFrame()}return s}seekFrame(e){clearTimeout(this.timerID),this.currentFrameNumber=e%this.frames.length,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}seek(e){clearTimeout(this.timerID),e<0&&(e=0),e*=1e3,e%=this.length;let t=0;for(;e>this.frames[t].time+this.frames[t].delay&&t<this.frames.length;)t+=1;this.currentFrameNumber=t,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber}async _load(e,t){try{this.loading=!0,await this._parse(e,t),this.loading=!1,this.play()}catch(e){if(!Object(fe.n)(e))return new h.a(\"invalid-resource\",\"Could not parse gif!\")}}_parse(e,t){const i=new it(e);i.pos+=6,this.width=i.data[i.pos++]+(i.data[i.pos++]<<8),this.height=i.data[i.pos++]+(i.data[i.pos++]<<8);const s=i.data[i.pos++];return this.globalColourCount=1<<1+(7&s),i.pos++,i.pos++,128&s&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,i)),Object(fe.c)((e,s)=>{setTimeout(()=>this._parseBlock(i,e,s,t),0)})}async _parseBlock(e,t,i,s){if(s&&s.signal&&Object(fe.o)(s.signal))return void i(Object(fe.e)());const r=e.data[e.pos++];if(44===r){if(this._parseImg(e),this.firstFrameOnly)return this._finishedLoading(),void t()}else{if(59===r)return this._finishedLoading(),void t();this._parseExt(e)}\"function\"==typeof this.onprogress&&this.onprogress({bytesRead:e.pos,totalBytes:e.data.length,frame:this.frames.length}),setTimeout(()=>this._parseBlock(e,t,i,s),0)}_parseColourTable(e,t){const i=[];for(let s=0;s<e;s++)i.push([t.data[t.pos++],t.data[t.pos++],t.data[t.pos++]]);return i}_parseImg(e){const t={};this.frames.push(t),t.disposalMethod=this.disposalMethod,t.time=this.length,t.delay=10*this.delayTime,this.length+=t.delay,t.transparencyIndex=this.transparencyGiven?this.transparencyIndex:void 0,t.leftPos=e.data[e.pos++]+(e.data[e.pos++]<<8),t.topPos=e.data[e.pos++]+(e.data[e.pos++]<<8),t.width=e.data[e.pos++]+(e.data[e.pos++]<<8),t.height=e.data[e.pos++]+(e.data[e.pos++]<<8);const i=e.data[e.pos++];t.localColourTableFlag=!!(128&i),t.localColourTableFlag&&(t.localColourTable=this._parseColourTable(1<<1+(7&i),e)),this.pixelBufSize!==t.width*t.height&&(this.pixelBuf=new Uint8Array(t.width*t.height),this.pixelBufSize=t.width*t.height),this._lzwDecode(e.data[e.pos++],e.readSubBlocksB()),64&i?(t.interlaced=!0,(e=>{const t=this.pixelBufSize/e;this.interlacedBufSize!==this.pixelBufSize&&(this.deinterlaceBuf=new Uint8Array(this.pixelBufSize),this.interlacedBufSize=this.pixelBufSize);let i=0;for(let s=0;s<4;s++)for(let r=this.interlaceOffsets[s];r<t;r+=this.interlaceSteps[s])this.deinterlaceBuf.set(this.pixelBuf.subarray(i,i+e),r*e),i+=e})(t.width)):t.interlaced=!1,this._processFrame(t)}_lzwDecode(e,t){let i,s,r,a,n,o,h,l,c,d,u;r=s=0;let m=[];for(a=1<<e,n=a+1,o=e+1,u=!1;!u;){for(l=h,h=0,i=0;i<o;i++)t[r>>3]&1<<(7&r)&&(h|=1<<i),r++;if(h===a){for(m=[],o=e+1,i=0;i<a;i++)m[i]=[i];m[a]=[],m[n]=null}else{if(h===n)return void(u=!0);for(h>=m.length?m.push(m[l].concat(m[l][0])):l!==a&&m.push(m[l].concat(m[h][0])),c=m[h],d=c.length,i=0;i<d;i++)this.pixelBuf[s++]=c[i];m.length===1<<o&&o<12&&o++}}}_processFrame(e){e.image=document.createElement(\"canvas\"),e.image.width=this.width,e.image.height=this.height,e.ctx=e.image.getContext(\"2d\");const t=e.localColourTableFlag?e.localColourTable:this.globalColourTable;null===this.lastFrame&&(this.lastFrame=e);const i=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod;i||e.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);const s=e.ctx.getImageData(e.leftPos,e.topPos,e.width,e.height),r=e.transparencyIndex,a=s.data,n=e.interlaced?this.deinterlaceBuf:this.pixelBuf,o=n.length;let h,l,c=0;for(let d=0;d<o;d++)h=n[d],l=t[h],r!==h?(a[c++]=l[0],a[c++]=l[1],a[c++]=l[2],a[c++]=255):i?(a[c+3]=0,c+=4):c+=4;e.ctx.putImageData(s,e.leftPos,e.topPos),this.lastFrame=e}_parseExt(e){const t=e.data[e.pos++];249===t?this._parseGCExt(e):254===t?this.comment+=e.readSubBlocks():255===t?this._parseAppExt(e):(1===t&&(e.pos+=13),e.readSubBlocks())}_parseAppExt(e){e.pos+=1,\"NETSCAPE\"===e.getString(8)?e.pos+=8:(e.pos+=3,e.readSubBlocks())}_parseGCExt(e){let t;e.pos++,t=e.data[e.pos++],this.disposalMethod=(28&t)>>2,this.transparencyGiven=!!(1&t),this.delayTime=e.data[e.pos++]+(e.data[e.pos++]<<8),this.transparencyIndex=e.data[e.pos++],e.pos++}_finishedLoading(){this.loading=!1,this.frameCount=this.frames.length,this.lastFrame=null,this.complete=!0,this.disposalMethod=void 0,this.transparencyGiven=void 0,this.delayTime=void 0,this.transparencyIndex=void 0,this.waitTillDone=void 0,this.pixelBuf=void 0,this.deinterlaceBuf=void 0,this.pixelBufSize=void 0,this.deinterlaceBuf=void 0,this.currentFrameNumber=0,this.frames.length>0&&this._setCurrentFrame(0),this.playOnLoad&&this.play()}_play(){let e,t;0!==this.playSpeed?(this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),t=this.currentFrameNumber,t-=1,t<0&&(t=this.frames.length-1),e=1*-this.frames[t].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,e=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout(()=>this._play(),e)):this.pause()}_setCurrentFrame(e){this.currentFrame={frameData:this.frames[e].image,top:0,left:0,width:this.width,height:this.height}}}class it{constructor(e){this.pos=0,this.data=new Uint8ClampedArray(e),this.len=this.data.length}getString(e){let t=\"\";for(;e--;)t+=String.fromCharCode(this.data[this.pos++]);return t}readSubBlocks(){let e,t,i=\"\";do{for(t=e=this.data[this.pos++];t--;)i+=String.fromCharCode(this.data[this.pos++])}while(0!==e&&this.pos<this.len);return i}readSubBlocksB(){let e,t;const i=[];do{for(t=e=this.data[this.pos++];t--;)i.push(this.data[this.pos++])}while(0!==e&&this.pos<this.len);return i}}var st=tt,rt=i(\"GqaZ\");const at=Object(we.a)(),nt=a.a.getLogger(\"esri.views.2d.engine.webgl.TextureManager\"),ot=e=>\"esriSMS\"===e.type&&e.path;function ht(e){switch(e.type){case\"esriSMS\":case\"esriPMS\":case\"CIMPointSymbol\":case\"CIMVectorMarker\":case\"CIMPictureMarker\":case\"CIMCharacterMarker\":return!1;default:return!0}}function lt(e,t){const i=Math.round(Object(f.d)(t)*window.devicePixelRatio);return Math.min(e,i*(i>=128?2:4))}const ct=(e,t,i)=>nt.error(new h.a(e,t,i));class dt{constructor(e,t,i){this.mosaicType=e,this.page=t,this.sdf=i}static fromMosaic(e,t){return new dt(e,t.page,t.sdf)}}var ut=i(\"gjrC\");class mt{constructor(){this.name=this.constructor.name}}class gt extends mt{constructor(){super(...arguments),this.defines=[],this._desc={vsPath:\"fx/integrate\",fsPath:\"fx/integrate\",attributes:{a_position:0}}}dispose(){this._quad&&this._quad.dispose()}bind(){}unbind(){}draw(e,t){if(!t.size)return;const{context:i,renderingOptions:s}=e;this._quad||(this._quad=new ut.a(i,[0,0,1,0,0,1,1,1]));const r=i.getBoundFramebufferObject(),{x:a,y:n,width:o,height:h}=i.getViewport();t.bindTextures(i);const l=t.getBlock(m.a);if(Object(re.g)(l))return;const c=l.getFBO(i),d=l.getFBO(i,1);i.setViewport(0,0,t.size,t.size),this._computeDelta(e,d,s.labelsAnimationTime),this._updateAnimationState(e,d,c),i.bindFramebuffer(r),i.setViewport(a,n,o,h)}_computeDelta(e,t,i){const{context:s,painter:r,displayLevel:a}=e,n=r.materialManager.getProgram(e,this._desc,[\"delta\"]);s.bindFramebuffer(t),s.setClearColor(0,0,0,0),s.clear(s.gl.COLOR_BUFFER_BIT),s.bindProgram(n),n.setUniform1i(\"u_maskTexture\",m.s),n.setUniform1i(\"u_sourceTexture\",m.t),n.setUniform1f(\"u_timeDelta\",e.deltaTime),n.setUniform1f(\"u_animationTime\",i),n.setUniform1f(\"u_zoomLevel\",Math.round(10*a)),this._quad.draw()}_updateAnimationState(e,t,i){const{context:s,painter:r}=e,a=r.materialManager.getProgram(e,this._desc,[\"update\"]);s.bindTexture(t.colorTexture,1),s.bindProgram(a),a.setUniform1i(\"u_sourceTexture\",1),s.bindFramebuffer(i),s.setClearColor(0,0,0,0),s.clear(s.gl.COLOR_BUFFER_BIT),this._quad.draw()}}const pt=e=>`#define ${(e=>e.replace(\"-\",\"_\").toUpperCase())(e)}\\n`,_t={name:\"blend\",attributes:{a_pos:0,a_tex:1},shaders:e=>({vertexShader:pt(e)+Object(le.a)(\"blend/blend.vert\"),fragmentShader:pt(e)+Object(le.a)(\"blend/blend.frag\")})},ft=a.a.getLogger(\"esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect\");class bt{constructor(){this._size=[0,0]}dispose(e){this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null),this._programCache&&(this._programCache.dispose(),this._programCache=null),this._quad&&(this._quad.dispose(),this._quad=null)}draw(e,t,i,s,r){const{context:a,drawPhase:n}=e;if(this._setupShader(a),s&&\"normal\"!==s&&n!==ie.c.LABEL)return void this._drawBlended(e,t,i,s,r);const o=this._programCache.getProgram(_t,\"normal\");if(!o)return void ft.error(new h.a(\"mapview-BlendEffect\",'Error creating shader program for blend mode \"normal\"'));a.bindProgram(o),t.setSamplingMode(i),a.bindTexture(t,0),o.setUniform1i(\"u_layerTexture\",0),o.setUniform1f(\"u_opacity\",r),a.setBlendingEnabled(!0),a.setBlendFunction(1,771);const l=this._quad;l.draw(),l.unbind()}_drawBlended(e,t,i,s,r){const{context:a,state:n,pixelRatio:o,inFadeTransition:l}=e,{size:c}=n,d=a.getBoundFramebufferObject();let u,m;if(Object(re.h)(d)){const e=d.descriptor;u=e.width,m=e.height}else u=Math.round(o*c[0]),m=Math.round(o*c[1]);this._createOrResizeTexture(e,u,m);const g=this._backBufferTexture;d.copyToTexture(0,0,u,m,0,0,g),a.setStencilTestEnabled(!1),a.setStencilWriteMask(0),a.setBlendingEnabled(!0),a.setDepthTestEnabled(!1),a.setDepthWriteEnabled(!1);const p=this._programCache.getProgram(_t,s);if(!p)return void ft.error(new h.a(\"mapview-BlendEffect\",\"Error creating shader program for blend mode \"+s));a.bindProgram(p),g.setSamplingMode(i),a.bindTexture(g,0),p.setUniform1i(\"u_backbufferTexture\",0),t.setSamplingMode(i),a.bindTexture(t,1),p.setUniform1i(\"u_layerTexture\",1),p.setUniform1f(\"u_opacity\",r),p.setUniform1f(\"u_inFadeOpacity\",l?1:0),a.setBlendFunction(1,0);const _=this._quad;_.draw(),_.unbind(),a.setBlendFunction(1,771)}_setupShader(e){this._programCache||(this._programCache=new oe.a(e),this._quad||(this._quad=new ut.a(e,[-1,-1,1,-1,-1,1,1,1])))}_createOrResizeTexture(e,t,i){const{context:s}=e;null!==this._backBufferTexture&&t===this._size[0]&&i===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(t,i):this._backBufferTexture=new Se.a(s,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:t,height:i}),this._size[0]=t,this._size[1]=i)}}class wt extends mt{constructor(e){super(),this.name=this.constructor.name,this.defines=[e]}dispose(){}bind({context:e,painter:t}){this._prev=e.getBoundFramebufferObject();const{width:i,height:s}=e.getViewport(),r=t.getFbos(i,s).effect0;e.bindFramebuffer(r),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT)}unbind(){}draw(e,t){const{context:i,painter:s,state:r,deltaTime:a}=e,n=s.getPostProcessingEffects(t.effects),o=i.getBoundFramebufferObject();n.length&&t.transitionStep(a,r.scale);for(const{postProcessingEffect:h,effect:l}of n)h.draw(e,o,l);i.bindFramebuffer(this._prev),i.setStencilTestEnabled(!1),s.blitTexture(i,o.colorTexture,9728),i.setStencilTestEnabled(!0)}}const yt=[void 0,void 0,void 0,1],vt=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],xt=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ot=a.a.getLogger(\"esri.views.2d.engine.webgl.painter.highlight.HighlightGradient\"),Tt=[0,0,0,0],St={name:\"highlight\",shaders:{vertexShader:Object(le.a)(\"highlight/textured.vert\"),fragmentShader:Object(le.a)(\"highlight/highlight.frag\")},attributes:{a_position:0,a_texcoord:1}},Ct={name:\"blur\",shaders:{vertexShader:Object(le.a)(\"highlight/textured.vert\"),fragmentShader:Object(le.a)(\"highlight/blur.frag\")},attributes:{a_position:0,a_texcoord:1}};function Mt(e,t,i){const s=new Se.a(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:t,height:i,samplingMode:9729});return[s,new Q.a(e,{colorTarget:0,depthStencilTarget:2},s)]}var jt=class extends mt{constructor(){super(...arguments),this.defines=[\"highlight\"],this._hlRenderer=new class{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(e,t){e.bindTexture(t,m.y),e.bindProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv(\"u_direction\",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv(\"u_channelSelector\",vt),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO()}finalBlur(e,t){e.bindTexture(t,m.y),e.bindProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv(\"u_direction\",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv(\"u_channelSelector\",xt),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO()}renderHighlight(e,t,i){e.bindTexture(t,m.y),e.bindProgram(this._resources.highlightProgram),i.applyHighlightOptions(e,this._resources.highlightProgram),e.bindVAO(this._resources.quadVAO),e.setBlendingEnabled(!0),e.setBlendFunction(1,771),e.drawArrays(5,0,4),e.bindVAO()}_initialize(e,t,i){this._width=t,this._height=i;const s=new K.a(e,34962,35044,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),r=new J.a(e,{a_position:0,a_texcoord:1},{geometry:[{name:\"a_position\",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:\"a_texcoord\",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:s}),a=Object(ee.a)(e,St),n=Object(ee.a)(e,Ct);a.setUniform1i(\"u_texture\",m.y),a.setUniform1i(\"u_shade\",m.z),a.setUniform4fv(\"u_sigmas\",yt),n.setUniform1i(\"u_texture\",m.y),n.setUniform4fv(\"u_sigmas\",yt),this._resources={quadGeometry:s,quadVAO:r,highlightProgram:a,blurProgram:n}}setup(e,t,i){this._resources?(this._width=t,this._height=i):this._initialize(e,t,i)}},this._hlGradient=new class{constructor(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:0,outlineWidth:.7,innerHaloWidth:.7,outerHaloWidth:.7},this.shadeTexChanged=!0,this.texelData=new Uint8Array(1024),this.minMaxDistance=[0,0]}setHighlightOptions(e){const t=this._convertedHighlightOptions;var i,s;(s=t).fillColor[0]=(i=e).color.r/255,s.fillColor[1]=i.color.g/255,s.fillColor[2]=i.color.b/255,s.fillColor[3]=i.color.a,i.haloColor?(s.outlineColor[0]=i.haloColor.r/255,s.outlineColor[1]=i.haloColor.g/255,s.outlineColor[2]=i.haloColor.b/255,s.outlineColor[3]=i.haloColor.a):(s.outlineColor[0]=s.fillColor[0],s.outlineColor[1]=s.fillColor[1],s.outlineColor[2]=s.fillColor[2],s.outlineColor[3]=s.fillColor[3]),s.fillColor[3]*=i.fillOpacity,s.outlineColor[3]*=i.haloOpacity,s.fillColor[0]*=s.fillColor[3],s.fillColor[1]*=s.fillColor[3],s.fillColor[2]*=s.fillColor[3],s.outlineColor[0]*=s.outlineColor[3],s.outlineColor[1]*=s.outlineColor[3],s.outlineColor[2]*=s.outlineColor[3],s.outlineWidth=.7,s.outerHaloWidth=.7,s.innerHaloWidth=.7,s.outlinePosition=0;const r=t.outlinePosition-t.outlineWidth/2-t.outerHaloWidth,a=t.outlinePosition-t.outlineWidth/2,n=t.outlinePosition+t.outlineWidth/2,o=t.outlinePosition+t.outlineWidth/2+t.innerHaloWidth,h=Math.sqrt(Math.PI/2)*yt[3],l=Math.abs(r)>h?Math.round(10*(Math.abs(r)-h))/10:0,c=Math.abs(o)>h?Math.round(10*(Math.abs(o)-h))/10:0;let d;l&&!c?Ot.error(\"The outer rim of the highlight is \"+l+\"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards).\"):!l&&c?Ot.error(\"The inner rim of the highlight is \"+c+\"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards).\"):l&&c&&Ot.error(\"The highlight is \"+Math.max(l,c)+\"px away from the edge of the feature; consider reducing some width values.\");const u=[void 0,void 0,void 0,void 0];function m(e,t,i){u[0]=(1-i)*e[0]+i*t[0],u[1]=(1-i)*e[1]+i*t[1],u[2]=(1-i)*e[2]+i*t[2],u[3]=(1-i)*e[3]+i*t[3]}const{texelData:g}=this;for(let p=0;p<256;++p)d=r+p/255*(o-r),d<r?(u[4*p+0]=0,u[4*p+1]=0,u[4*p+2]=0,u[4*p+3]=0):d<a?m(Tt,t.outlineColor,(d-r)/(a-r)):d<n?[u[0],u[1],u[2],u[3]]=t.outlineColor:d<o?m(t.outlineColor,t.fillColor,(d-n)/(o-n)):[u[4*p+0],u[4*p+1],u[4*p+2],u[4*p+3]]=t.fillColor,g[4*p+0]=255*u[0],g[4*p+1]=255*u[1],g[4*p+2]=255*u[2],g[4*p+3]=255*u[3];this.minMaxDistance[0]=r,this.minMaxDistance[1]=o,this.shadeTexChanged=!0}applyHighlightOptions(e,t){this.shadeTex||(this.shadeTex=new Se.a(e,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:256,height:1,samplingMode:9729})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,256,1,this.texelData),this.shadeTexChanged=!1),e.bindTexture(this.shadeTex,m.z),t.setUniform2fv(\"u_minMaxDistance\",this.minMaxDistance)}destroy(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)}},this._width=void 0,this._height=void 0,this._hlSurfaces=new class{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(e,t,i){this._width=t,this._height=i;const[s,r]=Mt(e,t,i),[a,n]=Mt(e,t,i);this._resources={sharedBlur1Tex:s,sharedBlur1Fbo:r,sharedBlur2Tex:a,sharedBlur2Fbo:n}}setup(e,t,i){!this._resources||this._width===t&&this._height===i||this.dispose(),this._resources||this._initialize(e,t,i)}get sharedBlur1Tex(){return this._resources.sharedBlur1Tex}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Tex}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}},this._adjustedWidth=void 0,this._adjustedHeight=void 0,this._blitRenderer=new de}dispose(){this._hlSurfaces&&this._hlSurfaces.dispose(),this._hlRenderer&&this._hlRenderer.dispose(),this._hlGradient&&this._hlGradient.destroy(),this._boundFBO=null}bind(e){const{context:t,painter:i}=e,{width:s,height:r}=t.getViewport(),a=i.getFbos(s,r).effect0;this.setup(e,s,r),t.bindFramebuffer(a),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind(){}setup({context:e},t,i){this._width=t,this._height=i;const s=t%4,r=i%4;i+=r<2?-r:4-r,this._adjustedWidth=t+=s<2?-s:4-s,this._adjustedHeight=i,this._boundFBO=e.getBoundFramebufferObject();const a=Math.round(.75*t),n=Math.round(.75*i);this._hlRenderer.setup(e,a,n),this._hlSurfaces.setup(e,a,n)}draw({context:e}){const t=e.getBoundFramebufferObject();e.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setStencilTestEnabled(!1),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(e,t.colorTexture,9728,1),e.setStencilTestEnabled(!1),e.setBlendingEnabled(!1),e.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(e,this._hlSurfaces.sharedBlur1Tex),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(e,this._hlSurfaces.sharedBlur2Tex),e.bindFramebuffer(this._boundFBO),e.setBlendingEnabled(!0),e.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(e,this._hlSurfaces.sharedBlur1Tex,this._hlGradient),this._boundFBO=null}setHighlightOptions(e){this._hlGradient.setHighlightOptions(e)}};class Pt extends mt{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=[\"id\"],this._lastSize=0}dispose(){Object(re.h)(this._fbo)&&this._fbo.dispose()}bind({context:e,painter:t}){const{width:i,height:s}=e.getViewport(),r=t.getFbos(i,s).effect0;e.bindFramebuffer(r),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT)}unbind(){}draw({context:e,state:t,pixelRatio:i},s,r=m.m){const a=e.getBoundFramebufferObject(),n=t.size[1]*i,o=Math.round(r*i),h=o/2,l=o/2;this._ensureBuffer(o),s.forEach((e,t)=>{const r=new Map,c=Math.floor(t[0]*i-o/2),d=Math.floor(n-t[1]*i-o/2);a.readPixels(c,d,o,o,6408,5121,this._buf);for(let i=0;i<this._buf32.length;i++){const e=this._buf32[i];if(4294967295!==e&&0!==e){const t=i%o,s=o-Math.floor(i/o),a=(h-t)*(h-t)+(l-s)*(l-s),n=r.has(e)?r.get(e):4294967295;r.set(e,Math.min(a,n))}}const u=Array.from(r).sort((e,t)=>e[1]-t[1]).map(e=>e[0]);e.resolve(u),s.delete(t)})}_ensureBuffer(e){this._lastSize!==e&&(this._lastSize=e,this._buf=new Uint8Array(4*e*e),this._buf32=new Uint32Array(this._buf.buffer))}}function Ft(e){switch(e){case\"bloom\":case\"blur\":case\"opacity\":case\"drop-shadow\":return e;default:return\"colorize\"}}const Rt={colorize:async()=>new((await i.e(152).then(i.bind(null,\"P3Vg\"))).Colorize),blur:async()=>new((await i.e(151).then(i.bind(null,\"B2cn\"))).Blur),bloom:async()=>new((await i.e(150).then(i.bind(null,\"mxcV\"))).Bloom),opacity:async()=>new((await i.e(154).then(i.bind(null,\"T/wP\"))).Opacity),\"drop-shadow\":async()=>new((await i.e(153).then(i.bind(null,\"eylR\"))).DropShadow)};class Bt{constructor(e){this._requestRender=e,this._effectMap=new Map,this._effectPromiseMap=new Map}dispose(){this._requestRender&&(this._requestRender=null),this._effectMap.forEach(e=>e.dispose()),this._effectMap.clear(),this._effectPromiseMap.clear()}getPostProcessingEffects(e){if(!e||0===e.length)return[];const t=[];for(const i of e){const e=Ft(i.type),s=this._effectMap.get(e);s?t.push({postProcessingEffect:s,effect:i}):this._enablePostProcessingEffect(e)}return t}async _enablePostProcessingEffect(e){const t=await this._loadPostProcessingEffect(e);this._requestRender&&(this._effectMap.set(e,t),this._requestRender.requestRender())}async _loadPostProcessingEffect(e){return this._effectPromiseMap.has(e)||this._effectPromiseMap.set(e,Rt[e]()),this._effectPromiseMap.get(e)}}var zt=i(\"tQ+6\");function Dt(e,t,i){return 1!==i||Object(re.h)(e)&&\"normal\"!==e||Object(re.h)(t)&&t.length>0}var It=i(\"zm0L\"),Et=i(\"lx5q\"),kt=i(\"GprA\");const Vt=Object(r.a)(\"esri-2d-profiler\");class At{constructor(e,t){if(this._events=new It.a,this._entries=new Map,this._timings=new Et.a(10),!Vt)return;this._ext=Object(kt.a)(e.gl,{}),this._debugOutput=t;const i=e.gl;if(this.enableCommandLogging)for(const s in i)if(\"function\"==typeof i[s]){const e=i[s],t=-1!==s.indexOf(\"draw\");i[s]=(...r)=>(this._events.emit(\"command\",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:s,args:r,isDrawCommand:t}),this._currentSummary&&(this._currentSummary.commands++,t&&this._currentSummary.drawCommands++),e.apply(i,r))}}get enableCommandLogging(){return!(\"object\"==typeof Vt&&Vt.disableCommands)}recordContainerStart(e){Vt&&(this._currentContainer=e)}recordContainerEnd(){Vt&&(this._currentContainer=null)}recordPassStart(e){Vt&&(this._currentPass=e,this._initSummary())}recordPassEnd(){Vt&&(this._currentPass=null,this._emitSummary())}recordBrushStart(e){Vt&&(this._currentBrush=e)}recordBrushEnd(){Vt&&(this._currentBrush=null)}recordStart(e){if(Vt&&Object(re.h)(this._ext)){if(this._entries.has(e)){const t=this._entries.get(e),i=this._ext.resultAvailable(t.query),s=this._ext.disjoint();if(i&&!s){const i=this._ext.getResult(t.query)/1e6;let s=0;if(Object(re.h)(this._timings.enqueue(i))){const e=this._timings.entries,t=e.length;let i=0;for(const s of e)i+=s;s=i/t}const r=i.toFixed(2),a=s?s.toFixed(2):\"--\";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${e}, ${r} ms (${a} last 10 avg)\\n${t.commandsLen} Commands (${t.drawCommands} draw)`),console.log(\"RenderPass breakdown: \"),console.table(t.summaries),console.log(\"Commands: \",t.commands),console.groupEnd()):console.log(`Frame report for ${e}, ${r} ms (${a} last 10 avg)`),this._debugOutput.innerHTML=`${r} (${a})`}for(const e of t.handles)e.remove();this._entries.delete(e)}const t={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(t.handles.push(this._events.on(\"command\",e=>{t.commandsLen++,t.commands.push(e),e.isDrawCommand&&t.drawCommands++})),t.handles.push(this._events.on(\"summary\",e=>{t.summaries.push(e)}))),this._ext.beginTimeElapsed(t.query),this._entries.set(e,t)}}recordEnd(e){Vt&&Object(re.h)(this._ext)&&this._entries.has(e)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._events.emit(\"summary\",this._currentSummary)}}var Lt=i(\"jjdI\");const Ut=a.a.getLogger(\"esri.views.2d.engine.webgl.WebGLDriverTest\");class Nt{constructor(e){this._ignoresSamplerPrecision=null,this._context=e}get ignoresSamplerPrecision(){return Object(re.g)(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=qt(this._context)),this._ignoresSamplerPrecision}}const qt=e=>{const t=new Q.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),i=new Uint8Array(4),s=new ut.a(e,[0,0,1,0,0,1,1,1]),r=new Lt.a(e,\"\\nprecision highp float;\\n\\nattribute vec2 a_pos;\\n\\nuniform highp sampler2D u_texture;\\nvarying vec4 v_color;\\n\\nfloat getBit(in float bitset, in int bitIndex) {\\n  float offset = pow(2.0, float(bitIndex));\\n\\n  return mod(floor(bitset / offset), 2.0);\\n}\\n\\nvoid main() {\\n  vec4 value = texture2D(u_texture, vec2(0.0));\\n\\n  float bit = getBit(value.x * 255.0, 1);\\n\\n  v_color = bit * vec4(1.0);\\n\\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\\n}\\n\",\"\\nprecision highp float;\\n\\nvarying vec4 v_color;\\n\\nvoid main() {\\n  gl_FragColor = v_color;\\n}\\n\",{a_pos:0}),a=new Se.a(e,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));r.setUniform1i(\"u_texture\",0),e.bindTexture(a,0);const n=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.bindProgram(r);const{x:o,y:h,width:l,height:c}=e.getViewport();e.setViewport(0,0,1,1),s.draw(),e.setViewport(o,h,l,c),t.readPixels(0,0,1,1,6408,5121,i),r.dispose(),s.dispose(),t.dispose();const d=255!==i[0]||255!==i[1]||255!==i[2]||255!==i[3];return d&&Ut.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${i[0]}.${i[1]}.${i[2]}.${i[3]}]`),e.bindFramebuffer(n),d},Ht={name:\"stencil\",shaders:{vertexShader:Object(le.a)(\"stencil/stencil.vert\"),fragmentShader:Object(le.a)(\"stencil/stencil.frag\")},attributes:{a_pos:0}};class Gt extends se.a{constructor(e,t){super(),this._trash=new Set,this._clipData=new Float32Array(8),this._upperLeft=Object(G.a)(),this._upperRight=Object(G.a)(),this._lowerLeft=Object(G.a)(),this._lowerRight=Object(G.a)(),this._mat2=Object(Y.a)(),this._clipRendererInitialized=!1,this._supersampleScreenshots=!0,this.renderRequested=!1,this.stage=this,this._stationary=!0;const{canvas:i=document.createElement(\"canvas\"),alpha:s=!0,stencil:a=!0,renderContext:n=\"webgl\",supersampleScreenshots:o=!0,contextOptions:l={}}=t;this._canvas=i;const c=Object($.b)(i,{alpha:s,antialias:!1,depth:!0,stencil:a},n);var d;this.context=new te.a(c,l),this.painter=new class{constructor(e,t){this.context=e,this._blitRenderer=new de,this._brushCache=new Map,this._vtlProgramCache=null,this._blendEffect=new bt,this.effects={highlight:new jt,hittest:new Pt,integrate:new gt,insideEffect:new wt(\"inside\"),outsideEffect:new wt(\"outside\")},this.materialManager=new class{constructor(e){this._programByKey=new Map,this._programCache=new oe.a(e)}dispose(){this._programCache&&this._programCache.dispose()}getProgram(e,t,i=[],s=[]){const r=t.vsPath+\".\"+t.fsPath+JSON.stringify(i)+s.join(\".\");if(this._programByKey.has(r))return this._programByKey.get(r);const a=s.reduce((t,i)=>({...t,[i]:e.driverTestResult[i]}),{}),n={...i.map(e=>\"string\"==typeof e?{name:e,value:!0}:e).reduce((e,t)=>({...e,[t.name]:t.value}),{}),...a},{vsPath:o,fsPath:h,attributes:l}=t,c=this._programCache.getProgram(ge(o,h,l),n);if(!c)throw new Error(\"Unable to get program for key: ${key}\");return this._programByKey.set(r,c),c}getMaterialProgram(e,t,i,s,r,a=[\"ignoresSamplerPrecision\"]){const n=(({rendererInfo:e,drawPhase:t},i,s,r)=>{return`${i.getVariationHash()}-${r.join(\".\")}-${a=t,(pe(a)?1:0)|(a===ie.c.HIGHLIGHT?2:0)}-${e.getVariationHash()}-${Object(re.h)(s)&&s.join(\".\")}`;var a})(e,t,r,a);if(this._programByKey.has(n))return this._programByKey.get(n);const o=((e,t,i,s)=>{const r=s.reduce((t,i)=>({...t,[i]:e.driverTestResult[i]}),{}),a={...t.getVariation(),...e.rendererInfo.getVariation(),highlight:e.drawPhase===ie.c.HIGHLIGHT,id:pe(e.drawPhase),...r};if(Object(re.h)(i))for(const n of i)a[n]=!0;return a})(e,t,r,a),h=this._programCache.getProgram(ge(i,i,s),o);if(!h)throw new Error(\"Unable to get program for key: ${key}\");return this._programByKey.set(n,h),h}}(e),this._vtlProgramCache=new class{constructor(e){this._cache=new Array(8);for(let t=0;t<8;t++)this._cache[t]={};this._programRepo=new oe.a(e)}dispose(){this._programRepo&&(this._programRepo.dispose(),this._programRepo=null)}getProgram(e,t,i){const s=this._cache[e];if(!s[t]){const r=this._programRepo.getProgram(this._getProgramTemplate(e),i);s[t]=r}return s[t]}getProgramAttributes(e){switch(e){case 0:return he.a.attributes;case 5:return he.b.attributes;case 1:return he.c.attributes;case 4:return he.d.attributes;case 3:return he.e.attributes;case 2:return he.f.attributes;case 6:return he.g.attributes;default:return null}}_getProgramTemplate(e){switch(e){case 0:return he.a;case 5:return he.b;case 1:return he.c;case 4:return he.d;case 3:return he.e;case 2:return he.f;case 6:return he.g;default:return null}}}(e),this.textureManager=new class{constructor(e){this._invalidFontsMap=new Map,this._sdfConverter=new class{constructor(e){this.size=e;const t=document.createElement(\"canvas\");t.width=t.height=e,this._context=t.getContext(\"2d\"),this._gridOuter=new Float64Array(e*e),this._gridInner=new Float64Array(e*e),this._f=new Float64Array(e),this._d=new Float64Array(e),this._z=new Float64Array(e+1),this._v=new Int16Array(e)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(e,t,i=31){this._initSVG();const s=this._createSVGString(e);return Object(fe.c)((e,r)=>{const a=new Image;a.src=\"data:image/svg+xml; charset=utf8, \"+encodeURIComponent(s),a.onload=()=>{a.onload=null,this._context.clearRect(0,0,this.size,this.size),this._context.drawImage(a,0,0,this.size,this.size);const t=this._context.getImageData(0,0,this.size,this.size),s=new Uint8Array(this.size*this.size*4);for(let e=0;e<this.size*this.size;e++){const i=t.data[4*e+3]/255;this._gridOuter[e]=1===i?0:0===i?Ee:Math.pow(Math.max(0,.5-i),2),this._gridInner[e]=1===i?Ee:0===i?0:Math.pow(Math.max(0,i-.5),2)}this._edt(this._gridOuter,this.size,this.size),this._edt(this._gridInner,this.size,this.size);for(let e=0;e<this.size*this.size;e++)Ie(.5-(this._gridOuter[e]-this._gridInner[e])/(2*i),s,4*e);e(s)};const n=t&&t.signal;n&&Object(fe.r)(n,()=>r(Object(fe.e)()))})}_initSVG(){if(!this._svg){const e=document.createElementNS(\"http://www.w3.org/2000/svg\",\"svg\");e.setAttribute(\"style\",\"position: absolute;\"),e.setAttribute(\"width\",\"0\"),e.setAttribute(\"height\",\"0\"),e.setAttribute(\"aria-hidden\",\"true\"),e.setAttribute(\"role\",\"presentation\"),document.body.appendChild(e),this._svg=e}}_createSVGString(e){const t=document.createElementNS(\"http://www.w3.org/2000/svg\",\"path\");t.setAttribute(\"d\",e),this._svg.appendChild(t);const i=t.getBBox(),s=i.width/i.height,r=this.size/2;let a,n,o,h;s>1?(n=a=r/i.width,o=this.size/4,h=r-r*(1/s)/2):(a=n=r/i.height,o=r-r*s/2,h=this.size/4),t.setAttribute(\"style\",`transform: matrix(${a}, 0, 0, ${n}, ${-i.x*a+o}, ${-i.y*n+h})`);const l=`<svg style=\"fill:red;\" height=\"${this.size}\" width=\"${this.size}\" xmlns=\"http://www.w3.org/2000/svg\">${this._svg.innerHTML}</svg>`;return this._svg.removeChild(t),l}_edt(e,t,i){const s=this._f,r=this._d,a=this._v,n=this._z;for(let o=0;o<t;o++){for(let r=0;r<i;r++)s[r]=e[r*t+o];this._edt1d(s,r,a,n,i);for(let s=0;s<i;s++)e[s*t+o]=r[s]}for(let o=0;o<i;o++){for(let i=0;i<t;i++)s[i]=e[o*t+i];this._edt1d(s,r,a,n,t);for(let i=0;i<t;i++)e[o*t+i]=Math.sqrt(r[i])}}_edt1d(e,t,i,s,r){i[0]=0,s[0]=-Ee,s[1]=+Ee;for(let a=1,n=0;a<r;a++){let t=(e[a]+a*a-(e[i[n]]+i[n]*i[n]))/(2*a-2*i[n]);for(;t<=s[n];)n--,t=(e[a]+a*a-(e[i[n]]+i[n]*i[n]))/(2*a-2*i[n]);n++,i[n]=a,s[n]=t,s[n+1]=+Ee}for(let a=0,n=0;a<r;a++){for(;s[n+1]<a;)n++;t[a]=(a-i[n])*(a-i[n])+e[i[n]]}}}(126),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._rasterizer=new class{dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(e,t,i){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement(\"canvas\")),\"simple-fill\"===e.type||\"esriSFS\"===e.type){const[i,s,r]=Oe.c.rasterizeSimpleFill(this._rasterizationCanvas,e.style,t);return{size:[s,r],image:new Uint32Array(i.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if(\"simple-line\"===e.type||\"esriSLS\"===e.type){const[t,i,s]=Oe.c.rasterizeSimpleLine(e.style,e.cap);return{size:[i,s],image:new Uint32Array(t.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let s,r,a;if(\"simple-marker\"===e.type||\"esriSMS\"===e.type||\"line-marker\"===e.type?(s=Oe.a.fromSimpleMarker(e),a=Object(Te.c)(s)):\"CIMHatchFill\"===e.type?(s=Oe.a.fromCIMHatchFill(e),r=new xe.a(s.frame.xmin,-s.frame.ymax,s.frame.xmax-s.frame.xmin,s.frame.ymax-s.frame.ymin)):e.markerPlacement&&\"CIMMarkerPlacementInsidePolygon\"===e.markerPlacement.type?(s=Oe.a.fromCIMInsidePolygon(e),r=new xe.a(s.frame.xmin,-s.frame.ymax,s.frame.xmax-s.frame.xmin,s.frame.ymax-s.frame.ymin)):(s=e,a=Object(Te.c)(s)),a&&!i){const[e,t,i]=Object(Te.a)(a);return e?{size:[t,i],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[n,o,h,l,c]=Oe.a.rasterize(this._rasterizationCanvas,s,r,!i);return n?{size:[o,h],image:new Uint32Array(n.buffer),sdf:!1,simplePattern:!1,anchorX:l,anchorY:c}:null}rasterizeImageResource(e,t,i,s){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement(\"canvas\")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;const r=this._rasterizationCanvas.getContext(\"2d\");i instanceof ImageData?r.putImageData(i,0,0):(i.setAttribute(\"width\",e+\"px\"),i.setAttribute(\"height\",t+\"px\"),r.drawImage(i,0,0,e,t));const a=r.getImageData(0,0,e,t),n=new Uint8Array(a.data);if(s)for(const u of s)if(u&&u.oldColor&&4===u.oldColor.length&&u.newColor&&4===u.newColor.length){const[e,t,i,s]=u.oldColor,[r,a,o,h]=u.newColor;if(e===r&&t===a&&i===o&&s===h)continue;for(let l=0;l<n.length;l+=4)e===n[l]&&t===n[l+1]&&i===n[l+2]&&s===n[l+3]&&(n[l]=r,n[l+1]=a,n[l+2]=o,n[l+3]=h)}let o;for(let u=0;u<n.length;u+=4)o=n[u+3]/255,n[u]=n[u]*o,n[u+1]=n[u+1]*o,n[u+2]=n[u+2]*o;let h=n,l=e,c=t;const d=512;if(l>=d||c>=d){const i=l/c;i>1?(l=d,c=Math.round(d/i)):(c=d,l=Math.round(d*i)),h=new Uint8Array(4*l*c);const s=new Uint8ClampedArray(h.buffer);Object(ve.h)(n,e,t,s,l,c,!1)}return{size:[e,t],image:new Uint32Array(h.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}},this._ongoingRasterizations=new Map,this._spriteMosaic=new Le(e,2048,2048,500),this._glyphSource=new class{constructor(e){this._glyphInfo={},this._baseURL=e}getRange(e,t,i){const s=this._getFontStack(e);if(s.getRange(t))return Object(fe.u)();const r=256*t,a=r+255,n=this._baseURL.replace(\"{fontstack}\",e).replace(\"{range}\",r+\"-\"+a);return Object(be.default)(n,{responseType:\"array-buffer\",...i}).then(e=>{s.addRange(t,new Fe(new Pe.a(new Uint8Array(e.data),new DataView(e.data))))})}getGlyph(e,t){const i=this._getFontStack(e);if(!i)return;const s=Math.floor(t/256);if(s>256)return;const r=i.getRange(s);return r?{metrics:r.getMetrics(t),bitmap:r.getBitmap(t)}:void 0}_getFontStack(e){let t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new Re),t}}(_e.a.fontsUrl+\"/{fontstack}/{range}.pbf\"),this._glyphMosaic=new class{constructor(e,t,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this.width=e,this.height=t,this._glyphSource=i,this._binPack=new Me(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}dispose(){this._binPack=null;for(const e of this._textures)e&&e.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyph(){const e=[117,149,181,207,207,181,149,117],t=[];for(let s=0;s<e.length;s++){const i=e[s];for(let e=0;e<11;e++)t.push(i)}const i={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(t)};this._recordGlyph(i)}async getGlyphItems(e,t,i){const s=this._getGlyphCache(e);return await this._fetchRanges(e,t,i),t.map(t=>this._getMosaicItem(s,e,t))}bind(e,t,i,s){const r=this._getTexture(e,i);r.setSamplingMode(t),this._dirties[i]&&(r.setData(this._glyphData[i]),this._dirties[i]=!1),e.bindTexture(r,s)}_getGlyphCache(e){return this._glyphCache[e]||(this._glyphCache[e]={}),this._glyphCache[e]}_getTexture(e,t){return this._textures[t]||(this._textures[t]=new Se.a(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[t]}_invalidate(){this._dirties[this._currentPage]=!0}async _fetchRanges(e,t,i){const s=function(e){const t=new Set;for(const i of e)t.add(je(i));return t}(t),r=[];s.forEach(t=>{r.push(this._fetchRange(e,t,i))}),await Object(fe.b)(r)}async _fetchRange(e,t,i){return t>256?null:(a=()=>this._glyphSource.getRange(e,t,i),(s=this._rangePromises).has(r=e+t)||s.set(r,a().then(()=>{s.delete(r)}).catch(e=>{s.delete(r),Object(fe.x)(e)})),s.get(r));var s,r,a}_getMosaicItem(e,t,i){if(!e[i]){const s=this._glyphSource.getGlyph(t,i);if(!s||!s.metrics)return(e=>({rect:new Ce.a(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:e,sdf:!0}))(i);const r=this._recordGlyph(s);e[i]={rect:r,page:this._currentPage,metrics:s.metrics,code:i,sdf:!0},this._invalidate()}return e[i]}_getMosaicItemsStable(e,t,i){const s=[],r=i.map(e=>e);return i.map(e=>e).sort().map(i=>this._getMosaicItem(e,t,i)).forEach(e=>{const t=r.indexOf(e.code);s[t]=e,r[t]=null}),s}_recordGlyph(e){const t=e.metrics;let i;if(0===t.width)i=new Ce.a(0,0,0,0);else{const s=3,a=t.width+2*s,n=t.height+2*s;i=this._binPack.allocate(a,n),i.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new Me(this.width-4,this.height-4),i=this._binPack.allocate(a,n));const o=this._glyphData[this._currentPage],h=e.bitmap;let l,c;if(h)for(let e=0;e<n;e++){l=a*e,c=this.width*(i.y+e)+i.x;for(let e=0;e<a;e++)o[c+e]=h[l+e]}Object(r.a)(\"esri-glyph-debug\")&&this._showDebugPage(o)}return i}_showDebugPage(e){const t=document.createElement(\"canvas\"),i=t.getContext(\"2d\"),s=new ImageData(this.width,this.height),r=s.data;t.width=this.width,t.height=this.height,t.style.border=\"1px solid black\";for(let a=0;a<e.length;++a)r[4*a+0]=e[a],r[4*a+1]=0,r[4*a+2]=0,r[4*a+3]=255;i.putImageData(s,0,0),document.body.appendChild(t)}}(1024,1024,this._glyphSource)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._rasterizer=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}async rasterizeItem(e,t,i,s){if(Object(re.g)(e))return ct(\"mapview-null-resource\",\"Unable to rasterize null resource\"),null;switch(e.type){case\"CIMTextSymbol\":case\"esriTS\":{const t=await this._rasterizeText(e,i,s);return t.forEach(e=>this._setTextureBinding(ie.a.GLYPH,e)),{glyphMosaicItems:t}}case\"esriSMS\":case\"esriPMS\":case\"esriSFS\":case\"esriPFS\":case\"esriSLS\":default:{if((r=e).type&&-1!==r.type.toLowerCase().indexOf(\"3d\"))return ct(\"mapview-invalid-type\",\"MapView does not support symbol type: \"+e.type,e),null;const i=await this._rasterizeSpriteSymbol(e,t,s);return Object(rt.a)(i)&&i&&this._setTextureBinding(ie.a.SPRITE,i),{spriteMosaicItem:i}}}var r}bindTextures(e,t,i,s=!1){if(0===i.textureBinding)return;const r=this._bindingInfos[i.textureBinding-1],a=r.page,n=s?9987:9729;switch(r.mosaicType){case ie.a.SPRITE:{const i=this.sprites.getWidth(a),s=this.sprites.getHeight(a),r=Object(p.m)(at,i,s);return this._spriteMosaic.bind(e,n,a,m.C),t.setUniform1i(\"u_texture\",m.C),void t.setUniform2fv(\"u_mosaicSize\",r)}case ie.a.GLYPH:{const i=this.glyphs.width,s=this.glyphs.height,r=Object(p.m)(at,i,s);return this._glyphMosaic.bind(e,n,a,m.x),t.setUniform1i(\"u_texture\",m.x),void t.setUniform2fv(\"u_mosaicSize\",r)}default:nt.error(\"mapview-texture-manager\",\"Cannot handle unknown type \"+r.mosaicType)}}_hashMosaic(e,t){return 1|e<<1|(t.sdf?1:0)<<2|t.page<<3}_setTextureBinding(e,t){const i=this._hashMosaic(e,t);if(!this._hashToBindingIndex.has(i)){const s=dt.fromMosaic(e,t);this._hashToBindingIndex.set(i,this._bindingInfos.length+1),this._bindingInfos.push(s)}t.textureBinding=this._hashToBindingIndex.get(i)}async _rasterizeText(e,t,i){const s=function(e){const t=function(e){if(!e.weight)return\"\";switch(e.weight.toLowerCase()){case\"bold\":case\"bolder\":return\"-bold\"}return\"\"}(e)+function(e){if(!e.style)return\"\";switch(e.style.toLowerCase()){case\"italic\":case\"oblic\":return\"-italic\"}return\"\"}(e);return function(e){const t=e.toLowerCase().split(\" \").join(\"-\");switch(t){case\"serif\":return\"noto-serif\";case\"sans-serif\":return\"arial-unicode-ms\";case\"monospace\":return\"ubuntu-mono\";case\"fantasy\":return\"cabin-sketch\";case\"cursive\":return\"redressed\";default:return t}}(e.family)+(t.length>0?t:\"-regular\")}(e.font),r=this._invalidFontsMap.has(s),a=t||function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e.charCodeAt(i));return t}(Object(ye.a)(e.text)[0]);try{return await this._glyphMosaic.getGlyphItems(r?\"arial-unicode-ms-regular\":s,a,i)}catch(e){return ct(\"mapview-invalid-resource\",`Couldn't find font ${s}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(s,!0),this._glyphMosaic.getGlyphItems(\"arial-unicode-ms-regular\",a,i)}}async _rasterizeSpriteSymbol(e,t,i){if(function(e){switch(e.type){case\"CIMSolidStroke\":case\"CIMSolidFill\":return!0;case\"esriSFS\":return\"esriSFSSolid\"===e.style||\"esriSFSNull\"===e.style;case\"esriSLS\":return\"esriSLSSolid\"===e.style||\"esriSLSNull\"===e.style;default:return!1}}(e))return null;const s=function(e){switch(e.type){case\"esriSMS\":return`${e.style}.${e.path}`;case\"esriSLS\":return`${e.style}.${e.cap}`;case\"esriSFS\":return\"\"+e.style;case\"esriPFS\":case\"esriPMS\":return e.imageData?`${e.imageData}${e.width}${e.height}`:`${e.url}${e.width}${e.height}`;default:return e.mosaicHash?e.mosaicHash:JSON.stringify(e)}}(e);if(this._spriteMosaic.has(s))return this._spriteMosaic.getSpriteItem(s);if(ot(e)||(e=>e.url||e.imageData)(e))return this._handleAsyncResource(s,e,i);const r=this._rasterizer.rasterizeJSONResource(e,t);if(r){const{size:t,image:i,sdf:a,simplePattern:n}=r;return this._addItemToMosaic(s,t,{type:\"static\",data:i},ht(e),a,n)}return new h.a(\"TextureManager\",\"unrecognized or null rasterized image\")}async _handleAsyncResource(e,t,i){if(this._ongoingRasterizations.has(e))return this._ongoingRasterizations.get(e);let s;s=ot(t)?this._handleSVG(t,e,i):this._handleImage(t,e,i),this._ongoingRasterizations.set(e,s);try{await s,this._ongoingRasterizations.delete(e)}catch{this._ongoingRasterizations.delete(e)}return s}async _handleSVG(e,t,i){const s=await this._sdfConverter.draw(e.path,i);return this._addItemToMosaic(t,[126,126],{type:\"static\",data:new Uint32Array(s.buffer)},!1,!0,!0)}async _handleGIFOrPNG(e,t,i){const s=await async function(e,t){const i=e.imageData?`data:${e.contentType};base64,${e.imageData}`:e.url;let s;const r=\";base64,\";if(-1!==i.indexOf(r)){const e=i.indexOf(r)+r.length,t=i.substring(e),a=atob(t),n=new Uint8Array(a.length);for(let i=0;i<a.length;i++)n[i]=a.charCodeAt(i);s=n.buffer}else try{const{data:e}=await Object(be.default)(i,{responseType:\"array-buffer\",...t});s=e}catch(e){if(!Object(fe.n)(e))return new h.a(\"mapview-invalid-resource\",\"Could not fetch requested resource at \"+i)}return s}(e,i);if(Object(rt.a)(s)){const r=et(s),a=Ge(s);if(!r&&!a)return new h.a(\"mapview-invalid-resource\",\"Image data is neither GIF nor PNG!\");let n;try{r&&function(e){if(!e||0===e.byteLength)return!1;const t=new Uint8Array(e);if(!et(t))return!1;let i=0;for(let s=0,r=t.length-9;s<r&&(0!==t[s]||33!==t[s+1]||249!==t[s+2]||4!==t[s+3]||0!==t[s+8]||44!==t[s+9]&&33!==t[s+9]||(i++,!(i>1)));++s);return i>1}(s)?n=await st.create(s,i):a&&function(e){const t=new Uint8Array(e);if(!Ge(t))return!1;let i=!1;return Ze(t,e=>!(i=\"acTL\"===e)),i}(s)&&(n=await Qe.create(s,i))}catch(e){if(!Object(fe.n)(e))return new h.a(\"mapview-invalid-resource\",\"Could not fetch requested resource!\")}if(n&&Object(rt.a)(n))return this._addItemToMosaic(t,[n.width,n.height],{type:\"animated\",data:n},ht(e),!1,!1);const o=new Blob([s],{type:r?\"image/gif\":\"image/png\"}),l=await async function(e){const t=window.URL.createObjectURL(e);try{const{data:e}=await Object(be.default)(t,{responseType:\"image\"});return window.URL.revokeObjectURL(t),e}catch(e){return window.URL.revokeObjectURL(t),new h.a(\"mapview-invalid-resource\",\"Could not fetch requested resource at \"+t)}}(o);if(l&&l instanceof HTMLImageElement){let i=l.width,s=l.height;\"esriPMS\"===e.type&&(i=Math.round(lt(l.width,e.width)),s=Math.round(l.height*(i/l.width)));const{size:r,sdf:a,image:n}=this._rasterizer.rasterizeImageResource(i,s,l,e.colorSubstitutions);return this._addItemToMosaic(t,r,{type:\"static\",data:n},ht(e),a,!1)}}return new h.a(\"mapview-invalid-resource\",\"Could not handle resource!\")}async _handleImage(e,t,i){if((e=>e.url&&-1!==e.url.indexOf(\".gif\")||e.contentType&&\"image/gif\"===e.contentType||e.imageData&&-1!==e.imageData.indexOf(\"data:image/gif\"))(e)||(e=>e.url&&-1!==e.url.indexOf(\".png\")||e.contentType&&\"image/png\"===e.contentType||e.imageData&&-1!==e.imageData.indexOf(\"data:image/png\"))(e))return this._handleGIFOrPNG(e,t,i);const s=e.imageData?`data:${e.contentType};base64,${e.imageData}`:e.url;try{const{data:r}=await Object(be.default)(s,{responseType:\"image\",...i});-1!==s.indexOf(\"data:image/svg+xml\")&&(r.width=Object(f.d)(e.width),r.height=Object(f.d)(e.height));let a=r.width,n=r.height;\"esriPMS\"===e.type&&(a=Math.round(lt(r.width,e.width)),n=Math.round(r.height*(a/r.width)));const{size:o,sdf:h,image:l}=this._rasterizer.rasterizeImageResource(a,n,r,e.colorSubstitutions);return this._addItemToMosaic(t,o,{type:\"static\",data:l},ht(e),h,!1)}catch(e){if(!Object(fe.n)(e))return new h.a(\"mapview-invalid-resource\",\"Could not fetch requested resource at \"+s)}}_addItemToMosaic(e,t,i,s,r,a){return this._spriteMosaic.addSpriteItem(e,t,i,s,r,a)}}(t),this._effectsManager=new Bt(t)}getRenderTarget(){return this._renderTarget}setRenderTarget(e){this._renderTarget=e}getFbos(e,t){if(e!==this._lastWidth||t!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=t,this._fbos){for(const i in this._fbos)this._fbos[i].resize(e,t);return this._fbos}const i={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e,height:t},s={colorTarget:0,depthStencilTarget:3},r=new ae.a(this.context,{width:e,height:t,internalFormat:34041});this._stencilBuf=r,this._fbos={output:new Q.a(this.context,s,i,r),blend:new Q.a(this.context,s,i,r),effect0:new Q.a(this.context,s,i,r)}}return this._fbos}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderLayers(e,t=null){const{width:i,height:s}=e.getViewport();this._prevFBO=e.getBoundFramebufferObject();const r=this.getFbos(i,s);if(e.bindFramebuffer(r.output),e.setColorMask(!0,!0,!0,!0),e.setDepthWriteEnabled(!0),Object(re.h)(t)){const{r:i,g:s,b:r,a:a}=t.color;e.setClearColor(a*i/255,a*s/255,a*r/255,a)}else e.setClearColor(0,0,0,0);e.setClearDepth(1),e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.setDepthWriteEnabled(!1)}beforeRenderLayer(e,t,i){const{context:s,blendMode:r,effects:a}=e;if(Dt(r,a,i))s.bindFramebuffer(this._fbos.blend),s.setColorMask(!0,!0,!0,!0),s.setClearColor(0,0,0,0),s.clear(s.gl.COLOR_BUFFER_BIT);else{const e=this._getOutputFBO();s.bindFramebuffer(e)}s.setDepthWriteEnabled(!1),s.setDepthTestEnabled(!1),s.setStencilTestEnabled(!0),s.setClearStencil(t),s.setStencilWriteMask(255),s.clear(s.gl.STENCIL_BUFFER_BIT)}compositeLayer(e,t){const{context:i,blendMode:s,effects:r}=e;if(Dt(s,r,t)){Object(re.h)(r)&&r.length>0&&e.drawPhase===ie.c.MAP&&this._applyEffects(e,r);const a=this._getOutputFBO();i.bindFramebuffer(a),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(1,771,1,771),i.setColorMask(!0,!0,!0,!0);const n=Object(re.h)(s)?s:\"normal\";this._blendEffect.draw(e,this._fbos.blend.colorTexture,9728,n,t)}}renderLayers(e){if(e.bindFramebuffer(this._prevFBO),!this._fbos)return;const t=this._getOutputFBO();e.setStencilTestEnabled(!1),e.setStencilWriteMask(0),this.blitTexture(e,t.colorTexture,9728)}dispose(){if(this.materialManager.dispose(),this.textureManager.dispose(),this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null),this._vtlProgramCache&&(this._vtlProgramCache.dispose(),this._vtlProgramCache=null),this._brushCache&&(this._brushCache.forEach(e=>e.dispose()),this._brushCache.clear(),this._brushCache=null),this._fbos)for(const e in this._fbos)this._fbos[e]&&this._fbos[e].dispose();if(this.effects)for(const e in this.effects)this.effects[e]&&this.effects[e].dispose();this._prevFBO=null}getGeometryBrush(e){const t={[ie.d.FILL]:ne.a.fill,[ie.d.LINE]:ne.a.line,[ie.d.MARKER]:ne.a.marker,[ie.d.TEXT]:ne.a.text}[e];let i=this._brushCache.get(t);return void 0===i&&(i=new t,this._brushCache.set(t,i)),this._brushCache.get(t)}renderObject(e,t,i,s){const r=ne.a[i];if(!r)return null;let a=this._brushCache.get(r);void 0===a&&(a=new r,this._brushCache.set(r,a)),a.prepareState(e,t,s),a.draw(e,t,s)}renderObjects(e,t,i,s){const r=ne.a[i];if(!r)return null;let a=this._brushCache.get(r);void 0===a&&(a=new r,this._brushCache.set(r,a)),a.drawMany(e,t,s)}getVectorTileProgramCache(){return this._vtlProgramCache}registerRenderPass(e){const t=e.brushes.map(e=>(this._brushCache.has(e)||this._brushCache.set(e,new e),this._brushCache.get(e)));return new class{constructor(e,t){var i;this.brushes=e,this.name=t.name,this.drawPhase=t.drawPhase||ie.c.MAP,this._targetFn=t.target,this.effects=t.effects||[],this.enableDefaultDraw=null!=(i=t.enableDefaultDraw)?i:()=>!0,this.has=t.has}render(e){const{context:t,profiler:i}=e,s=this._targetFn(),a=this.drawPhase&e.drawPhase;if(i.recordPassStart(this.name),a&&(!this.has||Object(r.a)(this.has))){this.enableDefaultDraw()&&this._doRender(e,s),i.recordPassEnd();for(const r of this.effects){if(!r.enable())continue;const a=r.apply;i.recordPassStart(this.name+\".\"+a.name),i.recordBrushStart(a.name);const n=r.args&&r.args(),{x:o,y:h,width:l,height:c}=t.getViewport(),d=t.getBoundFramebufferObject();a.bind(e,n),this._doRender(e,s,a.defines),a.draw(e,n),a.unbind(e,n),t.bindFramebuffer(d),t.setViewport(o,h,l,c),i.recordBrushEnd(),i.recordPassEnd()}}}_doRender(e,t,i){if(!Object(re.g)(t))if(Object(zt.g)(t)){for(const s of t)if(s.visible)for(const t of this.brushes)e.profiler.recordBrushStart(t.name),t.prepareState(e,s,i),t.draw(e,s,i),e.profiler.recordBrushEnd()}else for(const s of this.brushes)e.profiler.recordBrushStart(s.name),s.prepareState(e,t,i),s.draw(e,t,i),e.profiler.recordBrushEnd()}}(t,e)}setHighlightOptions(e){this.effects.highlight.setHighlightOptions(e)}blitTexture(e,t,i,s=1){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,i,s)}getPostProcessingEffects(e){return this._effectsManager.getPostProcessingEffects(e)}_getOutputFBO(){return null!=this._renderTarget?this._renderTarget:this._fbos.output}_applyEffects(e,t){const{context:i}=e,s=this._effectsManager.getPostProcessingEffects(t);for(const{postProcessingEffect:r,effect:a}of s)i.bindFramebuffer(this._fbos.blend),r.draw(e,this._fbos.blend,a)}}(this.context,this),Object(r.a)(\"esri-2d-profiler\")&&(this._debugOutput=document.createElement(\"div\"),this._debugOutput.setAttribute(\"style\",\"margin: 24px 64px; position: absolute; color: red;\"),e.appendChild(this._debugOutput)),this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:t.timeline||new X.a,renderingOptions:t.renderingOptions,driverTestResult:(d=this.context,new Nt(d)),profiler:new At(this.context,this._debugOutput),dataUploadCounter:0},this._taskHandle=Object(N.a)({render:e=>this.renderFrame(e)}),this._taskHandle.pause(),this._supersampleScreenshots=o,this._lostWebGLContextHandle=Object(U.c)(i,\"webglcontextlost\",()=>{this.emit(\"webgl-error\",{error:new h.a(\"webgl-context-lost\")})}),i.setAttribute(\"style\",\"width: 100%; height:100%; display:block;\"),e.appendChild(i)}destroy(){this.removeAllChildren(),this._emptyTrash(),this._taskHandle.remove(),this._taskHandle=null,this._boundFBO=null,this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null),this._clipVAO&&(this._clipVAO.dispose(),this._clipVAO=null,this._clipVBO=null),this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null),this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput),this.highlightOptions=null,this.painter.dispose(),this.context.dispose(),this._canvas=null}get background(){return this._background}set background(e){this._background=e,this.requestRender()}get highlightOptions(){return this._highlightOptions}set highlightOptions(e){this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null),this._highlightOptions=e,this._highlightOptions&&(this._highlightOptionsHandle=Object(H.a)(this._highlightOptions,\"version\",()=>{this.painter.setHighlightOptions(e),this.requestRender()}))}get renderingOptions(){return this._renderingOptions}set renderingOptions(e){this._renderingOptions=e,this.requestRender()}get state(){return this._state}set state(e){this._state=e,this.requestRender()}get stationary(){return this._stationary}set stationary(e){this._stationary!==e&&(this._stationary=e,this.requestRender())}trashDisplayObject(e){this._trash.add(e),this.requestRender()}untrashDisplayObject(e){return this._trash.delete(e)}requestRender(){this._lastRenderRequestTime=performance.now(),this.renderRequested||(this.renderRequested=!0,this.emit(\"will-render\"),this._taskHandle.resume())}renderFrame(e){e.time-this._lastRenderRequestTime>=2e3&&this._taskHandle.pause(),this.renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash(),this.emit(\"post-render\")}renderChildren(e){for(const t of this.children)t.beforeRender(e);this._renderChildren(this.children,e);for(const t of this.children)t.afterRender(e)}_renderChildren(e,t){const i=this.context;t.profiler.recordStart(\"drawLayers\"),t.dataUploadCounter=0,this._beforeRenderChildren(t),t.drawPhase=ie.c.MAP,this.painter.beforeRenderLayers(i,this.background);for(const s of e)s.processRender(t);this.painter.renderLayers(i),t.drawPhase=ie.c.HIGHLIGHT,this.painter.beforeRenderLayers(i);for(const s of e)s.processRender(t);if(this.painter.renderLayers(i),this._isLabelDrawPhaseRequired(e)){t.drawPhase=ie.c.LABEL,this.painter.beforeRenderLayers(i);for(const i of e)i.processRender(t);this.painter.renderLayers(i)}if(Object(r.a)(\"esri-tiles-debug\")){t.drawPhase=ie.c.DEBUG,this.painter.beforeRenderLayers(i);for(const i of e)i.processRender(t);this.painter.renderLayers(i)}t.profiler.recordEnd(\"drawLayers\"),this._afterRenderChildren()}_beforeRenderChildren(e){const{context:t}=this,{state:i,pixelRatio:s}=e;t.enforceState();const{size:r,rotation:a}=i,n=Math.round(r[0]*s),o=Math.round(r[1]*s);if(this._boundFBO=t.getBoundFramebufferObject(),!i.spatialReference||!(i.spatialReference._isWrappable?i.spatialReference._isWrappable():i.spatialReference.isWrappable))return void(this._clipFrame=!1);const h=Object(q.d)(a),l=Math.abs(Math.cos(h)),c=Math.abs(Math.sin(h)),d=Math.round(n*l+o*c),u=Math.round(i.worldScreenWidth);if(d<=u)return void(this._clipFrame=!1);this._clipFBO&&this._clipFBO.width===n&&this._clipFBO.height===o||(this._clipFBO=new Q.a(t,{colorTarget:0,depthStencilTarget:3,width:n,height:o}));const m=(this.state.padding.left-this.state.padding.right)/2,g=(this.state.padding.bottom-this.state.padding.top)/2,_=.5*n,f=.5*o,b=1/n,w=1/o,y=u*s*.5,v=.5*(n*c+o*l),x=this._upperLeft,O=this._upperRight,T=this._lowerLeft,S=this._lowerRight;Object(p.m)(x,-y,-v),Object(p.m)(O,y,-v),Object(p.m)(T,-y,v),Object(p.m)(S,y,v),Object(Z.d)(this._mat2),Object(Z.h)(this._mat2,this._mat2,[_+m,f+g]),0!==a&&Object(Z.f)(this._mat2,this._mat2,h),Object(p.n)(x,x,this._mat2),Object(p.n)(O,O,this._mat2),Object(p.n)(T,T,this._mat2),Object(p.n)(S,S,this._mat2);const C=this._clipData;C.set([2*T[0]*b-1,2*(o-T[1])*w-1,2*S[0]*b-1,2*(o-S[1])*w-1,2*x[0]*b-1,2*(o-x[1])*w-1,2*O[0]*b-1,2*(o-O[1])*w-1]),this._clipRendererInitialized||this._initializeClipRenderer(t),this._clipVBO.setData(C),this._boundFBO=t.getBoundFramebufferObject(),t.bindFramebuffer(this._clipFBO),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),t.setClearColor(0,0,0,0),t.setClearDepth(1),t.setClearStencil(0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT|t.gl.STENCIL_BUFFER_BIT),t.setDepthWriteEnabled(!1),this._clipFrame=!0}_afterRenderChildren(){const e=this.context;if(e.logIno(),this._clipFrame&&this._clipRendererInitialized){if(e.bindFramebuffer(this._boundFBO),this._boundFBO=null,e.bindVAO(this._clipVAO),e.bindProgram(this._clipStencilProgram),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunction(519,1,255),e.drawElements(4,6,5123,0),e.bindVAO(),e.setColorMask(!0,!0,!0,!0),null!=this.background){const{r:t,g:i,b:s,a:r}=this.background.color;e.setClearColor(r*t/255,r*i/255,r*s/255,r)}else e.setClearColor(0,0,0,0);e.clear(e.gl.COLOR_BUFFER_BIT),e.setBlendingEnabled(!0),e.setStencilFunction(514,1,255),this.painter.blitTexture(e,this._clipFBO.colorTexture,9728,1),e.setStencilTestEnabled(!1)}}doRender(e){const t=this.context,{state:i,pixelRatio:s}=e;this._resizeCanvas(e),this.context.enforceState(),t.setViewport(0,0,s*i.size[0],s*i.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),super.doRender(e)}async takeScreenshot(e,t){const i=Object(W.d)(e,this._supersampleScreenshots,this._state.padding),{framebufferWidth:s,framebufferHeight:r}=i,a=this.context,n=e.layers;let o=this.children;const h={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),pixelRatio:i.pixelRatio,time:Date.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1};if(null!=e.rotation){const t=h.state.viewpoint;t.rotation=e.rotation,h.state.viewpoint=t}n.length>0&&(o=[],n.forEach(e=>{const i=t.find(t=>t.layer.id===e.id);i&&\"container\"in i&&i.container&&o.push(i.container)}));const l=new Q.a(a,{colorTarget:0,depthStencilTarget:3,width:s,height:r}),c=a.getBoundFramebufferObject(),d=a.getViewport();a.bindFramebuffer(l),a.setViewport(0,0,s,r),this._renderChildren(o,h);const u=this._readbackScreenshot(i);a.bindFramebuffer(c),a.setViewport(d.x,d.y,d.width,d.height),this.requestRender();const m=this._ensureScreenshotEncodeCanvas();return Object(W.b)(u,e,m,{flipY:!0,premultipliedAlpha:!0})}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement(\"canvas\")),this._screenshotEncodeCanvas}_readbackScreenshot(e){const{framebufferWidth:t,framebufferHeight:i,region:s,resample:r}=e,a=this.context.gl;if(r){const e=Object(W.a)(t,i,this._ensureScreenshotEncodeCanvas());a.readPixels(0,0,t,i,6408,5121,new Uint8Array(e.data.buffer));const n=Object(W.a)(s.width,s.height,this._ensureScreenshotEncodeCanvas());return Object(W.c)(e,n,!0,r.region.x,i-(r.region.y+r.region.height),r.region.width,r.region.height)}{const e=Object(W.a)(s.width,s.height,this._ensureScreenshotEncodeCanvas());return a.readPixels(s.x,i-(s.y+s.height),s.width,s.height,6408,5121,new Uint8Array(e.data.buffer)),e}}_resizeCanvas(e){const t=this._canvas,i=t.style,{state:{size:s},pixelRatio:r}=e,a=s[0],n=s[1],o=Math.round(a*r),h=Math.round(n*r);t.width===o&&t.height===h||(t.width=o,t.height=h),i.width=a+\"px\",i.height=n+\"px\"}_initializeClipRenderer(e){if(this._clipRendererInitialized)return!0;const t=Ht.attributes,i=Object(ee.a)(e,Ht);if(!i)return!1;const s=K.a.createVertex(e,35040,32),r=new Uint16Array([0,1,2,2,1,3]),a=K.a.createIndex(e,35044,r),n=new J.a(e,t,{geometry:[{name:\"a_pos\",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:s},a);return this._clipStencilProgram=i,this._clipVBO=s,this._clipVAO=n,this._clipRendererInitialized=!0,!0}_emptyTrash(){for(;this._trash.size>0;){const e=Array.from(this._trash);this._trash.clear();for(const t of e)t.processDetach()}}_isLabelDrawPhaseRequired(e){let t=!1;for(const i of e){if(!(i instanceof se.a)){t=t||!1;break}if(i.hasLabels)return!0;t=t||this._isLabelDrawPhaseRequired(i.children)}return t}}var Wt=i(\"Vh9r\"),$t=i(\"SuVq\"),Zt=i(\"y3LX\"),Yt=i(\"qYtE\");const Xt=\"Shift\";let Kt=class extends l.a{constructor(e){super(e),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(e){this._handles&&this._handles.forEach(e=>{e.remove()}),this._handles=null,this._destroyOverlay(),this._set(\"view\",e),e&&(e.on(\"drag\",[Xt],e=>this._handleDrag(e,1)),e.on(\"drag\",[Xt,\"Ctrl\"],e=>this._handleDrag(e,-1)))}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(e,t,i,s){this._box.x=e,this._box.y=t,this._box.width=i,this._box.height=s,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(e,t,i,s,r){const a=this.view,n=a.toMap(Object(f.b)(e+.5*i,t+.5*s));let o=Math.max(i/a.width,s/a.height);-1===r&&(o=1/o),this._destroyOverlay(),this.navigation.end(),a.goTo({center:n,scale:a.scale*o})}_updateBox(e,t,i,s){const r=this._boxShape;r.setAttributeNS(null,\"x\",\"\"+e),r.setAttributeNS(null,\"y\",\"\"+t),r.setAttributeNS(null,\"width\",\"\"+i),r.setAttributeNS(null,\"height\",\"\"+s),r.setAttributeNS(null,\"class\",\"esri-zoom-box__outline\")}_updateBackground(e,t,i,s){this._backgroundShape.setAttributeNS(null,\"d\",this._toSVGPath(e,t,i,s,this.view.width,this.view.height))}_createContainer(){const e=document.createElement(\"div\");e.className=\"esri-zoom-box__container\",this.view.root.appendChild(e),this._container=e}_createOverlay(){const e=this.view.width,t=this.view.height,i=document.createElementNS(\"http://www.w3.org/2000/svg\",\"path\");i.setAttributeNS(null,\"d\",\"M 0 0 L \"+e+\" 0 L \"+e+\" \"+t+\" L 0 \"+t+\" Z\"),i.setAttributeNS(null,\"class\",\"esri-zoom-box__overlay-background\");const s=document.createElementNS(\"http://www.w3.org/2000/svg\",\"rect\"),r=document.createElementNS(\"http://www.w3.org/2000/svg\",\"svg\");r.setAttributeNS(\"http://www.w3.org/2000/xmlns/\",\"xmlns:xlink\",\"http://www.w3.org/1999/xlink\"),r.setAttributeNS(null,\"class\",\"esri-zoom-box__overlay\"),r.appendChild(i),r.appendChild(s),this._container.appendChild(r),this._backgroundShape=i,this._boxShape=s,this._overlay=r}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(e,t,i,s,r,a){const n=e+i,o=t+s;return\"M 0 0 L \"+r+\" 0 L \"+r+\" \"+a+\" L 0 \"+a+\" ZM \"+e+\" \"+t+\" L \"+e+\" \"+o+\" L \"+n+\" \"+o+\" L \"+n+\" \"+t+\" Z\"}_handleDrag(e,t){const i=e.x,s=e.y,r=e.origin.x,a=e.origin.y;let n,o,h,l;switch(i>r?(n=r,h=i-r):(n=i,h=r-i),s>a?(o=a,l=s-a):(o=s,l=a-s),e.action){case\"start\":this._start();break;case\"update\":this._update(n,o,h,l);break;case\"end\":this._end(n,o,h,l,t)}e.stopPropagation()}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:e,y:t,width:i,height:s}=this._box;this._updateBox(e,t,i,s),this._updateBackground(e,t,i,s),this._rafId=requestAnimationFrame(this._redraw)}};Object(s.a)([Object(n.b)()],Kt.prototype,\"navigation\",void 0),Object(s.a)([Object(n.b)()],Kt.prototype,\"view\",null),Kt=Object(s.a)([Object(o.a)(\"esri.views.2d.navigation.ZoomBox\")],Kt);var Jt=Kt,Qt=(i(\"4GrV\"),i(\"Cy1f\")),ei=i(\"5DEt\");class ti{constructor(e){this.gain=e}update(e){if(this.hasLastValue){const t=this.computeDelta(e);this.updateDelta(t)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return void 0!==this.lastValue}get hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(e){return e-this.lastValue}updateDelta(e){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*e:e}}class ii{constructor(e,t,i){this._initialVelocity=e,this._stopVelocity=t,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,t){const i=this.value(e);return this.value(e+t)-i}valueFromInitialVelocity(e,t){t=Math.min(t,this.duration);const i=1-this.friction;return e*(Math.pow(i,t)-1)/Math.log(i)}}class si extends ii{constructor(e,t,i,s,r){super(e,t,i),this.sceneVelocity=s,this.direction=r}value(e){return super.valueFromInitialVelocity(this.sceneVelocity,e)}}class ri{constructor(e=300,t=12,i=.84){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=i,this.enabled=!0,this.time=new ti(.6),this.screen=[new ti(.4),new ti(.4)],this.scene=[new ti(.6),new ti(.6),new ti(.6)],this.tmpDirection=Object(Qt.e)()}add(e,t,i){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(i)<.015)return;this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.scene[0].update(t[0]),this.scene[1].update(t[1]),this.scene[2].update(t[2]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,i=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(e,t,i){Object(ei.r)(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=Object(ei.m)(this.tmpDirection);return s>0&&Object(ei.b)(this.tmpDirection,this.tmpDirection,1/s),new si(e,t,i,s/this.time.filteredDelta,this.tmpDirection)}}let ai=class extends l.a{constructor(e){super(e),this.animationTime=0,this.momentumEstimator=new ri(500,6,.92),this.momentum=null,this.tmpMomentum=Object(Qt.e)(),this.momentumFinished=!1,this.viewpoint=new Zt.a({targetGeometry:new $t.a,scale:0,rotation:0}),this.watch(\"momentumFinished\",e=>{e&&this.navigation.stop()})}begin(e,t){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(t),this.previousDrag=t}update(e,t){this.addToEstimator(t);let i=t.center.x,s=t.center.y;const r=this.previousDrag;i=r?r.center.x-i:-i,s=r?s-r.center.y:s,e.viewpoint=Object(Yt.v)(this.viewpoint,e.viewpoint,[i||0,s||0]),this.previousDrag=t}end(e,t){this.addToEstimator(t),this.momentum=e.navigation.momentumEnabled?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(e),this.previousDrag=null,this.navigation.end()}addToEstimator(e){const t=e.center.x,i=e.center.y,s=Object(f.c)(-t,i),r=Object(Qt.g)(-t,i,0);this.momentumEstimator.add(s,r,.001*e.timestamp)}onAnimationUpdate(e){this.navigation.animationManager.animateContinous(e.viewpoint,(t,i)=>{this.momentumFinished=!this.momentum||this.momentum.isFinished(this.animationTime);const s=.001*i;if(!this.momentumFinished){const i=this.momentum.valueDelta(this.animationTime,s);Object(ei.b)(this.tmpMomentum,this.momentum.direction,i),Object(Yt.v)(t,t,this.tmpMomentum),e.constraints.constrainByGeometry(t)}this.animationTime+=s})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};Object(s.a)([Object(n.b)()],ai.prototype,\"momentumFinished\",void 0),Object(s.a)([Object(n.b)()],ai.prototype,\"viewpoint\",void 0),Object(s.a)([Object(n.b)()],ai.prototype,\"navigation\",void 0),ai=Object(s.a)([Object(o.a)(\"esri.views.2d.navigation.actions.Pan\")],ai);var ni=ai;class oi{constructor(e=2.5,t=.01,i=.95,s=12){this.minimumInitialVelocity=e,this.stopVelocity=t,this.friction=i,this.maxVelocity=s,this.enabled=!0,this.value=new ti(.8),this.time=new ti(.3)}add(e,t){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta){const t=this.value.computeDelta(e);this.value.filteredDelta*t<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Object(u.c)(e,-this.maxVelocity,this.maxVelocity),Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)}createMomentum(e,t,i){return new ii(e,t,i)}}class hi extends oi{constructor(e=3,t=.01,i=.95,s=12){super(e,t,i,s)}add(e,t){if(this.value.hasLastValue){const t=this.value.lastValue;let i=e-t;for(;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;e=t+i}super.add(e,t)}}class li extends ii{constructor(e,t,i){super(e,t,i)}value(e){const t=super.value(e);return Math.exp(t)}valueDelta(e,t){const i=super.value(e),s=super.value(e+t)-i;return Math.exp(s)}}class ci extends oi{constructor(e=2.5,t=.01,i=.95,s=12){super(e,t,i,s)}add(e,t){super.add(Math.log(e),t)}createMomentum(e,t,i){return new li(e,t,i)}}let di=class extends l.a{constructor(e){super(e),this._animationTime=0,this._momentumFinished=!1,this._rotationMomentumEstimator=new hi(.6,.15,.95),this._rotationDirection=1,this._zoomDirection=1,this._zoomMomentumEstimator=new ci,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new Zt.a({targetGeometry:new $t.a,scale:0,rotation:0}),this.watch(\"_momentumFinished\",e=>{e&&this.navigation.stop()})}begin(e,t){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=t.angle,this._previousRadius=this._startRadius=t.radius,this._previousCenter=t.center,this._updateTimestamp=null,e.constraints.rotationEnabled&&this.addToRotateEstimator(0,t.timestamp),this.addToZoomEstimator(t,1)}update(e,t){null===this._updateTimestamp&&(this._updateTimestamp=t.timestamp);const i=t.angle,s=t.radius,r=t.center,a=Math.abs(180*(i-this._startAngle)/Math.PI),n=Math.abs(s-this._startRadius),o=this._startRadius/s;if(this._previousRadius){const h=s/this._previousRadius;let l=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=l>=0?1:-1,this._zoomDirection=h>=1?1:-1,e.constraints.rotationEnabled?(null===this._zoomOnly&&t.timestamp-this._updateTimestamp>200&&(this._zoomOnly=n-a>0),null===this._zoomOnly||this._zoomOnly?l=0:this.addToRotateEstimator(i-this._startAngle,t.timestamp)):l=0,this.addToZoomEstimator(t,o),this.navigation.setViewpoint([r.x,r.y],1/h,l,[this._previousCenter.x-r.x,r.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=s,this._previousCenter=r}end(e){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(e),this.navigation.end()}addToRotateEstimator(e,t){this._rotationMomentumEstimator.add(e,.001*t)}addToZoomEstimator(e,t){this._zoomMomentumEstimator.add(t,.001*e.timestamp)}canZoomIn(e){const t=e.constraints.effectiveMaxScale;return 0===t||e.scale>t}canZoomOut(e){const t=e.constraints.effectiveMinScale;return 0===t||e.scale<t}onAnimationUpdate(e){this.navigation.animationManager.animateContinous(e.viewpoint,(t,i)=>{const s=!this.canZoomIn(e)&&this._zoomDirection>1||!this.canZoomOut(e)&&this._zoomDirection<1,r=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),a=s||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),n=.001*i;if(this._momentumFinished=r&&a,!this._momentumFinished){const i=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,n))*this._rotationDirection*180/Math.PI:0;let s=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,n)):1;const r=Object(G.a)(),a=Object(G.a)();if(this._previousCenter){Object(p.m)(r,this._previousCenter.x,this._previousCenter.y),Object(Yt.j)(a,e.size,e.padding),Object(p.h)(r,r,a);const{constraints:n,scale:o}=e,h=o*s;s<1&&!n.canZoomInTo(h)?(s=o/n.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):s>1&&!n.canZoomOutTo(h)&&(s=o/n.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),Object(Yt.s)(t,e.viewpoint,s,i,r,e.size),e.constraints.constrainByGeometry(t)}}this._animationTime+=n})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};Object(s.a)([Object(n.b)()],di.prototype,\"_momentumFinished\",void 0),Object(s.a)([Object(n.b)()],di.prototype,\"viewpoint\",void 0),Object(s.a)([Object(n.b)()],di.prototype,\"navigation\",void 0),di=Object(s.a)([Object(o.a)(\"esri.views.2d.navigation.actions.Pinch\")],di);var ui=di;const mi=Object(G.a)(),gi=Object(G.a)();let pi=class extends l.a{constructor(e){super(e),this._previousCenter=Object(G.a)(),this.viewpoint=new Zt.a({targetGeometry:new $t.a,scale:0,rotation:0})}begin(e,t){this.navigation.begin(),Object(p.m)(this._previousCenter,t.center.x,t.center.y)}update(e,t){const{state:{size:i,padding:s}}=e;Object(p.m)(mi,t.center.x,t.center.y),Object(Yt.g)(gi,i,s),e.viewpoint=Object(Yt.q)(this.viewpoint,e.state.paddedViewState.viewpoint,Object(Yt.b)(gi,this._previousCenter,mi)),Object(p.c)(this._previousCenter,mi)}end(){this.navigation.end()}};Object(s.a)([Object(n.b)()],pi.prototype,\"viewpoint\",void 0),Object(s.a)([Object(n.b)()],pi.prototype,\"navigation\",void 0),pi=Object(s.a)([Object(o.a)(\"esri.views.2d.actions.Rotate\")],pi);var _i=pi;const fi=new Zt.a({targetGeometry:new $t.a}),bi=[0,0];let wi=class extends l.a{constructor(e){super(e),this._endTimer=null,this.animationManager=null}initialize(){this.pan=new ni({navigation:this}),this.rotate=new _i({navigation:this}),this.pinch=new ui({navigation:this}),this.zoomBox=new Jt({view:this.view,navigation:this})}destroy(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null}begin(){this._set(\"interacting\",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}async zoom(e,t=this._getDefaultAnchor()){if(this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return e<1?this.zoomIn(t):this.zoomOut(t);this.setViewpoint(t,e,0,[0,0])}async zoomIn(e){const t=this.view,i=t.constraints.snapToNextScale(t.scale);return this._zoomToScale(i,e)}async zoomOut(e){const t=this.view,i=t.constraints.snapToPreviousScale(t.scale);return this._zoomToScale(i,e)}setViewpoint(e,t,i,s){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,e,t,i,s),this.end()}setViewpointImmediate(e,t=0,i=[0,0],s=this._getDefaultAnchor()){this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,s,e,t,i)}continousRotateClockwise(){const e=this.get(\"view.viewpoint\");this.animationManager.animateContinous(e,e=>{Object(Yt.q)(e,e,-1)})}continousRotateCounterclockwise(){const e=this.get(\"view.viewpoint\");this.animationManager.animateContinous(e,e=>{Object(Yt.q)(e,e,1)})}resetRotation(){this.view.rotation=0}continousPanLeft(){this._continuousPan([-10,0])}continousPanRight(){this._continuousPan([10,0])}continousPanUp(){this._continuousPan([0,10])}continousPanDown(){this._continuousPan([0,-10])}stop(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set(\"interacting\",!1))}_continuousPan(e){const t=this.get(\"view.viewpoint\");this.animationManager.animateContinous(t,t=>{Object(Yt.v)(t,t,e),this.view.constraints.constrainByGeometry(t)})}_startTimer(e){return null!==this._endTimer||(this._endTimer=setTimeout(()=>{this._endTimer=null;const e=performance.now()-this._lastEventTimestamp;e<250?this._endTimer=this._startTimer(e):this._set(\"interacting\",!1)},e)),this._endTimer}_getDefaultAnchor(){const{size:e,padding:{left:t,right:i,top:s,bottom:r}}=this.view;return bi[0]=.5*(e[0]-i+t),bi[1]=.5*(e[1]-r+s),bi}async _zoomToScale(e,t=this._getDefaultAnchor()){const{view:i}=this,{constraints:s,scale:r,viewpoint:a,size:n,padding:o}=i,h=s.canZoomInTo(e),l=s.canZoomOutTo(e);if(!(e<r&&!h||e>r&&!l))return Object(Yt.o)(fi,a,e/r,0,t,n,o),s.constrainByGeometry(fi),i.goTo(fi,{animate:!0})}_scaleRotateTranslateViewpoint(e,t,i,s,r){const{view:a}=this,{size:n,padding:o,constraints:h,scale:l,viewpoint:c}=a,d=l*i,u=h.canZoomInTo(d),m=h.canZoomOutTo(d);return(i<1&&!u||i>1&&!m)&&(i=1),Object(Yt.v)(c,c,r),Object(Yt.o)(e,c,i,s,t,n,o),h.constrainByGeometry(e)}};Object(s.a)([Object(n.b)()],wi.prototype,\"animationManager\",void 0),Object(s.a)([Object(n.b)({type:Boolean,readOnly:!0})],wi.prototype,\"interacting\",void 0),Object(s.a)([Object(n.b)()],wi.prototype,\"pan\",void 0),Object(s.a)([Object(n.b)()],wi.prototype,\"pinch\",void 0),Object(s.a)([Object(n.b)()],wi.prototype,\"rotate\",void 0),Object(s.a)([Object(n.b)()],wi.prototype,\"view\",void 0),Object(s.a)([Object(n.b)()],wi.prototype,\"zoomBox\",void 0),wi=Object(s.a)([Object(o.a)(\"esri.views.2d.navigation.MapViewNavigation\")],wi);var yi=wi,vi=i(\"r0DZ\"),xi=i(\"fEsP\"),Oi=i(\"LbAs\");const Ti={name:\"magnifier\",shaders:{vertexShader:Object(le.a)(\"magnifier/magnifier.vert\"),fragmentShader:Object(le.a)(\"magnifier/magnifier.frag\")},attributes:{a_pos:0}};var Si=class extends xi.a{constructor(){super(),this._handles=new vi.a,this._resourcePixelRatio=1,this.visible=!1}destroy(){this._handles.destroy(),this._handles=null,this._disposeRenderResources(),this._resourcesTask&&(this._resourcesTask.abort(),this._resourcesTask=null)}get background(){return this._background}set background(e){this._background=e,this.requestRender()}get magnifier(){return this._magnifier}set magnifier(e){this._magnifier=e,this._handles.removeAll(),this._handles.add([Object(H.a)(e,\"version\",()=>{this.visible=e.visible&&Object(re.h)(e.position)&&e.size>0,this.requestRender()}),e.watch([\"mask\",\"overlay\"],()=>this._reloadResources()),e.watch(\"size\",()=>{this._disposeRenderResources(),this.requestRender()})])}doRender(e){var t;const i=e.context;if(!this._resourcesTask)return void this._reloadResources();if(e.drawPhase!==ie.c.MAP||!this._canRender())return;this._updateResources(e);const s=this._magnifier;if(Object(re.g)(s.position))return;const r=e.pixelRatio,a=s.size*r,n=Math.ceil(1/s.factor*a);this._readbackTexture.resize(n,n);const{size:o}=e.state,h=r*o[0],l=r*o[1],c=.5*n,d=.5*n,m=Object(u.c)(r*s.position.x,c,h-c-1),g=Object(u.c)(l-r*s.position.y,d,l-d-1),p=m-c,_=g-d,f=this._readbackTexture;i.bindTexture(f,0),i.gl.copyTexImage2D(f.descriptor.target,0,f.descriptor.pixelFormat,p,_,n,n,0);const b=null==(t=this.background)?void 0:t.color,w=b?[b.a*b.r/255,b.a*b.g/255,b.a*b.b/255,b.a]:[1,1,1,1],y=(m+s.offsetX*r)/h*2-1,v=(g-s.offsetY*r)/l*2-1,x=a/h*2,O=a/l*2,T=this._program;i.bindVAO(this._vertexArrayObject),i.bindTexture(this._overlayTexture,6),i.bindTexture(this._maskTexture,7),i.bindProgram(T),T.setUniform4fv(\"u_background\",w),T.setUniform1i(\"u_readbackTexture\",0),T.setUniform1i(\"u_overlayTexture\",6),T.setUniform1i(\"u_maskTexture\",7),T.setUniform4f(\"u_drawPos\",y,v,x,O),T.setUniform1i(\"u_maskEnabled\",s.maskEnabled?1:0),T.setUniform1i(\"u_overlayEnabled\",s.overlayEnabled?1:0),i.setStencilTestEnabled(!1),i.drawArrays(5,0,4),i.bindVAO()}_canRender(){return this.mask&&this.overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const e=Object(re.h)(this._magnifier)?this._magnifier.mask:null,t=Object(re.h)(this._magnifier)?this._magnifier.overlay:null;this._resourcesTask=Object(fe.h)(async s=>{const r=Object(re.g)(e)||Object(re.g)(t)?async function(e){const t=i.e(162).then(i.bind(null,\"RzSf\")),s=i.e(163).then(i.bind(null,\"o3Xd\")),r=Object(Oi.a)((await t).default,{signal:e}),a=Object(Oi.a)((await s).default,{signal:e}),n={mask:await r,overlay:await a};return Object(fe.w)(e),n}(s):null,a=Object(re.h)(e)?Object(be.default)(e,{responseType:\"image\",signal:s}).then(e=>e.data):r.then(e=>e.mask),n=Object(re.h)(t)?Object(be.default)(t,{responseType:\"image\",signal:s}).then(e=>e.data):r.then(e=>e.overlay),[o,h]=await Object(fe.b)([a,n]);this.mask=o,this.overlay=h,this._disposeRenderResources(),this.requestRender()})}_disposeRenderResources(){this._readbackTexture=Object(re.d)(this._readbackTexture),this._overlayTexture=Object(re.d)(this._overlayTexture),this._maskTexture=Object(re.d)(this._maskTexture),this._vertexArrayObject=Object(re.d)(this._vertexArrayObject),this._program=Object(re.d)(this._program)}_updateResources(e){if(e.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),this._readbackTexture)return;const t=e.context;this._resourcePixelRatio=e.pixelRatio;const i=Math.ceil(this._magnifier.size*e.pixelRatio);this._program=function(e){return Object(ee.a)(e,Ti)}(t);const s=new Uint16Array([0,1,0,0,1,1,1,0]);this._vertexArrayObject=new J.a(t,Ti.attributes,{geometry:[{name:\"a_pos\",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:K.a.createVertex(t,35044,s)}),this.overlay.width=i,this.overlay.height=i,this._overlayTexture=new Se.a(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.overlay),this.mask.width=i,this.mask.height=i,this._maskTexture=new Se.a(t,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask);const r=1/this._magnifier.factor;this._readbackTexture=new Se.a(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:Math.ceil(r*i),height:Math.ceil(r*i)})}}}}]);","name":"34.173171b76105104aeace.js","input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[34],{\n\n/***/ \"tGAV\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"LabelManager\", function() { return /* reexport */ LabelManager; });\n__webpack_require__.d(__webpack_exports__, \"Stage\", function() { return /* reexport */ Stage_E; });\n__webpack_require__.d(__webpack_exports__, \"GraphicsView2D\", function() { return /* reexport */ GraphicsView2D[\"a\" /* default */]; });\n__webpack_require__.d(__webpack_exports__, \"MapViewNavigation\", function() { return /* reexport */ MapViewNavigation; });\n__webpack_require__.d(__webpack_exports__, \"MagnifierView2D\", function() { return /* reexport */ MagnifierView2D; });\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/tslib.es6.js\nvar tslib_es6 = __webpack_require__(\"pO5D\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/has.js\nvar has = __webpack_require__(\"wSAH\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Logger.js\nvar Logger = __webpack_require__(\"6S2I\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/accessorSupport/ensureType.js\nvar ensureType = __webpack_require__(\"zqDF\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/accessorSupport/decorators/property.js\nvar property = __webpack_require__(\"WbKI\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/accessorSupport/decorators/subclass.js + 1 modules\nvar subclass = __webpack_require__(\"04ZG\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Error.js\nvar core_Error = __webpack_require__(\"zlDU\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/urlUtils.js\nvar urlUtils = __webpack_require__(\"4EHJ\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/uuid.js\nvar uuid = __webpack_require__(\"ju1D\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/portal/support/resourceExtension.js\nvar resourceExtension = __webpack_require__(\"9AIY\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Accessor.js + 5 modules\nvar Accessor = __webpack_require__(\"/CmD\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/HandleOwner.js\nvar HandleOwner = __webpack_require__(\"kJYu\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/throttle.js\nvar throttle = __webpack_require__(\"5C/r\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/mathUtils.js\nvar mathUtils = __webpack_require__(\"OKTS\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/definitions.js\nvar definitions = __webpack_require__(\"jIHu\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/tiling/TileKey.js\nvar TileKey = __webpack_require__(\"rlSK\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/tiling/PagedTileQueue.js\nvar PagedTileQueue = __webpack_require__(\"Pns9\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/tiling/TileInfoView.js + 2 modules\nvar TileInfoView = __webpack_require__(\"AY31\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/tiling/TileQueue.js\nvar TileQueue = __webpack_require__(\"B81a\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/tiling/TileStrategy.js + 1 modules\nvar TileStrategy = __webpack_require__(\"0wLv\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/vec2.js\nvar vec2 = __webpack_require__(\"M0lq\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/collisions/CollisionBucketEntry.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\n/* harmony default export */ var CollisionBucketEntry = (class{constructor(){this._reference=null}get dirty(){return this.reference&&this.reference.isDirty}set dirty(e){this.reference&&this.reference.hasData&&(e||this.reference.isDirty)&&(this.reference.isDirty=e)}get index(){return this._reference&&this._reference.labelIndex}get reference(){return this._reference}set reference(e){this._reference=e}reset(s,n,i){const{state:c}=s,o=i.layerView.tileRenderer,f=this.reference;if(!f||!f.hasData)return!1;n&&(f.isDirty=!0);const a=f.transforms.labelMat2d,h=a[4],u=a[5];for(const s of f.displayObjects){const n=o.featuresView.attributeView,l=i.hasVV()?n.getVVSize(s.id):0;for(const n of s.metrics){i.hasVV()&&n.computeVVOffset(l,i.vvEval);const s=n.bounds.center,o=n.bounds.centerT;f.isDirty&&(n.minZoom=-1);const d=Object(vec2[\"c\"])(o,n.anchor);if(c.rotation?Object(vec2[\"n\" /* t */])(d,d,a):(o[0]=d[0]+h,o[1]=d[1]+u),Object(vec2[\"h\"])(o,d,s),o[0]+=n.offsetX,o[1]+=n.offsetY,n.boxes)for(const e of n.boxes){const s=e.center,i=n.anchor,o=e.centerT;Object(vec2[\"h\"])(o,i,s),c.rotation?Object(vec2[\"n\" /* t */])(o,o,a):(o[0]=o[0]+h,o[1]=o[1]+u)}}}return!0}});\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/collisions/CollisionBucket.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\n/* harmony default export */ var CollisionBucket = (class{constructor(e,i){this.neighbors=new Array(9),this._tiles=new Array(i);for(let e=0;e<i;e++)this._tiles[e]=new CollisionBucketEntry;this.key=e}get isDirty(){for(const e of this._tiles)if(e.dirty)return!0;return!1}get size(){return this._tiles.length}getTile(e){return this._tiles[e]}getReference(e){const t=this._tiles[e];return t&&t.reference}onRegisterLayer(e){this.invalidateRange(e),this._add(e)}onUnregisterLayer(e){this.invalidateRange(e),this._remove(e)}onLabelsRendered(){}invalidateRange(e){for(let t=e;t<this._tiles.length;t++)this._tiles[t].dirty=!0}add(e){this._add(e)}remove(e){this._remove(e)}canDelete(){return 0===this._tiles.length}ready(){for(const e of this._tiles)e.dirty=!1}computeNeighbors(e){this.neighbors[0]=this._getNeighbor(e,-1,-1),this.neighbors[1]=this._getNeighbor(e,0,-1),this.neighbors[2]=this._getNeighbor(e,1,-1),this.neighbors[3]=this._getNeighbor(e,-1,0),this.neighbors[4]=this,this.neighbors[5]=this._getNeighbor(e,1,0),this.neighbors[6]=this._getNeighbor(e,-1,1),this.neighbors[7]=this._getNeighbor(e,0,1),this.neighbors[8]=this._getNeighbor(e,1,1)}reset(e,t,i){const s=this._tiles[i.index];s&&s.reset(e,t,i)}_add(e){const i=[];if(e>=this._tiles.length)this._tiles.push(new CollisionBucketEntry);else{for(let s=0;s<this._tiles.length;s++)s===e&&i.push(new CollisionBucketEntry),i.push(this._tiles[s]);this._tiles=i}}_remove(e){const t=[];for(let i=0;i<this._tiles.length;i++)i!==e&&t.push(this._tiles[i]);this._tiles=t}_getNeighbor(t,i,s){const r=this.key,h=r.col+i,n=r.row+s,o=r.level,l=r.world,g=TileKey[\"a\" /* default */].getId(o,n,h,l);return t.has(g)?t.get(g):null}});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/screenUtils.js\nvar screenUtils = __webpack_require__(\"qRWG\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/renderers/support/lengthUtils.js\nvar lengthUtils = __webpack_require__(\"m0D6\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/collisions/visualVariableSimpleUtils.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst visualVariableSimpleUtils_e=Math.PI;function visualVariableSimpleUtils_r(r,i){switch(i.transformationType){case\"additive\":return function(t,n){const e=visualVariableSimpleUtils_a(n.minSize,t);return t+(e||n.minDataValue)}(r,i);case\"constant\":return function(t,n){const e=t.stops;let r=e&&e.length&&e[0].size;null==r&&(r=t.minSize);return visualVariableSimpleUtils_a(r,n)}(i,r);case\"clamped-linear\":return function(t,n){const e=(t-n.minDataValue)/(n.maxDataValue-n.minDataValue),r=visualVariableSimpleUtils_a(n.minSize,t),i=visualVariableSimpleUtils_a(n.maxSize,t);if(t<=n.minDataValue)return r;if(t>=n.maxDataValue)return i;return r+e*(i-r)}(r,i);case\"proportional\":return function(n,e){const r=n/e.minDataValue,i=visualVariableSimpleUtils_a(e.minSize,n),u=visualVariableSimpleUtils_a(e.maxSize,n);let s=null;return s=r*i,Object(mathUtils[\"c\" /* clamp */])(s,i,u)}(r,i);case\"stops\":return function(t,n){const[e,r,i]=function(t,n){if(!n)return;let e=0,r=n.length-1;return n.some(((n,a)=>t<n?(r=a,!0):(e=a,!1))),[e,r,(t-n[e])/(n[r]-n[e])]}(t,n.cache.ipData);if(e===r)return visualVariableSimpleUtils_a(n.stops[e].size,t);{const u=visualVariableSimpleUtils_a(n.stops[e].size,t);return u+(visualVariableSimpleUtils_a(n.stops[r].size,t)-u)*i}}(r,i);case\"real-world-size\":return function(r,i){const u=lengthUtils[\"a\" /* meterIn */][i.valueUnit],s=visualVariableSimpleUtils_a(i.minSize,r),o=visualVariableSimpleUtils_a(i.maxSize,r),{valueRepresentation:c}=i;let l=null;l=\"area\"===c?2*Math.sqrt(r/visualVariableSimpleUtils_e)/u:\"radius\"===c||\"distance\"===c?2*r/u:r/u;return Object(mathUtils[\"c\" /* clamp */])(l,s,o)}(r,i);case\"identity\":return r;case\"unknown\":return null}}function visualVariableSimpleUtils_a(t,n){return\"number\"==typeof t?t:visualVariableSimpleUtils_r(n,t)}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/collisions/LayerCollisionInfo.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst LayerCollisionInfo_i=(e,t)=>e.order-t.order,LayerCollisionInfo_n=(e,t)=>e.index-t.index,LayerCollisionInfo_l=Logger[\"a\" /* default */].getLogger(\"esri/views/2d/engine/webgl/collisions/CollisionEngine\");function LayerCollisionInfo_s(e,r){const o=!!e.minScale,i=!!e.maxScale,n=o&&r.scaleToZoom(e.minScale)||0,l=i&&r.scaleToZoom(e.maxScale)||255;return{deconflictionStrategy:e.deconflictionStrategy,minZoom:Object(mathUtils[\"c\" /* clamp */])(Math.floor(10*n),0,255),maxZoom:Object(mathUtils[\"c\" /* clamp */])(Math.floor(10*l),0,255)}}function LayerCollisionInfo_a(e){return t=>Object(screenUtils[\"d\" /* pt2px */])(visualVariableSimpleUtils_r(t,e))}function LayerCollisionInfo_c(e){if(!e)return null;for(const t of e)if(\"size\"===t.type)return LayerCollisionInfo_a(t);return null}class LayerCollisionInfo_d{constructor(e,t,r,o){this._vvHandle=null;const i=e.layer,{geometryType:n,labelingInfo:l,renderer:a}=i;a&&(this.vvEval=LayerCollisionInfo_c(\"visualVariables\"in a&&a.visualVariables)),this._vvHandle=i.watch(\"renderer\",(e=>{e&&(this.vvEval=LayerCollisionInfo_c(\"visualVariables\"in e&&e.visualVariables))}));const d=i.featureReduction,f=d&&\"cluster\"===d.type&&d.labelingInfo,m=(l||[]).map((e=>LayerCollisionInfo_s(e,o))),u=(f||[]).map((e=>LayerCollisionInfo_s(e,o)));this.layerView=e,this.geometryType=n,this.index=t,this.order=r,this.zoomRanges=[...m,...u],this.layerView=e}hasVV(){return!!this.vvEval}allOrNothing(){return!(\"polyline\"===this.geometryType)}destroy(){this._vvHandle.remove()}static create(e,t,r,o){const n=r.sort(LayerCollisionInfo_i);let l=!1,s=-1;for(const e of n)!l&&e.order>t&&(s=e.index,l=!0),l&&e.index++;return l||(s=n.length),new LayerCollisionInfo_d(e,s,t,o)}static delete(e,t){const r=t.sort(LayerCollisionInfo_n);for(let o=e+1;o<r.length;o++)t[o].index--;t[e].destroy(),t.splice(e,1)}static find(e,t){for(const r of t)if(r.index===e)return r;return LayerCollisionInfo_l.error(\"Tried to get a LayerCollisionInfo for an index that doesn't exist!\"),null}}/* harmony default export */ var LayerCollisionInfo = (LayerCollisionInfo_d);\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/collisions/CollisionEngine.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst CollisionEngine_h=definitions[\"F\" /* TILE_SIZE */]/definitions[\"d\" /* COLLISION_BUCKET_SIZE */],CollisionEngine_f=CollisionEngine_h,CollisionEngine_m=Logger[\"a\" /* default */].getLogger(\"esri.views.2d.engine.webgl.collisions.CollisionEngine\");class CollisionEngine_u{constructor(e){this._layers=new Map,this._collisionBuckets=new Map,this._didError=!1,this._tilingScheme=e}get collisionInfos(){return Array.from(this._layers.values())}registerLayerView(e,i){if(this._layers.has(e))return;const t=LayerCollisionInfo.create(e,i,this.collisionInfos,this._tilingScheme);this._layers.set(e,t),this._collisionBuckets.forEach((e=>e.onRegisterLayer(t.index)))}unregisterLayerView(e){if(!this._layers.has(e))return;const i=this._layers.get(e);LayerCollisionInfo.delete(i.index,this.collisionInfos),this._layers.delete(e),this._collisionBuckets.forEach(((e,t)=>{const s=e.getTile(i.index);s&&(e.onUnregisterLayer(i.index),e.canDelete()&&this._collisionBuckets.delete(t),s.reference&&(s.reference.isDirty=!1))}))}addTile(e,i){const t=i.key.id;if(!this._layers.has(e))return;this._collisionBuckets.has(t)||this._collisionBuckets.set(t,new CollisionBucket(i.key,this._layers.size));const s=this._getIndex(e);this._collisionBuckets.get(t).getTile(s).reference=i}removeTile(e,i){if(!this._layers.has(e)||!this._collisionBuckets.has(i))return;const t=this._getIndex(e),s=this._collisionBuckets.get(i).getTile(t);s.dirty=!1,s.reference=null}run(e,t){const s=Array.from(this._collisionBuckets.values()).sort(((e,i)=>e.key.compareRowMajor(i.key)));let o=!0;const r=e.renderingOptions.labelCollisionsEnabled&&!this._didError,n=this.collisionInfos;try{for(const i of s){o=o||i.isDirty,i.computeNeighbors(this._collisionBuckets);for(let t=0;t<this._layers.size;t++){const s=LayerCollisionInfo.find(t,n);i.reset(e,o,s)}}for(let e=0;e<this._layers.size;e++){const i=LayerCollisionInfo.find(e,n);for(const e of s)this._run(r,e,i,t)}}catch(e){CollisionEngine_m.error(new core_Error[\"a\" /* default */](\"mapview-labeling\",\"Encountered an error during decluttering. Disabling collisions\",e)),this._didError=!0}for(const e of s)e.ready()}_run(e,i,t,s){const o=i.getReference(t.index);o&&o.hasData&&(o.key.level!==s?this._resetLabelsMinZoom(i,t):this._runVisibility(e,i,o,t,s))}_resetLabelsMinZoom(e,i){if(!e||\"polyline\"===i.geometryType)return;const t=e.getReference(i.index);if(!t||!t.hasData)return;const s=i.layerView.tileRenderer.featuresView.attributeView,o=t.displayObjects;for(const e of o)s.setLabelMinZoom(e.id,255)}_checkLabelsVisible(e,i){const t=!i.filter||!!(e&definitions[\"i\" /* FILTER_FLAG_0 */]),s=!i.effect||i.effect.excludedLabelsVisible||!!(e&definitions[\"h\" /* EFFECT_FLAG_0 */]);return t&&s}_runVisibility(e,i,t,s,o){const r=s.layerView.tileRenderer.featuresView.attributeView,n=t.displayObjects.sort(((e,i)=>r.getLabelMinZoom(e.id)-r.getLabelMinZoom(i.id))),l=s.zoomRanges.some((e=>\"none\"===e.deconflictionStrategy));for(const t of n){if(!t.metrics.length)continue;let n=\"polyline\"===s.geometryType?0:10*(o-1);const c=r.getFilterFlags(t.id),a=this._checkLabelsVisible(c,s.layerView);if(e&&!l)for(let e=0;e<t.metrics.length;e++){const r=t.metrics[e],l=a?-1!==r.minZoom?r.minZoom:this._computeLabelVisibility(t,r,s.index,i,r.baseZoom,o):255;n=Math.max(l,n)}n=Math.max(n,0),r.setLabelMinZoom(t.id,n);for(const e of t.metrics)e.minZoom=n}}_computeLabelVisibility(e,i,t,s,o,r){let n=o;const{xBucket:l,yBucket:c,xOverflow:a,yOverflow:m}=i,u=l-a,g=l+a+1,d=c+m+1;for(let o=c-m;o<d;o++)for(let l=u;l<g;l++)if(!(l<-CollisionEngine_h||o<-CollisionEngine_f||l>CollisionEngine_h||o>CollisionEngine_f))for(let c=0;c<=t;c++){const a=this._getRelativeSubBucket(c,s,l,o);if(a)for(const s of a){if(c===t&&s.id===e.id)continue;const o=this._compareLabels(i,s,n,r);n=Math.max(o,n)}}return n}_compareLabels(e,i,s,o){const r=10*(o+1);if(-1===i.minZoom||i.minZoom>r)return s;const n=e.findCollisionDelta(i),l=Object(mathUtils[\"c\" /* clamp */])(Math.ceil(10*(n+o)),0,255);return i.minZoom>=l?s:Math.max(s,l)}_getNeighboringTile(e,i,t,s){const o=3*(1+s)+(1+t),r=i.neighbors[o];return r&&r.getTile(e)}_getRelativeSubBucket(e,i,t,o){const r=Object(mathUtils[\"l\" /* sign */])(Math.floor(t/4)),n=Object(mathUtils[\"l\" /* sign */])(Math.floor(o/4)),l=this._getNeighboringTile(e,i,r,n);return l&&l.reference&&l.index&&l.reference.hasData?l.index[o-4*n][t-4*r]:null}_getIndex(e){return this._layers.get(e).index}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/collisions/LayerViewSorter.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst LayerViewSorter_t=Logger[\"a\" /* default */].getLogger(\"esri.views.2d.engine.collisions.LayerViewSorter\");function LayerViewSorter_i(e){return\"esri.views.2d.layers.FeatureLayerView2D\"===e.declaredClass||\"esri.views.2d.layers.StreamLayerView2D\"===e.declaredClass}function LayerViewSorter_a(e){if(!e.layer||!e.layer.renderer)return!1;switch(e.layer.renderer.type){case\"class-breaks\":case\"simple\":case\"unique-value\":case\"dictionary\":case\"dot-density\":return!0;default:return LayerViewSorter_t.error(new core_Error[\"a\" /* default */](\"mapview-labeling\",`Renderer of type ${e.layer.renderer.type} does not currently support labeling`)),!1}}class LayerViewSorter_s{constructor(e,r){this.registerLayer=e,this.unregisterLayer=r,this._layerViewState=new Map}findIndex(e){return e.view.allLayerViews.findIndex((r=>r.uid===e.uid))}update(e){const{added:r,removed:t}=e;for(const e of t)LayerViewSorter_i(e)&&this._layerViewState.has(e)&&this._deleteState(e);for(const e of r)LayerViewSorter_i(e)&&LayerViewSorter_a(e)&&!this._layerViewState.has(e)&&this._createState(e);this._recomputeOrder()}destroy(){this._layerViewState.forEach((e=>e.handles.forEach((e=>e.remove()))))}_createState(e){const r={priority:-1,handles:null};return r.handles=[e.layer.watch(\"visible\",this._recomputeOrder.bind(this)),e.layer.watch(\"labelsVisible\",this._recomputeOrder.bind(this)),e.layer.watch(\"labelingInfo\",this._recomputeOrder.bind(this)),e.layer.watch(\"featureReduction\",this._recomputeOrder.bind(this))],this._layerViewState.set(e,r),r}_deleteState(e){if(!this._layerViewState.has(e))return;const r=this._layerViewState.get(e);r.handles.forEach((e=>e.remove())),-1!==r.priority&&this.unregisterLayer(e),this._layerViewState.delete(e)}_recomputeOrder(){this._layerViewState.forEach(((e,r)=>{const t=r.view.map.allLayers.findIndex((e=>e.uid===r.layer.uid)),i=r.layer,a=i.featureReduction,s=a&&\"cluster\"===a.type&&a.labelsVisible&&a.labelingInfo&&a.labelingInfo.length,l=i.labelsVisible&&i.labelingInfo&&i.labelingInfo.length||s,n=i.visible&&l?4294967295-t:-1;n!==e.priority&&(e.priority=n,this.unregisterLayer(r),-1!==n&&this.registerLayer(r,n))}))}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/LabelManager.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst LabelManager_d=Logger[\"a\" /* default */].getLogger(\"esri.views.2d.layers.labels.LabelManager\");let LabelManager_u=class extends(Object(HandleOwner[\"b\" /* HandleOwnerMixin */])(Accessor[\"a\" /* default */])){constructor(e){super(e),this._applyVisibilityPassThrottled=Object(throttle[\"a\" /* throttle */])(this._applyVisibilityPass,64,this),this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}initialize(){this.collisionEngine=new CollisionEngine_u(this.view.featuresTilingScheme),this._layerViewSorter=new LayerViewSorter_s(((e,t)=>{this.collisionEngine.registerLayerView(e,t);const i=e.tileRenderer;i&&i.forEachTile((t=>{t.isDirty=!0,this.addTile(e,t)})),this.requestUpdate()}),(e=>{this.collisionEngine.unregisterLayerView(e),this.requestUpdate()})),this.handles.add(this.view.allLayerViews.on(\"change\",(e=>{this._layerViewSorter.update(e)})))}destroy(){this._layerViewSorter.destroy(),this._layerViewSorter=null,this.collisionEngine=null,this._applyVisibilityPassThrottled.remove(),this._applyVisibilityPassThrottled=null}get updating(){return this.updateRequested}update(e){this._applyVisibilityPassThrottled(e)}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}processUpdate(e){this._set(\"updateParameters\",e),this.updateRequested&&(this.updateRequested=!1,this.update(e))}addTile(e,t){this.collisionEngine.addTile(e,t)}removeTile(e,t){this.collisionEngine.removeTile(e,t)}_applyVisibilityPass(e){try{const t=this.view.featuresTilingScheme.getClosestInfoForScale(e.state.scale).level;this.collisionEngine.run(e,t)}catch(e){LabelManager_d.error(new core_Error[\"a\" /* default */](\"mapview-labeling\",\"Encountered an error during label decluttering\",e))}}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],LabelManager_u.prototype,\"updateRequested\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({readOnly:!0})],LabelManager_u.prototype,\"updateParameters\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({dependsOn:[\"updateRequested\"]})],LabelManager_u.prototype,\"updating\",null),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],LabelManager_u.prototype,\"view\",void 0),LabelManager_u=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.views.2d.layers.labels.LabelManager\")],LabelManager_u);var LabelManager_c=LabelManager_u;/* harmony default export */ var LabelManager = (LabelManager_c);\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/events.js\nvar events = __webpack_require__(\"nYOO\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/scheduling.js\nvar scheduling = __webpack_require__(\"WBXD\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/common.js\nvar common = __webpack_require__(\"QhKk\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/watchUtils.js\nvar watchUtils = __webpack_require__(\"N5XI\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/vec2f64.js\nvar vec2f64 = __webpack_require__(\"AvGH\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/support/screenshotUtils.js\nvar screenshotUtils = __webpack_require__(\"TcGo\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/context-util.js\nvar context_util = __webpack_require__(\"zBXm\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/mat2d.js\nvar mat2d = __webpack_require__(\"opr1\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/mat2df64.js\nvar mat2df64 = __webpack_require__(\"9+ss\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/support/Timeline.js\nvar Timeline = __webpack_require__(\"Snp0\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/builtins.js\nvar builtins = __webpack_require__(\"n4uK\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/BufferObject.js\nvar BufferObject = __webpack_require__(\"fOQB\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/VertexArrayObject.js\nvar VertexArrayObject = __webpack_require__(\"D6bk\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/FramebufferObject.js\nvar FramebufferObject = __webpack_require__(\"0meK\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/programUtils.js\nvar programUtils = __webpack_require__(\"1F90\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/RenderingContext.js + 7 modules\nvar RenderingContext = __webpack_require__(\"bfJE\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/enums.js\nvar enums = __webpack_require__(\"yE7X\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/Container.js\nvar Container = __webpack_require__(\"AMBt\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/maybe.js\nvar maybe = __webpack_require__(\"srIe\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/Renderbuffer.js\nvar Renderbuffer = __webpack_require__(\"kbDN\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/brushes.js + 14 modules\nvar brushes = __webpack_require__(\"Oxob\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/ProgramCache.js\nvar ProgramCache = __webpack_require__(\"kGdt\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/vectorTiles/shaders/Programs.js + 2 modules\nvar Programs = __webpack_require__(\"6ldq\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/vectorTiles/shaders/ProgramCache.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\n/* harmony default export */ var shaders_ProgramCache = (class{constructor(t){this._cache=new Array(8);for(let r=0;r<8;r++)this._cache[r]={};this._programRepo=new ProgramCache[\"a\" /* default */](t)}dispose(){this._programRepo&&(this._programRepo.dispose(),this._programRepo=null)}getProgram(r,t,e){const s=this._cache[r];if(!s[t]){const a=this._programRepo.getProgram(this._getProgramTemplate(r),e);s[t]=a}return s[t]}getProgramAttributes(r){switch(r){case 0:return Programs[\"a\" /* background */].attributes;case 5:return Programs[\"b\" /* circle */].attributes;case 1:return Programs[\"c\" /* fill */].attributes;case 4:return Programs[\"d\" /* icon */].attributes;case 3:return Programs[\"e\" /* line */].attributes;case 2:return Programs[\"f\" /* outline */].attributes;case 6:return Programs[\"g\" /* text */].attributes;default:return null}}_getProgramTemplate(r){switch(r){case 0:return Programs[\"a\" /* background */];case 5:return Programs[\"b\" /* circle */];case 1:return Programs[\"c\" /* fill */];case 4:return Programs[\"d\" /* icon */];case 3:return Programs[\"e\" /* line */];case 2:return Programs[\"f\" /* outline */];case 6:return Programs[\"g\" /* text */];default:return null}}});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/sources/resolver.js + 1 modules\nvar resolver = __webpack_require__(\"vpBa\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/BitBlitPrograms.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst BitBlitPrograms_e={name:\"bitBlit\",shaders:{vertexShader:Object(resolver[\"a\" /* resolveIncludes */])(\"bitBlit/bitBlit.vert\"),fragmentShader:Object(resolver[\"a\" /* resolveIncludes */])(\"bitBlit/bitBlit.frag\")},attributes:{a_pos:0,a_tex:1}};\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/BitBlitRenderer.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass BitBlitRenderer_s{constructor(){this._initialized=!1}dispose(){this._program&&(this._program.dispose(),this._program=null),this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)}render(r,t,e,i){r&&(this._initialized||this._initialize(r),r.setBlendFunctionSeparate(1,771,1,771),r.bindVAO(this._vertexArrayObject),r.bindProgram(this._program),t.setSamplingMode(e),r.bindTexture(t,0),this._program.setUniform1i(\"u_tex\",0),this._program.setUniform1f(\"u_opacity\",i),r.drawArrays(5,0,4),r.bindTexture(null,0),r.bindVAO())}_initialize(s){if(this._initialized)return!0;const o=BitBlitPrograms_e.attributes,a=Object(programUtils[\"a\" /* createProgram */])(s,BitBlitPrograms_e);if(!a)return!1;const n=new Int8Array(16);n[0]=-1,n[1]=-1,n[2]=0,n[3]=0,n[4]=1,n[5]=-1,n[6]=1,n[7]=0,n[8]=-1,n[9]=1,n[10]=0,n[11]=1,n[12]=1,n[13]=1,n[14]=1,n[15]=1;const m=new VertexArrayObject[\"a\" /* default */](s,o,{geometry:[{name:\"a_pos\",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:\"a_tex\",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:BufferObject[\"a\" /* default */].createVertex(s,35044,n)});return this._program=a,this._vertexArrayObject=m,this._initialized=!0,!0}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/MaterialPrograms.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst MaterialPrograms_t=r=>{let e=\"\";e+=r[0].toUpperCase();for(let t=1;t<r.length;t++){const s=r[t];s===s.toUpperCase()?(e+=\"_\",e+=s):e+=s.toUpperCase()}return e},MaterialPrograms_s=e=>{const s={};for(const r in e){s[MaterialPrograms_t(r)]=e[r]}return Object(programUtils[\"b\" /* glslifyDefineMap */])(s)},MaterialPrograms_o=(r,t,o)=>{const n=r+r.substring(r.lastIndexOf(\"/\")),a=t+t.substring(t.lastIndexOf(\"/\"));return{name:name,attributes:o,shaders:r=>({vertexShader:MaterialPrograms_s(r)+Object(resolver[\"a\" /* resolveIncludes */])(`${n}.vert`),fragmentShader:MaterialPrograms_s(r)+Object(resolver[\"a\" /* resolveIncludes */])(`${a}.frag`)})}};\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/MaterialManager.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst MaterialManager_a=r=>r===enums[\"c\" /* WGLDrawPhase */].HITTEST||r===enums[\"c\" /* WGLDrawPhase */].LABEL_ALPHA,MaterialManager_s=({rendererInfo:e,drawPhase:o},s,i,n)=>`${s.getVariationHash()}-${n.join(\".\")}-${(r=>(MaterialManager_a(r)?1:0)|(r===enums[\"c\" /* WGLDrawPhase */].HIGHLIGHT?2:0))(o)}-${e.getVariationHash()}-${Object(maybe[\"h\" /* isSome */])(i)&&i.join(\".\")}`;/* harmony default export */ var MaterialManager = (class{constructor(r){this._programByKey=new Map,this._programCache=new ProgramCache[\"a\" /* default */](r)}dispose(){this._programCache&&this._programCache.dispose()}getProgram(r,e,t=[],a=[]){const s=e.vsPath+\".\"+e.fsPath+JSON.stringify(t)+a.join(\".\");if(this._programByKey.has(s))return this._programByKey.get(s);const i=a.reduce(((e,t)=>({...e,[t]:r.driverTestResult[t]})),{}),n={...t.map((r=>\"string\"==typeof r?{name:r,value:!0}:r)).reduce(((r,e)=>({...r,[e.name]:e.value})),{}),...i},{vsPath:g,fsPath:m,attributes:h}=e,p=this._programCache.getProgram(MaterialPrograms_o(g,m,h),n);if(!p)throw new Error(\"Unable to get program for key: ${key}\");return this._programByKey.set(s,p),p}getMaterialProgram(e,i,n,g,m,h=[\"ignoresSamplerPrecision\"]){const p=MaterialManager_s(e,i,m,h);if(this._programByKey.has(p))return this._programByKey.get(p);const c=((e,o,s,i)=>{const n=i.reduce(((r,t)=>({...r,[t]:e.driverTestResult[t]})),{}),g={...o.getVariation(),...e.rendererInfo.getVariation(),highlight:e.drawPhase===enums[\"c\" /* WGLDrawPhase */].HIGHLIGHT,id:MaterialManager_a(e.drawPhase),...n};if(Object(maybe[\"h\" /* isSome */])(s))for(const r of s)g[r]=!0;return g})(e,i,m,h),f=this._programCache.getProgram(MaterialPrograms_o(n,n,g),c);if(!f)throw new Error(\"Unable to get program for key: ${key}\");return this._programByKey.set(p,f),f}});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/config.js\nvar config = __webpack_require__(\"EyXx\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/promiseUtils.js\nvar promiseUtils = __webpack_require__(\"9MzC\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/request.js\nvar request = __webpack_require__(\"Lqtk\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/vec2f32.js\nvar vec2f32 = __webpack_require__(\"c46T\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/util/BidiText.js\nvar BidiText = __webpack_require__(\"t7mB\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/symbols/cim/utils.js\nvar utils = __webpack_require__(\"NrhG\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/symbols/cim/Rect.js\nvar Rect = __webpack_require__(\"Du6U\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/symbols/cim/CIMSymbolHelper.js + 1 modules\nvar CIMSymbolHelper = __webpack_require__(\"eT81\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/symbols/cim/SDFHelper.js\nvar SDFHelper = __webpack_require__(\"QFw1\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/symbols/cim/Rasterizer.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\n/* harmony default export */ var Rasterizer = (class{dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(e,s,o){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement(\"canvas\")),\"simple-fill\"===e.type||\"esriSFS\"===e.type){const[r,a,n]=CIMSymbolHelper[\"c\" /* SymbolHelper */].rasterizeSimpleFill(this._rasterizationCanvas,e.style,s);return{size:[a,n],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if(\"simple-line\"===e.type||\"esriSLS\"===e.type){const[r,a,n]=CIMSymbolHelper[\"c\" /* SymbolHelper */].rasterizeSimpleLine(e.style,e.cap);return{size:[a,n],image:new Uint32Array(r.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let m,l,f;if(\"simple-marker\"===e.type||\"esriSMS\"===e.type||\"line-marker\"===e.type?(m=CIMSymbolHelper[\"a\" /* CIMSymbolHelper */].fromSimpleMarker(e),f=Object(SDFHelper[\"c\" /* getSDFInfo */])(m)):\"CIMHatchFill\"===e.type?(m=CIMSymbolHelper[\"a\" /* CIMSymbolHelper */].fromCIMHatchFill(e),l=new Rect[\"a\" /* default */](m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):e.markerPlacement&&\"CIMMarkerPlacementInsidePolygon\"===e.markerPlacement.type?(m=CIMSymbolHelper[\"a\" /* CIMSymbolHelper */].fromCIMInsidePolygon(e),l=new Rect[\"a\" /* default */](m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):(m=e,f=Object(SDFHelper[\"c\" /* getSDFInfo */])(m)),f&&!o){const[e,r,t]=Object(SDFHelper[\"a\" /* buildSDF */])(f);return e?{size:[r,t],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[c,h,p,y,u]=CIMSymbolHelper[\"a\" /* CIMSymbolHelper */].rasterize(this._rasterizationCanvas,m,l,!o);return c?{size:[h,p],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:y,anchorY:u}:null}rasterizeImageResource(r,t,a,n){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement(\"canvas\")),this._rasterizationCanvas.width=r,this._rasterizationCanvas.height=t;const i=this._rasterizationCanvas.getContext(\"2d\");a instanceof ImageData?i.putImageData(a,0,0):(a.setAttribute(\"width\",`${r}px`),a.setAttribute(\"height\",`${t}px`),i.drawImage(a,0,0,r,t));const s=i.getImageData(0,0,r,t),o=new Uint8Array(s.data);if(n)for(const e of n)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[r,t,a,n]=e.oldColor,[i,s,m,l]=e.newColor;if(r===i&&t===s&&a===m&&n===l)continue;for(let e=0;e<o.length;e+=4)r===o[e]&&t===o[e+1]&&a===o[e+2]&&n===o[e+3]&&(o[e]=i,o[e+1]=s,o[e+2]=m,o[e+3]=l)}let m;for(let e=0;e<o.length;e+=4)m=o[e+3]/255,o[e]=o[e]*m,o[e+1]=o[e+1]*m,o[e+2]=o[e+2]*m;let l=o,f=r,c=t;const h=512;if(f>=h||c>=h){const a=f/c;a>1?(f=h,c=Math.round(h/a)):(c=h,f=Math.round(h*a)),l=new Uint8Array(4*f*c);const n=new Uint8ClampedArray(l.buffer);Object(utils[\"h\" /* resampleHermite */])(o,r,t,n,f,c,!1)}return{size:[r,t],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}});\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/fontUtils.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction fontUtils_e(e){const r=function(e){if(!e.weight)return\"\";switch(e.weight.toLowerCase()){case\"bold\":case\"bolder\":return\"-bold\"}return\"\"}(e)+function(e){if(!e.style)return\"\";switch(e.style.toLowerCase()){case\"italic\":case\"oblic\":return\"-italic\"}return\"\"}(e);return function(e){const r=e.toLowerCase().split(\" \").join(\"-\");switch(r){case\"serif\":return\"noto-serif\";case\"sans-serif\":return\"arial-unicode-ms\";case\"monospace\":return\"ubuntu-mono\";case\"fantasy\":return\"cabin-sketch\";case\"cursive\":return\"redressed\";default:return r}}(e.family)+(r.length>0?r:\"-regular\")}function fontUtils_r(e){switch(e){case\"underline\":return-26;case\"line-through\":return-18}return NaN}\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/Texture.js\nvar Texture = __webpack_require__(\"of9L\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/Rect.js\nvar webgl_Rect = __webpack_require__(\"qcDN\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/RectangleBinPack.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\n/* harmony default export */ var RectangleBinPack = (class{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new webgl_Rect[\"a\" /* default */](0,0,t,e))}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new webgl_Rect[\"a\" /* default */];let i=null,s=-1;for(let h=0;h<this._free.length;++h){const r=this._free[h];t<=r.width&&e<=r.height&&(null===i||r.y<=i.y&&r.x<=i.x)&&(i=r,s=h)}return null===i?new webgl_Rect[\"a\" /* default */]:(this._free.splice(s,1),i.width<i.height?(i.width>t&&this._free.push(new webgl_Rect[\"a\" /* default */](i.x+t,i.y,i.width-t,e)),i.height>e&&this._free.push(new webgl_Rect[\"a\" /* default */](i.x,i.y+e,i.width,i.height-e))):(i.width>t&&this._free.push(new webgl_Rect[\"a\" /* default */](i.x+t,i.y,i.width-t,i.height)),i.height>e&&this._free.push(new webgl_Rect[\"a\" /* default */](i.x,i.y+e,t,i.height-e))),new webgl_Rect[\"a\" /* default */](i.x,i.y,t,e))}release(h){for(let t=0;t<this._free.length;++t){const e=this._free[t];if(e.y===h.y&&e.height===h.height&&e.x+e.width===h.x)e.width+=h.width;else if(e.x===h.x&&e.width===h.width&&e.y+e.height===h.y)e.height+=h.height;else if(h.y===e.y&&h.height===e.height&&h.x+h.width===e.x)e.x=h.x,e.width+=h.width;else{if(h.x!==e.x||h.width!==e.width||h.y+h.height!==e.y)continue;e.y=h.y,e.height+=h.height}this._free.splice(t,1),this.release(h)}this._free.push(h)}});\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/GlyphMosaic.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst GlyphMosaic_a=t=>Math.floor(t/256);/* harmony default export */ var GlyphMosaic = (class{constructor(t,e,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=e,this._glyphSource=i,this._binPack=new RectangleBinPack(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyph(){const t=[117,149,181,207,207,181,149,117],e=[];for(let i=0;i<t.length;i++){const h=t[i];for(let t=0;t<11;t++)e.push(h)}const i={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)};this._recordGlyph(i)}async getGlyphItems(t,e,i){const h=this._getGlyphCache(t);return await this._fetchRanges(t,e,i),e.map((e=>this._getMosaicItem(h,t,e)))}bind(t,e,i,h){const s=this._getTexture(t,i);s.setSamplingMode(e),this._dirties[i]&&(s.setData(this._glyphData[i]),this._dirties[i]=!1),t.bindTexture(s,h)}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_getTexture(t,e){return this._textures[e]||(this._textures[e]=new Texture[\"a\" /* default */](t,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[e]}_invalidate(){this._dirties[this._currentPage]=!0}async _fetchRanges(t,i,h){const s=function(t){const e=new Set;for(const i of t)e.add(GlyphMosaic_a(i));return e}(i),r=[];s.forEach((e=>{r.push(this._fetchRange(t,e,h))})),await Object(promiseUtils[\"b\" /* all */])(r)}async _fetchRange(t,e,h){if(e>256)return null;const s=t+e;return r=this._rangePromises,a=s,n=()=>this._glyphSource.getRange(t,e,h),r.has(a)||r.set(a,n().then((()=>{r.delete(a)})).catch((t=>{r.delete(a),Object(promiseUtils[\"x\" /* throwIfNotAbortError */])(t)}))),r.get(a);var r,a,n}_getMosaicItem(t,e,i){if(!t[i]){const h=this._glyphSource.getGlyph(e,i);if(!h||!h.metrics)return(t=>({rect:new webgl_Rect[\"a\" /* default */](0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:t,sdf:!0}))(i);const r=this._recordGlyph(h),a=this._currentPage,n=h.metrics;t[i]={rect:r,page:a,metrics:n,code:i,sdf:!0},this._invalidate()}return t[i]}_getMosaicItemsStable(t,e,i){const h=[],s=i.map((t=>t));return i.map((t=>t)).sort().map((i=>this._getMosaicItem(t,e,i))).forEach((t=>{const e=s.indexOf(t.code);h[e]=t,s[e]=null})),h}_recordGlyph(e){const i=e.metrics;let h;if(0===i.width)h=new webgl_Rect[\"a\" /* default */](0,0,0,0);else{const s=3,a=i.width+2*s,n=i.height+2*s;h=this._binPack.allocate(a,n),h.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new RectangleBinPack(this.width-4,this.height-4),h=this._binPack.allocate(a,n));const c=this._glyphData[this._currentPage],o=e.bitmap;let l,g;if(o)for(let t=0;t<n;t++){l=a*t,g=this.width*(h.y+t)+h.x;for(let t=0;t<a;t++)c[g+t]=o[l+t]}Object(has[\"a\" /* default */])(\"esri-glyph-debug\")&&this._showDebugPage(c)}return h}_showDebugPage(t){const e=document.createElement(\"canvas\"),i=e.getContext(\"2d\"),h=new ImageData(this.width,this.height),s=h.data;e.width=this.width,e.height=this.height,e.style.border=\"1px solid black\";for(let e=0;e<t.length;++e)s[4*e+0]=t[e],s[4*e+1]=0,s[4*e+2]=0,s[4*e+3]=255;i.putImageData(h,0,0),document.body.appendChild(e)}});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/pbf.js\nvar pbf = __webpack_require__(\"ATu9\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/GlyphSource.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass GlyphSource_a{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const t=e.getMessage();let s,a,r,n,i,c,g;for(;t.next();)switch(t.tag()){case 1:s=t.getUInt32();break;case 2:a=t.getBytes();break;case 3:r=t.getUInt32();break;case 4:n=t.getUInt32();break;case 5:i=t.getSInt32();break;case 6:c=t.getSInt32();break;case 7:g=t.getUInt32();break;default:t.skip()}t.release(),s&&(this._metrics[s]={width:r,height:n,left:i,top:c,advance:g},this._bitmaps[s]=a);break}default:e.skip()}e.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class GlyphSource_r{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}/* harmony default export */ var GlyphSource = (class{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(r,n,i){const c=this._getFontStack(r);if(c.getRange(n))return Object(promiseUtils[\"u\" /* resolve */])();const g=256*n,o=g+255,h=this._baseURL.replace(\"{fontstack}\",r).replace(\"{range}\",g+\"-\"+o);return Object(request[\"default\"])(h,{responseType:\"array-buffer\",...i}).then((t=>{c.addRange(n,new GlyphSource_a(new pbf[\"a\" /* default */](new Uint8Array(t.data),new DataView(t.data))))}))}getGlyph(t,e){const s=this._getFontStack(t);if(!s)return;const a=Math.floor(e/256);if(a>256)return;const r=s.getRange(a);return r?{metrics:r.getMetrics(e),bitmap:r.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new GlyphSource_r),e}});\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/packingUtils.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst packingUtils_r=[1,256,65536,16777216],packingUtils_t=[1/256,1/65536,1/16777216,1/4294967296],packingUtils_n=function(r,n=0){let o=0;for(let e=0;e<4;e++)o+=r[n+e]*packingUtils_t[e];return o}(new Uint8ClampedArray([255,255,255,255]));function packingUtils_o(t,o,e=0){const f=function(r,t,n){if(r<t)return t;if(r>n)return n;return r}(t,0,packingUtils_n);for(let t=0;t<4;t++)o[e+t]=Math.floor(256*((u=f*packingUtils_r[t])-Math.floor(u)));var u}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/SDFConverter.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst SDFConverter_h=1e20;/* harmony default export */ var SDFConverter = (class{constructor(t){this.size=t;const s=document.createElement(\"canvas\");s.width=s.height=t,this._context=s.getContext(\"2d\"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(r,n,o=31){this._initSVG();const a=this._createSVGString(r);return Object(promiseUtils[\"c\" /* create */])(((t,r)=>{const d=new Image;d.src=\"data:image/svg+xml; charset=utf8, \"+encodeURIComponent(a),d.onload=()=>{d.onload=null,this._context.clearRect(0,0,this.size,this.size),this._context.drawImage(d,0,0,this.size,this.size);const s=this._context.getImageData(0,0,this.size,this.size),e=new Uint8Array(this.size*this.size*4);for(let t=0;t<this.size*this.size;t++){const e=s.data[4*t+3]/255;this._gridOuter[t]=1===e?0:0===e?SDFConverter_h:Math.pow(Math.max(0,.5-e),2),this._gridInner[t]=1===e?SDFConverter_h:0===e?0:Math.pow(Math.max(0,e-.5),2)}this._edt(this._gridOuter,this.size,this.size),this._edt(this._gridInner,this.size,this.size);for(let t=0;t<this.size*this.size;t++){const s=this._gridOuter[t]-this._gridInner[t];packingUtils_o(.5-s/(2*o),e,4*t)}t(e)};const l=n&&n.signal;l&&Object(promiseUtils[\"r\" /* onAbort */])(l,(()=>r(Object(promiseUtils[\"e\" /* createAbortError */])())))}))}_initSVG(){if(!this._svg){const t=document.createElementNS(\"http://www.w3.org/2000/svg\",\"svg\");t.setAttribute(\"style\",\"position: absolute;\"),t.setAttribute(\"width\",\"0\"),t.setAttribute(\"height\",\"0\"),t.setAttribute(\"aria-hidden\",\"true\"),t.setAttribute(\"role\",\"presentation\"),document.body.appendChild(t),this._svg=t}}_createSVGString(t){const s=document.createElementNS(\"http://www.w3.org/2000/svg\",\"path\");s.setAttribute(\"d\",t),this._svg.appendChild(s);const e=s.getBBox(),i=e.width/e.height,h=this.size/2;let r,n,o,a;if(i>1){n=r=h/e.width;const t=h*(1/i);o=this.size/4,a=h-t/2}else{r=n=h/e.height;o=h-h*i/2,a=this.size/4}const d=-e.x*r+o,l=-e.y*n+a;s.setAttribute(\"style\",`transform: matrix(${r}, 0, 0, ${n}, ${d}, ${l})`);const _=`<svg style=\"fill:red;\" height=\"${this.size}\" width=\"${this.size}\" xmlns=\"http://www.w3.org/2000/svg\">${this._svg.innerHTML}</svg>`;return this._svg.removeChild(s),_}_edt(t,s,e){const i=this._f,h=this._d,r=this._v,n=this._z;for(let o=0;o<s;o++){for(let h=0;h<e;h++)i[h]=t[h*s+o];this._edt1d(i,h,r,n,e);for(let i=0;i<e;i++)t[i*s+o]=h[i]}for(let o=0;o<e;o++){for(let e=0;e<s;e++)i[e]=t[o*s+e];this._edt1d(i,h,r,n,s);for(let e=0;e<s;e++)t[o*s+e]=Math.sqrt(h[e])}}_edt1d(t,s,e,i,r){e[0]=0,i[0]=-SDFConverter_h,i[1]=+SDFConverter_h;for(let s=1,n=0;s<r;s++){let r=(t[s]+s*s-(t[e[n]]+e[n]*e[n]))/(2*s-2*e[n]);for(;r<=i[n];)n--,r=(t[s]+s*s-(t[e[n]]+e[n]*e[n]))/(2*s-2*e[n]);n++,e[n]=s,i[n]=r,i[n+1]=+SDFConverter_h}for(let h=0,n=0;h<r;h++){for(;i[n+1]<h;)n++;s[h]=(h-e[n])*(h-e[n])+t[e[n]]}}});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/GeometryUtils.js\nvar GeometryUtils = __webpack_require__(\"HQFP\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/SpriteMosaic.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction SpriteMosaic_c(t){return t&&\"static\"===t.type}class SpriteMosaic_n{constructor(e,i,s,a=0){if(this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._fixSpriteLocationsTable=Object(has[\"a\" /* default */])(\"fix-sprite-locations\"),this._testId=Object(has[\"a\" /* default */])(\"test-id\"),this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(i<=0||s<=0)&&console.error(\"Sprites mosaic defaultWidth and defaultHeight must be greater than zero!\"),this._pageWidth=i,this._pageHeight=s,this._requestRender=e,a>0&&(this._maxItemSize=a),this.pixelRatio=window.devicePixelRatio||1,this._fixSpriteLocationsTable){const t=[];for(const e in this._fixSpriteLocationsTable[this._testId]){const i=this._fixSpriteLocationsTable[this._testId][e];t[i.page]=i.pageSize}for(const e of t)this._mosaicPages.push({mosaicsData:{type:\"static\",data:new Uint32Array(e[0]*e[1])},size:[e[0],e[1]],dirty:!0,texture:void 0})}this._binPack=new RectangleBinPack(this._pageWidth,this._pageHeight);const r=Math.floor(this._pageWidth),o=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:\"static\",data:new Uint32Array(r*o)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,e,i,s,a,o){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let h,n,p;if(SpriteMosaic_c(i))if(this._fixSpriteLocationsTable&&this._fixSpriteLocationsTable[this._testId]&&this._fixSpriteLocationsTable[this._testId][t]){const e=this._fixSpriteLocationsTable[this._testId][t];h=e.rect,n=e.page,p=e.pageSize}else[h,n,p]=this._allocateImage(e[0],e[1]);else{h=new webgl_Rect[\"a\" /* default */](0,0,e[0],e[1]),n=this._mosaicPages.length;const t=void 0;this._mosaicPages.push({mosaicsData:i,size:e,dirty:!0,texture:t})}if(h.width<=0||h.height<=0)return null;const g={rect:h,width:e[0],height:e[1],sdf:a,simplePattern:o,pixelRatio:1,page:n};return this._mosaicRects.set(t,g),SpriteMosaic_c(i)&&this._copy({rect:h,spriteSize:e,spriteData:i.data,page:n,pageSize:p,repeat:s,sdf:a}),g}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t)}getSpriteItems(t){const e={};for(const i of t)e[i]=this.getSpriteItem(i);return e}getMosaicItemPosition(t){const e=this.getSpriteItem(t),i=e&&e.rect;if(!i)return null;i.width=e.width,i.height=e.height;const a=e.width,r=e.height,o=definitions[\"r\" /* SPRITE_PADDING */],h=this._mosaicPages[e.page];return{size:[e.width,e.height],tl:[(i.x+o)/h[0],(i.y+o)/h[1]],br:[(i.x+o+a)/h[0],(i.y+o+r)/h[1]],page:e.page}}bind(t,i,s=0,r=0){const o=this._mosaicPages[s],h=o.mosaicsData;let n=o.texture;if(n||(n=function(t,e,i){if(SpriteMosaic_c(e))return new Texture[\"a\" /* default */](t,{pixelFormat:6408,dataType:5121,width:i[0],height:i[1]},new Uint8Array(e.data.buffer));return new Texture[\"a\" /* default */](t,{pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:i[0],height:i[1]},null)}(t,h,o.size),o.texture=n),n.setSamplingMode(i),SpriteMosaic_c(h))t.bindTexture(n,r),o.dirty&&(n.setData(new Uint8Array(h.data.buffer)),n.generateMipmap());else{const i=h.data,s=i.bindFrame(t,n,r);Object(maybe[\"h\" /* isSome */])(this._requestRender)&&s&&i.frameCount>0&&this._requestRender.requestRender(),i.bindFrame(t,n,r)}o.dirty=!1}static _copyBits(t,e,i,s,a,r,o,h,c,n,p){let g=s*e+i,m=h*r+o;if(p){m-=r;for(let o=-1;o<=n;o++,g=((o+n)%n+s)*e+i,m+=r)for(let e=-1;e<=c;e++)a[m+e]=t[g+(e+c)%c]}else for(let i=0;i<n;i++){for(let e=0;e<c;e++)a[m+e]=t[g+e];g+=e,m+=r}}_copy(t){if(t.page>=this._mosaicPages.length)return;const e=this._mosaicPages[t.page],a=e.mosaicsData;if(!SpriteMosaic_c(e.mosaicsData))throw new core_Error[\"a\" /* default */](\"mapview-invalid-resource\",\"unsuitable data type!\");const r=t.spriteData,o=a.data;o&&r||console.error(\"Source or target images are uninitialized!\"),SpriteMosaic_n._copyBits(r,t.spriteSize[0],0,0,o,t.pageSize[0],t.rect.x+definitions[\"r\" /* SPRITE_PADDING */],t.rect.y+definitions[\"r\" /* SPRITE_PADDING */],t.spriteSize[0],t.spriteSize[1],t.repeat),e.dirty=!0}_allocateImage(t,e){t+=2*definitions[\"r\" /* SPRITE_PADDING */],e+=2*definitions[\"r\" /* SPRITE_PADDING */];const i=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<i){const i=Math.pow(2,Math.ceil(Object(GeometryUtils[\"c\" /* log2 */])(t))),s=Math.pow(2,Math.ceil(Object(GeometryUtils[\"c\" /* log2 */])(e))),a=new webgl_Rect[\"a\" /* default */](0,0,t,e);return this._mosaicPages.push({mosaicsData:{type:\"static\",data:new Uint32Array(i*s)},size:[i,s],dirty:!0,texture:void 0}),[a,this._mosaicPages.length-1,[i,s]]}const a=this._binPack.allocate(t,e);if(a.width<=0){const i=this._mosaicPages[this._currentPage];return!i.dirty&&SpriteMosaic_c(i.mosaicsData)&&(i.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:\"static\",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new RectangleBinPack(this._pageWidth,this._pageHeight),this._allocateImage(t,e)}return[a,this._currentPage,[this._pageWidth,this._pageHeight]]}dispose(){this._binPack=null;for(const t of this._mosaicPages){const e=t.texture;e&&e.dispose();const i=t.mosaicsData;if(!SpriteMosaic_c(i)){i.data.pause()}}this._mosaicPages=null,this._mosaicRects.clear()}}/* harmony default export */ var SpriteMosaic = (SpriteMosaic_n);\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/apng.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst apng_i=new Uint32Array(256);for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)e=0!=(1&e)?3988292384^e>>>1:e>>>1;apng_i[t]=e}const apng_n=new core_Error[\"a\" /* default */](\"Not a PNG\"),apng_s=new core_Error[\"a\" /* default */](\"Not an animated PNG\"),apng_h=new Uint8Array([137,80,78,71,13,10,26,10]);function apng_u(t){const e=t.constructor===Uint8Array?t:new Uint8Array(t);return!apng_h.some(((t,r)=>t!==e[r]))}function apng_l(t){let e,r;return apng_m(new Uint8Array(t),((t,a,i)=>{const n=new DataView(a.buffer);\"IHDR\"===t&&(e=n.getUint32(i+8),r=n.getUint32(i+12))})),[e,r]}function apng_o(t){const e=new Uint8Array(t);if(!apng_u(e))return!1;let r=!1;return apng_m(e,(t=>!(r=\"acTL\"===t))),r}class apng_c{constructor(){this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[],this.paused=!1,this.playing=!1,this.playSpeed=1,this.currentFrameNumber=0,this._lastUsedFrame=-1}static async create(r,a){const i=new apng_c;try{await i._load(r,a)}catch(r){if(!Object(promiseUtils[\"n\" /* isAbortError */])(r))return new core_Error[\"a\" /* default */](\"invalid-resource\",`Could not load PNG: ${r.message}`)}return i}play(){this.playing||(this.paused=!1,this.playing=!0,this._play())}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}togglePlay(){this.paused||!this.playing?this.play():this.pause()}bindFrame(t,e,r){t.bindTexture(e,r);const a=this.frameChanged();if(!a)return!1;const i=this.currentFrame,n=i.frameData,s=e.descriptor;return(i.left||i.top||i.width!==s.width||i.height!==s.height)&&e.setData(null),e.updateData(0,i.left,i.top,i.width,i.height,n),this.updateUsedFrame(),a}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber}async _load(a,i){try{const t=function(t,e){const r=new Uint8Array(e);if(apng_h.some(((t,e)=>t!==r[e])))return apng_n;let a=!1;if(apng_m(r,(t=>!(a=\"acTL\"===t))),!a)return apng_s;const i=[],u=[];let l=null,o=null,c=0;if(apng_m(r,((e,r,a,n)=>{const s=new DataView(r.buffer);switch(e){case\"IHDR\":l=r.subarray(a+8,a+8+n),t.width=s.getUint32(a+8),t.height=s.getUint32(a+12);break;case\"acTL\":t.numPlays=s.getUint32(a+8+4);break;case\"fcTL\":{o&&(t.frames.push(o),c++),o=new apng_d,o.width=s.getUint32(a+8+4),o.height=s.getUint32(a+8+8),o.left=s.getUint32(a+8+12),o.top=s.getUint32(a+8+16);const e=s.getUint16(a+8+20);let r=s.getUint16(a+8+22);0===r&&(r=100),o.delay=1e3*e/r,o.delay<=10&&(o.delay=100),t.playTime+=o.delay,o.disposeOp=s.getUint8(a+8+24),o.blendOp=s.getUint8(a+8+25),o.dataParts=[],0===c&&2===o.disposeOp&&(o.disposeOp=1);break}case\"fdAT\":o&&o.dataParts.push(r.subarray(a+8+4,a+8+n));break;case\"IDAT\":o&&o.dataParts.push(r.subarray(a+8,a+8+n));break;case\"IEND\":u.push(apng_g(r,a,12+n));break;default:i.push(apng_g(r,a,12+n))}})),0===t.frames.length)return apng_s;t.frameCount=t.frames.length;const p=new Blob(i),y=new Blob(u);return t.frames.forEach((t=>{let e=[];e.push(apng_h),l.set(apng_w(t.width),0),l.set(apng_w(t.height),4),e.push(apng_f(\"IHDR\",l)),e.push(p),t.dataParts.forEach((t=>e.push(apng_f(\"IDAT\",t)))),e.push(y),t.data=new Blob(e,{type:\"image/png\"}),delete t.dataParts,e=null})),t}(this,a);if(t!==this)return t;this._resizeCanvas=document.createElement(\"canvas\"),this._resizeCanvas.width=this.width,this._resizeCanvas.height=this.height,await Object(promiseUtils[\"b\" /* all */])(this.frames.map((t=>t.createImage(this._resizeCanvas))))}catch(r){if(!Object(promiseUtils[\"n\" /* isAbortError */])(r))return new core_Error[\"a\" /* default */](\"invalid-resource\",\"Could not parse PNG\")}this.play()}_play(){let t,e;if(0===this.playSpeed)return void this.pause();this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),e=this.currentFrameNumber,e-=1,e<0&&(e=this.frames.length-1),t=1*-this.frames[e].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,t=1*this.frames[this.currentFrameNumber].delay/this.playSpeed);const r=this.frames[this.currentFrameNumber];this.currentFrame={frameData:r.imageData,top:r.top,left:r.left,width:r.width,height:r.height},this.timerID=window.setTimeout((()=>this._play()),t)}}class apng_d{constructor(){this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.data=null,this.imageData=null}async createImage(t){if(null===this.imageData)return Object(promiseUtils[\"c\" /* create */])(((e,r)=>{const a=URL.createObjectURL(this.data),i=document.createElement(\"img\");i.onload=()=>{URL.revokeObjectURL(a),this.imageData=function(t,e){e.width=t.width,e.height=t.height;const r=e.getContext(\"2d\");r.drawImage(t,0,0,t.width,t.height);const a=r.getImageData(0,0,t.width,t.height),i=new Uint8Array(a.data);let n;for(let t=0;t<i.length;t+=4)n=i[t+3]/255,i[t]=i[t]*n,i[t+1]=i[t+1]*n,i[t+2]=i[t+2]*n;return new ImageData(new Uint8ClampedArray(i.buffer),t.width,t.height)}(i,t),e()},i.onerror=()=>{URL.revokeObjectURL(a),this.imageData=null,r(new Error(\"Image creation error\"))},i.src=a}))}}function apng_m(t,e){const r=new DataView(t.buffer);let a,i,n,s=8;do{i=r.getUint32(s),a=apng_p(t,s+4,4),n=e(a,t,s,i),s+=12+i}while(!1!==n&&\"IEND\"!==a&&s<t.length)}function apng_p(t,e,r){const a=Array.prototype.slice.call(t.subarray(e,e+r));return String.fromCharCode.apply(String,a)}function apng_g(t,e,r){const a=new Uint8Array(r);return a.set(t.subarray(e,e+r)),a}function apng_f(t,e){const r=t.length+e.length,a=new Uint8Array(r+8),n=new DataView(a.buffer);n.setUint32(0,e.length),a.set(function(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}(t),4),a.set(e,8);const s=function(t,e=0,r=t.length-e){let a=-1;for(let n=e,s=e+r;n<s;n++)a=a>>>8^apng_i[255&(a^t[n])];return-1^a}(a,4,r);return n.setUint32(r+4,s),a}function apng_w(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}/* harmony default export */ var apng = (apng_c);\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/gif.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst gif_r=249,gif_h=254,gif_o=255,gif_l=1,gif_n=44,gif_d=59;function gif_p(t){if(!t||0===t.byteLength)return!1;const e=t.constructor===Uint8Array?t:new Uint8Array(t);return 71===e[0]&&73===e[1]&&70===e[2]&&56===e[3]}function gif_u(t){const e=new Uint8ClampedArray(t);let s=6;return[e[s++]+(e[s++]<<8),e[s++]+(e[s++]<<8)]}function gif_m(t){if(!t||0===t.byteLength)return!1;const e=new Uint8Array(t);if(!gif_p(e))return!1;let s=0;for(let t=0,i=e.length-9;t<i&&(0!==e[t]||33!==e[t+1]||249!==e[t+2]||4!==e[t+3]||0!==e[t+8]||44!==e[t+9]&&33!==e[t+9]||(s++,!(s>1)));++t);return s>1}class gif_c{constructor(){this.paused=!1,this.playing=!1,this.waitTillDone=!0,this.loading=!1,this.firstFrameOnly=!1,this.frames=[],this.comment=\"\",this.length=0,this.currentFrameNumber=0,this.frameCount=0,this.playSpeed=1,this.lastFrame=null,this.playOnLoad=!0,this.complete=!1,this.interlaceOffsets=[0,4,2,1],this.interlaceSteps=[8,8,4,2],this._lastUsedFrame=-1}static async create(s,i){const a=new gif_c;try{await a._load(s,i)}catch(s){if(!Object(promiseUtils[\"n\" /* isAbortError */])(s))return new core_Error[\"a\" /* default */](\"invalid-resource\",`Could not load PNG: ${s.message}`)}return a}play(){this.playing||(this.paused=!1,this.playing=!0,this._play())}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}togglePlay(){this.paused||!this.playing?this.play():this.pause()}bindFrame(t,e,s){t.bindTexture(e,s);const i=this.frameChanged();if(i){const t=this.currentFrame,s=t.frameData;e.updateData(0,0,0,t.width,t.height,s),this.updateUsedFrame()}return i}seekFrame(t){clearTimeout(this.timerID),this.currentFrameNumber=t%this.frames.length,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}seek(t){clearTimeout(this.timerID),t<0&&(t=0),t*=1e3,t%=this.length;let e=0;for(;t>this.frames[e].time+this.frames[e].delay&&e<this.frames.length;)e+=1;this.currentFrameNumber=e,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber}async _load(s,i){try{this.loading=!0,await this._parse(s,i),this.loading=!1,this.play()}catch(s){if(!Object(promiseUtils[\"n\" /* isAbortError */])(s))return new core_Error[\"a\" /* default */](\"invalid-resource\",\"Could not parse gif!\")}}_parse(t,e){const i=new gif_f(t);i.pos+=6,this.width=i.data[i.pos++]+(i.data[i.pos++]<<8),this.height=i.data[i.pos++]+(i.data[i.pos++]<<8);const a=i.data[i.pos++];return this.globalColourCount=1<<1+(7&a),i.pos++,i.pos++,128&a&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,i)),Object(promiseUtils[\"c\" /* create */])(((t,s)=>{setTimeout((()=>this._parseBlock(i,t,s,e)),0)}))}async _parseBlock(t,e,s,r){if(r&&r.signal&&Object(promiseUtils[\"o\" /* isAborted */])(r.signal))return void s(Object(promiseUtils[\"e\" /* createAbortError */])());const h=t.data[t.pos++];if(h===gif_n){if(this._parseImg(t),this.firstFrameOnly)return this._finishedLoading(),void e()}else{if(h===gif_d)return this._finishedLoading(),void e();this._parseExt(t)}\"function\"==typeof this.onprogress&&this.onprogress({bytesRead:t.pos,totalBytes:t.data.length,frame:this.frames.length}),setTimeout((()=>this._parseBlock(t,e,s,r)),0)}_parseColourTable(t,e){const s=[];for(let i=0;i<t;i++)s.push([e.data[e.pos++],e.data[e.pos++],e.data[e.pos++]]);return s}_parseImg(t){const e=t=>{const e=this.pixelBufSize/t;this.interlacedBufSize!==this.pixelBufSize&&(this.deinterlaceBuf=new Uint8Array(this.pixelBufSize),this.interlacedBufSize=this.pixelBufSize);let s=0;for(let i=0;i<4;i++)for(let a=this.interlaceOffsets[i];a<e;a+=this.interlaceSteps[i])this.deinterlaceBuf.set(this.pixelBuf.subarray(s,s+t),a*t),s+=t},s={};this.frames.push(s),s.disposalMethod=this.disposalMethod,s.time=this.length,s.delay=10*this.delayTime,this.length+=s.delay,this.transparencyGiven?s.transparencyIndex=this.transparencyIndex:s.transparencyIndex=void 0,s.leftPos=t.data[t.pos++]+(t.data[t.pos++]<<8),s.topPos=t.data[t.pos++]+(t.data[t.pos++]<<8),s.width=t.data[t.pos++]+(t.data[t.pos++]<<8),s.height=t.data[t.pos++]+(t.data[t.pos++]<<8);const i=t.data[t.pos++];s.localColourTableFlag=!!(128&i),s.localColourTableFlag&&(s.localColourTable=this._parseColourTable(1<<1+(7&i),t)),this.pixelBufSize!==s.width*s.height&&(this.pixelBuf=new Uint8Array(s.width*s.height),this.pixelBufSize=s.width*s.height),this._lzwDecode(t.data[t.pos++],t.readSubBlocksB()),64&i?(s.interlaced=!0,e(s.width)):s.interlaced=!1,this._processFrame(s)}_lzwDecode(t,e){let s,i,a,r,h,o,l,n,d,p,u;a=i=0;let m=[];for(r=1<<t,h=r+1,o=t+1,u=!1;!u;){for(n=l,l=0,s=0;s<o;s++)e[a>>3]&1<<(7&a)&&(l|=1<<s),a++;if(l===r){for(m=[],o=t+1,s=0;s<r;s++)m[s]=[s];m[r]=[],m[h]=null}else{if(l===h)return void(u=!0);for(l>=m.length?m.push(m[n].concat(m[n][0])):n!==r&&m.push(m[n].concat(m[l][0])),d=m[l],p=d.length,s=0;s<p;s++)this.pixelBuf[i++]=d[s];m.length===1<<o&&o<12&&o++}}}_processFrame(t){t.image=document.createElement(\"canvas\"),t.image.width=this.width,t.image.height=this.height,t.ctx=t.image.getContext(\"2d\");const e=t.localColourTableFlag?t.localColourTable:this.globalColourTable;null===this.lastFrame&&(this.lastFrame=t);const s=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod;s||t.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);const i=t.ctx.getImageData(t.leftPos,t.topPos,t.width,t.height),a=t.transparencyIndex,r=i.data,h=t.interlaced?this.deinterlaceBuf:this.pixelBuf,o=h.length;let l,n,d=0;for(let t=0;t<o;t++)l=h[t],n=e[l],a!==l?(r[d++]=n[0],r[d++]=n[1],r[d++]=n[2],r[d++]=255):s?(r[d+3]=0,d+=4):d+=4;t.ctx.putImageData(i,t.leftPos,t.topPos),this.lastFrame=t}_parseExt(t){const e=t.data[t.pos++];e===gif_r?this._parseGCExt(t):e===gif_h?this.comment+=t.readSubBlocks():e===gif_o?this._parseAppExt(t):(e===gif_l&&(t.pos+=13),t.readSubBlocks())}_parseAppExt(t){t.pos+=1,\"NETSCAPE\"===t.getString(8)?t.pos+=8:(t.pos+=3,t.readSubBlocks())}_parseGCExt(t){let e;t.pos++,e=t.data[t.pos++],this.disposalMethod=(28&e)>>2,this.transparencyGiven=!!(1&e),this.delayTime=t.data[t.pos++]+(t.data[t.pos++]<<8),this.transparencyIndex=t.data[t.pos++],t.pos++}_finishedLoading(){this.loading=!1,this.frameCount=this.frames.length,this.lastFrame=null,this.complete=!0,this.disposalMethod=void 0,this.transparencyGiven=void 0,this.delayTime=void 0,this.transparencyIndex=void 0,this.waitTillDone=void 0,this.pixelBuf=void 0,this.deinterlaceBuf=void 0,this.pixelBufSize=void 0,this.deinterlaceBuf=void 0,this.currentFrameNumber=0,this.frames.length>0&&this._setCurrentFrame(0),this.playOnLoad&&this.play()}_play(){let t,e;0!==this.playSpeed?(this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),e=this.currentFrameNumber,e-=1,e<0&&(e=this.frames.length-1),t=1*-this.frames[e].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,t=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout((()=>this._play()),t)):this.pause()}_setCurrentFrame(t){const e=this.frames[t];this.currentFrame={frameData:e.image,top:0,left:0,width:this.width,height:this.height}}}class gif_f{constructor(t){this.pos=0,this.data=new Uint8ClampedArray(t),this.len=this.data.length}getString(t){let e=\"\";for(;t--;)e+=String.fromCharCode(this.data[this.pos++]);return e}readSubBlocks(){let t,e,s=\"\";do{for(e=t=this.data[this.pos++];e--;)s+=String.fromCharCode(this.data[this.pos++])}while(0!==t&&this.pos<this.len);return s}readSubBlocksB(){let t,e;const s=[];do{for(e=t=this.data[this.pos++];e--;)s.push(this.data[this.pos++])}while(0!==t&&this.pos<this.len);return s}}/* harmony default export */ var gif = (gif_c);\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/util/Result.js\nvar Result = __webpack_require__(\"GqaZ\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/util/symbolUtils.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction symbolUtils_e(e){switch(e.type){case\"esriSMS\":return`${e.style}.${e.path}`;case\"esriSLS\":return`${e.style}.${e.cap}`;case\"esriSFS\":return`${e.style}`;case\"esriPFS\":case\"esriPMS\":return e.imageData?`${e.imageData}${e.width}${e.height}`:`${e.url}${e.width}${e.height}`;default:return e.mosaicHash?e.mosaicHash:JSON.stringify(e)}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/TextureManager.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst z=Object(vec2f32[\"a\" /* c */])(),TextureManager_j=Logger[\"a\" /* default */].getLogger(\"esri.views.2d.engine.webgl.TextureManager\"),TextureManager_R=e=>\"esriSMS\"===e.type&&e.path;function TextureManager_C(e){switch(e.type){case\"esriSMS\":case\"esriPMS\":case\"CIMPointSymbol\":case\"CIMVectorMarker\":case\"CIMPictureMarker\":case\"CIMCharacterMarker\":return!1;default:return!0}}function U(e,t){const i=Math.round(Object(screenUtils[\"d\" /* pt2px */])(t)*window.devicePixelRatio),s=i>=128?2:4;return Math.min(e,i*s)}const TextureManager_F=(e,t,i)=>TextureManager_j.error(new core_Error[\"a\" /* default */](e,t,i));class TextureManager_P{constructor(e,t,i){this.mosaicType=e,this.page=t,this.sdf=i}static fromMosaic(e,t){return new TextureManager_P(e,t.page,t.sdf)}}/* harmony default export */ var TextureManager = (class{constructor(t){this._invalidFontsMap=new Map,this._sdfConverter=new SDFConverter(126),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._rasterizer=new Rasterizer,this._ongoingRasterizations=new Map,this._spriteMosaic=new SpriteMosaic(t,2048,2048,500),this._glyphSource=new GlyphSource(`${config[\"a\" /* default */].fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new GlyphMosaic(1024,1024,this._glyphSource)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._rasterizer=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}async rasterizeItem(e,i,s,r){if(Object(maybe[\"g\" /* isNone */])(e))return TextureManager_F(\"mapview-null-resource\",\"Unable to rasterize null resource\"),null;switch(e.type){case\"CIMTextSymbol\":case\"esriTS\":{const t=await this._rasterizeText(e,s,r);return t.forEach((e=>this._setTextureBinding(enums[\"a\" /* MosaicType */].GLYPH,e))),{glyphMosaicItems:t}}case\"esriSMS\":case\"esriPMS\":case\"esriSFS\":case\"esriPFS\":case\"esriSLS\":default:{if((a=e).type&&-1!==a.type.toLowerCase().indexOf(\"3d\"))return TextureManager_F(\"mapview-invalid-type\",`MapView does not support symbol type: ${e.type}`,e),null;const t=await this._rasterizeSpriteSymbol(e,i,r);return Object(Result[\"a\" /* ok */])(t)&&t&&this._setTextureBinding(enums[\"a\" /* MosaicType */].SPRITE,t),{spriteMosaicItem:t}}}var a}bindTextures(e,t,i,s=!1){if(0===i.textureBinding)return;const r=this._bindingInfos[i.textureBinding-1],a=r.page,n=s?9987:9729;switch(r.mosaicType){case enums[\"a\" /* MosaicType */].SPRITE:{const i=this.sprites.getWidth(a),s=this.sprites.getHeight(a),r=Object(vec2[\"m\" /* s */])(z,i,s);return this._spriteMosaic.bind(e,n,a,definitions[\"C\" /* TEXTURE_BINDING_SPRITE_ATLAS */]),t.setUniform1i(\"u_texture\",definitions[\"C\" /* TEXTURE_BINDING_SPRITE_ATLAS */]),void t.setUniform2fv(\"u_mosaicSize\",r)}case enums[\"a\" /* MosaicType */].GLYPH:{const i=this.glyphs.width,s=this.glyphs.height,r=Object(vec2[\"m\" /* s */])(z,i,s);return this._glyphMosaic.bind(e,n,a,definitions[\"x\" /* TEXTURE_BINDING_GLYPH_ATLAS */]),t.setUniform1i(\"u_texture\",definitions[\"x\" /* TEXTURE_BINDING_GLYPH_ATLAS */]),void t.setUniform2fv(\"u_mosaicSize\",r)}default:TextureManager_j.error(\"mapview-texture-manager\",`Cannot handle unknown type ${r.mosaicType}`)}}_hashMosaic(e,t){return 1|e<<1|(t.sdf?1:0)<<2|t.page<<3}_setTextureBinding(e,t){const i=this._hashMosaic(e,t);if(!this._hashToBindingIndex.has(i)){const s=TextureManager_P.fromMosaic(e,t),r=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,r),this._bindingInfos.push(s)}t.textureBinding=this._hashToBindingIndex.get(i)}async _rasterizeText(e,t,i){const s=fontUtils_e(e.font),r=this._invalidFontsMap.has(s),a=t||function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e.charCodeAt(i));return t}(Object(BidiText[\"a\" /* bidiText */])(e.text)[0]);try{return await this._glyphMosaic.getGlyphItems(r?\"arial-unicode-ms-regular\":s,a,i)}catch(e){return TextureManager_F(\"mapview-invalid-resource\",`Couldn't find font ${s}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(s,!0),this._glyphMosaic.getGlyphItems(\"arial-unicode-ms-regular\",a,i)}}async _rasterizeSpriteSymbol(e,t,i){if(function(e){switch(e.type){case\"CIMSolidStroke\":case\"CIMSolidFill\":return!0;case\"esriSFS\":return\"esriSFSSolid\"===e.style||\"esriSFSNull\"===e.style;case\"esriSLS\":return\"esriSLSSolid\"===e.style||\"esriSLSNull\"===e.style;default:return!1}}(e))return null;const r=symbolUtils_e(e);if(this._spriteMosaic.has(r))return this._spriteMosaic.getSpriteItem(r);if(TextureManager_R(e)||(e=>e.url||e.imageData)(e))return this._handleAsyncResource(r,e,i);const a=this._rasterizer.rasterizeJSONResource(e,t);if(a){const{size:t,image:i,sdf:s,simplePattern:n}=a;return this._addItemToMosaic(r,t,{type:\"static\",data:i},TextureManager_C(e),s,n)}return new core_Error[\"a\" /* default */](\"TextureManager\",\"unrecognized or null rasterized image\")}async _handleAsyncResource(e,t,i){if(this._ongoingRasterizations.has(e))return this._ongoingRasterizations.get(e);let s;s=TextureManager_R(t)?this._handleSVG(t,e,i):this._handleImage(t,e,i),this._ongoingRasterizations.set(e,s);try{await s,this._ongoingRasterizations.delete(e)}catch{this._ongoingRasterizations.delete(e)}return s}async _handleSVG(e,t,i){const s=[126,126],r=await this._sdfConverter.draw(e.path,i);return this._addItemToMosaic(t,s,{type:\"static\",data:new Uint32Array(r.buffer)},!1,!0,!0)}async _handleGIFOrPNG(e,t,i){const a=await async function(e,t){const i=e.imageData?`data:${e.contentType};base64,${e.imageData}`:e.url;let a;const o=\";base64,\";if(-1!==i.indexOf(o)){const e=i.indexOf(o)+o.length,t=i.substring(e),s=atob(t),r=new Uint8Array(s.length);for(let e=0;e<s.length;e++)r[e]=s.charCodeAt(e);a=r.buffer}else try{const{data:e}=await Object(request[\"default\"])(i,{responseType:\"array-buffer\",...t});a=e}catch(e){if(!Object(promiseUtils[\"n\" /* isAbortError */])(e))return new core_Error[\"a\" /* default */](\"mapview-invalid-resource\",`Could not fetch requested resource at ${i}`)}return a}(e,i);if(Object(Result[\"a\" /* ok */])(a)){const o=gif_p(a),c=apng_u(a);if(!o&&!c)return new core_Error[\"a\" /* default */](\"mapview-invalid-resource\",\"Image data is neither GIF nor PNG!\");let h;try{o&&gif_m(a)?h=await gif.create(a,i):c&&apng_o(a)&&(h=await apng.create(a,i))}catch(e){if(!Object(promiseUtils[\"n\" /* isAbortError */])(e))return new core_Error[\"a\" /* default */](\"mapview-invalid-resource\",\"Could not fetch requested resource!\")}if(h&&Object(Result[\"a\" /* ok */])(h))return this._addItemToMosaic(t,[h.width,h.height],{type:\"animated\",data:h},TextureManager_C(e),!1,!1);const d=new Blob([a],{type:o?\"image/gif\":\"image/png\"}),u=await async function(e){const t=window.URL.createObjectURL(e);try{const{data:e}=await Object(request[\"default\"])(t,{responseType:\"image\"});return window.URL.revokeObjectURL(t),e}catch(e){return window.URL.revokeObjectURL(t),new core_Error[\"a\" /* default */](\"mapview-invalid-resource\",`Could not fetch requested resource at ${t}`)}}(d);if(u&&u instanceof HTMLImageElement){let i=u.width,s=u.height;\"esriPMS\"===e.type&&(i=Math.round(U(u.width,e.width)),s=Math.round(u.height*(i/u.width)));const{size:r,sdf:a,image:n}=this._rasterizer.rasterizeImageResource(i,s,u,e.colorSubstitutions);return this._addItemToMosaic(t,r,{type:\"static\",data:n},TextureManager_C(e),a,!1)}}return new core_Error[\"a\" /* default */](\"mapview-invalid-resource\",\"Could not handle resource!\")}async _handleImage(e,t,i){if((e=>e.url&&-1!==e.url.indexOf(\".gif\")||e.contentType&&\"image/gif\"===e.contentType||e.imageData&&-1!==e.imageData.indexOf(\"data:image/gif\"))(e)||(e=>e.url&&-1!==e.url.indexOf(\".png\")||e.contentType&&\"image/png\"===e.contentType||e.imageData&&-1!==e.imageData.indexOf(\"data:image/png\"))(e))return this._handleGIFOrPNG(e,t,i);const o=e.imageData?`data:${e.contentType};base64,${e.imageData}`:e.url;try{const{data:s}=await Object(request[\"default\"])(o,{responseType:\"image\",...i});-1!==o.indexOf(\"data:image/svg+xml\")&&(s.width=Object(screenUtils[\"d\" /* pt2px */])(e.width),s.height=Object(screenUtils[\"d\" /* pt2px */])(e.height));let r=s.width,c=s.height;\"esriPMS\"===e.type&&(r=Math.round(U(s.width,e.width)),c=Math.round(s.height*(r/s.width)));const{size:h,sdf:d,image:u}=this._rasterizer.rasterizeImageResource(r,c,s,e.colorSubstitutions);return this._addItemToMosaic(t,h,{type:\"static\",data:u},TextureManager_C(e),d,!1)}catch(e){if(!Object(promiseUtils[\"n\" /* isAbortError */])(e))return new core_Error[\"a\" /* default */](\"mapview-invalid-resource\",`Could not fetch requested resource at ${o}`)}}_addItemToMosaic(e,t,i,s,r,a){return this._spriteMosaic.addSpriteItem(e,t,i,s,r,a)}});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/VertexStream.js\nvar VertexStream = __webpack_require__(\"gjrC\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/Effect.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass Effect_t{constructor(){this.name=this.constructor.name}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/AnimationEffect.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass AnimationEffect_o extends Effect_t{constructor(){super(...arguments),this.defines=[],this._desc={vsPath:\"fx/integrate\",fsPath:\"fx/integrate\",attributes:{a_position:0}}}dispose(){this._quad&&this._quad.dispose()}bind(){}unbind(){}draw(i,r){if(!r.size)return;const{context:a,renderingOptions:o}=i;this._quad||(this._quad=new VertexStream[\"a\" /* default */](a,[0,0,1,0,0,1,1,1]));const n=a.getBoundFramebufferObject(),{x:m,y:u,width:d,height:f}=a.getViewport();r.bindTextures(a);const c=r.getBlock(definitions[\"a\" /* ATTRIBUTE_DATA_ANIMATION */]);if(Object(maybe[\"g\" /* isNone */])(c))return;const _=c.getFBO(a),l=c.getFBO(a,1);a.setViewport(0,0,r.size,r.size),this._computeDelta(i,l,o.labelsAnimationTime),this._updateAnimationState(i,l,_),a.bindFramebuffer(n),a.setViewport(m,u,d,f)}_computeDelta(e,t,s){const{context:a,painter:o,displayLevel:n}=e,m=o.materialManager.getProgram(e,this._desc,[\"delta\"]);a.bindFramebuffer(t),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT),a.bindProgram(m),m.setUniform1i(\"u_maskTexture\",definitions[\"s\" /* TEXTURE_BINDING_ATTRIBUTE_DATA_0 */]),m.setUniform1i(\"u_sourceTexture\",definitions[\"t\" /* TEXTURE_BINDING_ATTRIBUTE_DATA_1 */]),m.setUniform1f(\"u_timeDelta\",e.deltaTime),m.setUniform1f(\"u_animationTime\",s),m.setUniform1f(\"u_zoomLevel\",Math.round(10*n)),this._quad.draw()}_updateAnimationState(e,t,i){const{context:r,painter:s}=e,a=s.materialManager.getProgram(e,this._desc,[\"update\"]);r.bindTexture(t.colorTexture,1),r.bindProgram(a),a.setUniform1i(\"u_sourceTexture\",1),r.bindFramebuffer(i),r.setClearColor(0,0,0,0),r.clear(r.gl.COLOR_BUFFER_BIT),this._quad.draw()}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/BlendPrograms.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst BlendPrograms_r=e=>`#define ${(e=>e.replace(\"-\",\"_\").toUpperCase())(e)}\\n`,BlendPrograms_a={name:\"blend\",attributes:{a_pos:0,a_tex:1},shaders:a=>({vertexShader:BlendPrograms_r(a)+Object(resolver[\"a\" /* resolveIncludes */])(\"blend/blend.vert\"),fragmentShader:BlendPrograms_r(a)+Object(resolver[\"a\" /* resolveIncludes */])(\"blend/blend.frag\")})};\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/BlendEffect.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst BlendEffect_d=Logger[\"a\" /* default */].getLogger(\"esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect\");class BlendEffect_u{constructor(){this._size=[0,0]}dispose(e){this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null),this._programCache&&(this._programCache.dispose(),this._programCache=null),this._quad&&(this._quad.dispose(),this._quad=null)}draw(e,r,i,s,n){const{context:u,drawPhase:c}=e;if(this._setupShader(u),s&&\"normal\"!==s&&c!==enums[\"c\" /* WGLDrawPhase */].LABEL)return void this._drawBlended(e,r,i,s,n);const m=this._programCache.getProgram(BlendPrograms_a,\"normal\");if(!m)return void BlendEffect_d.error(new core_Error[\"a\" /* default */](\"mapview-BlendEffect\",'Error creating shader program for blend mode \"normal\"'));u.bindProgram(m),r.setSamplingMode(i),u.bindTexture(r,0),m.setUniform1i(\"u_layerTexture\",0),m.setUniform1f(\"u_opacity\",n),u.setBlendingEnabled(!0),u.setBlendFunction(1,771);const f=this._quad;f.draw(),f.unbind()}_drawBlended(r,i,s,o,n){const{context:u,state:c,pixelRatio:m,inFadeTransition:f}=r,{size:h}=c,l=u.getBoundFramebufferObject();let p,g;if(Object(maybe[\"h\" /* isSome */])(l)){const e=l.descriptor;p=e.width,g=e.height}else p=Math.round(m*h[0]),g=Math.round(m*h[1]);this._createOrResizeTexture(r,p,g);const _=this._backBufferTexture;l.copyToTexture(0,0,p,g,0,0,_),u.setStencilTestEnabled(!1),u.setStencilWriteMask(0),u.setBlendingEnabled(!0),u.setDepthTestEnabled(!1),u.setDepthWriteEnabled(!1);const b=this._programCache.getProgram(BlendPrograms_a,o);if(!b)return void BlendEffect_d.error(new core_Error[\"a\" /* default */](\"mapview-BlendEffect\",`Error creating shader program for blend mode ${o}`));u.bindProgram(b),_.setSamplingMode(s),u.bindTexture(_,0),b.setUniform1i(\"u_backbufferTexture\",0),i.setSamplingMode(s),u.bindTexture(i,1),b.setUniform1i(\"u_layerTexture\",1),b.setUniform1f(\"u_opacity\",n),b.setUniform1f(\"u_inFadeOpacity\",f?1:0),u.setBlendFunction(1,0);const x=this._quad;x.draw(),x.unbind(),u.setBlendFunction(1,771)}_setupShader(e){this._programCache||(this._programCache=new ProgramCache[\"a\" /* default */](e),this._quad||(this._quad=new VertexStream[\"a\" /* default */](e,[-1,-1,1,-1,-1,1,1,1])))}_createOrResizeTexture(e,r,t){const{context:s}=e;null!==this._backBufferTexture&&r===this._size[0]&&t===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(r,t):this._backBufferTexture=new Texture[\"a\" /* default */](s,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:r,height:t}),this._size[0]=r,this._size[1]=t)}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/FeatureEffect.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass FeatureEffect_t extends Effect_t{constructor(e){super(),this.name=this.constructor.name,this.defines=[e]}dispose(){}bind({context:e,painter:t}){this._prev=e.getBoundFramebufferObject();const{width:s,height:r}=e.getViewport(),n=t.getFbos(s,r).effect0;e.bindFramebuffer(n),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT)}unbind(){}draw(e,t){const{context:s,painter:r,state:n,deltaTime:o}=e,c=r.getPostProcessingEffects(t.effects),i=s.getBoundFramebufferObject();c.length&&t.transitionStep(o,n.scale);for(const{postProcessingEffect:t,effect:s}of c)t.draw(e,i,s);s.bindFramebuffer(this._prev),s.setStencilTestEnabled(!1),r.blitTexture(s,i.colorTexture,9728),s.setStencilTestEnabled(!0)}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/highlight/parameters.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst parameters_o=[void 0,void 0,void 0,1],parameters_i=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],parameters_t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],parameters_d=256,parameters_n={outlineWidth:.7,outerHaloWidth:.7,innerHaloWidth:.7,outlinePosition:0};\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/highlight/HighlightGradient.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst HighlightGradient_n=Logger[\"a\" /* default */].getLogger(\"esri.views.2d.engine.webgl.painter.highlight.HighlightGradient\");const HighlightGradient_h=[0,0,0,0];/* harmony default export */ var HighlightGradient = (class{constructor(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:parameters_n.outlinePosition,outlineWidth:parameters_n.outlineWidth,innerHaloWidth:parameters_n.innerHaloWidth,outerHaloWidth:parameters_n.outerHaloWidth},this.shadeTexChanged=!0,this.texelData=new Uint8Array(4*parameters_d),this.minMaxDistance=[0,0]}setHighlightOptions(o){const i=this._convertedHighlightOptions;var t,s;t=o,(s=i).fillColor[0]=t.color.r/255,s.fillColor[1]=t.color.g/255,s.fillColor[2]=t.color.b/255,s.fillColor[3]=t.color.a,t.haloColor?(s.outlineColor[0]=t.haloColor.r/255,s.outlineColor[1]=t.haloColor.g/255,s.outlineColor[2]=t.haloColor.b/255,s.outlineColor[3]=t.haloColor.a):(s.outlineColor[0]=s.fillColor[0],s.outlineColor[1]=s.fillColor[1],s.outlineColor[2]=s.fillColor[2],s.outlineColor[3]=s.fillColor[3]),s.fillColor[3]*=t.fillOpacity,s.outlineColor[3]*=t.haloOpacity,s.fillColor[0]*=s.fillColor[3],s.fillColor[1]*=s.fillColor[3],s.fillColor[2]*=s.fillColor[3],s.outlineColor[0]*=s.outlineColor[3],s.outlineColor[1]*=s.outlineColor[3],s.outlineColor[2]*=s.outlineColor[3],s.outlineWidth=parameters_n.outlineWidth,s.outerHaloWidth=parameters_n.outerHaloWidth,s.innerHaloWidth=parameters_n.innerHaloWidth,s.outlinePosition=parameters_n.outlinePosition;const a=i.outlinePosition-i.outlineWidth/2-i.outerHaloWidth,d=i.outlinePosition-i.outlineWidth/2,u=i.outlinePosition+i.outlineWidth/2,g=i.outlinePosition+i.outlineWidth/2+i.innerHaloWidth,C=Math.sqrt(Math.PI/2)*parameters_o[3],f=Math.abs(a)>C?Math.round(10*(Math.abs(a)-C))/10:0,c=Math.abs(g)>C?Math.round(10*(Math.abs(g)-C))/10:0;let m;f&&!c?HighlightGradient_n.error(\"The outer rim of the highlight is \"+f+\"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards).\"):!f&&c?HighlightGradient_n.error(\"The inner rim of the highlight is \"+c+\"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards).\"):f&&c&&HighlightGradient_n.error(\"The highlight is \"+Math.max(f,c)+\"px away from the edge of the feature; consider reducing some width values.\");const p=[void 0,void 0,void 0,void 0];function x(o,i,t){p[0]=(1-t)*o[0]+t*i[0],p[1]=(1-t)*o[1]+t*i[1],p[2]=(1-t)*o[2]+t*i[2],p[3]=(1-t)*o[3]+t*i[3]}const{texelData:w}=this;for(let o=0;o<parameters_d;++o)m=a+o/(parameters_d-1)*(g-a),m<a?(p[4*o+0]=0,p[4*o+1]=0,p[4*o+2]=0,p[4*o+3]=0):m<d?x(HighlightGradient_h,i.outlineColor,(m-a)/(d-a)):m<u?[p[0],p[1],p[2],p[3]]=i.outlineColor:m<g?x(i.outlineColor,i.fillColor,(m-u)/(g-u)):[p[4*o+0],p[4*o+1],p[4*o+2],p[4*o+3]]=i.fillColor,w[4*o+0]=255*p[0],w[4*o+1]=255*p[1],w[4*o+2]=255*p[2],w[4*o+3]=255*p[3];this.minMaxDistance[0]=a,this.minMaxDistance[1]=g,this.shadeTexChanged=!0}applyHighlightOptions(o,e){this.shadeTex||(this.shadeTex=new Texture[\"a\" /* default */](o,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:parameters_d,height:1,samplingMode:9729})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,parameters_d,1,this.texelData),this.shadeTexChanged=!1),o.bindTexture(this.shadeTex,definitions[\"z\" /* TEXTURE_BINDING_HIGHLIGHT_1 */]),e.setUniform2fv(\"u_minMaxDistance\",this.minMaxDistance)}destroy(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)}});\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/HighlightPrograms.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst HighlightPrograms_e={name:\"highlight\",shaders:{vertexShader:Object(resolver[\"a\" /* resolveIncludes */])(\"highlight/textured.vert\"),fragmentShader:Object(resolver[\"a\" /* resolveIncludes */])(\"highlight/highlight.frag\")},attributes:{a_position:0,a_texcoord:1}},HighlightPrograms_r={name:\"blur\",shaders:{vertexShader:Object(resolver[\"a\" /* resolveIncludes */])(\"highlight/textured.vert\"),fragmentShader:Object(resolver[\"a\" /* resolveIncludes */])(\"highlight/blur.frag\")},attributes:{a_position:0,a_texcoord:1}};\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/highlight/HighlightRenderer.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\n/* harmony default export */ var HighlightRenderer = (class{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(e,s){e.bindTexture(s,definitions[\"y\" /* TEXTURE_BINDING_HIGHLIGHT_0 */]),e.bindProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv(\"u_direction\",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv(\"u_channelSelector\",parameters_i),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO()}finalBlur(e,s){e.bindTexture(s,definitions[\"y\" /* TEXTURE_BINDING_HIGHLIGHT_0 */]),e.bindProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv(\"u_direction\",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv(\"u_channelSelector\",parameters_t),e.bindVAO(this._resources.quadVAO),e.drawArrays(5,0,4),e.bindVAO()}renderHighlight(e,s,i){e.bindTexture(s,definitions[\"y\" /* TEXTURE_BINDING_HIGHLIGHT_0 */]),e.bindProgram(this._resources.highlightProgram),i.applyHighlightOptions(e,this._resources.highlightProgram),e.bindVAO(this._resources.quadVAO),e.setBlendingEnabled(!0),e.setBlendFunction(1,771),e.drawArrays(5,0,4),e.bindVAO()}_initialize(o,h,m){this._width=h,this._height=m;const d=new BufferObject[\"a\" /* default */](o,34962,35044,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),g=new VertexArrayObject[\"a\" /* default */](o,{a_position:0,a_texcoord:1},{geometry:[{name:\"a_position\",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:\"a_texcoord\",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:d}),l=Object(programUtils[\"a\" /* createProgram */])(o,HighlightPrograms_e),_=Object(programUtils[\"a\" /* createProgram */])(o,HighlightPrograms_r);l.setUniform1i(\"u_texture\",definitions[\"y\" /* TEXTURE_BINDING_HIGHLIGHT_0 */]),l.setUniform1i(\"u_shade\",definitions[\"z\" /* TEXTURE_BINDING_HIGHLIGHT_1 */]),l.setUniform4fv(\"u_sigmas\",parameters_o),_.setUniform1i(\"u_texture\",definitions[\"y\" /* TEXTURE_BINDING_HIGHLIGHT_0 */]),_.setUniform4fv(\"u_sigmas\",parameters_o),this._resources={quadGeometry:d,quadVAO:g,highlightProgram:l,blurProgram:_}}setup(r,e,s){this._resources?(this._width=e,this._height=s):this._initialize(r,e,s)}});\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/highlight/HighlightSurfaces.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction HighlightSurfaces_r(r,t,i){const h=new Texture[\"a\" /* default */](r,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:t,height:i,samplingMode:9729});return[h,new FramebufferObject[\"a\" /* default */](r,{colorTarget:0,depthStencilTarget:2},h)]}/* harmony default export */ var HighlightSurfaces = (class{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(e,s,t){this._width=s,this._height=t;const[i,h]=HighlightSurfaces_r(e,s,t),[o,u]=HighlightSurfaces_r(e,s,t);this._resources={sharedBlur1Tex:i,sharedBlur1Fbo:h,sharedBlur2Tex:o,sharedBlur2Fbo:u}}setup(e,s,r){!this._resources||this._width===s&&this._height===r||this.dispose(),this._resources||this._initialize(e,s,r)}get sharedBlur1Tex(){return this._resources.sharedBlur1Tex}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Tex}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}});\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/HighlightEffect.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\n/* harmony default export */ var HighlightEffect = (class extends Effect_t{constructor(){super(...arguments),this.defines=[\"highlight\"],this._hlRenderer=new HighlightRenderer,this._hlGradient=new HighlightGradient,this._width=void 0,this._height=void 0,this._hlSurfaces=new HighlightSurfaces,this._adjustedWidth=void 0,this._adjustedHeight=void 0,this._blitRenderer=new BitBlitRenderer_s}dispose(){this._hlSurfaces&&this._hlSurfaces.dispose(),this._hlRenderer&&this._hlRenderer.dispose(),this._hlGradient&&this._hlGradient.destroy(),this._boundFBO=null}bind(e){const{context:t,painter:i}=e,{width:h,height:s}=t.getViewport(),r=i.getFbos(h,s).effect0;this.setup(e,h,s),t.bindFramebuffer(r),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind(){}setup({context:e},t,i){this._width=t,this._height=i;const h=t%4,s=i%4;t+=h<2?-h:4-h,i+=s<2?-s:4-s,this._adjustedWidth=t,this._adjustedHeight=i,this._boundFBO=e.getBoundFramebufferObject();const r=Math.round(.75*t),d=Math.round(.75*i);this._hlRenderer.setup(e,r,d),this._hlSurfaces.setup(e,r,d)}draw({context:e}){const t=e.getBoundFramebufferObject();e.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setStencilTestEnabled(!1),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(e,t.colorTexture,9728,1),e.setStencilTestEnabled(!1),e.setBlendingEnabled(!1),e.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(e,this._hlSurfaces.sharedBlur1Tex),e.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(e,this._hlSurfaces.sharedBlur2Tex),e.bindFramebuffer(this._boundFBO),e.setBlendingEnabled(!0),e.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(e,this._hlSurfaces.sharedBlur1Tex,this._hlGradient),this._boundFBO=null}setHighlightOptions(e){this._hlGradient.setHighlightOptions(e)}});\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/HittestEffect.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass HittestEffect_r extends Effect_t{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=[\"id\"],this._lastSize=0}dispose(){Object(maybe[\"h\" /* isSome */])(this._fbo)&&this._fbo.dispose()}bind({context:t,painter:e}){const{width:s,height:r}=t.getViewport(),i=e.getFbos(s,r).effect0;t.bindFramebuffer(i),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind(){}draw({context:t,state:s,pixelRatio:r},i,o=definitions[\"m\" /* HITTEST_SEARCH_SIZE */]){const f=t.getBoundFramebufferObject(),n=s.size[1]*r,a=Math.round(o*r),h=a/2,c=a/2;this._ensureBuffer(a),i.forEach(((t,e)=>{const s=new Map,o=Math.floor(e[0]*r-a/2),u=Math.floor(n-e[1]*r-a/2);f.readPixels(o,u,a,a,6408,5121,this._buf);for(let t=0;t<this._buf32.length;t++){const e=this._buf32[t];if(4294967295!==e&&0!==e){const r=t%a,i=a-Math.floor(t/a),o=(h-r)*(h-r)+(c-i)*(c-i),f=s.has(e)?s.get(e):4294967295;s.set(e,Math.min(o,f))}}const b=Array.from(s).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]));t.resolve(b),i.delete(e)}))}_ensureBuffer(t){this._lastSize!==t&&(this._lastSize=t,this._buf=new Uint8Array(4*t*t),this._buf32=new Uint32Array(this._buf.buffer))}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/effects/post-processing/EffectManager.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction EffectManager_e(e){switch(e){case\"bloom\":case\"blur\":case\"opacity\":case\"drop-shadow\":return e;default:return\"colorize\"}}const EffectManager_t={colorize:async()=>new((await __webpack_require__.e(/* import() */ 152).then(__webpack_require__.bind(null, \"P3Vg\"))).Colorize),blur:async()=>new((await __webpack_require__.e(/* import() */ 151).then(__webpack_require__.bind(null, \"B2cn\"))).Blur),bloom:async()=>new((await __webpack_require__.e(/* import() */ 150).then(__webpack_require__.bind(null, \"mxcV\"))).Bloom),opacity:async()=>new((await __webpack_require__.e(/* import() */ 154).then(__webpack_require__.bind(null, \"T/wP\"))).Opacity),\"drop-shadow\":async()=>new((await __webpack_require__.e(/* import() */ 153).then(__webpack_require__.bind(null, \"eylR\"))).DropShadow)};class EffectManager_s{constructor(e){this._requestRender=e,this._effectMap=new Map,this._effectPromiseMap=new Map}dispose(){this._requestRender&&(this._requestRender=null),this._effectMap.forEach((e=>e.dispose())),this._effectMap.clear(),this._effectPromiseMap.clear()}getPostProcessingEffects(t){if(!t||0===t.length)return[];const s=[];for(const o of t){const t=EffectManager_e(o.type),r=this._effectMap.get(t);r?s.push({postProcessingEffect:r,effect:o}):this._enablePostProcessingEffect(t)}return s}async _enablePostProcessingEffect(e){const t=await this._loadPostProcessingEffect(e);this._requestRender&&(this._effectMap.set(e,t),this._requestRender.requestRender())}async _loadPostProcessingEffect(e){return this._effectPromiseMap.has(e)||this._effectPromiseMap.set(e,EffectManager_t[e]()),this._effectPromiseMap.get(e)}}\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/arrayUtils.js\nvar arrayUtils = __webpack_require__(\"tQ+6\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/painter/RenderPass.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\n/* harmony default export */ var RenderPass = (class{constructor(r,e){var s;this.brushes=r,this.name=e.name,this.drawPhase=e.drawPhase||enums[\"c\" /* WGLDrawPhase */].MAP,this._targetFn=e.target,this.effects=e.effects||[],this.enableDefaultDraw=null!=(s=e.enableDefaultDraw)?s:()=>!0,this.has=e.has}render(e){const{context:s,profiler:t}=e,a=this._targetFn(),o=this.drawPhase&e.drawPhase;if(t.recordPassStart(this.name),o&&(!this.has||Object(has[\"a\" /* default */])(this.has))){this.enableDefaultDraw()&&this._doRender(e,a),t.recordPassEnd();for(const r of this.effects){if(!r.enable())continue;const o=r.apply;t.recordPassStart(this.name+\".\"+o.name),t.recordBrushStart(o.name);const i=r.args&&r.args(),{x:n,y:h,width:f,height:d}=s.getViewport(),c=s.getBoundFramebufferObject();o.bind(e,i),this._doRender(e,a,o.defines),o.draw(e,i),o.unbind(e,i),s.bindFramebuffer(c),s.setViewport(n,h,f,d),t.recordBrushEnd(),t.recordPassEnd()}}}_doRender(r,t,a){if(!Object(maybe[\"g\" /* isNone */])(t))if(Object(arrayUtils[\"g\" /* isArrayLike */])(t)){for(const e of t)if(e.visible)for(const s of this.brushes)r.profiler.recordBrushStart(s.name),s.prepareState(r,e,a),s.draw(r,e,a),r.profiler.recordBrushEnd()}else for(const e of this.brushes)r.profiler.recordBrushStart(e.name),e.prepareState(r,t,a),e.draw(r,t,a),r.profiler.recordBrushEnd()}});\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/Painter.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction Painter_m(t,s,r){return 1!==r||Object(maybe[\"h\" /* isSome */])(t)&&\"normal\"!==t||Object(maybe[\"h\" /* isSome */])(s)&&s.length>0}/* harmony default export */ var Painter = (class{constructor(e,t){this.context=e,this._blitRenderer=new BitBlitRenderer_s,this._brushCache=new Map,this._vtlProgramCache=null,this._blendEffect=new BlendEffect_u,this.effects={highlight:new HighlightEffect,hittest:new HittestEffect_r,integrate:new AnimationEffect_o,insideEffect:new FeatureEffect_t(\"inside\"),outsideEffect:new FeatureEffect_t(\"outside\")},this.materialManager=new MaterialManager(e),this._vtlProgramCache=new shaders_ProgramCache(e),this.textureManager=new TextureManager(t),this._effectsManager=new EffectManager_s(t)}getRenderTarget(){return this._renderTarget}setRenderTarget(e){this._renderTarget=e}getFbos(e,r){if(e!==this._lastWidth||r!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=r,this._fbos){for(const t in this._fbos)this._fbos[t].resize(e,r);return this._fbos}const i={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e,height:r},n={colorTarget:0,depthStencilTarget:3},o=new Renderbuffer[\"a\" /* default */](this.context,{width:e,height:r,internalFormat:34041});this._stencilBuf=o,this._fbos={output:new FramebufferObject[\"a\" /* default */](this.context,n,i,o),blend:new FramebufferObject[\"a\" /* default */](this.context,n,i,o),effect0:new FramebufferObject[\"a\" /* default */](this.context,n,i,o)}}return this._fbos}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderLayers(t,s=null){const{width:r,height:i}=t.getViewport();this._prevFBO=t.getBoundFramebufferObject();const n=this.getFbos(r,i);if(t.bindFramebuffer(n.output),t.setColorMask(!0,!0,!0,!0),t.setDepthWriteEnabled(!0),Object(maybe[\"h\" /* isSome */])(s)){const{r:e,g:r,b:i,a:n}=s.color;t.setClearColor(n*e/255,n*r/255,n*i/255,n)}else t.setClearColor(0,0,0,0);t.setClearDepth(1),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT),t.setDepthWriteEnabled(!1)}beforeRenderLayer(e,t,s){const{context:r,blendMode:i,effects:n}=e;if(Painter_m(i,n,s))r.bindFramebuffer(this._fbos.blend),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.clear(r.gl.COLOR_BUFFER_BIT);else{const e=this._getOutputFBO();r.bindFramebuffer(e)}r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setStencilTestEnabled(!0),r.setClearStencil(t),r.setStencilWriteMask(255),r.clear(r.gl.STENCIL_BUFFER_BIT)}compositeLayer(t,s){const{context:i,blendMode:n,effects:o}=t;if(Painter_m(n,o,s)){Object(maybe[\"h\" /* isSome */])(o)&&o.length>0&&t.drawPhase===enums[\"c\" /* WGLDrawPhase */].MAP&&this._applyEffects(t,o);const h=this._getOutputFBO();i.bindFramebuffer(h),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(1,771,1,771),i.setColorMask(!0,!0,!0,!0);const a=Object(maybe[\"h\" /* isSome */])(n)?n:\"normal\";this._blendEffect.draw(t,this._fbos.blend.colorTexture,9728,a,s)}}renderLayers(e){if(e.bindFramebuffer(this._prevFBO),!this._fbos)return;const t=this._getOutputFBO();e.setStencilTestEnabled(!1),e.setStencilWriteMask(0),this.blitTexture(e,t.colorTexture,9728)}dispose(){if(this.materialManager.dispose(),this.textureManager.dispose(),this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null),this._vtlProgramCache&&(this._vtlProgramCache.dispose(),this._vtlProgramCache=null),this._brushCache&&(this._brushCache.forEach((e=>e.dispose())),this._brushCache.clear(),this._brushCache=null),this._fbos)for(const e in this._fbos)this._fbos[e]&&this._fbos[e].dispose();if(this.effects)for(const e in this.effects)this.effects[e]&&this.effects[e].dispose();this._prevFBO=null}getGeometryBrush(e){const t={[enums[\"d\" /* WGLGeometryType */].FILL]:brushes[\"a\" /* brushes */].fill,[enums[\"d\" /* WGLGeometryType */].LINE]:brushes[\"a\" /* brushes */].line,[enums[\"d\" /* WGLGeometryType */].MARKER]:brushes[\"a\" /* brushes */].marker,[enums[\"d\" /* WGLGeometryType */].TEXT]:brushes[\"a\" /* brushes */].text}[e];let s=this._brushCache.get(t);return void 0===s&&(s=new t,this._brushCache.set(t,s)),this._brushCache.get(t)}renderObject(e,t,s,r){const i=brushes[\"a\" /* brushes */][s];if(!i)return null;let o=this._brushCache.get(i);void 0===o&&(o=new i,this._brushCache.set(i,o)),o.prepareState(e,t,r),o.draw(e,t,r)}renderObjects(e,t,s,r){const i=brushes[\"a\" /* brushes */][s];if(!i)return null;let o=this._brushCache.get(i);void 0===o&&(o=new i,this._brushCache.set(i,o)),o.drawMany(e,t,r)}getVectorTileProgramCache(){return this._vtlProgramCache}registerRenderPass(e){const t=e.brushes.map((e=>(this._brushCache.has(e)||this._brushCache.set(e,new e),this._brushCache.get(e))));return new RenderPass(t,e)}setHighlightOptions(e){this.effects.highlight.setHighlightOptions(e)}blitTexture(e,t,s,r=1){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,s,r)}getPostProcessingEffects(e){return this._effectsManager.getPostProcessingEffects(e)}_getOutputFBO(){return null!=this._renderTarget?this._renderTarget:this._fbos.output}_applyEffects(e,t){const{context:s}=e,r=this._effectsManager.getPostProcessingEffects(t);for(const{postProcessingEffect:t,effect:i}of r)s.bindFramebuffer(this._fbos.blend),t.draw(e,this._fbos.blend,i)}});\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Evented.js\nvar Evented = __webpack_require__(\"zm0L\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/CircularArray.js\nvar CircularArray = __webpack_require__(\"lx5q\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/capabilities/DisjointTimerQuery.js\nvar DisjointTimerQuery = __webpack_require__(\"GprA\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/Profiler.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst Profiler_i=Object(has[\"a\" /* default */])(\"esri-2d-profiler\");class Profiler_o{constructor(e,s){if(this._events=new Evented[\"a\" /* default */],this._entries=new Map,this._timings=new CircularArray[\"a\" /* default */](10),!Profiler_i)return;this._ext=Object(DisjointTimerQuery[\"a\" /* createDisjointTimerQuery */])(e.gl,{}),this._debugOutput=s;const o=e.gl;if(this.enableCommandLogging)for(const e in o)if(\"function\"==typeof o[e]){const s=o[e],t=-1!==e.indexOf(\"draw\");o[e]=(...r)=>(this._events.emit(\"command\",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:e,args:r,isDrawCommand:t}),this._currentSummary&&(this._currentSummary.commands++,t&&this._currentSummary.drawCommands++),s.apply(o,r))}}get enableCommandLogging(){return!(\"object\"==typeof Profiler_i&&Profiler_i.disableCommands)}recordContainerStart(e){Profiler_i&&(this._currentContainer=e)}recordContainerEnd(){Profiler_i&&(this._currentContainer=null)}recordPassStart(e){Profiler_i&&(this._currentPass=e,this._initSummary())}recordPassEnd(){Profiler_i&&(this._currentPass=null,this._emitSummary())}recordBrushStart(e){Profiler_i&&(this._currentBrush=e)}recordBrushEnd(){Profiler_i&&(this._currentBrush=null)}recordStart(e){if(Profiler_i&&Object(maybe[\"h\" /* isSome */])(this._ext)){if(this._entries.has(e)){const t=this._entries.get(e),r=this._ext.resultAvailable(t.query),n=this._ext.disjoint();if(r&&!n){const r=this._ext.getResult(t.query)/1e6;let n=0;if(Object(maybe[\"h\" /* isSome */])(this._timings.enqueue(r))){const e=this._timings.entries,s=e.length;let t=0;for(const s of e)t+=s;n=t/s}const i=r.toFixed(2),o=n?n.toFixed(2):\"--\";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${e}, ${i} ms (${o} last 10 avg)\\n${t.commandsLen} Commands (${t.drawCommands} draw)`),console.log(\"RenderPass breakdown: \"),console.table(t.summaries),console.log(\"Commands: \",t.commands),console.groupEnd()):console.log(`Frame report for ${e}, ${i} ms (${o} last 10 avg)`),this._debugOutput.innerHTML=`${i} (${o})`}for(const e of t.handles)e.remove();this._entries.delete(e)}const t={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(t.handles.push(this._events.on(\"command\",(e=>{t.commandsLen++,t.commands.push(e),e.isDrawCommand&&t.drawCommands++}))),t.handles.push(this._events.on(\"summary\",(e=>{t.summaries.push(e)})))),this._ext.beginTimeElapsed(t.query),this._entries.set(e,t)}}recordEnd(e){Profiler_i&&Object(maybe[\"h\" /* isSome */])(this._ext)&&this._entries.has(e)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._events.emit(\"summary\",this._currentSummary)}}\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/webgl/Program.js + 2 modules\nvar Program = __webpack_require__(\"jjdI\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/WebGLDriverTest.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst WebGLDriverTest_s=Logger[\"a\" /* default */].getLogger(\"esri.views.2d.engine.webgl.WebGLDriverTest\");class WebGLDriverTest_a{constructor(e){this._ignoresSamplerPrecision=null,this._context=e}get ignoresSamplerPrecision(){return Object(maybe[\"g\" /* isNone */])(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=WebGLDriverTest_l(this._context)),this._ignoresSamplerPrecision}}const WebGLDriverTest_p=e=>new WebGLDriverTest_a(e),WebGLDriverTest_l=e=>{const r=new FramebufferObject[\"a\" /* default */](e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),a=new Uint8Array(4),p=new VertexStream[\"a\" /* default */](e,[0,0,1,0,0,1,1,1]),l=new Program[\"a\" /* default */](e,\"\\nprecision highp float;\\n\\nattribute vec2 a_pos;\\n\\nuniform highp sampler2D u_texture;\\nvarying vec4 v_color;\\n\\nfloat getBit(in float bitset, in int bitIndex) {\\n  float offset = pow(2.0, float(bitIndex));\\n\\n  return mod(floor(bitset / offset), 2.0);\\n}\\n\\nvoid main() {\\n  vec4 value = texture2D(u_texture, vec2(0.0));\\n\\n  float bit = getBit(value.x * 255.0, 1);\\n\\n  v_color = bit * vec4(1.0);\\n\\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\\n}\\n\",\"\\nprecision highp float;\\n\\nvarying vec4 v_color;\\n\\nvoid main() {\\n  gl_FragColor = v_color;\\n}\\n\",{a_pos:0}),g=new Texture[\"a\" /* default */](e,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));l.setUniform1i(\"u_texture\",0),e.bindTexture(g,0);const m=e.getBoundFramebufferObject();e.bindFramebuffer(r),e.bindProgram(l);const{x:c,y:d,width:u,height:h}=e.getViewport();e.setViewport(0,0,1,1),p.draw(),e.setViewport(c,d,u,h),r.readPixels(0,0,1,1,6408,5121,a),l.dispose(),p.dispose(),r.dispose();const f=255!==a[0]||255!==a[1]||255!==a[2]||255!==a[3];return f&&WebGLDriverTest_s.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${a[0]}.${a[1]}.${a[2]}.${a[3]}]`),e.bindFramebuffer(m),f};\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/StencilPrograms.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst StencilPrograms_r={name:\"stencil\",shaders:{vertexShader:Object(resolver[\"a\" /* resolveIncludes */])(\"stencil/stencil.vert\"),fragmentShader:Object(resolver[\"a\" /* resolveIncludes */])(\"stencil/stencil.frag\")},attributes:{a_pos:0}};\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/Stage.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst Stage_B=2e3;class Stage_E extends Container[\"a\" /* Container */]{constructor(r,n){super(),this._trash=new Set,this._clipData=new Float32Array(8),this._upperLeft=Object(vec2f64[\"a\"])(),this._upperRight=Object(vec2f64[\"a\"])(),this._lowerLeft=Object(vec2f64[\"a\"])(),this._lowerRight=Object(vec2f64[\"a\"])(),this._mat2=Object(mat2df64[\"a\" /* c */])(),this._clipRendererInitialized=!1,this._supersampleScreenshots=!0,this.renderRequested=!1,this.stage=this,this._stationary=!0;const{canvas:h=document.createElement(\"canvas\"),alpha:o=!0,stencil:l=!0,renderContext:d=\"webgl\",supersampleScreenshots:c=!0,contextOptions:p={}}=n;this._canvas=h;const _=Object(context_util[\"b\" /* createContextOrErrorHTML */])(h,{alpha:o,antialias:!1,depth:!0,stencil:l},d);this.context=new RenderingContext[\"a\" /* default */](_,p),this.painter=new Painter(this.context,this),Object(has[\"a\" /* default */])(\"esri-2d-profiler\")&&(this._debugOutput=document.createElement(\"div\"),this._debugOutput.setAttribute(\"style\",\"margin: 24px 64px; position: absolute; color: red;\"),r.appendChild(this._debugOutput)),this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:n.timeline||new Timeline[\"a\" /* Timeline */],renderingOptions:n.renderingOptions,driverTestResult:WebGLDriverTest_p(this.context),profiler:new Profiler_o(this.context,this._debugOutput),dataUploadCounter:0},this._taskHandle=Object(scheduling[\"a\" /* addFrameTask */])({render:e=>this.renderFrame(e)}),this._taskHandle.pause(),this._supersampleScreenshots=c,this._lostWebGLContextHandle=Object(events[\"c\" /* on */])(h,\"webglcontextlost\",(()=>{this.emit(\"webgl-error\",{error:new core_Error[\"a\" /* default */](\"webgl-context-lost\")})})),h.setAttribute(\"style\",\"width: 100%; height:100%; display:block;\"),r.appendChild(h)}destroy(){this.removeAllChildren(),this._emptyTrash(),this._taskHandle.remove(),this._taskHandle=null,this._boundFBO=null,this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null),this._clipVAO&&(this._clipVAO.dispose(),this._clipVAO=null,this._clipVBO=null),this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null),this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput),this.highlightOptions=null,this.painter.dispose(),this.context.dispose(),this._canvas=null}get background(){return this._background}set background(e){this._background=e,this.requestRender()}get highlightOptions(){return this._highlightOptions}set highlightOptions(e){this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null),this._highlightOptions=e,this._highlightOptions&&(this._highlightOptionsHandle=Object(watchUtils[\"a\" /* init */])(this._highlightOptions,\"version\",(()=>{this.painter.setHighlightOptions(e),this.requestRender()})))}get renderingOptions(){return this._renderingOptions}set renderingOptions(e){this._renderingOptions=e,this.requestRender()}get state(){return this._state}set state(e){this._state=e,this.requestRender()}get stationary(){return this._stationary}set stationary(e){this._stationary!==e&&(this._stationary=e,this.requestRender())}trashDisplayObject(e){this._trash.add(e),this.requestRender()}untrashDisplayObject(e){return this._trash.delete(e)}requestRender(){this._lastRenderRequestTime=performance.now(),this.renderRequested||(this.renderRequested=!0,this.emit(\"will-render\"),this._taskHandle.resume())}renderFrame(e){e.time-this._lastRenderRequestTime>=2e3&&this._taskHandle.pause(),this.renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash(),this.emit(\"post-render\")}renderChildren(e){for(const t of this.children)t.beforeRender(e);this._renderChildren(this.children,e);for(const t of this.children)t.afterRender(e)}_renderChildren(t,i){const s=this.context;i.profiler.recordStart(\"drawLayers\"),i.dataUploadCounter=0,this._beforeRenderChildren(i),i.drawPhase=enums[\"c\" /* WGLDrawPhase */].MAP,this.painter.beforeRenderLayers(s,this.background);for(const e of t)e.processRender(i);this.painter.renderLayers(s),i.drawPhase=enums[\"c\" /* WGLDrawPhase */].HIGHLIGHT,this.painter.beforeRenderLayers(s);for(const e of t)e.processRender(i);this.painter.renderLayers(s);if(this._isLabelDrawPhaseRequired(t)){i.drawPhase=enums[\"c\" /* WGLDrawPhase */].LABEL,this.painter.beforeRenderLayers(s);for(const e of t)e.processRender(i);this.painter.renderLayers(s)}if(Object(has[\"a\" /* default */])(\"esri-tiles-debug\")){i.drawPhase=enums[\"c\" /* WGLDrawPhase */].DEBUG,this.painter.beforeRenderLayers(s);for(const e of t)e.processRender(i);this.painter.renderLayers(s)}i.profiler.recordEnd(\"drawLayers\"),this._afterRenderChildren()}_beforeRenderChildren(e){const{context:t}=this,{state:i,pixelRatio:s}=e;t.enforceState();const{size:n,rotation:a}=i,h=Math.round(n[0]*s),o=Math.round(n[1]*s);this._boundFBO=t.getBoundFramebufferObject();if(!(i.spatialReference&&(i.spatialReference._isWrappable?i.spatialReference._isWrappable():i.spatialReference.isWrappable)))return void(this._clipFrame=!1);const l=Object(common[\"d\" /* t */])(a),d=Math.abs(Math.cos(l)),u=Math.abs(Math.sin(l)),f=Math.round(h*d+o*u),b=Math.round(i.worldScreenWidth);if(f<=b)return void(this._clipFrame=!1);this._clipFBO&&this._clipFBO.width===h&&this._clipFBO.height===o||(this._clipFBO=new FramebufferObject[\"a\" /* default */](t,{colorTarget:0,depthStencilTarget:3,width:h,height:o}));const w=(this.state.padding.left-this.state.padding.right)/2,R=(this.state.padding.bottom-this.state.padding.top)/2,x=.5*h,y=.5*o,C=1/h,F=1/o,v=b*s*.5,P=.5*(h*u+o*d),S=this._upperLeft,j=this._upperRight,B=this._lowerLeft,E=this._lowerRight;Object(vec2[\"m\" /* s */])(S,-v,-P),Object(vec2[\"m\" /* s */])(j,v,-P),Object(vec2[\"m\" /* s */])(B,-v,P),Object(vec2[\"m\" /* s */])(E,v,P),Object(mat2d[\"d\" /* i */])(this._mat2),Object(mat2d[\"h\" /* t */])(this._mat2,this._mat2,[x+w,y+R]),0!==a&&Object(mat2d[\"f\" /* r */])(this._mat2,this._mat2,l),Object(vec2[\"n\" /* t */])(S,S,this._mat2),Object(vec2[\"n\" /* t */])(j,j,this._mat2),Object(vec2[\"n\" /* t */])(B,B,this._mat2),Object(vec2[\"n\" /* t */])(E,E,this._mat2);const T=this._clipData;T.set([2*B[0]*C-1,2*(o-B[1])*F-1,2*E[0]*C-1,2*(o-E[1])*F-1,2*S[0]*C-1,2*(o-S[1])*F-1,2*j[0]*C-1,2*(o-j[1])*F-1]),this._clipRendererInitialized||this._initializeClipRenderer(t),this._clipVBO.setData(T),this._boundFBO=t.getBoundFramebufferObject(),t.bindFramebuffer(this._clipFBO),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),t.setClearColor(0,0,0,0),t.setClearDepth(1),t.setClearStencil(0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT|t.gl.STENCIL_BUFFER_BIT),t.setDepthWriteEnabled(!1),this._clipFrame=!0}_afterRenderChildren(){const e=this.context;if(e.logIno(),this._clipFrame&&this._clipRendererInitialized){if(e.bindFramebuffer(this._boundFBO),this._boundFBO=null,e.bindVAO(this._clipVAO),e.bindProgram(this._clipStencilProgram),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunction(519,1,255),e.drawElements(4,6,5123,0),e.bindVAO(),e.setColorMask(!0,!0,!0,!0),null!=this.background){const{r:t,g:i,b:s,a:r}=this.background.color;e.setClearColor(r*t/255,r*i/255,r*s/255,r)}else e.setClearColor(0,0,0,0);e.clear(e.gl.COLOR_BUFFER_BIT),e.setBlendingEnabled(!0),e.setStencilFunction(514,1,255),this.painter.blitTexture(e,this._clipFBO.colorTexture,9728,1),e.setStencilTestEnabled(!1)}}doRender(e){const t=this.context,{state:i,pixelRatio:s}=e;this._resizeCanvas(e),this.context.enforceState(),t.setViewport(0,0,s*i.size[0],s*i.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),super.doRender(e)}async takeScreenshot(e,t){const i=Object(screenshotUtils[\"d\" /* screenshotSuperSampleSettings */])(e,this._supersampleScreenshots,this._state.padding),{framebufferWidth:s,framebufferHeight:r}=i,n=this.context,a=e.layers;let l=this.children;const d={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),pixelRatio:i.pixelRatio,time:Date.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1};if(null!=e.rotation){const t=d.state.viewpoint;t.rotation=e.rotation,d.state.viewpoint=t}a.length>0&&(l=[],a.forEach((e=>{const i=t.find((t=>t.layer.id===e.id));i&&\"container\"in i&&i.container&&l.push(i.container)})));const c=new FramebufferObject[\"a\" /* default */](n,{colorTarget:0,depthStencilTarget:3,width:s,height:r}),p=n.getBoundFramebufferObject(),u=n.getViewport();n.bindFramebuffer(c),n.setViewport(0,0,s,r),this._renderChildren(l,d);const _=this._readbackScreenshot(i);n.bindFramebuffer(p),n.setViewport(u.x,u.y,u.width,u.height),this.requestRender();const m=this._ensureScreenshotEncodeCanvas();return Object(screenshotUtils[\"b\" /* encodeResult */])(_,e,m,{flipY:!0,premultipliedAlpha:!0})}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement(\"canvas\")),this._screenshotEncodeCanvas}_readbackScreenshot(e){const{framebufferWidth:t,framebufferHeight:i,region:s,resample:r}=e,n=this.context.gl;if(r){const e=Object(screenshotUtils[\"a\" /* createEmptyImageData */])(t,i,this._ensureScreenshotEncodeCanvas());n.readPixels(0,0,t,i,6408,5121,new Uint8Array(e.data.buffer));const a=Object(screenshotUtils[\"a\" /* createEmptyImageData */])(s.width,s.height,this._ensureScreenshotEncodeCanvas());return Object(screenshotUtils[\"c\" /* resampleHermite */])(e,a,!0,r.region.x,i-(r.region.y+r.region.height),r.region.width,r.region.height)}{const e=Object(screenshotUtils[\"a\" /* createEmptyImageData */])(s.width,s.height,this._ensureScreenshotEncodeCanvas());return n.readPixels(s.x,i-(s.y+s.height),s.width,s.height,6408,5121,new Uint8Array(e.data.buffer)),e}}_resizeCanvas(e){const t=this._canvas,i=t.style,{state:{size:s},pixelRatio:r}=e,n=s[0],a=s[1],h=Math.round(n*r),o=Math.round(a*r);t.width===h&&t.height===o||(t.width=h,t.height=o),i.width=n+\"px\",i.height=a+\"px\"}_initializeClipRenderer(e){if(this._clipRendererInitialized)return!0;const t=StencilPrograms_r.attributes,i=Object(programUtils[\"a\" /* createProgram */])(e,StencilPrograms_r);if(!i)return!1;const s=BufferObject[\"a\" /* default */].createVertex(e,35040,32),r=new Uint16Array([0,1,2,2,1,3]),n=BufferObject[\"a\" /* default */].createIndex(e,35044,r),a=new VertexArrayObject[\"a\" /* default */](e,t,{geometry:[{name:\"a_pos\",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:s},n);return this._clipStencilProgram=i,this._clipVBO=s,this._clipVAO=a,this._clipRendererInitialized=!0,!0}_emptyTrash(){for(;this._trash.size>0;){const e=Array.from(this._trash);this._trash.clear();for(const t of e)t.processDetach()}}_isLabelDrawPhaseRequired(e){let t=!1;for(const i of e){if(!(i instanceof Container[\"a\" /* Container */])){t=t||!1;break}if(i.hasLabels)return!0;t=t||this._isLabelDrawPhaseRequired(i.children)}return t}}\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js + 5 modules\nvar GraphicsView2D = __webpack_require__(\"Vh9r\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/geometry/Point.js + 2 modules\nvar Point = __webpack_require__(\"SuVq\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/Viewpoint.js + 1 modules\nvar Viewpoint = __webpack_require__(\"y3LX\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/viewpointUtils.js\nvar viewpointUtils = __webpack_require__(\"qYtE\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/navigation/ZoomBox.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst ZoomBox_o=\"esri-zoom-box__container\",ZoomBox_a=\"esri-zoom-box__overlay\",ZoomBox_n=\"esri-zoom-box__overlay-background\",ZoomBox_h=\"esri-zoom-box__outline\",ZoomBox_l=\"Shift\",ZoomBox_c=\"Ctrl\";let ZoomBox_d=class extends Accessor[\"a\" /* default */]{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this._handles&&this._handles.forEach((t=>{t.remove()})),this._handles=null,this._destroyOverlay(),this._set(\"view\",t),t&&(t.on(\"drag\",[ZoomBox_l],(t=>this._handleDrag(t,1))),t.on(\"drag\",[ZoomBox_l,ZoomBox_c],(t=>this._handleDrag(t,-1))))}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,e,i,s){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=s,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,e,i,s,o){const a=this.view,n=a.toMap(Object(screenUtils[\"b\" /* createScreenPoint */])(t+.5*i,e+.5*s));let h=Math.max(i/a.width,s/a.height);-1===o&&(h=1/h),this._destroyOverlay(),this.navigation.end(),a.goTo({center:n,scale:a.scale*h})}_updateBox(t,e,i,s){const r=this._boxShape;r.setAttributeNS(null,\"x\",\"\"+t),r.setAttributeNS(null,\"y\",\"\"+e),r.setAttributeNS(null,\"width\",\"\"+i),r.setAttributeNS(null,\"height\",\"\"+s),r.setAttributeNS(null,\"class\",ZoomBox_h)}_updateBackground(t,e,i,s){this._backgroundShape.setAttributeNS(null,\"d\",this._toSVGPath(t,e,i,s,this.view.width,this.view.height))}_createContainer(){const t=document.createElement(\"div\");t.className=ZoomBox_o,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,e=this.view.height,i=document.createElementNS(\"http://www.w3.org/2000/svg\",\"path\");i.setAttributeNS(null,\"d\",\"M 0 0 L \"+t+\" 0 L \"+t+\" \"+e+\" L 0 \"+e+\" Z\"),i.setAttributeNS(null,\"class\",ZoomBox_n);const s=document.createElementNS(\"http://www.w3.org/2000/svg\",\"rect\"),r=document.createElementNS(\"http://www.w3.org/2000/svg\",\"svg\");r.setAttributeNS(\"http://www.w3.org/2000/xmlns/\",\"xmlns:xlink\",\"http://www.w3.org/1999/xlink\"),r.setAttributeNS(null,\"class\",ZoomBox_a),r.appendChild(i),r.appendChild(s),this._container.appendChild(r),this._backgroundShape=i,this._boxShape=s,this._overlay=r}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,e,i,s,r,o){const a=t+i,n=e+s;return\"M 0 0 L \"+r+\" 0 L \"+r+\" \"+o+\" L 0 \"+o+\" ZM \"+t+\" \"+e+\" L \"+t+\" \"+n+\" L \"+a+\" \"+n+\" L \"+a+\" \"+e+\" Z\"}_handleDrag(t,e){const i=t.x,s=t.y,r=t.origin.x,o=t.origin.y;let a,n,h,l;switch(i>r?(a=r,h=i-r):(a=i,h=r-i),s>o?(n=o,l=s-o):(n=s,l=o-s),t.action){case\"start\":this._start();break;case\"update\":this._update(a,n,h,l);break;case\"end\":this._end(a,n,h,l,e)}t.stopPropagation()}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:e,width:i,height:s}=this._box;this._updateBox(t,e,i,s),this._updateBackground(t,e,i,s),this._rafId=requestAnimationFrame(this._redraw)}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],ZoomBox_d.prototype,\"navigation\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],ZoomBox_d.prototype,\"view\",null),ZoomBox_d=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.views.2d.navigation.ZoomBox\")],ZoomBox_d);var ZoomBox_=ZoomBox_d;/* harmony default export */ var ZoomBox = (ZoomBox_);\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/geometry.js\nvar geometry = __webpack_require__(\"4GrV\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/vec3f64.js\nvar vec3f64 = __webpack_require__(\"Cy1f\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/chunks/vec3.js\nvar vec3 = __webpack_require__(\"5DEt\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/navigation/FilteredFiniteDifference.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass FilteredFiniteDifference_t{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const e=this.computeDelta(t);this.updateDelta(e)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return void 0!==this.lastValue}get hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(t){return t-this.lastValue}updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/navigation/Momentum.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass Momentum_t{constructor(t,i,o){this._initialVelocity=t,this._stopVelocity=i,this._friction=o,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const o=this.value(t);return this.value(t+i)-o}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const o=1-this.friction;return t*(Math.pow(o,i)-1)/Math.log(o)}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/navigation/PanPlanarMomentumEstimator.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass PanPlanarMomentumEstimator_c extends Momentum_t{constructor(e,t,i,s,n){super(e,t,i),this.sceneVelocity=s,this.direction=n}value(e){return super.valueFromInitialVelocity(this.sceneVelocity,e)}}class PanPlanarMomentumEstimator_h{constructor(t=300,i=12,s=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=s,this.enabled=!0,this.time=new FilteredFiniteDifference_t(.6),this.screen=[new FilteredFiniteDifference_t(.4),new FilteredFiniteDifference_t(.4)],this.scene=[new FilteredFiniteDifference_t(.6),new FilteredFiniteDifference_t(.6),new FilteredFiniteDifference_t(.6)],this.tmpDirection=Object(vec3f64[\"e\" /* c */])()}add(e,t,i){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.015)return}this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.scene[0].update(t[0]),this.scene[1].update(t[1]),this.scene[2].update(t[2]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,i=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(e,n,r){Object(vec3[\"r\" /* s */])(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const h=Object(vec3[\"m\" /* l */])(this.tmpDirection);h>0&&Object(vec3[\"b\" /* a */])(this.tmpDirection,this.tmpDirection,1/h);const a=h/this.time.filteredDelta;return new PanPlanarMomentumEstimator_c(e,n,r,a,this.tmpDirection)}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/navigation/actions/Pan.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nlet Pan_c=class extends Accessor[\"a\" /* default */]{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new PanPlanarMomentumEstimator_h(500,6,.92),this.momentum=null,this.tmpMomentum=Object(vec3f64[\"e\" /* c */])(),this.momentumFinished=!1,this.viewpoint=new Viewpoint[\"a\" /* default */]({targetGeometry:new Point[\"a\" /* default */],scale:0,rotation:0}),this.watch(\"momentumFinished\",(t=>{t&&this.navigation.stop()}))}begin(t,i){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(i),this.previousDrag=i}update(t,i){this.addToEstimator(i);let o=i.center.x,s=i.center.y;const e=this.previousDrag;o=e?e.center.x-o:-o,s=e?s-e.center.y:s,t.viewpoint=Object(viewpointUtils[\"v\" /* translateBy */])(this.viewpoint,t.viewpoint,[o||0,s||0]),this.previousDrag=i}end(t,i){this.addToEstimator(i);const o=t.navigation.momentumEnabled;this.momentum=o?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this.previousDrag=null,this.navigation.end()}addToEstimator(t){const i=t.center.x,o=t.center.y,s=Object(screenUtils[\"c\" /* createScreenPointArray */])(-i,o),e=Object(vec3f64[\"g\" /* f */])(-i,o,0);this.momentumEstimator.add(s,e,.001*t.timestamp)}onAnimationUpdate(t){this.navigation.animationManager.animateContinous(t.viewpoint,((i,o)=>{this.momentumFinished=!this.momentum||this.momentum.isFinished(this.animationTime);const s=.001*o;if(!this.momentumFinished){const o=this.momentum.valueDelta(this.animationTime,s);Object(vec3[\"b\" /* a */])(this.tmpMomentum,this.momentum.direction,o),Object(viewpointUtils[\"v\" /* translateBy */])(i,i,this.tmpMomentum),t.constraints.constrainByGeometry(i)}this.animationTime+=s}))}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],Pan_c.prototype,\"momentumFinished\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],Pan_c.prototype,\"viewpoint\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],Pan_c.prototype,\"navigation\",void 0),Pan_c=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.views.2d.navigation.actions.Pan\")],Pan_c);var Pan_d=Pan_c;/* harmony default export */ var Pan = (Pan_d);\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/navigation/MomentumEstimator.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass MomentumEstimator_s{constructor(t=2.5,i=.01,s=.95,l=12){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=s,this.maxVelocity=l,this.enabled=!0,this.value=new FilteredFiniteDifference_t(.8),this.time=new FilteredFiniteDifference_t(.3)}add(t,e){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(e)<.01)return;if(this.value.hasFilteredDelta){const e=this.value.computeDelta(t);this.value.filteredDelta*e<0&&this.value.reset()}}this.time.update(e),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Object(mathUtils[\"c\" /* clamp */])(e,-this.maxVelocity,this.maxVelocity),Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)}createMomentum(t,e,s){return new Momentum_t(t,e,s)}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/navigation/RotationMomentumEstimator.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass RotationMomentumEstimator_a extends MomentumEstimator_s{constructor(t=3,a=.01,s=.95,e=12){super(t,a,s,e)}add(t,a){if(this.value.hasLastValue){const a=this.value.lastValue;let s=t-a;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=a+s}super.add(t,a)}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/navigation/ZoomMomentumEstimator.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass ZoomMomentumEstimator_r extends Momentum_t{constructor(e,t,r){super(e,t,r)}value(e){const t=super.value(e);return Math.exp(t)}valueDelta(e,t){const r=super.value(e),s=super.value(e+t)-r;return Math.exp(s)}}class ZoomMomentumEstimator_s extends MomentumEstimator_s{constructor(e=2.5,t=.01,r=.95,s=12){super(e,t,r,s)}add(e,t){super.add(Math.log(e),t)}createMomentum(e,t,s){return new ZoomMomentumEstimator_r(e,t,s)}}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/navigation/actions/Pinch.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nlet Pinch_l=class extends Accessor[\"a\" /* default */]{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._rotationMomentumEstimator=new RotationMomentumEstimator_a(.6,.15,.95),this._rotationDirection=1,this._zoomDirection=1,this._zoomMomentumEstimator=new ZoomMomentumEstimator_s,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new Viewpoint[\"a\" /* default */]({targetGeometry:new Point[\"a\" /* default */],scale:0,rotation:0}),this.watch(\"_momentumFinished\",(t=>{t&&this.navigation.stop()}))}begin(t,o){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=o.angle,this._previousRadius=this._startRadius=o.radius,this._previousCenter=o.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,o.timestamp),this.addToZoomEstimator(o,1)}update(t,o){null===this._updateTimestamp&&(this._updateTimestamp=o.timestamp);const i=o.angle,s=o.radius,e=o.center,n=Math.abs(180*(i-this._startAngle)/Math.PI),m=Math.abs(s-this._startRadius),a=this._startRadius/s;if(this._previousRadius){const r=s/this._previousRadius;let h=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=h>=0?1:-1,this._zoomDirection=r>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&o.timestamp-this._updateTimestamp>200&&(this._zoomOnly=m-n>0),null===this._zoomOnly||this._zoomOnly?h=0:this.addToRotateEstimator(i-this._startAngle,o.timestamp)):h=0,this.addToZoomEstimator(o,a),this.navigation.setViewpoint([e.x,e.y],1/r,h,[this._previousCenter.x-e.x,e.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=s,this._previousCenter=e}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,o){this._rotationMomentumEstimator.add(t,.001*o)}addToZoomEstimator(t,o){this._zoomMomentumEstimator.add(o,.001*t.timestamp)}canZoomIn(t){const o=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||o>i}canZoomOut(t){const o=t.scale,i=t.constraints.effectiveMinScale;return 0===i||o<i}onAnimationUpdate(t){this.navigation.animationManager.animateContinous(t.viewpoint,((o,i)=>{const s=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,e=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),n=s||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),p=.001*i;if(this._momentumFinished=e&&n,!this._momentumFinished){const i=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,p))*this._rotationDirection*180/Math.PI:0;let s=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,p)):1;const e=Object(vec2f64[\"a\"])(),n=Object(vec2f64[\"a\"])();if(this._previousCenter){Object(vec2[\"m\" /* s */])(e,this._previousCenter.x,this._previousCenter.y),Object(viewpointUtils[\"j\" /* getPaddingScreenTranslation */])(n,t.size,t.padding),Object(vec2[\"h\"])(e,e,n);const{constraints:m,scale:p}=t,c=p*s;s<1&&!m.canZoomInTo(c)?(s=p/m.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):s>1&&!m.canZoomOutTo(c)&&(s=p/m.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),Object(viewpointUtils[\"s\" /* scaleAndRotateBy */])(o,t.viewpoint,s,i,e,t.size),t.constraints.constrainByGeometry(o)}}this._animationTime+=p}))}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],Pinch_l.prototype,\"_momentumFinished\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],Pinch_l.prototype,\"viewpoint\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],Pinch_l.prototype,\"navigation\",void 0),Pinch_l=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.views.2d.navigation.actions.Pinch\")],Pinch_l);var Pinch_=Pinch_l;/* harmony default export */ var Pinch = (Pinch_);\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/navigation/actions/Rotate.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst Rotate_v=Object(vec2f64[\"a\"])(),Rotate_d=Object(vec2f64[\"a\"])();let Rotate_j=class extends Accessor[\"a\" /* default */]{constructor(e){super(e),this._previousCenter=Object(vec2f64[\"a\"])(),this.viewpoint=new Viewpoint[\"a\" /* default */]({targetGeometry:new Point[\"a\" /* default */],scale:0,rotation:0})}begin(e,t){this.navigation.begin(),Object(vec2[\"m\" /* s */])(this._previousCenter,t.center.x,t.center.y)}update(e,t){const{state:{size:o,padding:r}}=e;Object(vec2[\"m\" /* s */])(Rotate_v,t.center.x,t.center.y),Object(viewpointUtils[\"g\" /* getAnchor */])(Rotate_d,o,r),e.viewpoint=Object(viewpointUtils[\"q\" /* rotateBy */])(this.viewpoint,e.state.paddedViewState.viewpoint,Object(viewpointUtils[\"b\" /* angleBetween */])(Rotate_d,this._previousCenter,Rotate_v)),Object(vec2[\"c\"])(this._previousCenter,Rotate_v)}end(){this.navigation.end()}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],Rotate_j.prototype,\"viewpoint\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],Rotate_j.prototype,\"navigation\",void 0),Rotate_j=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.views.2d.actions.Rotate\")],Rotate_j);var Rotate_h=Rotate_j;/* harmony default export */ var Rotate = (Rotate_h);\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/navigation/MapViewNavigation.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst MapViewNavigation_l=new Viewpoint[\"a\" /* default */]({targetGeometry:new Point[\"a\" /* default */]}),MapViewNavigation_v=[0,0];let MapViewNavigation_w=class extends Accessor[\"a\" /* default */]{constructor(t){super(t),this._endTimer=null,this.animationManager=null}initialize(){this.pan=new Pan({navigation:this}),this.rotate=new Rotate({navigation:this}),this.pinch=new Pinch({navigation:this}),this.zoomBox=new ZoomBox({view:this.view,navigation:this})}destroy(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null}begin(){this._set(\"interacting\",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}async zoom(t,i=this._getDefaultAnchor()){if(this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(i):this.zoomOut(i);this.setViewpoint(i,t,0,[0,0])}async zoomIn(t){const i=this.view,o=i.constraints.snapToNextScale(i.scale);return this._zoomToScale(o,t)}async zoomOut(t){const i=this.view,o=i.constraints.snapToPreviousScale(i.scale);return this._zoomToScale(o,t)}setViewpoint(t,i,o,n){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,i,o,n),this.end()}setViewpointImmediate(t,i=0,o=[0,0],n=this._getDefaultAnchor()){this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,t,i,o)}continousRotateClockwise(){const t=this.get(\"view.viewpoint\");this.animationManager.animateContinous(t,(t=>{Object(viewpointUtils[\"q\" /* rotateBy */])(t,t,-1)}))}continousRotateCounterclockwise(){const t=this.get(\"view.viewpoint\");this.animationManager.animateContinous(t,(t=>{Object(viewpointUtils[\"q\" /* rotateBy */])(t,t,1)}))}resetRotation(){this.view.rotation=0}continousPanLeft(){this._continuousPan([-10,0])}continousPanRight(){this._continuousPan([10,0])}continousPanUp(){this._continuousPan([0,10])}continousPanDown(){this._continuousPan([0,-10])}stop(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set(\"interacting\",!1))}_continuousPan(t){const i=this.get(\"view.viewpoint\");this.animationManager.animateContinous(i,(i=>{Object(viewpointUtils[\"v\" /* translateBy */])(i,i,t),this.view.constraints.constrainByGeometry(i)}))}_startTimer(t){return null!==this._endTimer||(this._endTimer=setTimeout((()=>{this._endTimer=null;const t=performance.now()-this._lastEventTimestamp;t<250?this._endTimer=this._startTimer(t):this._set(\"interacting\",!1)}),t)),this._endTimer}_getDefaultAnchor(){const{size:t,padding:{left:i,right:o,top:n,bottom:e}}=this.view;return MapViewNavigation_v[0]=.5*(t[0]-o+i),MapViewNavigation_v[1]=.5*(t[1]-e+n),MapViewNavigation_v}async _zoomToScale(t,i=this._getDefaultAnchor()){const{view:o}=this,{constraints:n,scale:e,viewpoint:s,size:a,padding:r}=o,m=n.canZoomInTo(t),p=n.canZoomOutTo(t);if(!(t<e&&!m||t>e&&!p))return Object(viewpointUtils[\"o\" /* padAndScaleAndRotateBy */])(MapViewNavigation_l,s,t/e,0,i,a,r),n.constrainByGeometry(MapViewNavigation_l),o.goTo(MapViewNavigation_l,{animate:!0})}_scaleRotateTranslateViewpoint(t,i,o,n,e){const{view:s}=this,{size:a,padding:m,constraints:p,scale:h,viewpoint:u}=s,l=h*o,v=p.canZoomInTo(l),w=p.canZoomOutTo(l);return(o<1&&!v||o>1&&!w)&&(o=1),Object(viewpointUtils[\"v\" /* translateBy */])(u,u,e),Object(viewpointUtils[\"o\" /* padAndScaleAndRotateBy */])(t,u,o,n,i,a,m),p.constrainByGeometry(t)}};Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],MapViewNavigation_w.prototype,\"animationManager\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])({type:Boolean,readOnly:!0})],MapViewNavigation_w.prototype,\"interacting\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],MapViewNavigation_w.prototype,\"pan\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],MapViewNavigation_w.prototype,\"pinch\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],MapViewNavigation_w.prototype,\"rotate\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],MapViewNavigation_w.prototype,\"view\",void 0),Object(tslib_es6[\"a\" /* _ */])([Object(property[\"b\" /* property */])()],MapViewNavigation_w.prototype,\"zoomBox\",void 0),MapViewNavigation_w=Object(tslib_es6[\"a\" /* _ */])([Object(subclass[\"a\" /* subclass */])(\"esri.views.2d.navigation.MapViewNavigation\")],MapViewNavigation_w);var MapViewNavigation_g=MapViewNavigation_w;/* harmony default export */ var MapViewNavigation = (MapViewNavigation_g);\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/core/Handles.js\nvar Handles = __webpack_require__(\"r0DZ\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/views/2d/engine/DisplayObject.js\nvar DisplayObject = __webpack_require__(\"fEsP\");\n\n// EXTERNAL MODULE: ./node_modules/@arcgis/core/support/requestImageUtils.js\nvar requestImageUtils = __webpack_require__(\"LbAs\");\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/magnifier/resources.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nasync function resources_s(s){const r=__webpack_require__.e(/* import() */ 162).then(__webpack_require__.bind(null, \"RzSf\")),i=__webpack_require__.e(/* import() */ 163).then(__webpack_require__.bind(null, \"o3Xd\")),o=Object(requestImageUtils[\"a\" /* requestImage */])((await r).default,{signal:s}),e=Object(requestImageUtils[\"a\" /* requestImage */])((await i).default,{signal:s}),m={mask:await o,overlay:await e};return Object(promiseUtils[\"w\" /* throwIfAborted */])(s),m}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/engine/webgl/shaders/MagnifierPrograms.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nconst MagnifierPrograms_i={name:\"magnifier\",shaders:{vertexShader:Object(resolver[\"a\" /* resolveIncludes */])(\"magnifier/magnifier.vert\"),fragmentShader:Object(resolver[\"a\" /* resolveIncludes */])(\"magnifier/magnifier.frag\")},attributes:{a_pos:0}};function MagnifierPrograms_t(e){return Object(programUtils[\"a\" /* createProgram */])(e,MagnifierPrograms_i)}\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/magnifier/MagnifierView2D.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\n/* harmony default export */ var MagnifierView2D = (class extends DisplayObject[\"a\" /* DisplayObject */]{constructor(){super(),this._handles=new Handles[\"a\" /* default */],this._resourcePixelRatio=1,this.visible=!1}destroy(){this._handles.destroy(),this._handles=null,this._disposeRenderResources(),this._resourcesTask&&(this._resourcesTask.abort(),this._resourcesTask=null)}get background(){return this._background}set background(e){this._background=e,this.requestRender()}get magnifier(){return this._magnifier}set magnifier(e){this._magnifier=e,this._handles.removeAll(),this._handles.add([Object(watchUtils[\"a\" /* init */])(e,\"version\",(()=>{this.visible=e.visible&&Object(maybe[\"h\" /* isSome */])(e.position)&&e.size>0,this.requestRender()})),e.watch([\"mask\",\"overlay\"],(()=>this._reloadResources())),e.watch(\"size\",(()=>{this._disposeRenderResources(),this.requestRender()}))])}doRender(r){var t;const s=r.context;if(!this._resourcesTask)return void this._reloadResources();if(r.drawPhase!==enums[\"c\" /* WGLDrawPhase */].MAP||!this._canRender())return;this._updateResources(r);const i=this._magnifier;if(Object(maybe[\"g\" /* isNone */])(i.position))return;const o=r.pixelRatio,n=i.size*o,h=1/i.factor,m=Math.ceil(h*n);this._readbackTexture.resize(m,m);const{size:l}=r.state,d=o*l[0],u=o*l[1],c=.5*m,p=.5*m,g=Object(mathUtils[\"c\" /* clamp */])(o*i.position.x,c,d-c-1),f=Object(mathUtils[\"c\" /* clamp */])(u-o*i.position.y,p,u-p-1),b=g-c,x=f-p,y=this._readbackTexture;s.bindTexture(y,0),s.gl.copyTexImage2D(y.descriptor.target,0,y.descriptor.pixelFormat,b,x,m,m,0);const k=null==(t=this.background)?void 0:t.color,T=k?[k.a*k.r/255,k.a*k.g/255,k.a*k.b/255,k.a]:[1,1,1,1],R=(g+i.offsetX*o)/d*2-1,v=(f-i.offsetY*o)/u*2-1,w=n/d*2,j=n/u*2,M=this._program;s.bindVAO(this._vertexArrayObject),s.bindTexture(this._overlayTexture,6),s.bindTexture(this._maskTexture,7),s.bindProgram(M),M.setUniform4fv(\"u_background\",T),M.setUniform1i(\"u_readbackTexture\",0),M.setUniform1i(\"u_overlayTexture\",6),M.setUniform1i(\"u_maskTexture\",7),M.setUniform4f(\"u_drawPos\",R,v,w,j),M.setUniform1i(\"u_maskEnabled\",i.maskEnabled?1:0),M.setUniform1i(\"u_overlayEnabled\",i.overlayEnabled?1:0),s.setStencilTestEnabled(!1),s.drawArrays(5,0,4),s.bindVAO()}_canRender(){return this.mask&&this.overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const t=Object(maybe[\"h\" /* isSome */])(this._magnifier)?this._magnifier.mask:null,a=Object(maybe[\"h\" /* isSome */])(this._magnifier)?this._magnifier.overlay:null;this._resourcesTask=Object(promiseUtils[\"h\" /* createTask */])((async s=>{const n=Object(maybe[\"g\" /* isNone */])(t)||Object(maybe[\"g\" /* isNone */])(a)?resources_s(s):null,h=Object(maybe[\"h\" /* isSome */])(t)?Object(request[\"default\"])(t,{responseType:\"image\",signal:s}).then((e=>e.data)):n.then((e=>e.mask)),m=Object(maybe[\"h\" /* isSome */])(a)?Object(request[\"default\"])(a,{responseType:\"image\",signal:s}).then((e=>e.data)):n.then((e=>e.overlay)),[l,d]=await Object(promiseUtils[\"b\" /* all */])([h,m]);this.mask=l,this.overlay=d,this._disposeRenderResources(),this.requestRender()}))}_disposeRenderResources(){this._readbackTexture=Object(maybe[\"d\" /* disposeMaybe */])(this._readbackTexture),this._overlayTexture=Object(maybe[\"d\" /* disposeMaybe */])(this._overlayTexture),this._maskTexture=Object(maybe[\"d\" /* disposeMaybe */])(this._maskTexture),this._vertexArrayObject=Object(maybe[\"d\" /* disposeMaybe */])(this._vertexArrayObject),this._program=Object(maybe[\"d\" /* disposeMaybe */])(this._program)}_updateResources(e){if(e.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),this._readbackTexture)return;const r=e.context;this._resourcePixelRatio=e.pixelRatio;const t=Math.ceil(this._magnifier.size*e.pixelRatio);this._program=MagnifierPrograms_t(r);const s=new Uint16Array([0,1,0,0,1,1,1,0]),i=MagnifierPrograms_i.attributes;this._vertexArrayObject=new VertexArrayObject[\"a\" /* default */](r,i,{geometry:[{name:\"a_pos\",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:BufferObject[\"a\" /* default */].createVertex(r,35044,s)}),this.overlay.width=t,this.overlay.height=t,this._overlayTexture=new Texture[\"a\" /* default */](r,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.overlay),this.mask.width=t,this.mask.height=t,this._maskTexture=new Texture[\"a\" /* default */](r,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask);const a=1/this._magnifier.factor;this._readbackTexture=new Texture[\"a\" /* default */](r,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:Math.ceil(a*t),height:Math.ceil(a*t)})}});\n\n// CONCATENATED MODULE: ./node_modules/@arcgis/core/views/2d/mapViewDeps.js\n/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\n\n\n\n/***/ })\n\n}]);","inputSourceMap":null}