(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{"1kEK":function(t,e,n){"use strict";n.d(e,"a",function(){return i});const i={convertToGEGeometry:function(t,e){return null==e?null:t.convertJSONToGeometry(e)},exportPoint:function(t,e,n){const i=new s(t.getPointX(e),t.getPointY(e),n),r=t.hasZ(e),a=t.hasM(e);return r&&(i.z=t.getPointZ(e)),a&&(i.m=t.getPointM(e)),i},exportPolygon:function(t,e,n){return new r(t.exportPaths(e),n,t.hasZ(e),t.hasM(e))},exportPolyline:function(t,e,n){return new a(t.exportPaths(e),n,t.hasZ(e),t.hasM(e))},exportMultipoint:function(t,e,n){return new o(t.exportPoints(e),n,t.hasZ(e),t.hasM(e))},exportExtent:function(t,e,n){const i=t.hasZ(e),s=t.hasM(e),r=new u(t.getXMin(e),t.getYMin(e),t.getXMax(e),t.getYMax(e),n);if(i){const n=t.getZExtent(e);r.zmin=n.vmin,r.zmax=n.vmax}if(s){const n=t.getMExtent(e);r.mmin=n.vmin,r.mmax=n.vmax}return r}};class s{constructor(t,e,n){this.x=t,this.y=e,this.spatialReference=n,this.z=void 0,this.m=void 0}}class r{constructor(t,e,n,i){this.rings=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,n&&(this.hasZ=n),i&&(this.hasM=i)}}class a{constructor(t,e,n,i){this.paths=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,n&&(this.hasZ=n),i&&(this.hasM=i)}}class o{constructor(t,e,n,i){this.points=t,this.spatialReference=e,this.hasZ=void 0,this.hasM=void 0,n&&(this.hasZ=n),i&&(this.hasM=i)}}class u{constructor(t,e,n,i,s){this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i,this.spatialReference=s,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},"2X7Z":function(t,e,n){"use strict";function i(t,e){return t?e?4:3:e?3:2}function s(t,e,n,s,o){if(!e||!e.lengths.length)return null;const u="upperLeft"===(null==o?void 0:o.originPosition)?-1:1;t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0);const l=t.coords,c=[],h=n?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:d,coords:f}=e,m=i(n,s);let p=0;for(const i of d){const t=r(h,f,p,i,n,s,u);t&&c.push(t),p+=i*m}if(c.sort((t,e)=>{let i=u*t[2]-u*e[2];return 0===i&&n&&(i=t[4]-e[4]),i}),c.length){let t=6*c[0][2];l[0]=c[0][0]/t,l[1]=c[0][1]/t,n&&(t=6*c[0][4],l[2]=0!==t?c[0][3]/t:0),(l[0]<h[0]||l[0]>h[1]||l[1]<h[2]||l[1]>h[3]||n&&(l[2]<h[4]||l[2]>h[5]))&&(l.length=0)}if(!l.length){const t=e.lengths[0]?a(f,0,d[0],n,s):null;if(!t)return null;l[0]=t[0],l[1]=t[1],n&&t.length>2&&(l[2]=t[2])}return t}function r(t,e,n,s,r,a,o=1){const u=i(r,a);let l=n,c=n+u,h=0,d=0,f=0,m=0,p=0;for(let i=0,y=s-1;i<y;i++,l+=u,c+=u){const n=e[l],i=e[l+1],s=e[l+2],a=e[c],o=e[c+1],u=e[c+2];let g=n*o-a*i;m+=g,h+=(n+a)*g,d+=(i+o)*g,r&&(g=n*u-a*s,f+=(s+u)*g,p+=g),n<t[0]&&(t[0]=n),n>t[1]&&(t[1]=n),i<t[2]&&(t[2]=i),i>t[3]&&(t[3]=i),r&&(s<t[4]&&(t[4]=s),s>t[5]&&(t[5]=s))}if(m*o>0&&(m*=-1),p*o>0&&(p*=-1),!m)return null;const g=[h,d,.5*m];return r&&(g[3]=f,g[4]=.5*p),g}function a(t,e,n,s,r){const a=i(s,r);let h=e,d=e+a,f=0,m=0,p=0,g=0;for(let i=0,y=n-1;i<y;i++,h+=a,d+=a){const e=t[h],n=t[h+1],i=t[h+2],r=t[d],a=t[d+1],y=t[d+2],x=s?u(e,n,i,r,a,y):o(e,n,r,a);if(x)if(f+=x,s){const t=c(e,n,i,r,a,y);m+=x*t[0],p+=x*t[1],g+=x*t[2]}else{const t=l(e,n,r,a);m+=x*t[0],p+=x*t[1]}}return f>0?s?[m/f,p/f,g/f]:[m/f,p/f]:n>0?s?[t[e],t[e+1],t[e+2]]:[t[e],t[e+1]]:null}function o(t,e,n,i){const s=n-t,r=i-e;return Math.sqrt(s*s+r*r)}function u(t,e,n,i,s,r){const a=i-t,o=s-e,u=r-n;return Math.sqrt(a*a+o*o+u*u)}function l(t,e,n,i){return[t+.5*(n-t),e+.5*(i-e)]}function c(t,e,n,i,s,r){return[t+.5*(i-t),e+.5*(s-e),n+.5*(r-n)]}n.d(e,"a",function(){return s})},AIxD:function(t,e,n){"use strict";n.d(e,"a",function(){return b}),n.d(e,"b",function(){return g}),n.d(e,"c",function(){return o}),n.d(e,"d",function(){return _}),n.d(e,"e",function(){return I}),n.d(e,"f",function(){return j}),n.d(e,"g",function(){return M});var i=n("qatw");const s=(t,e,n)=>[e,n],r=(t,e,n)=>[e,n,t[2]],a=(t,e,n)=>[e,n,t[2],t[3]];function o(t){return t?{originPosition:"upper-left"===t.originPosition?"upperLeft":"lower-left"===t.originPosition?"lowerLeft":t.originPosition,scale:[t.tolerance,t.tolerance],translate:[t.extent.xmin,t.extent.ymax]}:null}function u({scale:t,translate:e},n){return Math.round((n-e[0])/t[0])}function l({scale:t,translate:e},n){return Math.round((e[1]-n)/t[1])}function c(t,e,n){const i=[];let s,r,a,o;for(let c=0;c<n.length;c++){const h=n[c];c>0?(a=u(t,h[0]),o=l(t,h[1]),a===s&&o===r||(i.push(e(h,a-s,o-r)),s=a,r=o)):(s=u(t,h[0]),r=l(t,h[1]),i.push(e(h,s,r)))}return i.length>0?i:null}function h({scale:t,translate:e},n){return n*t[0]+e[0]}function d({scale:t,translate:e},n){return e[1]-n*t[1]}function f(t,e,n){const i=new Array(n.length);if(!n.length)return i;const[s,r]=t.scale;let a=h(t,n[0][0]),o=d(t,n[0][1]);i[0]=e(n[0],a,o);for(let u=1;u<n.length;u++){const t=n[u];a+=t[0]*s,o-=t[1]*r,i[u]=e(t,a,o)}return i}function m(t,e,n){const i=new Array(n.length);for(let s=0;s<n.length;s++)i[s]=f(t,e,n[s]);return i}function p(t,e,n,i,o){return e.points=function(t,e,n,i){return c(t,n?i?a:r:i?r:s,e)}(t,n.points,i,o),e}function g(t,e,n,i,s){return e.x=u(t,n.x),e.y=l(t,n.y),e!==n&&(i&&(e.z=n.z),s&&(e.m=n.m)),e}function y(t,e,n,i,o){const u=function(t,e,n,i){const o=[],u=n?i?a:r:i?r:s;for(let s=0;s<e.length;s++){const n=c(t,u,e[s]);n&&n.length>=3&&o.push(n)}return o.length?o:null}(t,n.rings,i,o);return u?(e.rings=u,e):null}function x(t,e,n,i,o){const u=function(t,e,n,i){const o=[],u=n?i?a:r:i?r:s;for(let s=0;s<e.length;s++){const n=c(t,u,e[s]);n&&n.length>=2&&o.push(n)}return o.length?o:null}(t,n.paths,i,o);return u?(e.paths=u,e):null}function b(t,e){return t&&e?Object(i.f)(e)?g(t,{},e,!1,!1):Object(i.h)(e)?x(t,{},e,!1,!1):Object(i.g)(e)?y(t,{},e,!1,!1):Object(i.e)(e)?p(t,{},e,!1,!1):Object(i.d)(e)?((s={}).xmin=u(n=t,(r=e).xmin),s.ymin=l(n,r.ymin),s.xmax=u(n,r.xmax),s.ymax=l(n,r.ymax),s):null:null;var n,s,r}function _(t,e,n,i,o){return e.points=function(t,e,n,i){return f(t,n?i?a:r:i?r:s,e)}(t,n.points,i,o),e}function I(t,e,n,i,s){return e.x=h(t,n.x),e.y=d(t,n.y),e!==n&&(i&&(e.z=n.z),s&&(e.m=n.m)),e}function j(t,e,n,i,o){return e.rings=function(t,e,n,i){return m(t,n?i?a:r:i?r:s,e)}(t,n.rings,i,o),e}function M(t,e,n,i,o){return e.paths=function(t,e,n,i){return m(t,n?i?a:r:i?r:s,e)}(t,n.paths,i,o),e}},BUoz:function(t,e,n){"use strict";n.r(e);var i=n("zlDU"),s=n("9MzC"),r=n("f4Nx"),a=n("qatw"),o=n("wdpY"),u=n("Lqtk"),l=n("Z4F+"),c=n("ZlUD"),h=n("gLc9"),d=n("HsO1"),f=n("46M0"),m=n("iNG6"),p=n("ZRfE"),g=n("ZBG3"),y=n("IcpP");const x={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsPercentileStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}};e.default=class{constructor(){this._queryEngine=null}destroy(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=this._requiredFields=this._fieldsIndex=this._createDefaultAttributes=null}async load(t){const e=[];await this._checkProjection(t.spatialReference);let n=null;t.url&&(n=(await Object(u.default)(t.url,{responseType:"json"})).data,await Object(f.c)(n));const s=Object(f.b)(n,{geometryType:t.geometryType}),a=t.fields||s.fields||[],y=null!=t.hasZ?t.hasZ:s.hasZ,b=s.geometryType,_=t.objectIdField||("number"===s.objectIdFieldType?s.objectIdFieldName:"OBJECTID")||"OBJECTID",I=t.spatialReference||r.a;let j=t.timeInfo;if(!b)throw new i.a("geojson-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");if("string"===s.objectIdFieldType&&e.push({name:"geojson-layer:unsupported-id-type",message:"Feature ids are of type string and can't be honored."}),a===s.fields&&s.unknownFields.length>0&&e.push({name:"geojson-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:s.unknownFields}}),_){let t=null;a.some(e=>e.name===_&&(t=e,!0))?(t.type="esriFieldTypeOID",t.editable=!1,t.nullable=!1):a.unshift({alias:_,name:_,type:"esriFieldTypeOID",editable:!1,nullable:!1})}for(const r of a){if(null==r.name&&(r.name=r.alias),null==r.alias&&(r.alias=r.name),!r.name)throw new i.a("geojson-layer:invalid-field-name","field name is missing",{field:r});if(r.name===_&&(r.type="esriFieldTypeOID"),-1===l.a.jsonValues.indexOf(r.type))throw new i.a("geojson-layer:invalid-field-type",`invalid type for field "${r.name}"`,{field:r})}const M={};this._requiredFields=[];for(const i of a)if("esriFieldTypeOID"!==i.type&&"esriFieldTypeGlobalID"!==i.type){i.editable=null==i.editable||!!i.editable,i.nullable=null==i.nullable||!!i.nullable;const t=Object(o.o)(i);i.nullable||void 0!==t?M[i.name]=t:this._requiredFields.push(i)}if(this._fieldsIndex=new h.a(a),j){if(j.startTimeField){const t=this._fieldsIndex.get(j.startTimeField);t?(j.startTimeField=t.name,t.type="esriFieldTypeDate"):j.startTimeField=null}if(j.endTimeField){const t=this._fieldsIndex.get(j.endTimeField);t?(j.endTimeField=t.name,t.type="esriFieldTypeDate"):j.endTimeField=null}if(j.trackIdField){const t=this._fieldsIndex.get(j.trackIdField);t?j.trackIdField=t.name:(j.trackIdField=null,e.push({name:"geojson-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:j}}))}j.startTimeField||j.endTimeField||(e.push({name:"geojson-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:j}}),j=null)}const O={warnings:e,featureErrors:[],layerDefinition:{...x,drawingInfo:Object(m.c)(b),templates:Object(m.b)(M),extent:null,geometryType:b,objectIdField:_,fields:a,hasZ:!!y,timeInfo:j}};this._queryEngine=new g.a({fields:a,geometryType:b,hasM:!1,hasZ:y,objectIdField:_,spatialReference:I,timeInfo:j,featureStore:new p.a({geometryType:b,hasM:!1,hasZ:y})}),this._createDefaultAttributes=Object(m.a)(M,_),this._nextObjectId=s.maxObjectId+1;const F=Object(f.a)(n,{geometryType:b,hasZ:y,objectIdFieldName:"number"===s.objectIdFieldType?_:null});if(!Object(r.c)(I,r.a))for(const i of F)i.geometry&&(i.geometry=Object(c.d)(Object(d.b)(Object(c.k)(i.geometry,b,y,!1),r.a,I)));return this._loadInitialFeatures(O,F),O}async applyEdits(t){const{spatialReference:e,geometryType:n}=this._queryEngine;return await Object(s.b)([Object(y.c)(e,n),Object(d.a)(t.adds,e),Object(d.a)(t.updates,e)]),this._applyEdits(t)}async queryFeatures(t={},e={}){return this._queryEngine.executeQuery(t,e.signal)}async queryFeatureCount(t={},e={}){return this._queryEngine.executeQueryForCount(t,e.signal)}async queryObjectIds(t={},e={}){return this._queryEngine.executeQueryForIds(t,e.signal)}async queryExtent(t={},e={}){return this._queryEngine.executeQueryForExtent(t,e.signal)}_loadInitialFeatures(t,e){const{featureStore:n,objectIdField:i}=this._queryEngine,s=[];for(const r of e){const e=this._createDefaultAttributes(),n=Object(y.d)(this._fieldsIndex,this._requiredFields,e,r.attributes,!0,t.warnings);n?t.featureErrors.push(n):(this._assignObjectId(e,r.attributes,!0),r.attributes=e,r.objectId=e[i],s.push(r))}if(n.addMany(s),t.layerDefinition.extent=this._queryEngine.fullExtent,t.layerDefinition.timeInfo){const{start:e,end:n}=this._queryEngine.timeExtent;t.layerDefinition.timeInfo.timeExtent=[e,n]}return t}_applyEdits(t){const{adds:e,updates:n,deletes:i}=t,s={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(e&&e.length&&this._applyAddEdits(s,e),n&&n.length&&this._applyUpdateEdits(s,n),i&&i.length){for(const t of i)s.deleteResults.push(Object(y.b)(t));this._queryEngine.featureStore.removeManyById(i)}return{fullExtent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent,featureEditResults:s}}_applyAddEdits(t,e){const{addResults:n}=t,{geometryType:i,hasM:s,hasZ:r,objectIdField:o,spatialReference:u,featureStore:l}=this._queryEngine,h=[];for(const c of e){if(c.geometry&&i!==Object(a.c)(c.geometry)){n.push(Object(y.a)("Incorrect geometry type."));continue}const e=this._createDefaultAttributes(),s=Object(y.d)(this._fieldsIndex,this._requiredFields,e,c.attributes);s?n.push(s):(this._assignObjectId(e,c.attributes),c.attributes=e,null!=c.uid&&(t.uidToObjectId[c.uid]=c.attributes[o]),c.geometry&&(c.geometry=Object(d.b)(Object(y.e)(c.geometry,u),c.geometry.spatialReference,u)),h.push(c),n.push(Object(y.b)(c.attributes[o])))}l.addMany(Object(c.c)([],h,i,r,s,o))}_applyUpdateEdits({updateResults:t},e){const{geometryType:n,hasM:i,hasZ:s,objectIdField:r,spatialReference:o,featureStore:u}=this._queryEngine;for(const l of e){const{attributes:e,geometry:h}=l,f=e&&e[r];if(null==f){t.push(Object(y.a)(`Identifier field ${r} missing`));continue}if(!u.has(f)){t.push(Object(y.a)(`Feature with object id ${f} missing`));continue}const m=Object(c.i)(u.getFeature(f),n,s,i);if(h){if(n!==Object(a.c)(h)){t.push(Object(y.a)("Incorrect geometry type."));continue}m.geometry=Object(d.b)(Object(y.e)(h,o),h.spatialReference,o)}if(e){const n=Object(y.d)(this._fieldsIndex,this._requiredFields,m.attributes,e);if(n){t.push(n);continue}}u.add(Object(c.a)(m,n,s,i,r)),t.push(Object(y.b)(f))}}_assignObjectId(t,e,n=!1){const i=this._queryEngine.objectIdField;t[i]=n&&isFinite(e[i])?e[i]:this._nextObjectId++}async _checkProjection(t){try{await Object(d.a)(r.a,t)}catch{throw new i.a("geojson-layer","Projection not supported")}}}},HsO1:function(t,e,n){"use strict";n.d(e,"a",function(){return d}),n.d(e,"b",function(){return p}),n.d(e,"c",function(){return y});var i=n("9MzC"),s=n("f4Nx"),r=n("l4ZG"),a=n("gYg2"),o=n("1kEK");const u=[0,0];function l(t,e){if(!e)return null;if("x"in e){const n={x:0,y:0};return[n.x,n.y]=t(e.x,e.y,u),null!=e.z&&(n.z=e.z),null!=e.m&&(n.m=e.m),n}if("xmin"in e){const n={xmin:0,ymin:0,xmax:0,ymax:0};return[n.xmin,n.ymin]=t(e.xmin,e.ymin,u),[n.xmax,n.ymax]=t(e.xmax,e.ymax,u),e.hasZ&&(n.zmin=e.zmin,n.zmax=e.zmax,n.hasZ=!0),e.hasM&&(n.mmin=e.mmin,n.mmax=e.mmax,n.hasM=!0),n}return"rings"in e?{rings:c(e.rings,t),hasM:e.hasM,hasZ:e.hasZ}:"paths"in e?{paths:c(e.paths,t),hasM:e.hasM,hasZ:e.hasZ}:"points"in e?{points:h(e.points,t),hasM:e.hasM,hasZ:e.hasZ}:void 0}function c(t,e){const n=[];for(const i of t)n.push(h(i,e));return n}function h(t,e){const n=[];for(const i of t){const t=e(i[0],i[1],[0,0]);n.push(t),i.length>2&&t.push(i[2]),i.length>3&&t.push(i[3])}return n}async function d(t,e){if(!e)return;const n=Array.isArray(t)?t.map(t=>{var e;return null==(e=t.geometry)?void 0:e.spatialReference}):[t];await Object(a.b)(n.map(t=>({source:t,dest:e})))}const f=l.bind(null,r.c),m=l.bind(null,r.f);function p(t,e,n){return t?(n||(n=e,e=t.spatialReference),Object(s.i)(e)&&Object(s.i)(n)&&!Object(s.c)(e,n)?Object(r.a)(e,n)?Object(s.m)(n)?f(t):m(t):Object(a.h)(o.a,[t],e,n,null)[0]:t):t}const g=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(t,e,n){!t||!t.length||!e||!n||Object(s.c)(e,n);const r={geometries:t,inSpatialReference:e,outSpatialReference:n,resolve:null};return this._jobs.push(r),Object(i.c)(t=>{r.resolve=t,null===this._timer&&(this._timer=setTimeout(this._process,10))})}_process(){this._timer=null;const t=this._jobs.shift();if(!t)return;const{geometries:e,inSpatialReference:n,outSpatialReference:i,resolve:u}=t;Object(r.a)(n,i)?Object(s.m)(i)?u(e.map(f)):u(e.map(m)):u(Object(a.h)(o.a,e,n,i,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};async function y(t,e,n){return g.push(t,e,n)}},RjdO:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var i=n("X2wA"),s=Object(i.b)(function(t){var e;void 0!==(e=function(){function t(n,i,s,r,a){for(;r>s;){if(r-s>600){var o=r-s+1,u=i-s+1,l=Math.log(o),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(o-c)/o)*(u-o/2<0?-1:1);t(n,i,Math.max(s,Math.floor(i-u*c/o+h)),Math.min(r,Math.floor(i+(o-u)*c/o+h)),a)}var d=n[i],f=s,m=r;for(e(n,s,i),a(n[r],d)>0&&e(n,s,r);f<m;){for(e(n,f,m),f++,m--;a(n[f],d)<0;)f++;for(;a(n[m],d)>0;)m--}0===a(n[s],d)?e(n,s,m):e(n,++m,r),m<=i&&(s=m+1),i<=m&&(r=m-1)}}function e(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function n(t,e){return t<e?-1:t>e?1:0}return function(e,i,s,r,a){t(e,i,s||0,r||e.length-1,a||n)}}())&&(t.exports=e)})},"kB+0":function(t,e,n){"use strict";n.d(e,"a",function(){return s});var i=n("RjdO");function s(t,e){if(!(this instanceof s))return new s(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&("function"==typeof e?this.toBBox=e:this._initFormat(e)),this.clear()}function r(t,e,n){if(!n)return e.indexOf(t);for(var i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function a(t,e){o(t,0,t.children.length,e,t)}function o(t,e,n,i,s){s||(s=p(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var r,a=e;a<n;a++)r=t.children[a],u(s,t.leaf?i(r):r);return s}function u(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function h(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function d(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function m(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,e,n,s,r){for(var a,o=[e,n];o.length;)(n=o.pop())-(e=o.pop())<=s||(a=e+Math.ceil((n-e)/s/2)*s,Object(i.a)(t,a,e,n,r),o.push(e,a,a,n))}s.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],i=this.toBBox;if(!m(t,e))return n;for(var s,r,a,o,u=[];e;){for(s=0,r=e.children.length;s<r;s++)a=e.children[s],m(t,o=e.leaf?i(a):a)&&(e.leaf?n.push(a):f(t,o)?this._all(a,n):u.push(a));e=u.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!m(t,e))return!1;for(var i,s,r,a,o=[];e;){for(i=0,s=e.children.length;i<s;i++)if(r=e.children[i],m(t,a=e.leaf?n(r):r)){if(e.leaf||f(t,a))return!0;o.push(r)}e=o.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=p([]),this},remove:function(t,e){if(!t)return this;for(var n,i,s,a,o=this.data,u=this.toBBox(t),l=[],c=[];o||l.length;){if(o||(o=l.pop(),i=l[l.length-1],n=c.pop(),a=!0),o.leaf&&-1!==(s=r(t,o.children,e)))return o.children.splice(s,1),l.push(o),this._condense(l),this;a||o.leaf||!f(o,u)?i?(n++,o=i.children[n],a=!1):o=null:(l.push(o),c.push(n),n=0,i=o,o=o.children[0])}return this},toBBox:function(t){return t},compareMinX:l,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,i){var s,r=n-e+1,o=this._maxEntries;if(r<=o)return a(s=p(t.slice(e,n+1)),this.toBBox),s;i||(i=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,i-1))),(s=p([])).leaf=!1,s.height=i;var u,l,c,h,d=Math.ceil(r/o),f=d*Math.ceil(Math.sqrt(o));for(g(t,e,n,f,this.compareMinX),u=e;u<=n;u+=f)for(g(t,u,c=Math.min(u+f-1,n),d,this.compareMinY),l=u;l<=c;l+=d)h=Math.min(l+d-1,c),s.children.push(this._build(t,l,h,i-1));return a(s,this.toBBox),s},_chooseSubtree:function(t,e,n,i){for(var s,r,a,o,u,l,c,d,f,m;i.push(e),!e.leaf&&i.length-1!==n;){for(c=d=1/0,s=0,r=e.children.length;s<r;s++)u=h(a=e.children[s]),f=t,m=a,(l=(Math.max(m.maxX,f.maxX)-Math.min(m.minX,f.minX))*(Math.max(m.maxY,f.maxY)-Math.min(m.minY,f.minY))-u)<d?(d=l,c=u<c?u:c,o=a):l===d&&u<c&&(c=u,o=a);e=o||e.children[0]}return e},_insert:function(t,e,n){var i=n?t:(0,this.toBBox)(t),s=[],r=this._chooseSubtree(i,this.data,e,s);for(r.children.push(t),u(r,i);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(i,s,e)},_split:function(t,e){var n=t[e],i=n.children.length,s=this._minEntries;this._chooseSplitAxis(n,s,i);var r=this._chooseSplitIndex(n,s,i),o=p(n.children.splice(r,n.children.length-r));o.height=n.height,o.leaf=n.leaf,a(n,this.toBBox),a(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(n,o)},_splitRoot:function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var i,s,r,a,u,l,c,d,f,m,p,g,y,x;for(l=c=1/0,i=e;i<=n-e;i++)f=s=o(t,0,i,this.toBBox),m=r=o(t,i,n,this.toBBox),p=Math.max(f.minX,m.minX),g=Math.max(f.minY,m.minY),y=Math.min(f.maxX,m.maxX),x=Math.min(f.maxY,m.maxY),a=Math.max(0,y-p)*Math.max(0,x-g),u=h(s)+h(r),a<l?(l=a,d=i,c=u<c?u:c):a===l&&u<c&&(c=u,d=i);return d},_chooseSplitAxis:function(t,e,n){var i=t.leaf?this.compareMinX:l,s=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,s)&&t.children.sort(i)},_allDistMargin:function(t,e,n,i){t.children.sort(i);var s,r,a=this.toBBox,l=o(t,0,e,a),c=o(t,n-e,n,a),h=d(l)+d(c);for(s=e;s<n-e;s++)r=t.children[s],u(l,t.leaf?a(r):r),h+=d(l);for(s=n-e-1;s>=e;s--)r=t.children[s],u(c,t.leaf?a(r):r),h+=d(c);return h},_adjustParentBBoxes:function(t,e,n){for(var i=n;i>=0;i--)u(e[i],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():a(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}}}]);