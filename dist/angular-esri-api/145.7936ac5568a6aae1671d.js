(window.webpackJsonp=window.webpackJsonp||[]).push([[145],{O5Ly:function(e,t,n){"use strict";n.r(t),n.d(t,"load",function(){return c});var r=n("zlDU"),a=n("9MzC"),l=n("Lqtk"),o=n("AiS/"),i=n("YOx9"),u=n("Fewv"),s=n("oLSx");async function c(e,t){const n=e.instance.portalItem;return n&&n.id?(await n.load(t),function(e){const t=e.instance.portalItem;if(-1===e.supportedTypes.indexOf(t.type))throw new r.a("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t.type,expectedType:e.supportedTypes.join(", ")})}(e),async function(e,t){const n=e.instance,o=n.portalItem,{url:c,title:d}=o,m=Object(u.a)(o);if("group"===n.type)return n.read({title:d},m),function(e,t){let n;const o=e.portalItem.type;switch(o){case"Feature Service":n=s.a.FeatureLayer;break;case"Stream Service":n=s.a.StreamLayer;break;case"Scene Service":n=s.a.SceneLayer;break;case"Feature Collection":n=s.a.FeatureLayer;break;default:throw new r.a("portal:unsupported-item-type-as-group",`The item type '${o}' is not supported as a 'GroupLayer'`)}let i;return n().then(e=>(i=e,y(t))).then(t=>f(t)>0?p(e,i,t):function(e,t){return e.portalItem.url?Object(l.default)(e.portalItem.url,{responseType:"json",query:{f:"json"}}).then(n=>{var r,a;const l=n.data;function o(e){return{id:e.id,name:e.name}}l&&p(e,t,{layers:null==(r=l.layers)?void 0:r.map(o),tables:null==(a=l.tables)?void 0:a.map(o)})}):Object(a.u)()}(e,i))}(n,e);c&&n.read({url:c},m);const h=await y(e,t);return h&&n.read(h,m),n.resourceReferences={portalItem:o,paths:m.readResourcePaths},n.read({title:d},m),Object(i.a)(n,m)}(e,t)):Object(a.u)()}function p(e,t,n){let r=n.layers||[];const a=n.tables||[];"Feature Collection"===e.portalItem.type&&(r.forEach(e=>{var t;"Table"===(null==e||null==(t=e.layerDefinition)?void 0:t.type)&&a.push(e)}),r=r.filter(e=>{var t;return"Table"!==(null==e||null==(t=e.layerDefinition)?void 0:t.type)})),r.reverse().forEach(r=>{const a=d(e,t,n,r);e.add(a)}),a.reverse().forEach(r=>{const a=d(e,t,n,r);e.tables.add(a)})}function d(e,t,n,r){const a=new t({portalItem:e.portalItem.clone(),layerId:r.id,sublayerTitleMode:"service-name"});if("Feature Collection"===e.portalItem.type){const t={origin:"portal-item",portal:e.portalItem.portal||o.a.getDefault()};a.read(r,t);const l=n.showLegend;null!=l&&a.read({showLegend:l},t)}return a}function y(e,t){if(!1===e.supportsData)return Object(a.u)();const n=e.instance;return n.portalItem.fetchData("json",t).catch(()=>null).then(e=>{const t=e;let r;if(function(e){return"stream"!==e.type&&"layerId"in e}(n)){let a=!0;return e&&f(t)>0&&(null==n.layerId&&(n.layerId=function(e){const t=e.layers;if(t&&t.length)return t[0].id;const n=e.tables;return n&&n.length?n[0].id:null}(t)),r=function(e,t){const n=e.layers;if(n)for(let a=0;a<n.length;a++)if(n[a].id===t)return n[a];const r=e.tables;if(r)for(let a=0;a<r.length;a++)if(r[a].id===t)return r[a];return null}(t,n.layerId),r&&(1===f(t)&&(a=!1),null!=e.showLegend&&(r.showLegend=e.showLegend))),a&&"service-name"!==n.sublayerTitleMode&&(n.sublayerTitleMode="item-title-and-service-name"),r}return e})}function f(e){var t,n,r,a;return(null!=(t=null==e||null==(n=e.layers)?void 0:n.length)?t:0)+(null!=(r=null==e||null==(a=e.tables)?void 0:a.length)?r:0)}}}]);