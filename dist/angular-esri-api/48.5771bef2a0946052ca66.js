(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{"6BjF":function(e,t,a){"use strict";a.r(t);var i=a("pO5D"),s=(a("wSAH"),a("6S2I")),r=(a("zqDF"),a("WbKI")),n=a("04ZG"),o=(a("4EHJ"),a("ju1D"),a("9AIY"),a("9MzC")),p=a("N5XI"),l=a("bHqs"),c=a("cM4j"),d=a("NloG"),u=a("6UvW"),h=a("srIe"),b=a("zlDU"),y=a("gvqN"),O=a("U282"),m=a("rXMu");const j=e=>{let t=class extends e{async fetchPopupFeatures(e,t){const{layer:a}=this;if(!e)return Object(o.t)(new b.a("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:a}));const i=this.get("view.scale"),s=[],r=async e=>{if(e.visible&&(0===e.minScale||i<=e.minScale)&&(0===e.maxScale||i>=e.maxScale))if(e.sublayers)e.sublayers.forEach(r);else if(e.popupEnabled){const a=Object(m.a)(e,{...t,defaultPopupTemplateEnabled:!1});Object(h.h)(a)&&s.push({sublayer:e,popupTemplate:a})}},n=a.sublayers.toArray().map(r);await Object(o.b)(n);const p=s.map(async({sublayer:a,popupTemplate:i})=>{await a.load().catch(()=>{});const s=a.createQuery(),r=Object(h.h)(t)?t.event:null,n=Object(O.a)({renderer:a.renderer,event:r}),o=this.createFetchPopupFeaturesQueryGeometry(e,n);s.geometry=o,s.outFields=await Object(m.b)(a,i);const p=await this._loadArcadeModules(i);return p&&p.arcadeUtils.hasGeometryOperations(i)||(s.maxAllowableOffset=o.width/n),(await a.queryFeatures(s)).features});return(await Object(o.j)(p)).reduce((e,t)=>t.value?[...e,...t.value]:e,[]).filter(e=>null!=e)}canResume(){var e,t;return!(!super.canResume()||null!=(e=this.imageParameters)&&null!=(t=e.timeExtent)&&t.isEmpty)}_loadArcadeModules(e){if(e.get("expressionInfos.length"))return Object(y.e)()}};return Object(i.a)([Object(r.b)()],t.prototype,"imageParameters",void 0),Object(i.a)([Object(r.b)()],t.prototype,"layer",void 0),Object(i.a)([Object(r.b)({dependsOn:["imageParameters.timeExtent"]})],t.prototype,"suspended",void 0),t=Object(i.a)([Object(n.a)("esri.views.layers.MapImageLayerView")],t),t};var v=a("LTnl"),g=a("Vm2Q"),f=a("vbiG");const w=s.a.getLogger("esri.views.2d.layers.MapImageLayerView2D");let x=class extends(j(Object(l.a)(Object(g.a)(d.a)))){constructor(){super(...arguments),this._exportImageVersion=-1}hitTest(){return null}update(e){this.strategy.update(e).catch(e=>{Object(o.n)(e)||w.error(e)})}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:a}=this.layer,i=a>=10.3,s=a>=10;this._bitmapContainer=new v.a,this.container.addChild(this._bitmapContainer),this.strategy=new f.a({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:i,imageNormalizationSupported:s,hidpi:!0}),this.imageParameters=new c.a({view:this.view,layer:this.layer}),this.handles.add(Object(p.a)(this.imageParameters,"version",e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())}),"mapimagelayerview-update")}detach(){this.strategy.destroy(),this.handles.remove("mapimagelayerview-update"),this.imageParameters.destroy(),this.imageParameters=null,this._exportImageVersion=-1,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return Object(u.a)(e,t,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,a,i){return this.layer.fetchImage(e,t,a,{timeExtent:this.imageParameters.timeExtent,timestamp:this.refreshTimestamp,...i})}};Object(i.a)([Object(r.b)()],x.prototype,"strategy",void 0),Object(i.a)([Object(r.b)({dependsOn:["strategy.updating"]})],x.prototype,"updating",void 0),x=Object(i.a)([Object(n.a)("esri.views.2d.layers.MapImageLayerView2D")],x),t.default=x},"6UvW":function(e,t,a){"use strict";a.d(t,"a",function(){return n});var i=a("srIe"),s=a("OvF4"),r=(a("4GrV"),a("gEht"));function n(e,t,a,n=new s.a){let o;if("2d"===a.type)o=t*a.resolution;else if("3d"===a.type){const s=a.overlayPixelSizeInMapUnits(e),n=a.basemapSpatialReference;o=Object(i.h)(n)&&!n.equals(a.spatialReference)?Object(r.c)(n)/Object(r.c)(a.spatialReference):t*s}const p=e.x-o,l=e.y-o,c=e.x+o,d=e.y+o,{spatialReference:u}=a;return n.xmin=Math.min(p,c),n.ymin=Math.min(l,d),n.xmax=Math.max(p,c),n.ymax=Math.max(l,d),n.spatialReference=u,n}a("U282"),new s.a},NloG:function(e,t,a){"use strict";var i=a("pO5D"),s=(a("wSAH"),a("6S2I")),r=(a("zqDF"),a("WbKI")),n=a("04ZG"),o=(a("4EHJ"),a("ju1D"),a("9AIY"),a("/CmD")),p=a("zm0L"),l=a("pdg3"),c=a("+rMe"),d=a("kJYu");let u=class extends(Object(d.b)(Object(l.a)(Object(c.b)(p.a.EventedMixin(o.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",a=this.layer&&this.layer.title||"no title";throw s.a.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${a}', id: '${t}')`,e),e}})}get fullOpacity(){const e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(i.a)([Object(r.b)({dependsOn:["layer.opacity","parent.fullOpacity"]})],u.prototype,"fullOpacity",null),Object(i.a)([Object(r.b)()],u.prototype,"layer",void 0),Object(i.a)([Object(r.b)()],u.prototype,"parent",void 0),Object(i.a)([Object(r.b)({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],u.prototype,"suspended",null),Object(i.a)([Object(r.b)({readOnly:!0,dependsOn:["visible","layer.loaded","parent.suspended","view?.ready"]})],u.prototype,"suspendInfo",null),Object(i.a)([Object(r.b)({readOnly:!0,dependsOn:["suspended","layer.legendEnabled?"]})],u.prototype,"legendEnabled",null),Object(i.a)([Object(r.b)({type:Boolean,dependsOn:["updatingHandles.updating"],readOnly:!0})],u.prototype,"updating",null),Object(i.a)([Object(r.b)({dependsOn:["layer.visible"]})],u.prototype,"visible",null),u=Object(i.a)([Object(n.a)("esri.views.layers.LayerView")],u),t.a=u},U282:function(e,t,a){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function s(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,a=0;for(let i=0;i<e.length;i++){const s=e[i].size;"number"==typeof s&&(t+=s,a++)}return t/a}(e.stops):t}function r(e){const t=e&&e.renderer,a="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return a;const r="visualVariables"in t?function(e,t){if(!t)return e;const a=t.filter(e=>"size"===e.type).map(t=>{const{maxSize:a,minSize:i}=t;return(s(a,e)+s(i,e))/2});let i=0;const r=a.length;if(0===r)return e;for(let s=0;s<r;s++)i+=a[s];const n=Math.floor(i/r);return Math.max(n,e)}(a,t.visualVariables):a;if("simple"===t.type)return i(r,t.symbol);if("unique-value"===t.type){let e=r;return t.uniqueValueInfos.forEach(t=>{e=i(e,t.symbol)}),e}if("class-breaks"===t.type){let e=r;return t.classBreakInfos.forEach(t=>{e=i(e,t.symbol)}),e}return r}a.d(t,"a",function(){return r})},Vm2Q:function(e,t,a){"use strict";a.d(t,"a",function(){return M});var i=a("pO5D"),s=(a("wSAH"),a("6S2I"),a("zqDF"),a("WbKI")),r=a("04ZG"),n=(a("4EHJ"),a("ju1D"),a("9AIY"),a("LE9a")),o=a("fX31"),p=a("N5XI"),l=a("ag7Y");let c=class extends l.a{};c=Object(i.a)([Object(r.a)("esri.views.layers.support.ClipArea")],c);var d,u=c;let h=d=class extends u{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new d({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};Object(i.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],h.prototype,"left",void 0),Object(i.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],h.prototype,"right",void 0),Object(i.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],h.prototype,"top",void 0),Object(i.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],h.prototype,"bottom",void 0),Object(i.a)([Object(s.b)({readOnly:!0,dependsOn:["left","right","top","bottom"]})],h.prototype,"version",null),h=d=Object(i.a)([Object(r.a)("esri.views.layers.support.ClipRect")],h);var b,y=h,O=a("AMBt"),m=a("N2DF"),j=a("OvF4"),v=a("Ehki"),g=a("qatw");a("4GrV");const f={base:m.a,key:"type",typeMap:{extent:j.a,polygon:v.a}};let w=b=class extends u{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new b({geometry:this.geometry.clone()})}};Object(i.a)([Object(s.b)({types:f,json:{read:g.a,write:!0}})],w.prototype,"geometry",void 0),Object(i.a)([Object(s.b)({readOnly:!0,dependsOn:["geometry"]})],w.prototype,"version",null),w=b=Object(i.a)([Object(r.a)("esri.views.layers.support.Geometry")],w);var x=w;let I=class extends u{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(i.a)([Object(s.b)({type:[[[Number]]],json:{write:!0}})],I.prototype,"path",void 0),Object(i.a)([Object(s.b)({readOnly:!0,dependsOn:["path"]})],I.prototype,"version",null),I=Object(i.a)([Object(r.a)("esri.views.layers.support.Path")],I);const q=n.a.ofType({key:"type",base:u,typeMap:{rect:y,path:I,geometry:x}}),M=e=>{let t=class extends e{constructor(){super(...arguments),this.clips=new q,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new O.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(p.a)(this,"suspended",e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},!0),Object(p.a)(this,["layer.opacity","container"],()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)},!0),Object(p.a)(this,["layer.blendMode"],e=>{this.container&&(this.container.blendMode=e)},!0),Object(p.a)(this,["layer.effect"],e=>{this.container&&(this.container.effect=e)},!0),this.clips.on("change",()=>{this.container.clips=this.clips,this.notifyChange("clips")})]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{}):this.when().then(()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)},()=>{})}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){let t=!0;const a=this.layer,i=a.minScale,s=a.maxScale;if(null!=i&&null!=s){let a=!i,r=!s;!a&&e<=i&&(a=!0),!r&&e>=s&&(r=!0),t=a&&r}return t}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(i.a)([Object(s.b)({type:q,set(e){const t=Object(o.b)(e,this._get("clips"),q);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(i.a)([Object(s.b)()],t.prototype,"moving",void 0),Object(i.a)([Object(s.b)()],t.prototype,"attached",void 0),Object(i.a)([Object(s.b)()],t.prototype,"container",void 0),Object(i.a)([Object(s.b)({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),Object(i.a)([Object(s.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(i.a)([Object(s.b)()],t.prototype,"updateRequested",void 0),Object(i.a)([Object(s.b)({dependsOn:["attached","updateRequested","suspended"]})],t.prototype,"updating",null),Object(i.a)([Object(s.b)()],t.prototype,"view",void 0),t=Object(i.a)([Object(r.a)("esri.views.2d.layers.LayerView2D")],t),t}},rXMu:function(e,t,a){"use strict";a.d(t,"a",function(){return n}),a.d(t,"b",function(){return r});var i=a("srIe"),s=a("wdpY");async function r(e,t=e.popupTemplate){if(!Object(i.h)(t))return[];const a=await t.getRequiredFields(e.fields),{lastEditInfoEnabled:r}=t,{objectIdField:n,typeIdField:o,globalIdField:p,relationships:l}=e;if(a.includes("*"))return["*"];const c=r?await Object(s.m)(e):[],d=Object(s.i)(e.fields,[...a,...c]);return o&&d.push(o),d&&n&&Object(s.p)(e.fields,n)&&-1===d.indexOf(n)&&d.push(n),d&&p&&Object(s.p)(e.fields,p)&&-1===d.indexOf(p)&&d.push(p),l&&l.forEach(t=>{const{keyField:a}=t;d&&a&&Object(s.p)(e.fields,a)&&-1===d.indexOf(a)&&d.push(a)}),d}function n(e,t){return e.popupTemplate?e.popupTemplate:Object(i.h)(t)&&t.defaultPopupTemplateEnabled&&Object(i.h)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);