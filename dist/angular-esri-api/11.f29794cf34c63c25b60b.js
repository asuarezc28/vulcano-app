(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{M08Z:function(e,t,i){"use strict";i.d(t,"a",function(){return S}),i.d(t,"b",function(){return q}),i.d(t,"c",function(){return P}),i.d(t,"d",function(){return k}),i.d(t,"e",function(){return B}),i.d(t,"f",function(){return I}),i.d(t,"g",function(){return v}),i.d(t,"h",function(){return R}),i.d(t,"i",function(){return H}),i("wSAH");var s=i("srIe"),r=i("f4Nx"),n=i("WZb1"),a=i("PNY3"),o=i("KLE9"),c=i("qatw"),h=i("qRWG"),d=i("kYAx"),l=i("qNUd"),u=i("M0lq"),p=i("opr1"),g=i("LGNZ"),b=i("c46T"),m=i("Mt1D"),y=i("G0q+"),f=i("t7mB"),_=i("eT81");const O=Math.PI/180,j=Object(g.a)(),x=Object(b.a)(),w=Object(d.d)();function S(e,t,i,s,n,a,h){if(!s||!i.symbol)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;const d=s;if(!Object(c.f)(d)){Object(o.a)(e,d);let s=t[0];0===s&&(s=D(i),t[0]=s);const r=n*s/2;return e[0]-=r,e[1]-=r,e[2]+=r,e[3]+=r,e}{const s=d.x,o=d.y;"esriTS"===i.symbol.type&&0===t[2]&&0===t[3]&&B(t,i.symbol,i.mosaicItem),function(e,t,i,s,n,a,o,c){let h;switch(s.type){case"esriSMS":case"esriPMS":h=P(t,i,s,a,o,0);break;case"esriTS":h=k(t,i,s,n,a,0);break;case"cim":case"CIMSymbolReference":case"expanded-cim":h=q(t,i,s,a,o,0)}let d,u,p=0;for(let r=0;r<h.rings[0].length-1;r++)u=h.rings[0][r],d=(t-u[0])*(t-u[0])+(i-u[1])*(i-u[1]),p=Math.max(p,d);p=Math.sqrt(p);let g=Object(l.b)(t-p,c),b=Object(l.b)(t+p,c);if(g>b){const e=Object(r.d)(c);if(e){const[t,i]=e.valid;g=t,b=i}}e[0]=g,e[1]=i-p,e[2]=b,e[3]=i+p}(e,s,o,i.symbol,t,n,a,h)}return e}function v(e){return"simple-marker"===e||"picture-marker"===e||"text"===e}function I(e){switch(Object(s.n)(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}const G=Object(b.a)(),T=Object(b.a)(),M=Object(b.a)(),U=Object(b.a)(),z=Object(b.a)(),A=Object(b.a)(),C=Object(b.a)();function R(e,t,i,s){Object(u.m)(M,t,i);const r=e.paths;let n,a,o,c,h,d,l,p,g,b=1/0;for(let m=0;m<r.length;m++){const e=r[m];if(!(e.length<2))for(let r=1;r<e.length;r++)n=e[r-1][0],o=e[r-1][1],a=e[r][0],c=e[r][1],h=Math.min(n,a)-s,d=Math.min(o,c)-s,l=Math.max(n,a)+s,p=Math.max(o,c)+s,t<h||t>l||i<d||i>p||(Object(u.m)(G,n,o),Object(u.m)(T,a,c),Object(u.d)(U,T,G),Object(u.d)(z,G,M),Object(u.a)(A,U,Object(u.g)(U,z)/Object(u.g)(U,U)),Object(u.d)(C,z,A),g=Object(u.g)(C,C),b>g&&(b=g))}return Math.sqrt(b)<=s}function P(e,t,i,s,r,n){let a,o;const c=Object(h.d)(i.xoffset),d=Object(h.d)(i.yoffset),l=O*i.angle,g=O*n;switch(i.type){case"esriSMS":a=o=Object(h.d)(i.size);break;case"esriPMS":a=Object(h.d)(i.width),o=Object(h.d)(i.height)}r<.04&&(s=.04*s/r);const b=Object(p.d)(j);Object(p.h)(b,b,Object(u.m)(x,e,t)),Object(p.f)(b,b,g-l),Object(p.g)(b,b,Object(u.m)(x,s,-s)),Object(p.h)(b,b,Object(u.m)(x,c,-d));const m=[0,0];Object(u.n)(m,Object(u.m)(x,-.5*a,-.5*o),b);const y=[0,0];Object(u.n)(y,Object(u.m)(x,-.5*a,.5*o),b);const f=[0,0];Object(u.n)(f,Object(u.m)(x,.5*a,-.5*o),b);const _=[0,0];return Object(u.n)(_,Object(u.m)(x,.5*a,.5*o),b),{rings:[[m,f,_,y,m]]}}function q(e,t,i,s,r,n){const a=_.a.getEnvelope(i.data);if(!a)return null;r<.04&&(s=.04*s/r);const o=Object(h.d)(a.width),c=Object(h.d)(a.height),d=Object(h.d)(a.x),l=Object(h.d)(a.y),g=0*O,b=O*n,m=Object(p.d)(j);Object(p.h)(m,m,Object(u.m)(x,e,t)),Object(p.f)(m,m,b-g),Object(p.g)(m,m,Object(u.m)(x,s,s));const y=[0,0];Object(u.n)(y,Object(u.m)(x,d,l+c),m);const f=[0,0];Object(u.n)(f,Object(u.m)(x,d,l),m);const w=[0,0];Object(u.n)(w,Object(u.m)(x,d+o,l+c),m);const S=[0,0];return Object(u.n)(S,Object(u.m)(x,d+o,l),m),{rings:[[y,w,S,f,y]]}}function k(e,t,i,s,r,n){const a=Object(h.d)(i.xoffset),o=Object(h.d)(i.yoffset),c=O*i.angle,d=O*n,l=Object(p.d)(j);Object(p.h)(l,l,Object(u.m)(x,e,t)),Object(p.f)(l,l,d),Object(p.g)(l,l,Object(u.m)(x,r,-r));const g=s[0]+s[2]/2,b=s[1]+s[3]/2;Object(p.h)(l,l,Object(u.m)(x,a,-o)),Object(p.h)(l,l,Object(u.m)(x,g,b)),Object(p.f)(l,l,c),Object(p.h)(l,l,Object(u.m)(x,-g,-b));const m=[0,0];Object(u.n)(m,Object(u.m)(x,s[0],s[1]),l);const y=[0,0];Object(u.n)(y,Object(u.m)(x,s[0],s[1]+s[3]),l);const f=[0,0];Object(u.n)(f,Object(u.m)(x,s[0]+s[2],s[1]),l);const _=[0,0];return Object(u.n)(_,Object(u.m)(x,s[0]+s[2],s[1]+s[3]),l),{rings:[[m,f,_,y,m]]}}function H(e){let t,i,s,n,h,d,l,u,p,g=null;if(!e)return null;if("mesh"===e.type)return e.toJSON();if(t=e.spatialReference,i=Object(r.d)(t),!i)return e.toJSON();s=t.isWebMercator,d=s?102100:4326,n=F[d].maxX,h=F[d].minX,l=F[d].plus180Line,u=F[d].minus180Line;const b=e.toJSON();if(Object(c.f)(b))p=Z(b,n,h);else if(Object(c.e)(b))b.points=b.points.map(e=>Z(e,n,h)),p=b;else if(Object(c.d)(b))p=function(e,t){if(!t)return e;const i=function(e,t){const i=[],{ymin:s,ymax:r}=e,n=e.xmax-e.xmin,a=e.xmin,o=e.xmax;let c;const[h,d]=t.valid;c=L(e.xmin,t);const l=c.x,u=c.frameId;c=L(e.xmax,t);const p=c.x,g=c.frameId,b=l===p&&n>0;if(n>2*d){const e={xmin:a<o?l:p,ymin:s,xmax:d,ymax:r},t={xmin:h,ymin:s,xmax:a<o?p:l,ymax:r},n={xmin:0,ymin:s,xmax:d,ymax:r},c={xmin:h,ymin:s,xmax:0,ymax:r},b=[],m=[];N(e,n)&&b.push(u),N(e,c)&&m.push(u),N(t,n)&&b.push(g),N(t,c)&&m.push(g);for(let i=u+1;i<g;i++)b.push(i),m.push(i);i.push({extent:e,frameIds:[u]},{extent:t,frameIds:[g]},{extent:n,frameIds:b},{extent:c,frameIds:m})}else l>p||b?i.push({extent:{xmin:l,ymin:s,xmax:d,ymax:r},frameIds:[u]},{extent:{xmin:h,ymin:s,xmax:p,ymax:r},frameIds:[g]}):i.push({extent:{xmin:l,ymin:s,xmax:p,ymax:r},frameIds:[u]});return i}(e,t).map(e=>e.extent);return i.length<2?i[0]||e:i.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:i.map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}}(b,i);else if(Object(c.g)(b)||Object(c.h)(b)){const e=w;Object(o.a)(e,b);const t={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},i=V(t.xmin,h)*(2*n),s=0===i?b:function(e,t){const i=function(e){return Object(c.g)(e)?e.rings:e.paths}(e);for(const s of i)for(const e of s)e[0]+=t;return e}(b,i);t.xmin+=i,t.xmax+=i,Object(a.a)(t,l)&&t.xmax!==n||Object(a.a)(t,u)&&t.xmin!==h?g=s:p=s}else p=e.clone();return null!==g?(new W).cut(g,n):p}function D(e){switch(e.symbol.type){case"esriSFS":case"esriPFS":{const t=e.symbol.outline;return t?t.width:0}case"esriSLS":return Object(h.d)(e.symbol.width);case"esriSMS":return Object(h.d)(e.symbol.size);case"esriPMS":return Object(h.d)(Math.max(e.symbol.width,e.symbol.height));case"esriTS":{const t=[0,0,0,0];B(t,e.symbol,e.mosaicItem);const i=Math.max(Math.abs(t[0]),Math.abs(t[1]));return Math.max(t[2],t[3])+i}case"expanded-cim":{const t=_.a.getEnvelope(e.symbol.data);return Object(h.d)(Math.sqrt(t.width*t.width+t.height*t.height))}case"composite-symbol":return e.symbol.layers.length?D({symbol:e.symbol.layers[e.symbol.layers.length-1],mosaicItem:null}):0;case"label":default:return 0}}function B(e,t,i){if(!i||0===i.glyphMosaicItems.length)return e;const s=Object(f.a)(t.text)[1],r=i.glyphMosaicItems,n=Object(y.a)(r,s,{scale:Object(h.d)(t.font.size)/24,angle:t.angle,xOffset:t.xoffset,yOffset:t.yoffset,hAlign:Object(m.d)(t.horizontalAlignment||"center"),vAlign:Object(m.f)(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=Object(h.d)(n.x-n.halfWidth),e[1]=Object(h.d)(n.y-n.halfHeight),e[2]=Object(h.d)(n.width),e[3]=Object(h.d)(n.height),e}const F={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:n.a.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:n.a.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:n.a.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:n.a.WGS84}}};function V(e,t){return Math.ceil((e-t)/(2*t))}function L(e,t){const[i,s]=t.valid,r=2*s;let n,a=0;return e>s?(n=Math.ceil(Math.abs(e-s)/r),e-=n*r,a=n):e<i&&(n=Math.ceil(Math.abs(e-i)/r),e+=n*r,a=-n),{x:e,frameId:a}}function N(e,t){const{xmin:i,ymin:s,xmax:r,ymax:n}=t;return X(e,i,s)&&X(e,i,n)&&X(e,r,n)&&X(e,r,s)}function X(e,t,i){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax}function Z(e,t,i){if(Array.isArray(e)){const s=e[0];if(s>t){const i=V(s,t);e[0]=s+i*(-2*t)}else if(s<i){const t=V(s,i);e[0]=s+t*(-2*i)}}else{const s=e.x;if(s>t){const i=V(s,t);e.x+=i*(-2*t)}else if(s<i){const t=V(s,i);e.x+=t*(-2*i)}}return e}class W{cut(e,t){let i;if(e.rings)this.closed=!0,i=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,i=e.paths,this.minPts=2}const s=i.length,r=-2*t;for(let n=0;n<s;n++){const e=i[n];if(e&&e.length>=this.minPts){const t=[];for(const i of e)t.push([i[0]+r,i[1]]);i.push(t)}}return this.closed?e.rings=i:e.paths=i,e}}},Vh9r:function(e,t,i){"use strict";var s=i("pO5D"),r=i("wSAH"),n=i("srIe"),a=(i("6S2I"),i("zqDF"),i("WbKI")),o=i("04ZG"),c=(i("4EHJ"),i("ju1D"),i("9AIY"),i("9MzC")),h=i("/CmD"),d=i("f4Nx"),l=i("WZb1"),u=i("Mu3I"),p=i("Ehki"),g=i("qatw"),b=i("qRWG"),m=i("kYAx"),y=i("psH3"),f=i("kJYu"),_=i("HsO1"),O=i("jIHu"),j=i("sq/B"),x=i("t7mB"),w=i("ZxoT"),S=i("fZs+"),v=i("KFVX"),I=i("owVx"),G=i("Bcjy"),T=i("Dw8i"),M=i("J3nV"),U=i("2AbE"),z=i("Swtj"),A=i("ZlUD"),C=i("8NDJ"),R=i("Q0oN");class P extends R.a{constructor(e,t){super(e,t,null)}static from(e){const t=C.a.createInstance(),i=[],s=e.filter(e=>!!e.geometry);for(const r of s){const e=Object(g.c)(r.geometry);Object(A.e)(i,[r],e,!1,!1,"uid")}return new P(t,i)}get geometryType(){const e=this._current;return e?e.geometryType:null}readGraphic(){return this._current}getCursor(){return this.copy()}copy(){const e=new P(this.instance,this._features);return this.copyInto(e),e}}var q=i("w5u1"),k=i("yE7X"),H=i("by2V"),D=class extends H.a{get hasLabels(){return!1}get labelsVisible(){return!1}renderChildren(e){this.attributeView.bindTextures(e.context),this.children.some(e=>e.hasData)&&(super.renderChildren(e),e.drawPhase===k.c.MAP&&this._renderChildren(e),e.drawPhase===k.c.HIGHLIGHT&&this._renderHighlight(e))}_renderChildren(e,t){for(const i of this.children)i.isReady&&i.hasData&&(i.commitChanges(e),e.context.setStencilFunction(514,i.stencilRef,255),i._displayList.replay(e,i,t))}_renderHighlight(e){const{painter:t}=e,i=t.effects.highlight;i.bind(e),this._renderChildren(e,i.defines),i.draw(e),i.unbind()}},B=i("M08Z"),F=i("IXLn"),V=i("+NQI"),L=i("gEht"),N=i("qNUd"),X=i("kB+0"),Z=i("V+VG"),W=i("gVKr"),E=i("AIxD");const Y=new W.a,J=new W.a;function Q(e){e.coords.length=0,e.lengths.length=0}class K{constructor(){this.bounds=Object(m.d)(),this.graphic=null,this.size=[0,0,0,0]}static acquire(e=null,t,i,s,r,n){let a;return 0===K._pool.length?a=new K:(a=K._pool.pop(),this._set.delete(a)),a.acquire(e,t,i,s,r,n),a}static release(e){e&&!this._set.has(e)&&(e.release(),this._pool.push(e),this._set.add(e))}static getCentroidQuantized(e,t){if(Object(g.g)(e.geometry)){const i=e.symbol;if(Object(n.g)(i))return null;if(Object(B.g)(i.type)){const i=Object(Z.a)(e.geometry);return Object(E.b)(t,{},{x:i[0],y:i[1]},!1,!1)}}return null}acquire(e=null,t,i,s,r,n){e&&this.set(e,t,i,s,r,n)}release(){this.graphic=null,this.symbolResource=null,this.geometry=null}get symbol(){return this.symbolResource.symbol}set(e,t,i,s,r,n){this.graphic=e,this.geometry=i,this.symbolResource=t,this.updateBounds(s,r,n)}updateBounds(e,t,i){Object(B.a)(this.bounds,this.size,this.symbolResource,this.geometry,e,t,i)}getGeometryQuantized(e){if(Object(g.g)(this.geometry)){const t=this.geometry.rings;if(1===t.length&&2===t[0].length)return Object(E.a)(e,{paths:[[t[0][0],t[0][1]]]})}else if(Object(g.h)(this.geometry))return Q(Y),Q(J),Object(A.h)(Y,this.geometry),Object(A.q)(J,Y,this.geometry.hasZ,this.geometry.hasM,"esriGeometryPolyline",e.scale[0]),Object(A.u)(Y,J,this.geometry.hasZ,this.geometry.hasM,"esriGeometryPolyline",e),Object(A.o)(Y,this.geometry.hasZ,this.geometry.hasM);return Object(E.a)(e,this.geometry)}}K._pool=[],K._set=new Set;var $=K;const ee={minX:0,minY:0,maxX:0,maxY:0},te=Object(m.d)(),ie=[];function se(e,t,i,s,r){return ee.minX=t,ee.minY=i,ee.maxX=s,ee.maxY=r,e.search(ee)}var re=i("pdg3");const ne=e=>{let t=class extends(Object(re.a)(e)){constructor(){super(...arguments),this.graphics=null,this.renderer=null,this.view=null}};return Object(s.a)([Object(a.b)()],t.prototype,"graphics",void 0),Object(s.a)([Object(a.b)()],t.prototype,"renderer",void 0),Object(s.a)([Object(a.b)()],t.prototype,"updating",void 0),Object(s.a)([Object(a.b)()],t.prototype,"view",void 0),t=Object(s.a)([Object(o.a)("esri.views.layers.GraphicsView")],t),t};function ae(e,t,i){if(i.has(e))return i.get(e);const s={tile:t,addedOrModified:[],removed:[]};return i.set(e,s),s}let oe=class extends(ne(Object(f.b)(h.a))){constructor(e){super(e),this._storage=new z.a,this._displayIds=new Map,this._tiles=new Map,this._graphicStoreUpdate=!1,this._graphicsSet=new Set,this._matcher=Object(c.u)(null),this._tileUpdateSet=new Set,this._tilesToUpdate=new Map,this._graphicIdToAbortController=new Map,this._attached=!1,this._highlightIds=new Map,this._updatingGraphicsTimer=null,this._processing=!1,this._needsProcessing=!1,this._pendingUpdate={added:new Set,updated:new Set,removed:new Set},this.lastUpdateId=-1,this.updateRequested=!1,this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this),this._processAnalyzedGraphics=this._processAnalyzedGraphics.bind(this),this._graphicsChangeHandler=this._graphicsChangeHandler.bind(this)}_createMatcher(e,t){if(e){const i=Object(I.a)({indexCount:0,fields:{}},"feature",e);this._matcher=Object(G.a)(i,t,null)}}_createDisplayId(e){return this._displayIds.has(e)||this._displayIds.set(e,this._storage.createDisplayId()),this._displayIds.get(e)}initialize(){this._tileStore=new q.a(this.view.featuresTilingScheme),this.container=new D(this.view.featuresTilingScheme),this._attributeStore=new U.a({type:"local",initialize:e=>Object(c.u)(this.container.attributeView.initialize(e)),update:e=>this.container.attributeView.requestUpdate(e),render:()=>this.container.requestRender()},Object(j.a)()),this._graphicStore=new class{constructor(e,t,i,s,n,a){this._graphics=s,this._onAdd=n,this._onRemove=a,this._index=Object(X.a)(9,Object(r.a)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this._itemByGraphic=new Map,this._currentLevel=-1/0,this._tileInfoView=e,this._uidFieldName=i;const o=e.getClosestInfoForScale(t);o&&(this._currentLevel=o.level,this._resolution=this._tileInfoView.getTileResolution(o.level)),this._metersPerUnit=Object(L.b)(e.spatialReference)}hitTest(e,t,i,s,r){e=Object(N.b)(e,this._tileInfoView.spatialReference);const n=.5*s*i;te[0]=e-n,te[1]=t-n,te[2]=e+n,te[3]=t+n;const a=.5*s*(i+50),o=se(this._index,e-a,t-a,e+a,t+a);if(!o||0===o.length)return[];const c={x:e,y:t},h=[];let d;for(const l of o)if(l.graphic.visible)switch(Object(g.c)(l.geometry)){case"esriGeometryPoint":{const e=l.symbol;if(!e)continue;const t=l.geometry,{x:i,y:n}=t,a=s*this._metersPerUnit;let o;switch(e.type){case"esriTS":o=Object(B.d)(i,n,e,l.size,s,r);break;case"expanded-cim":o=Object(B.b)(i,n,e,s,a,r);break;case"esriSMS":case"esriPMS":o=Object(B.c)(i,n,e,s,a,r)}Object(F.g)(o,c)&&h.push(l)}break;case"esriGeometryPolyline":{const i=l.symbol;if(!i||!i.layers.length)continue;const r=i.layers[0];d=1.5*s*window.devicePixelRatio*Object(b.d)(r.width),Object(B.h)(l.geometry,e,t,d)&&h.push(l)}break;case"esriGeometryEnvelope":{const e=l.geometry,t=Object(m.i)(e.xmin,e.ymin,e.xmax,e.ymax);Object(m.k)(t,te)&&h.push(l);break}case"esriGeometryPolygon":{if(Object(F.g)(l.geometry,c)){h.push(l);break}const e=Object(V.b)(l.geometry);if(Math.abs(e.ymax-e.ymin)<5*s||Math.abs(e.xmax-e.xmin)<5*s){const t=Object(m.i)(e.xmin,e.ymin,e.xmax,e.ymax);Object(m.k)(t,te)&&h.push(l)}break}case"esriGeometryMultipoint":{const e=l.symbol;if(!e)continue;const t=l.geometry.points;let i;for(let n=0;n<t.length;n++)if(i="esriTS"===e.type?Object(B.d)(t[n][0],t[n][1],e,l.size,s,r):Object(B.c)(t[n][0],t[n][1],e,s,s*this._metersPerUnit,r),Object(F.g)(i,c)){h.push(l);break}break}}return h.sort((e,t)=>{const i=Object(B.f)(e.graphic),s=Object(B.f)(t.graphic);return i===s?t.zorder-e.zorder:i-s}),h.map(e=>e.graphic)}getGraphicsData(e,t,i){const s=se(this._index,t.bounds[0],t.bounds[1],t.bounds[2],t.bounds[3]);if(0===s.length||0===i.length)return[];s.sort((e,t)=>e.zorder-t.zorder),s[0].insertAfter=-1;for(let h=1;h<s.length;h++)s[h].insertAfter=s[h-1].graphic.uid;s.sort((e,t)=>e.graphic.uid-t.graphic.uid),i.sort((e,t)=>e.uid-t.uid);let r,n=0,a=0;const o=[],c={originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[t.bounds[0],t.bounds[3]]};for(const h of i){for(a=-2;n<s.length;)if(r=s[n],n++,h.uid===r.graphic.uid){a=r.insertAfter;break}if(!r.geometry||-2===a)continue;const t=r.getGeometryQuantized(c),i={...r.graphic.attributes};i[this._uidFieldName]=h.uid,null==r.groupId&&(r.groupId=e.createTemplateGroup(r.symbol,null)),o.push({centroid:$.getCentroidQuantized(r,c),geometry:t,attributes:i,symbol:r.symbol,groupId:r.groupId,insertAfter:a,zorder:r.zorder})}return o.sort((e,t)=>e.zorder-t.zorder),o}queryTileData(e,t){const i=50*t.resolution,s=Object(m.l)(t.bounds,i,Object(m.d)()),r=se(this._index,s[0],s[1],s[2],s[3]),n=[];return this._createTileGraphics(n,e,r,{originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[t.bounds[0],t.bounds[3]]}),n}has(e){return this._itemByGraphic.has(e)}getBounds(e){return this._itemByGraphic.has(e)?this._itemByGraphic.get(e).bounds:null}addOrModify(e,t,i){if(!e)return;this.has(e)&&this.remove(e),this._onAdd(e);const s=$.acquire(e,t,i,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference);return this._itemByGraphic.set(e,s),i&&this._index.insert(s),s.bounds}remove(e){if(!this._itemByGraphic.has(e))return;this._onRemove(e);const t=this._itemByGraphic.get(e);this._index.remove(t),this._itemByGraphic.delete(e)}updateZ(){const e=this._graphics.items;let t,i;for(let s=0;s<e.length;s++)i=e[s],t=this._itemByGraphic.get(i),t&&(t.zorder=s)}update(e,t,i){const s=this._itemByGraphic.get(e);s.groupId=null;const r=Object(m.b)(s.bounds);return s.size[0]=s.size[1]=0,this._index.remove(s),s.set(e,t,i,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference),i&&this._index.insert(s),{oldBounds:r,newBounds:s.bounds}}updateLevel(e){if(this._currentLevel===e)return;this._currentLevel=e;const t=this._tileInfoView.getTileResolution(e);this._resolution=t,this._index.clear(),ie.length=0,this._itemByGraphic.forEach(e=>{e.updateBounds(this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference),e.geometry&&ie.push(e)}),this._index.load(ie)}clear(){this._itemByGraphic.clear(),this._index.clear()}_createTileGraphics(e,t,i,s){const r=this._uidFieldName;let n,a,o,c;i.sort((e,t)=>e.zorder-t.zorder);for(let h=0;h<i.length;h++){o=i[h],n=o.graphic,a=o.getGeometryQuantized(s),c=0===h?-1:i[h-1].graphic.uid;const d={...o.graphic.attributes};d[r]=n.uid,null==o.groupId&&(o.groupId=t.createTemplateGroup(o.symbol,null)),e.push({centroid:$.getCentroidQuantized(o,s),geometry:a,attributes:d,symbol:o.symbol,groupId:o.groupId,insertAfter:c,zorder:o.zorder})}}}(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,e=>{this._createDisplayId(e.uid),this._setFilterState(e.uid,e.visible)},e=>{const t=this._displayIds.get(e.uid);this._displayIds.delete(e.uid),this._storage.releaseDisplayId(t)});const e=new T.a(this.container.getMaterialItems.bind(this.container),!0);this._createMatcher(this.renderer,e),this._meshFactory=new M.a(null,this.uid,e),this._templateStore=e,this.watch("renderer",t=>{this._createMatcher(t,e);for(const e of this.graphics)this._pendingUpdate.updated.add(e);this.requestUpdate()}),this._tileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",()=>{this.graphics.items.length>0&&this._graphicsChangeHandler({target:this.graphics,added:this.graphics.items,removed:[],moved:[]}),this.handles.add(this.graphics.on("change",this._graphicsChangeHandler),"graphics"),this._attached=!0,this.notifyChange("updating")})}destroy(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating")),this.container.destroy(),this._set("graphics",null),this._graphicStore.clear(),this._tileStore.destroy(),this._attributeStore=null}get updating(){return!this._attached||null!==this._updatingGraphicsTimer||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0}hitTest(e,t){if(!this.view||!this.view.position)return Object(c.u)();const i=this.view.toMap(Object(b.b)(e,t));return this.searchFeatures(i).then(e=>e&&e.length?e[0]:null)}async searchFeatures(e,t=2){return this._graphicStore.hitTest(e.x,e.y,t,this.view.state.resolution,this.view.state.rotation)}update(e){const t=e.state,i=this.view.featuresTilingScheme.getClosestInfoForScale(t.scale).level;if(this._graphicStore.updateLevel(i),this._tileStore.setViewState(t),this._graphicStoreUpdate=!0,this.updateRequested=!1,this._pendingUpdate.updated.size>0){if(!this._processing)return void this._updateGraphics();this._needsProcessing=!0}}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}processUpdate(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}graphicUpdateHandler(e){const{graphic:t,property:i,newValue:s}=e,r=t;switch(i){case"attributes":break;case"geometry":case"symbol":this._pendingUpdate.updated.add(r),this.requestUpdate();break;case"visible":this._setFilterState(r.uid,s),this._attributeStore.sendUpdates()}}addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight()}removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight()}_updateHighlight(){const e=Array.from(this._highlightIds.keys()),t=e.map(e=>this._displayIds.get(e));this._attributeStore.setHighlight(e,t)}_getIntersectingTiles(e){const t=this._graphicStore.getBounds(e);return t&&0!==Object(m.o)(t)&&0!==Object(m.j)(t)?this._tileStore.boundsIntersections(t):[]}_updateTile(e){const t=e.tile,i=this._getGraphicsData(this._templateStore,t,e.addedOrModified);return this._processGraphics(i).then(i=>(this._patchTile(t.key,{type:"update",addOrUpdate:i,remove:e.removed,end:!0}),i))}_patchTile(e,t){if(!this._tiles.has(e))return;const i=this._tiles.get(e);this.container.onTileData(i,t),this.container.requestRender()}_graphicsChangeHandler(e){for(const t of e.added)this._pendingUpdate.added.add(t);for(const t of e.moved)this._pendingUpdate.added.add(t);for(const t of e.removed)this._pendingUpdate.added.has(t)?this._pendingUpdate.added.delete(t):this._pendingUpdate.removed.add(t);this._processing?this._needsProcessing=!0:this._updateGraphics()}_getGraphicsToUpdate(){const e={added:[],removed:[],updated:[]},t=this._pendingUpdate;for(const i of this.graphics.items)t.added.has(i)?e.added.push(i):t.updated.has(i)&&e.updated.push(i);for(const i of t.removed)this._graphicStore.has(i)&&e.removed.push(i);return t.added.clear(),t.removed.clear(),t.updated.clear(),e}async _updateGraphics(){this._processing=!0;const{added:e,removed:t,updated:i}=this._getGraphicsToUpdate(),s=this._tilesToUpdate;let r;try{if(!this._graphicStoreUpdate){const e=this.view.state,t=this.view.featuresTilingScheme.getClosestInfoForScale(e.scale).level;this._graphicStore.updateLevel(t),this._tileStore.setViewState(e)}const n=[],a=new Array(e.length+t.length);for(let e=0;e<i.length;e++){const t=i[e],o=this._getIntersectingTiles(t);for(const e of o)r=e.id,ae(r,e,s).removed.push(this._displayIds.get(t.uid));n.push(this._updateGraphic(t,null)),a[e]=t}const o=i.length;for(let t=0;t<e.length;t++){const i=e[t];a[o+t]=i,this._graphicsSet.add(i),n.push(this.addGraphic(i))}for(const e of t){this._abortProcessingGraphic(e.uid);const t=this._getIntersectingTiles(e);for(const i of t)r=i.id,ae(r,i,s).removed.push(this._displayIds.get(e.uid));this._graphicsSet.delete(e),this._graphicStore.remove(e)}let h;this._flipUpdatingGraphics(),await Object(c.b)(n);for(let e=0;e<a.length;e++){h=a[e];const t=this._getIntersectingTiles(h);for(const e of t)r=e.id,ae(r,e,s).addedOrModified.push(h)}this._graphicStore.updateZ();const d=[];for(const[e,t]of s)d.push(this._updateTile(t));await Object(c.b)(d)}catch(e){}s.clear(),this.notifyChange("updating"),this._processing=!1,this._needsProcessing&&(this._needsProcessing=!1,this._updateGraphics())}_getArcadeInfo(e){const t=(e.attributes?Object.keys(e.attributes):[]).map(t=>({name:t,alias:t,type:"string"==typeof e.attributes[t]?"esriFieldTypeString":"esriFieldTypeDouble"}));return Object(n.g)(e.geometry)?null:{geometryType:Object(g.c)(e.geometry),spatialReference:l.a.fromJSON(e.geometry.spatialReference),fields:t}}async _getSymbolForGraphic(e,t){return Object(n.h)(e.symbol)?e.symbol:Object(n.h)(this.renderer)?this.renderer.getSymbolAsync(e,{scale:this.view.scale,abortOptions:t}):this._getNullSymbol(e)}async _getSymbolResources(e,t){if(!this.container.stage)return Object(c.u)(null);const i=this._getArcadeInfo(e),s=await this._getSymbolForGraphic(e,t),r=Object(I.c)(s),n=await Object(w.a)(r,i,t);if("esriTS"===n.type){const e=[],[t]=Object(x.a)(n.text);for(let r=0;r<t.length;r++)e.push(t.charCodeAt(r));const i={symbol:n,id:0,glyphIds:e},[{mosaicItem:s}]=await this.container.getMaterialItems([i]);return{symbol:n,mosaicItem:s}}return{symbol:n,mosaicItem:null}}async _projectAndNormalizeGeometry(e){if(Object(n.g)(e.geometry))return Object(c.u)(null);let t=e.geometry;return Object(g.g)(t)?t.rings=t.rings:Object(g.h)(t)?t.paths=t.paths:Object(g.d)(t)&&(t=p.a.fromExtent(t)),Object(_.a)(t.spatialReference,this.view.spatialReference).then(()=>{const e=Object(B.i)(t),i=Object(_.b)(e,t.spatialReference,this.view.spatialReference);return Object(u.a)(i),i})}_onTileUpdate(e){const t=Object(d.d)(this.view.spatialReference);if(e.added&&e.added.length>0)for(const i of e.added)this._addNewTile(i,t);if(e.removed&&e.removed.length>0)for(const i of e.removed)this._removeTile(i.key)}addGraphic(e){this._abortProcessingGraphic(e.uid);const t=Object(c.d)();return this._graphicIdToAbortController.set(e.uid,t),this._addOrUpdateGraphic(e,{signal:t.signal}).then(()=>{this._graphicIdToAbortController.delete(e.uid)}).catch(t=>{if(this._graphicIdToAbortController.delete(e.uid),!Object(c.n)(t))throw t})}async _updateGraphic(e,t){const i=this._projectAndNormalizeGeometry(e),s=this._getSymbolResources(e,t),[r,n]=await Object(c.b)([i,s]);this._graphicStore.addOrModify(e,n,r)}async _addOrUpdateGraphic(e,t){const i=this._projectAndNormalizeGeometry(e),s=this._getSymbolResources(e,t);try{const[t,r]=await Object(c.b)([i,s]);this._addProjectedGraphic(e,r,t)}catch(e){if(!Object(c.n)(e))throw e}}_addProjectedGraphic(e,t,i){this._graphicsSet.has(e)&&this._graphicStore.addOrModify(e,t,i)}_addTile(e){const t=Object(m.d)();this.view.featuresTilingScheme.getTileBounds(t,e);const i=new v.a(e,t,!0);return this._tiles.set(e,i),this.container.addChild(i),i}_addNewTile(e,t){const i=this._addTile(e.key),s=this._graphicStore.queryTileData(this._templateStore,e);if(t){const i=Math.round((t.valid[1]-t.valid[0])/e.resolution);for(const e of s)e.geometry&&Object(g.f)(e.geometry)&&this._wrapPoints(e,i)}const r=e.key;this._tileUpdateSet.add(e.key),this.notifyChange("updating"),this._processGraphics(s).then(e=>{i.setData({type:"update",clear:!0,addOrUpdate:e,remove:[],end:!0}),this._tileUpdateSet.delete(r),this.notifyChange("updating")}).catch(e=>{if(this._tileUpdateSet.delete(r),this.notifyChange("updating"),!Object(c.n)(e))throw e})}_removeTile(e){if(!this._tiles.has(e))return;const t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}_setFilterState(e,t){const i=this._displayIds.get(e),s=this._attributeStore.getHighlightFlag(e);this._attributeStore.setData(i,0,0,s|(t?O.i:0))}_getGraphicsData(e,t,i){const s=Object(d.d)(this.view.spatialReference),r=this._graphicStore.getGraphicsData(e,t,i);if(s){const e=Math.round((s.valid[1]-s.valid[0])/t.resolution);for(const t of r)t.geometry&&Object(g.f)(t.geometry)&&this._wrapPoints(t,e)}return r}_wrapPoints(e,t){const i=e.geometry;512===t?i.x<20?e.geometry={points:[[i.x,i.y],[t,0]]}:i.x>492&&(e.geometry={points:[[i.x,i.y],[-t,0]]}):i.x<-20?e.geometry={points:[[i.x,i.y],[t,0]]}:i.x>532&&(e.geometry={points:[[i.x,i.y],[-t,0]]})}async _processGraphics(e,t){if(!e||!e.length||!this._meshFactory)return null;const i=P.from(e),s=this._meshFactory;return await s.analyzeGraphics(i,await this._matcher,null,null,t),this._attributeStore.sendUpdates(),this._processAnalyzedGraphics(i)}_processAnalyzedGraphics(e){const t=this._meshFactory,i=t.createMeshData(e.getApproximateSize()),s=e.getCursor();for(;s.next();){const e=s.readGraphic();e.insertAfter=-1===e.insertAfter?-1:this._displayIds.get(e.insertAfter),e.displayId=this._displayIds.get(e.attributes[this.uid]),t.writeGraphic(i,s)}const r={};return i.encode(r,[]),S.a.decode(r)}_abortProcessingGraphic(e){this._graphicIdToAbortController.has(e)&&this._graphicIdToAbortController.get(e).abort()}_getNullSymbol(e){const t=e.geometry;return Object(g.h)(t)?y.d:Object(g.g)(t)||Object(g.d)(t)?y.c:y.b}_flipUpdatingGraphics(){this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout(()=>{this._updatingGraphicsTimer=null,this.notifyChange("updating")},160),this.notifyChange("updating")}};Object(s.a)([Object(a.b)({constructOnly:!0})],oe.prototype,"requestUpdateCallback",void 0),Object(s.a)([Object(a.b)({constructOnly:!0})],oe.prototype,"graphics",void 0),Object(s.a)([Object(a.b)()],oe.prototype,"updating",null),Object(s.a)([Object(a.b)()],oe.prototype,"view",void 0),Object(s.a)([Object(a.b)()],oe.prototype,"updateRequested",void 0),oe=Object(s.a)([Object(o.a)("esri.views.2d.layers.support.GraphicsView2D")],oe),t.a=oe}}]);